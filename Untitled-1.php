<?php
date_default_timezone_set('Asia/Dhaka');
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/users_right.php';
include 'include/pop_security.php';
include 'include/functions.php';



?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SYSTEM</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php
        $page_title = 'Welcome To Dashboard';
        include 'Header.php';
        ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-md-6 col-sm-12">
                            <!-- New Request -->
                            <a href="con_request.php" class="btn btn-warning  mb-1">   <i class="fas fa-user-clock"></i> New Request
                                <?php
                                if ($allCstmr = $con->query('SELECT * FROM customer_request WHERE status=0')) {
                                    if ($allCstmr->num_rows > 0) {
                                        echo '<span class="badge rounded-pill bg-danger float-end">' . $allCstmr->num_rows . '<span>';
                                    } else {

                                    }
                                }
                                
                                ?>
                            </a>
                            <!-- Add Customer -->
                            <button type="button" data-bs-toggle="modal" data-bs-target="#addCustomerModal"
                                class=" btn btn-success mb-1">  <i class="fas fa-user-plus"></i> Add
                                Customer</button>

                            <!-- Recharge Now -->
                            <button type="button" data-bs-toggle="modal" data-bs-target="#addRechargeModal"
                                class="btn btn-primary mb-1">
                                <i class="fas fa-bolt"></i> Recharge Now
                            </button>

                           
                            <button type="button" data-bs-toggle="modal" data-bs-target="#ticketModal"
                            class="btn btn-success mb-1"> <i class="fas fa-ticket-alt"></i> Add Ticket</button>
                            

                            <button type="button" id="addSmsBtn" class="btn btn-primary text-blue mb-1">  <i class="fas fa-envelope"></i> SMS Notification</button>

                          
                        </div>
                        <div class="col-md-6 col-sm-12">
                            <div class="d-flex flex-wrap justify-content-md-end justify-content-center align-items-center gap-3 p-2 bg-light ">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-clock text-primary me-1"></i>
                                    <!-- <strong class="text-dark">Date And Time:</strong> -->
                                    <span class="text-info ms-1">
                                        <?php 
                                       $dbtime = $con->query('SELECT NOW() AS dbtime');
                                       $rowd = $dbtime->fetch_assoc();
                                       echo date_format(date_create($rowd['dbtime']), 'd M, Y h:i A'); 
                                      
                                        ?>
                                    </span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-hourglass-half text-warning me-1"></i>
                                    <strong class="text-dark">Uptime:</strong>
                                    <span class="text-info ms-1">
                                        <?php 
                                        $exec_uptime = preg_split('/[\s]+/', trim(shell_exec('uptime')));
                                        echo $uptime = $exec_uptime[2] . ' Days';
                                        
                                        ?>
                                    </span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-database text-success me-1"></i>
                                    <strong class="text-dark">DB Sync:</strong>
                                    <span class="text-info ms-1">
                                        <?php 
                                        $cronupdt = $con->query('SELECT * FROM cron');
                                        $rowcron = $cronupdt->fetch_assoc();

                                        //echo date_format(date_create($rowcron['date']), 'd M, Y h:i A'); 
                                        echo timeAgo($rowcron['date']);
                                        
                                        ?>
                                    </span>
                                </div>
                            </div>
                        </div>


                    </div>
                    <div class="row">

                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?online=1">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-primary me-0 float-end"><i
                                                    class="fas fa-user-check"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-primary">
                                                    <?php
                                                    if ($onlinecstmr = $con->query('SELECT * FROM radacct WHERE acctstoptime IS NULL')) {
                                                        echo $onlinecst = $onlinecstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                <img src="images/icon/online.png" height="10"
                                                    width="10" />&nbsp;Online
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->



                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?offline=1">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-secondary me-0 float-end"><i
                                                    class="fas fa-user-times"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-muted">
                                                    <?php
                                                    if ($offline_customer = $con->query("SELECT * FROM customers WHERE status='1' AND username NOT IN(SELECT username FROM radacct WHERE acctstoptime IS NULL AND acctterminatecause='')")) {
                                                        echo $total_offline_customer = $offline_customer->num_rows;
                                                    }
                                                    
                                                    ?>
                                                </span>
                                                <img src="images/icon/disabled.png" height="10"
                                                    width="10" />&nbsp;Offline
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->


                        <div class="col">
                            <a href="customers_new.php?active=1">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-success me-0 float-end"><i
                                                    class="fas fa-users"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-success">
                                                    <?php
                                                    if ($totalCustomer = $con->query("SELECT * FROM customers WHERE status='1'")) {
                                                        echo $totalcstmr = $totalCustomer->num_rows;
                                                    }
                                                    
                                                    ?>
                                                </span>
                                                Active Customers
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div> <!--End col -->

                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?expired=1">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-danger me-0 float-end"><i
                                                    class="fas fa-user-clock"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-secondary">
                                                    <?php if ($AllExcstmr = $con->query('SELECT * FROM `customers` WHERE  NOW() > expiredate')) {
                                                        echo $AllExcstmr->num_rows;
                                                    }
                                                    
                                                    ?>
                                                </span>
                                                Expired
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?disabled=1">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-brown me-0 float-end"><i
                                                    class="fas fa-user-lock"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php if ($dsblcstmr = $con->query("SELECT * FROM customers WHERE status='0'")) {
                                                        echo $dsblcstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Disabled
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div><!--end col -->
                        <div class="col">
                            <div class="card">
                                <a href="con_request.php">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-warning me-0 float-end"><i
                                                    class="fas fa-user-plus"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-secondary">
                                                    <?php if ($requestcst = $con->query("SELECT * FROM customer_request WHERE status='0'")) {
                                                        echo $requestcst->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Request
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div><!--end col -->
                    </div> <!-- end row-->



                    <!-- New Row-->
                    <div class="row">

                        <div class="col-md-6 col-xl-3">
                            <div class="card">
                                <div class="card-body">
                                    <a href="pop_branch.php">
                                        <div class="mini-stat">

                                            <span class="mini-stat-icon bg-brown me-0 float-end"><i
                                                    class="fas fa-project-diagram"></i></span>
                                            <div class="mini-stat-info">

                                                <span class="counter text-brown">
                                                    <?php
                                                    if ($data = $con->query('SELECT * FROM add_pop')) {
                                                        echo $data->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                POP/Branch
                                                <br>
                                                <img src="images/icon/online.png" height="10"
                                                    width="10" />&nbsp;Online
                                                <?php
                                                $popCounts = get_count_pop_and_area_with_online_and_offline($con, 'add_pop', 'pop');
                                                echo $popCounts['online'];
                                                ?>

                                                <br>
                                                <img src="images/icon/disabled.png" height="10"
                                                    width="10" />&nbsp;Offline
                                                <?php
                                                echo $popCounts['offline'];
                                                ?>



                                            </div>
                                        </div>
                                </div></a>
                            </div>
                        </div> <!-- End col -->

                        <div class="col-md-6 col-xl-3">

                            <div class="card">
                                <div class="card-body">
                                    <a href="pop_area.php">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-teal me-0 float-end"><i
                                                    class="fas fa-search-location"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-teal">
                                                    <?php if ($totalCustomer = $con->query('SELECT * FROM area_list')) {
                                                        echo $totalCustomer->num_rows;
                                                    }
                                                    
                                                    ?>
                                                </span>
                                                Area
                                                <br>
                                                <img src="images/icon/online.png" height="10"
                                                    width="10" />&nbsp;Online
                                                <?php
                                                $popCounts = get_count_pop_and_area_with_online_and_offline($con, 'area_list', 'area');
                                                echo $popCounts['online'];
                                                ?>

                                                <br>
                                                <img src="images/icon/disabled.png" height="10"
                                                    width="10" />&nbsp;Offline
                                                <?php
                                                echo $popCounts['offline'];
                                                ?>



                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                        </div> <!--End col -->





                        <div class="col-md-6 col-xl-3">
                            <div class="card">
                                <a href="allTickets.php">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-success me-0 float-end"><i
                                                    class="fas fa-ticket-alt"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php if ($dsblcstmr = $con->query('SELECT * FROM ticket')) {
                                                        echo $dsblcstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Tickets
                                                <br> <img src="images/icon/online.png" height="10"
                                                    width="10" />&nbsp;Completed <?php echo get_ticket_count($con, 'Complete'); ?> <br> <img
                                                    src="images/icon/disabled.png" height="10"
                                                    width="10" />&nbsp;Incompleted <?php echo get_ticket_count($con, 'Active'); ?>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                        <div class="col-md-6 col-xl-3">
                            <div class="card">
                                <a href="nas.php">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-purple me-0 float-end"><i
                                                    class="fas fa-network-wired"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-teal">
                                                    <?php if ($dsblcstmr = $con->query('SELECT * FROM nas')) {
                                                        echo $dsblcstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Routers
                                                <br> <img src="images/icon/online.png" height="10"
                                                    width="10" />&nbsp;Online <?php echo 0; ?> <br> <img
                                                    src="images/icon/disabled.png" height="10"
                                                    width="10" />&nbsp;Offline <?php echo 0; ?>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div><!--end col -->
                    </div> <!-- end row-->


                    <div class="row">

                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-header bg-white text-black d-flex justify-content-between align-items-center">
                                    <h4 class="card-title">POP/Branch</h4>
                                    <a href="pop_branch.php" class="btn btn-light border-0 p-0">
                                    <i class="fas fa-arrows-alt"></i>

                                    </a>
                                </div>

                                <div class="card-body">
                                    <table class="table table-bordered dt-responsive nowrap"
                                        style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>POP Name</th>
                                                <th>Total</th>
                                                <th><img src="images/icon/online.png" height="10"
                                                        width="10" /> Online</th>
                                                <th><img src="images/icon/expired.png" height="10"
                                                        width="10" /> Expired</th>
                                                <th><img src="images/icon/disabled.png" height="10"
                                                        width="10" /> Disabled</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php
                                            $sql = "SELECT * FROM add_pop LIMIT 9";
                                            $result = mysqli_query($con, $sql);

                                            while ($rows = mysqli_fetch_assoc($result)) {
                                                $pop_ID = $rows['id'];
                                            ?>

                                            <tr>
                                                <td><?php echo $rows['id']; ?></td>
                                                <td><a
                                                        href="view_pop.php?id=<?php echo $pop_ID; ?>"><?php echo $rows['pop']; ?></a>
                                                </td>
                                                <td>
                                                    <?php
                                                    
                                                    $sql = "SELECT * FROM customers WHERE pop='$pop_ID'";
                                                    $countpopusr = mysqli_query($con, $sql);
                                                    
                                                    echo $countpopusr->num_rows;
                                                    
                                                    ?>

                                                </td>
                                                <td>
                                                    <?php
                                                    
                                                    $sql = "SELECT radacct.username FROM radacct
                                                                                                                INNER JOIN customers
                                                                                                                ON customers.username=radacct.username
                                                                                                                
                                                                                                                WHERE customers.pop='$pop_ID' AND radacct.acctstoptime IS NULL";
                                                    $countpoponlnusr = mysqli_query($con, $sql);
                                                    
                                                    echo $countpoponlnusr->num_rows;
                                                    
                                                    ?>

                                                </td>
                                                <td>
                                                    <?php
                                                    $sql = "SELECT * FROM customers WHERE pop='$pop_ID' AND NOW() > expiredate";
                                                    $countxprd = mysqli_query($con, $sql);
                                                    $totalexprs = $countxprd->num_rows;
                                                    if ($totalexprs == 0) {
                                                        echo $totalexprs;
                                                    } else {
                                                        echo "<span class='badge bg-danger'>$totalexprs</span>";
                                                    }
                                                    
                                                    //
                                                    
                                                    ?>
                                                </td>

                                                <td>
                                                    <?php
                                                    $disableQ = "SELECT * FROM customers WHERE pop='$pop_ID' AND status='0'";
                                                    $countdsbld = mysqli_query($con, $disableQ);
                                                    $totaldsbld = $countdsbld->num_rows;
                                                    if ($totaldsbld == 0) {
                                                        echo $totaldsbld;
                                                    } else {
                                                        echo "<span class='badge bg-danger'>$totaldsbld</span>";
                                                    }
                                                    
                                                    //
                                                    
                                                    ?>
                                                </td>

                                            </tr>
                                            <?php } ?>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6">
                            <div class="card">
                                <div class="card-header bg-white text-black">
                                    <h4 class="card-title">Tickets</h4>
                                    <button style="float: right;">
                                        <a href="allTickets.php">+</a>
                                    </button>
                                    <?php
                                    $badge_colors = ['bg-primary', 'bg-purple', 'bg-success', 'bg-warning'];
                                    $color_index = 0;
                                    $is_first = true;
                                    
                                    if ($get_best_area = $con->query('SELECT area_id, COUNT(*) AS ticket_count FROM ticket GROUP BY area_id ORDER BY ticket_count DESC LIMIT 5')) {
                                        while ($rows = $get_best_area->fetch_assoc()) {
                                            $area_id = $rows['area_id'];
                                            $ticket_count = $rows['ticket_count'];
                                            $area_name_result = $con->query("SELECT name FROM area_list WHERE id = $area_id");
                                    
                                            if ($area_name_result && ($area_row = $area_name_result->fetch_assoc())) {
                                                $area_name = $area_row['name'];
                                    
                                                if ($is_first) {
                                                    echo '<span class="badge bg-danger me-2">' . htmlspecialchars($area_name) . ' (' . $ticket_count . ')</span>';
                                                    $is_first = false;
                                                } else {
                                                    echo '<span class="badge ' . $badge_colors[$color_index] . ' me-2">' . htmlspecialchars($area_name) . ' (' . $ticket_count . ')</span>';
                                                    $color_index++;
                                                }
                                            } else {
                                                echo '<span class="badge bg-secondary me-2">Unknown (' . $ticket_count . ')</span>';
                                            }
                                            if ($color_index >= count($badge_colors)) {
                                                $color_index = 0;
                                            }
                                        }
                                    } else {
                                        echo '<span class="badge bg-danger">Error fetching areas</span>';
                                    }
                                    ?>
                                </div>



                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table id="tickets_table" class="table table-bordered dt-responsive nowrap">
                                            <thead>
                                                <tr>
                                                    <th>Status</th>
                                                    <th>Created</th>
                                                    <th>Customer Name</th>
                                                    <th>Issues</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="ticket-list">
                                                <?php
                                                $sql = "SELECT * FROM `ticket` ORDER BY id DESC limit 5";
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {

                                                ?>

                                                <tr>

                                                    <td>
                                                        <?php 
                                                            $ticketType = $rows["ticket_type"];
                                                            
                                                            if ($ticketType === "Complete"): ?>

                                                        <a href="tickets_profile.php?id=<?php echo $rows['id']; ?>">
                                                            <span class="badge bg-success">Completed</span>
                                                        </a>
                                                        <?php elseif ($ticketType === "Active"): ?>

                                                        <a href="tickets_profile.php?id=<?php echo $rows['id']; ?>">
                                                            <span class="badge bg-danger">Active</span>
                                                        </a>
                                                        <?php elseif ($ticketType === "Close"): ?>

                                                        <a href="tickets_profile.php?id=<?php echo $rows['id']; ?>">
                                                            <span class="badge bg-success">Close</span>
                                                        </a>
                                                        <?php else: ?>
                                                        <a
                                                            href="tickets_profile.php?id=<?php echo $rows['id']; ?>"><?php echo $ticketType; ?></a>
                                                        <?php endif; ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $startdate = $rows['startdate'];
                                                        echo timeAgo($startdate);
                                                        ?>

                                                    </td>
                                                    <td>
                                                        <?php
                                                        $customer_id = $rows['customer_id'];
                                                        $customer = $con->query("SELECT * FROM customers WHERE id=$customer_id ");
                                                        while ($stmr = $customer->fetch_array()) {
                                                            $cstmrID = $stmr['id'];
                                                            $username = $stmr['username'];
                                                            $cstmr_fullname = $stmr['fullname'];
                                                            $cstmr_area = $stmr['area'];
                                                        }
                                                        
                                                        // Area name
                                                        $customerArea = $con->query("SELECT * FROM area_list WHERE id=$cstmr_area");
                                                        while ($stmrAr = $customerArea->fetch_array()) {
                                                            $stmrAria = $stmrAr['name'];
                                                        }
                                                        ?>

                                                        <?php
                                                        
                                                        $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$username'");
                                                        $chkc = $onlineusr->num_rows;
                                                        if ($chkc == 1) {
                                                            echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                                                        } else {
                                                            echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';
                                                        }
                                                        
                                                        ?>


                                                        <a href="profile.php?clid=<?php echo $cstmrID; ?>"
                                                            target="_blank"> <?php echo $cstmr_fullname; ?></a>

                                                        </br>
                                                        <span class=" fas fa-map-marker-alt text-muted"><i>
                                                                <?php echo $stmrAria; ?></i></span>
                                                    </td>

                                                    </td>
                                                    <td>
                                                        <?php
                                                        $complain_typeId = $rows['complain_type'];
                                                        if ($allCom = $con->query("SELECT * FROM ticket_topic WHERE id='$complain_typeId' ")) {
                                                            while ($rowss = $allCom->fetch_array()) {
                                                                echo $rowss['topic_name'];
                                                            }
                                                        }
                                                        ?>
                                                    </td>
                                                    <td>

                                                        <a class="btn-sm btn btn-success"
                                                            href="tickets_profile.php?id=<?php echo $rows['id']; ?>"><i
                                                                class="fas fa-eye"></i>
                                                        </a>


                                                    </td>
                                                </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            <!------------ ------------->
















                            <!---------------------->
                        </div>






                    </div>
                    <!-- end row -->



                    <div class="row">
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Ticket Statics 10 Days</h4>


                                    <div class="row text-center mt-4">
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Tickets</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Complete' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Resolved</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Active' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate">Pending</p>
                                        </div>

                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Close' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate danger">Closed</p>
                                        </div>

                                    </div>

                                    <div id="chart" dir="ltr"></div>





                                </div>
                            </div>
                        </div>


                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">

                                    <h4 class="card-title mb-4">Customer Statics</h4>

                                    <div class="row text-center mt-4">
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18"></h5>
                                            <p class="text-muted text-truncate">New</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18"></h5>
                                            <p class="text-muted text-truncate">Expired</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18"></h5>
                                            <p class="text-muted text-truncate">Disabled</p>
                                        </div>
                                    </div>

                                    <div id="simple-line-chart" class="" dir="ltr"
                                        style="height: 310px;">
                                    </div>

                                </div>
                            </div>
                        </div>


                    </div>
                    <!-- end row -->

                    <div class="row">
                        <div class="col-md-6 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                     <h4 class="card-title mb-4">Tickets Counts By Month</h4>
                                    <canvas id="complaintChart" width="400" height="200"></canvas> 
                                       <h4 class="card-title mb-4" id="percentageChange"></h4>  
                                </div>
                            </div>
                        </div>


                        <div class="col-md-6 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Customer Counts By Month</h4>   
                                    <canvas id="customerChart" width="400" height="200"></canvas> 
                                       <h4 class="card-title mb-4" id="customerPercentageChange"></h4>                 
                                </div>
                            </div>
                        </div>
                    </div>





                    <div class="row">

                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Yearly Customer Statics</h4>


                                    <div class="row text-center mt-4">
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Tickets</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Complete' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Resolved</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Active' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate">Pending</p>
                                        </div>

                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Close' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate danger">Closed</p>
                                        </div>

                                    </div>

                                    <div id="chart_year" dir="ltr"></div>

                                </div>
                            </div>
                        </div>







                        <div class="col-md-6 stretch-card">
                            <div class="card">
                                <div class="card-body">



                                    <div class="row">
                                        <div class="col-md-8 mt-1 py-2">
                                            <p class="card-title ">New Customers by months</p>
                                        </div>
                                        <div class="col-md-4">
                                            <button style="float: right;">
                                                <a href="customers.php">+</a>
                                            </button>
                                        </div>
                                    </div>



                                    <div class="table-responsive">
                                        <table id="datatables" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Months</th>
                                                    <th>New Conn.</th>
                                                    <th>Expired Conn.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                for($i=1; $i<=12; $i++)
                                                {
                                                    ?>
                                                <tr>
                                                    <td><?php echo $i; ?></td>
                                                    <td>
                                                        <?php
                                                        $month = sprintf('%02d', $i);
                                                        $currentyrMnth = date('Y') . '-' . $month;
                                                        echo date('M-Y', strtotime($currentyrMnth));
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%'";
                                                        $result = mysqli_query($con, $sql);
                                                        $countconn = mysqli_num_rows($result);
                                                        echo '<a href="customers_new.php?new_customer_month=' . $currentyrMnth . '">' . $countconn . '</a>';
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE  expiredate LIKE '%$currentyrMnth%'";
                                                        $result = mysqli_query($con, $sql);
                                                        $countexpconn = mysqli_num_rows($result);
                                                        echo '<a href="customers_new.php?expire_customer_month=' . $currentyrMnth . '">' . $countexpconn . '</a>';
                                                        ?>
                                                    </td>
                                                </tr>
                                                <?php }	 ?>
                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </div>









                    </div>



                    <div class="row">


                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-title">System info</p>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div id="fluid-meter2"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <div id="fluid-meter"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <div id="fluid-meter1"></div>
                                        </div>
                                    </div>
                                    <div class="table-responsive">


                                        <pre>
<strong>Uptime:</strong>
<?php system('uptime'); ?>
<br />
<strong>System Information:</strong>
<?php system('uname -a'); ?>

<?php
//<strong>CPU Usage:</strong>
$exec_loads = sys_getloadavg();
$exec_cores = trim(shell_exec("grep -P '^processor' /proc/cpuinfo|wc -l"));
$cpu1 = round(($exec_loads[1] / ($exec_cores + 1)) * 100, 0);

//<strong>RAM Usage%:</strong>
$exec_free = explode("\n", trim(shell_exec('free')));
$get_mem = preg_split('/[\s]+/', $exec_free[1]);
$mem1 = round(($get_mem[2] / $get_mem[1]) * 100, 0);

//<strong>RAM Usage:</strong>
$exec_free = explode("\n", trim(shell_exec('free')));
print_r($get_mem = preg_split('/[\s]+/', $exec_free[1]));
$mem = number_format(round($get_mem[2] / 1024 / 1024, 2), 2) . '/' . number_format(round($get_mem[1] / 1024 / 1024, 2), 2);
?>

<strong>System Date & Time:</strong>
<?php
//$exec_uptime = preg_split("/[\s]+/", trim(shell_exec('uptime')));
echo date('D-M-Y') . ' ' . date('h:i:s A') . '<br/>';
echo date_default_timezone_get();
?>
<br/>
<strong><span class="mdi-database-clock-outline"></span> Date & Time:</strong>
<?php
//$exec_uptime = preg_split("/[\s]+/", trim(shell_exec('uptime')));
$dbtime = $con->query('SELECT NOW() AS dbtime');
$rowd = $dbtime->fetch_assoc();
echo $rowd['dbtime'];

?>


<strong>Uptime:</strong>
<?php
$exec_uptime = preg_split('/[\s]+/', trim(shell_exec('uptime')));
echo $uptime = $exec_uptime[2] . ' Days';
?>
<br/>
<strong>DB Sync:</strong>
<?php
$cronupdt = $con->query('SELECT * FROM cron');
$rowcron = $cronupdt->fetch_assoc();
echo $rowcron['date'];

?>
<?php

?>
</pre>




                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php
            include 'Footer.php';
            ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <div class="modal fade" id="addRechargeModal" tabindex="-1" aria-labelledby="myLargeModalLabel"
        aria-hidden="true">
        <div class="modal-dialog ">
            <div class="modal-content">
                <div class="modal-header ">
                    <h5 class="modal-title" id="exampleModalLabel">Add Recharge</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="recharge_customer" class="form-label">Select Customer</label>
                                <select id="recharge_customer" class="form-select">
                                    <option value="">Select Customer</option>
                                    <?php
                                    if ($allCustomer = $con->query('SELECT * FROM customers')) {
                                        while ($rows = $allCustomer->fetch_array()) {
                                            echo '<option value="' . $rows['id'] . '">' . $rows['username'] . ' (' . $rows['mobile'] . ')</option>';
                                        }
                                    }
                                    ?>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="recharge_customer_month" class="form-label">Month</label>
                                <select id="recharge_customer_month" class="form-select">
                                    <?php for ($i = 1; $i <= 12; $i++) : ?>
                                    <option value="<?= $i ?>"><?= $i ?></option>
                                    <?php endfor; ?>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="recharge_customer_package" class="form-label">Package</label>
                                <select id="recharge_customer_package" class="form-select" disabled>
                                    <!-- Options will be loaded here dynamically -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="recharge_customer_package_price" class="form-label">Package Price</label>
                                <input id="recharge_customer_package_price" type="text" class="form-control"
                                    disabled>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="ref" class="form-label">Reference</label>
                                <input id="ref" type="text" class="form-control">
                            </div>
                            <div class="col-md-6 d-none">
                                <label for="recharge_customer_pop_id" class="form-label">Pop ID</label>
                                <input id="recharge_customer_pop_id" type="text" class="form-control" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="recharge_customer_amount" class="form-label">Payable Amount</label>
                                <input id="recharge_customer_amount" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="row mb-3">

                            <div class="col-md-6">
                                <label for="recharge_customer_transaction_type" class="form-label">Transaction
                                    Type</label>
                                <select id="recharge_customer_transaction_type" class="form-select">
                                    <option value="1">Cash</option>
                                    <option value="0">On Credit</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn btn-success mt-4" id="add_recharge_btn"
                                    style="margin-top: 4px;">
                                    <i class="mdi mdi-battery-charging-90"></i>&nbsp;&nbsp;Recharge Now
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!---add send msg modal---->
    <div id="sendMessage" class="modal fade" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title mt-0" id="myModalLabel">Send Message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm">
                            <div class="form-group">
                                <label>Customer Account</label>
                                <select name="cstmr_ac" id="cstmr_ac" class="form-control select2"
                                    onchange="currentCstmrAc()" style="width:100%;">
                                    <option>Select</option>
                                    <?php
                                    
                                    if ($allCstmr = $con->query("SELECT * FROM customers WHERE user_type=$auth_usr_type AND status=1 ")) {
                                        while ($rows = $allCstmr->fetch_array()) {
                                            echo '<option value=' . $rows['id'] . '>' . $rows['fullname'] . '</option>';
                                        }
                                    }
                                    
                                    ?>

                                </select>
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="form-group mb-2">
                                <label>Customer Phone No.</label>
                                <input id="phone" type="text" name="phone" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="form-group mb-2">
                                <label>Message Template</label>
                                <select class="form-select" id="currentMessageTemp" onchange="currentMsgTemp()">
                                    <option>Select</option>
                                    <?php
                                    if ($allCstmr = $con->query('SELECT * FROM message_template WHERE user_type=1')) {
                                        while ($rows = $allCstmr->fetch_array()) {
                                            echo '<option value=' . $rows['id'] . '>' . $rows['template_name'] . '</option>';
                                        }
                                    }
                                    
                                    ?>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <div class="form-group">
                                <label>Message</label>
                                <textarea id="message" rows="5" placeholder="Enter Your Message" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary waves-effect"
                        data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary waves-effect waves-light">Send Message</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    <?php include 'modal/tickets_modal.php'; ?>


    <?php require 'modal/customer_modal.php'; ?>

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>



    <?php include 'script.php'; ?>
    <script src="js/tickets.js"></script>
    <script src="js/customer.js"></script>
    <script type="text/javascript">
        /*** Add ticket Modal Script****/
        ticket_modal();
        loadCustomers();
        ticket_assign();
        ticket_complain_type();


        new Chartist.Line("#simple-line-chart", {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            series: [{
                    name: 'New Customers',
                    data: [<?php
                    for ($i = 1; $i <= 12; $i++) {
                        $currentyrMnth = date('Y') . '-' . str_pad($i, 2, '0', STR_PAD_LEFT);
                        $sql = "SELECT COUNT(*) AS new_customers FROM customers WHERE createdate LIKE '%$currentyrMnth%'";
                        $result = mysqli_query($con, $sql);
                        $row = mysqli_fetch_assoc($result);
                        echo $row['new_customers'] . ',';
                    }
                    ?>]
                },
                {
                    name: 'Active Customers',
                    data: [<?php
                    for ($i = 1; $i <= 12; $i++) {
                        $currentyrMnth = date('Y') . '-' . str_pad($i, 2, '0', STR_PAD_LEFT);
                        $sql = "SELECT COUNT(*) AS active_customers FROM customers WHERE status = '1' AND createdate LIKE '%$currentyrMnth%'";
                        $result = mysqli_query($con, $sql);
                        $row = mysqli_fetch_assoc($result);
                        echo $row['active_customers'] . ',';
                    }
                    ?>]
                },
                {
                    name: 'Expired Customers',
                    data: [<?php
                    for ($i = 1; $i <= 12; $i++) {
                        $currentyrMnth = date('Y') . '-' . str_pad($i, 2, '0', STR_PAD_LEFT);
                        $sql = "SELECT COUNT(*) AS expired_customers FROM customers WHERE expiredate LIKE '%$currentyrMnth%'";
                        $result = mysqli_query($con, $sql);
                        $row = mysqli_fetch_assoc($result);
                        echo $row['expired_customers'] . ',';
                    }
                    ?>]
                },
                {
                    name: 'Disabled Customers',
                    data: [<?php
                    for ($i = 1; $i <= 12; $i++) {
                        $currentyrMnth = date('Y') . '-' . str_pad($i, 2, '0', STR_PAD_LEFT);
                        $sql = "SELECT COUNT(*) AS disabled_customers FROM customers WHERE status = '0' AND createdate LIKE '%$currentyrMnth%'";
                        $result = mysqli_query($con, $sql);
                        $row = mysqli_fetch_assoc($result);
                        echo $row['disabled_customers'] . ',';
                    }
                    ?>]
                }
            ]
        }, {
            fullWidth: true,
            chartPadding: {
                right: 40
            },
            plugins: [Chartist.plugins.tooltip()]
        });






        var times = function(e) {
                return Array.apply(null, new Array(e))
            },
            data = times(52).map(Math.random).reduce(function(e, t, a) {
                return e.labels.push(a + 1), e.series.forEach(function(e) {
                    e.push(100 * Math.random())
                }), e
            }, {
                labels: [],
                series: times(4).map(function() {
                    return new Array
                })
            }),
            options = {
                showLine: !1,
                axisX: {
                    labelInterpolationFnc: function(e, t) {
                        return t % 13 == 0 ? "W" + e : null
                    }
                }
            },
            responsiveOptions = [
                ["screen and (min-width: 640px)", {
                    axisX: {
                        labelInterpolationFnc: function(e, t) {
                            return t % 4 == 0 ? "W" + e : null
                        }
                    }
                }]
            ];
        new Chartist.Line("#scatter-diagram", data, options, responsiveOptions);


        ///////////////// Chart Bar //////////////////////
        ! function(e) {
            "use strict";

            function a() {}
            a.prototype.init = function() {
                    c3.generate({
                        bindto: "#chart",
                        data: {
                            columns: [
                                ["Tickets",
                                    <?php
                                    // Date find from 5 days ago
                                    //echo $Fidayago = strtotime(date("d", strtotime("-5 day")));
                                    /**/
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $tktsql = $con->query("SELECT * FROM ticket WHERE startdate LIKE '%$daystkt%'");
                                        echo $tktsql->num_rows;
                                        echo ',';
                                    }
                                    
                                    ?>
                                ],
                                ["Resolved",
                                    <?php
                                    // Date find from 5 days ago
                                    
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $tktsql = $con->query("SELECT * FROM ticket WHERE startdate LIKE '%$daystkt%' AND ticket_type='Complete'");
                                        echo $tktsql->num_rows;
                                        echo ',';
                                    }
                                    
                                    ?>


                                ],
                                ["Pending",
                                    <?php
                                    // Date find from 5 days ago
                                    
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $tktsql = $con->query("SELECT * FROM ticket WHERE startdate LIKE '%$daystkt%' AND ticket_type='Active'");
                                        echo $tktsql->num_rows;
                                        echo ',';
                                    }
                                    
                                    ?>


                                ]
                            ],
                            type: "bar",
                            colors: {
                                Tickets: "#fb8c00",
                                Resolved: "#3bc3e9",
                                Pending: "#5468da"
                            }
                        }
                    })
                },
                e.ChartC3 = new a, e.ChartC3.Constructor = a
        }(window.jQuery),
        function() {
            "use strict";
            window.jQuery.ChartC3.init()
        }();


        ///////////////// ####### Yearly Customer statics Chart Bar ######## //////////////////////
        ! function(e) {
            "use strict";

            function a() {}
            a.prototype.init = function() {
                    c3.generate({
                        bindto: "#chart_year",
                        data: {
                            columns: [
                                ["New Customer",
                                    <?php
                                    
                                    for ($i = 1; $i < 13; $i++) {
                                        $currentyrMnth = date('Y') . '-0' . $i;
                                        date('M-Y', strtotime(date('Y') . '-' . $i));
                                        $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%'";
                                        $result = mysqli_query($con, $sql);
                                        echo $countconn = mysqli_num_rows($result) . ',';
                                    }
                                    
                                    ?>
                                ],
                                ["Expired",
                                    <?php
                                    // Date find from 5 days ago
                                    
                                    for ($i = 0; $i < 11; $i++) {
                                        $currentyrMnth = date('Y') . '-0' . $i;
                                        date('M-Y', strtotime(date('Y') . '-' . $i));
                                        $sql = "SELECT * FROM customers WHERE expiredate LIKE '%$currentyrMnth%'";
                                        $result = mysqli_query($con, $sql);
                                        echo $countconn = mysqli_num_rows($result) . ',';
                                    }
                                    
                                    ?>


                                ],
                                ["Disabled",
                                    <?php
                                    // Date find from 5 days ago
                                    
                                    for ($i = 0; $i < 11; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $tktsql = $con->query("SELECT * FROM ticket WHERE startdate LIKE '%$daystkt%' AND ticket_type='Active'");
                                        echo $tktsql->num_rows;
                                        echo ',';
                                    }
                                    
                                    ?>


                                ]
                            ],
                            type: "bar",
                            colors: {
                                Tickets: "#fb8c00",
                                Resolved: "#3bc3e9",
                                Pending: "#5468da"
                            }
                        }
                    })
                },
                e.ChartC3 = new a, e.ChartC3.Constructor = a
        }(window.jQuery),
        function() {
            "use strict";
            window.jQuery.ChartC3.init()
        }();

      /**********************************Tickets Counts By Month *******************************/
         <?php
       
        $currentYear = date("Y");
        $lastYear = $currentYear - 1;
        $currentMonth = date("m");
        $lastMonth = ($currentMonth == 1) ? 12 : $currentMonth - 1;
        $yearOfLastMonth = ($currentMonth == 1) ? $lastYear : $currentYear;

        $result = $con->query("SELECT MONTH(startdate) as month, YEAR(startdate) as year, COUNT(*) as total_complaints 
                  FROM ticket 
                  WHERE (YEAR(startdate) IN ('$currentYear', '$lastYear')) 
                  GROUP BY YEAR(startdate), MONTH(startdate)");

        $complaintsData = [];
        while ($row = $result->fetch_assoc()) {
            $complaintsData[] = $row;
        }

        $con->close();

        $labels = [];
        $datasetCurrentYear = [];
        $datasetLastYear = [];
        $currentMonthComplaints = 0;
        $lastMonthComplaints = 0;

        for ($i = 1; $i <= 12; $i++) {
            $labels[] = date("F", mktime(0, 0, 0, $i, 1));

            $currentData = array_filter($complaintsData, function ($d) use ($i, $currentYear) {
                return $d['month'] == $i && $d['year'] == $currentYear;
            });

            $lastData = array_filter($complaintsData, function ($d) use ($i, $lastYear) {
                return $d['month'] == $i && $d['year'] == $lastYear;
            });

            $currentCount = !empty($currentData) ? array_values($currentData)[0]['total_complaints'] : 0;
            $lastCount = !empty($lastData) ? array_values($lastData)[0]['total_complaints'] : 0;

            $datasetCurrentYear[] = $currentCount;
            $datasetLastYear[] = $lastCount;

            if ($i == $currentMonth) {
                $currentMonthComplaints = $currentCount;
            }
            if ($i == $lastMonth) {
                $lastMonthComplaints = $currentCount;
            }
        }
        if ($lastMonthComplaints > 0) {
            $percentageChange = (($currentMonthComplaints - $lastMonthComplaints) / $lastMonthComplaints) * 100;
        } else {
            $percentageChange = $currentMonthComplaints > 0 ? 100 : 0;
        }
        ?>

        let labels = <?php echo json_encode($labels); ?>;
        let datasetCurrentYear = <?php echo json_encode($datasetCurrentYear); ?>;
        let datasetLastYear = <?php echo json_encode($datasetLastYear); ?>;
        let percentageChange = <?php echo json_encode($percentageChange); ?>;

        new Chart(document.getElementById("complaintChart"), {
            type: "line",
            data: {
                labels: labels,
                datasets: [
                    {
                        label: "<?php echo $currentYear; ?> Tickets",
                        data: datasetCurrentYear,
                        borderColor: "blue",
                        fill: false
                    },
                    {
                        label: "<?php echo $lastYear; ?> Tickets",
                        data: datasetLastYear,
                        borderColor: "red",
                        fill: false
                    }
                ]
            }
        });

        let percentageElement = document.getElementById("percentageChange");
        if (percentageChange > 0) {
            percentageElement.innerHTML = " Tickets increased by <span style='color: green;'>" + percentageChange.toFixed(2) + "%</span> this month!";
        } else if (percentageChange < 0) {
            percentageElement.innerHTML = " Tickets decreased by <span style='color: red;'>" + Math.abs(percentageChange.toFixed(2)) + "%</span> this month!";
        } else {
            percentageElement.innerHTML = " No change in Tickets this month!";
        }
        /**********************************Tickets Counts By Month *******************************/

        /********************************** Customer Counts By Month *******************************/
        <?php
        $currentYearCustomer = date("Y");
        $lastYearCustomer = $currentYearCustomer - 1;
        $currentMonthCustomer = date("m");
        $lastMonthCustomer = ($currentMonthCustomer == 1) ? 12 : $currentMonthCustomer - 1;
        $yearOfLastMonthCustomer = ($currentMonthCustomer == 1) ? $lastYearCustomer : $currentYearCustomer;
       
        ?>
        let labelsCustomer = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    
        let datasetCustomer2025 = [50, 70, 80, 60, 90, 100, 120, 110, 105, 95, 85, 75]; 
        let datasetCustomer2024 = [40, 60, 70, 50, 80, 90, 110, 100, 95, 85, 75, 65];


        new Chart(document.getElementById("customerChart"), {
            type: "line",
            data: {
                labels: labelsCustomer,
                datasets: [
                    {
                        label: "<?php echo $currentYearCustomer;?> Customers",
                        data: datasetCustomer2025,
                        borderColor: "green",
                        fill: false
                    },
                    {
                        label: "<?php echo $lastYearCustomer; ?> Customers",
                        data: datasetCustomer2024,
                        borderColor: "orange",
                        fill: false
                    }
                ]
            }
        });
        let percentageElementCustomer  = document.getElementById("customerPercentageChange");
        percentageElementCustomer.innerHTML = " Customer increased by <span style='color: green;'>"+'23'+"%</span> this month!";
        // if (percentageChangeCustomer  > 0) {
        //     percentageElementCustomer.innerHTML = " Customer increased by <span style='color: green;'>"+'23'+"%</span> this month!";
        // } else if (percentageChangeCustomer  < 0) {
        //     percentageElementCustomer.innerHTML = " Customer decreased by <span style='color: red;'>" + '32'+ "%</span> this month!";
        // } else {
        //     percentageElementCustomer.innerHTML = " No change in Customer this month!";
        // }

  
        /**********************************Customer Counts By Month *******************************/
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#cstmr_ac').select2();
            //
            $('#addRechargeModal').on('shown.bs.modal', function() {
                /*Check if select2 is already initialized*/
                if (!$('#recharge_customer').hasClass("select2-hidden-accessible")) {
                    $("#recharge_customer").select2({
                        dropdownParent: $('#addRechargeModal'),
                        placeholder: "Select Customer"
                    });
                }
            });
        });

        function currentMsgTemp() {
            var name = $("#currentMessageTemp").val();
            var currentMsgTemp = "0";
            $.ajax({
                type: 'POST',
                data: {
                    name: name,
                    currentMsgTemp: currentMsgTemp
                },
                url: 'include/message.php',
                success: function(response) {
                    console.log(response);
                    $("#message").val(response);
                }
            });
        }

        function currentCstmrAc() {
            var name = $("#cstmr_ac").val();
            var currentCstmrAc = "0";
            $.ajax({
                type: 'POST',
                data: {
                    name: name,
                    currentCstmrAc: currentCstmrAc
                },
                url: 'include/message.php',
                success: function(response) {
                    console.log(response);
                    $("#phone").val(response);
                }
            });
        }
    </script>
    <script type="text/javascript">
        $("#addSmsBtn").click(function() {
            $("#sendMessage").modal('show');
        });

        //////////////////////////////// CUSTOMER  Recharge SCRIPT ///////////////////////////////////////////////////



        $("#recharge_customer").on('change', function() {
            var id = $("#recharge_customer").val();
            getCustomerPackage(id);
            getCustomerPackagePrice(id);
            getCustomerPopId(id);

        });

        //get Package name
        function getCustomerPackage(recevedId) {
            var customerId = recevedId;
            $.ajax({
                url: 'include/customers_server.php',
                method: 'POST',
                data: {
                    id: customerId,
                    getCustomerSpecificId: 0
                },
                //dataType: 'json',
                success: function(responseData) {
                    $("#recharge_customer_package").html(responseData);
                },
                error: function(xhr, textStatus, errorThrown) {
                    // Handle any errors here
                    console.error('An error occurred:', errorThrown);
                }
            });
        }
        //get Package price
        function getCustomerPackagePrice(recevedId) {
            var customerId = recevedId;
            $.ajax({
                url: 'include/customers_server.php',
                method: 'POST',
                data: {
                    id: customerId,
                    getCustomerPackagePrice: 0
                },
                //dataType: 'json',
                success: function(responseData) {
                    $("#recharge_customer_package_price").val(responseData);
                    $("#recharge_customer_amount").val(responseData);
                },
                error: function(xhr, textStatus, errorThrown) {
                    // Handle any errors here
                    console.error('An error occurred:', errorThrown);
                }
            });
        }
        //get Package price
        function getCustomerPopId(recevedId) {
            var customerId = recevedId;
            $.ajax({
                url: 'include/customers_server.php',
                method: 'POST',
                data: {
                    id: customerId,
                    getCustomerPop: 0
                },
                //dataType: 'json',
                success: function(responseData) {
                    $("#recharge_customer_pop_id").val(responseData);
                },
                error: function(xhr, textStatus, errorThrown) {
                    // Handle any errors here
                    console.error('An error occurred:', errorThrown);
                }
            });
        }
        //get recharge Calculation
        getCalculation();

        function getCalculation() {
            $(document).on('change', "#recharge_customer_month", function() {
                var month = $("#recharge_customer_month").val();
                var price = $("#recharge_customer_package_price").val();
                var totalAmount = Number(month * price);
                $("#recharge_customer_amount").val(totalAmount);
            });
        }

        //customer recharge script

        $(document).on('click', '#add_recharge_btn', function() {
            var customer_id = $("#recharge_customer").val();
            var month = $("#recharge_customer_month").val();
            var package = $("#recharge_customer_package").val();
            var mainAmount = $("#recharge_customer_amount").val();
            var tra_type = $("#recharge_customer_transaction_type").val();
            var pop_id = $("#recharge_customer_pop_id").val();
            var ref = $("#ref").val();
            sendData(customer_id, month, package, mainAmount, tra_type, pop_id, ref);
        });
        const sendData = (customer_id, month, package, mainAmount, tra_type, pop_id, ref) => {

            if (month.length == 0) {
                toastr.error("Select Month");
            } else if (customer_id.length == 0) {
                toastr.error("Select Customer");
            } else if (tra_type.length == 0) {
                toastr.error("Select Transaction");
            } else {
                $("#add_recharge_btn").html(
                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                $.ajax({
                    type: 'POST',
                    url: 'include/customer_recharge_server.php',
                    data: {
                        customer_id: customer_id,
                        month: month,
                        package: package,
                        amount: mainAmount,
                        tra_type: tra_type,
                        pop_id: pop_id,
                        RefNo: ref,
                        add_recharge_data: 0
                    },
                    success: function(response) {
                        if (response == 1) {
                            $("#add_recharge_btn").html('Recharge Now');
                            $("#addRechargeModal").modal('hide');
                            toastr.success("Recharge Successful");
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response);
                            $("#add_recharge_btn").html('Recharge Now');
                        }



                    }
                });



            }

        }
    </script>


    <script type="text/javascript">
        //Storage
        var fm = new FluidMeter();
        fm.init({
            targetContainer: document.getElementById("fluid-meter1"),
            fillPercentage: <?php echo $mem1; ?>,
        });

        // CPU
        var fm = new FluidMeter();
        fm.init({
            targetContainer: document.getElementById("fluid-meter2"),
            fillPercentage: <?php echo $cpu1; ?>,

        });

        //RAM
        var fm = new FluidMeter();
        fm.init({
            targetContainer: document.getElementById("fluid-meter"),
            fillPercentage: <?php echo $mem1; ?>,
            options: {
                fontSize: "70px",
                fontFamily: "Arial",
                fontFillStyle: "white",
                drawShadow: true,
                drawText: true,
                drawPercentageSign: true,
                drawBubbles: true,
                size: 300,
                borderWidth: 25,
                backgroundColor: "#e2e2e2",
                foregroundColor: "#fafafa",
                foregroundFluidLayer: {
                    fillStyle: "#F1C40F",
                    angularSpeed: 100,
                    maxAmplitude: 12,
                    frequency: 30,
                    horizontalSpeed: -150
                },
                backgroundFluidLayer: {
                    fillStyle: "#F1C40F",
                    angularSpeed: 100,
                    maxAmplitude: 9,
                    frequency: 30,
                    horizontalSpeed: 150
                },
                backgroundFluidLayer: {
                    fillStyle: "  #CCCCFF",
                    angularSpeed: 100,
                    maxAmplitude: 9,
                    frequency: 30,
                    horizontalSpeed: 150
                },
            }
        });
        fm.setPercentage(percentage);


        /////////////////////////Chart /////////////////////////////////////
    </script>


</body>

</html>


<?php 

$result = $con->query("SELECT * FROM notifications WHERE status = 'unread' ORDER BY created_at DESC ");
$notifications = mysqli_fetch_all($result, MYSQLI_ASSOC);

?>
<header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="http://103.146.16.154/assets/images/it-fast.png" class="img-fluid" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="http://103.146.16.154/assets/images/it-fast.png" class="img-fluid" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="http://103.146.16.154/assets/images/it-fast.png" class="img-fluid" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="http://103.146.16.154/assets/images/it-fast.png" class="img-fluid" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title"> 
                            <?php echo isset($page_title) ? $page_title : 'Welcome To Dashboard'; ?>
                        </h4>
                    </div>
                </div>



                <div class="d-flex">
                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php 
                                if (isset($_SESSION['fullname'])) {
                                    echo $_SESSION['fullname'];
									
                                }elseif (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                }
                                ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="http://103.146.16.154/profileImages/avatar.png" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                             <?php 
                             if(!empty($page_title=="POP/Branch")){
                                echo '<div class="profile-info">';
                                echo '<p class="profile-item"><i class="mdi mdi-marker-check"></i><strong>Fullname:</strong> '.$fullname.'</p>';
                                echo '<p class="profile-item"><i class="mdi mdi-account-circle"></i> <strong>Username:</strong> '.$username.'</p>';
                                echo '<p class="profile-item"><i class="fas fa-dollar-sign"></i> <strong>Opening Balance:</strong> '.$opening_bal.'</p>';
                                echo '<p class="profile-item"><i class="mdi mdi-phone"></i> <strong>Mobile:</strong> '.$mobile_num1.'</p>';
                                echo '<p class="profile-item"><i class="fas fa-envelope"></i> <strong>Email:</strong>'.$email_address.'</p>';
                                echo ' </div>';
                             }
                             
                             ?>
                            <a class="dropdown-item text-danger" href="logout.php"><i class="mdi mdi-power"></i> Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill"><?= count($notifications);?></span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (<?= count($notifications);?>) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">

                            <?php foreach ($notifications as $notification): ?>
    <a href="<?= htmlspecialchars($notification['url']) ?>" class="text-reset notification-item">
        <div class="d-flex">
            <div class="avatar-xs me-3">
                <span class="avatar-title bg-success rounded-circle font-size-16">
                   <?php echo $notification['icon']; ?>
                </span>
            </div>
            <div class="flex-1">
                <h6 class="mt-0 font-size-15 mb-1"><?= htmlspecialchars($notification['message']) ?></h6>
                <div class="font-size-12 text-muted">
                    <p class="mb-1"><?= htmlspecialchars($notification['created_at']) ?></p>
                </div>
            </div>
        </div>
    </a>
<?php endforeach; ?>

                            </div>
                            <!-- <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div> -->
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <style>
.profile-info {
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.profile-item {
    margin-bottom: 10px;
    font-size: 14px;
    display: flex;
    align-items: center;
    color: #333;
}

.profile-item i {
    font-size: 18px;
    margin-right: 10px;
    color: #007bff;
}

.profile-item strong {
    color: #495057;
}

</style>

<footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  iT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="#">iT-Fast</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

            <?php
include("include/security_token.php");
include("include/users_right.php");
?>
<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<?php include 'style.php'; ?>
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <!-- WOW.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
	<style>
        /* div#tickets_datatable_filter {
            display: none;
        }
        div#tickets_datatable_length {
            display: flex;
        }
        .customer_filter {
            width: 400px !important;
        }
        @media (min-width: 600px) {
            .customer_filter {
                width: 200px !important; 
            }
            
        } */

        .animate__custom {
            animation-duration: 0.5s !important; 
            animation-delay: 1s !important; 
        }
    </style>



</head>

<body data-sidebar="dark">



    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php
        $page_title="Tickets";
        include 'Header.php'; 
        ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Ticket</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                   
									<!-- <a href="create_ticket.php" class="btn btn-primary mt-2 mb-2 mt-xl-0 mdi mdi-account-plus mdi-18px" >&nbsp;&nbsp;New Ticket</a> -->
									<button type="button" class="btn btn-primary mt-2 mb-2 mt-xl-0 "  data-bs-toggle="modal" data-bs-target="#ticketModal"><i class="fas fa-ticket-alt"></i>&nbsp;&nbsp; New Ticket</button>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <!-- <div id="export_buttonscc" class="mb-3"></div> -->
                                    <div class="table-responsive">
                                        <table id="tickets_datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>No.</th> 
                                                    <th>Status</th> 
                                                    <th>Created</th>
                                                    <th>Priority</th>
                                                    <th>Customer Name</th>
                                                    <th>Phone Number</th>
                                                    <th>Issues</th>
                                                    <th>Pop/Area</th>                                                   
                                                    <th>Assigned Team</th>
                                                    <th>Ticket For</th>
                                                    <th>Acctual Work</th>
                                                    <th>Completed</th>
                                                    <th>Percentage</th>
                                                    <th>Note</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>

    <div class="modal fade" id="settings_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header  bg-info">
                    <h5 class="modal-title text-white " id="exampleModalLabel">Ticket Settings <i class="fas fa-cog"></i></h5>
                    
                </div>
                <form action="include/tickets_server.php?add_ticket_settings=true" method="POST" id="settings_modal_form">
                    <div class="modal-body">
                        <div class="form-group d-none">
                            <input type="text" name="ticket_id" value="" required>
                        </div>
                        <div class="form-group mb-2">
                               <label>Ticket Status</label>
                            <select id="ticket_type" name="ticket_type" class="form-select" required>
                                <option value="">Select</option>
                                <option value="Active">Active</option>
                                <option value="New" >New</option>
                                <option value="Open">Open</option>
                                <option value="Complete">Complete</option>
                                <option value="Close">Close</option>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Progress</label>
                                <select id="progress" name="progress" class="form-select" required>
                                    <option value="">Select</option>
                                    <option value="0%">0%</option>
                                    <option value="15%">15%</option>
                                    <option value="25%">25%</option>
                                    <option value="35%">35%</option>
                                    <option value="45%">45%</option>
                                    <option value="55%">55%</option>
                                    <option value="65%">65%</option>
                                    <option value="75%">75%</option>
                                    <option value="85%">85%</option>
                                    <option value="95%">95%</option>
                                    <option value="100%">100%</option>
                                </select>
                        </div>
                        <div class="form-group mb-2">
                            <label for="">Assigned To</label>
                            <select name="assigned" id="assigned" class="form-select" required>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Write Comment</label> 
                            <textarea class="form-control"  rows="5" name="comment" placeholder="Enter Your Comment" style="height: 89px;"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <?php require 'modal/tickets_modal.php';?>

    <?php include 'script.php'; ?>
    <script src="js/tickets.js"></script>
    <script type="text/javascript">
       
        $(document).ready(function(){
            var received_pop_id = "<?php echo isset($_GET['pop_id']) ? $_GET['pop_id'] : ''; ?>";
            var received_area_id = "<?php echo isset($_GET['area_id']) ? $_GET['area_id'] : ''; ?>";

            if (received_pop_id.length > 0 || received_area_id.length > 0) {
                console.log('yes');
            }else{
                loadAreaOptions();  
            }
           

            function loadAreaOptions() {
                $.ajax({
                    url: 'include/area_server.php?get_area_data=1', 
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var popOptions = '<label style="margin-left: 10px;"> ';
                            popOptions += '<select class="area_filter form-select select2">';
                            popOptions += '<option value="">--Select Area--</option>';
                            
                        
                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="'+data.id+'">'+data.name+'</option>';
                            });

                            popOptions += '</select></label>';
                            
                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.select2').select2();
                            }, 500);

                            var status_filter = '<label style="margin-left: 10px;"> ';
                            status_filter += '<select class="status_filter form-select select2">';
                            status_filter += '<option value="">--Select Status--</option>';
                            status_filter += ' <option value="Active" selected>Active</option>';
                            status_filter += '<option value="New">New</option>';
                            status_filter += '<option value="Open">Open</option>';
                            status_filter += '<option value="Complete">Complete</option>';
                            status_filter += ' <option value="Close">Close</option>';
                            status_filter += '</select></label>';


                            setTimeout(() => {
                                $('.dataTables_length').parent().removeClass(
                                    'col-sm-12 col-md-6');
                                $('.dataTables_filter').parent().removeClass(
                                    'col-sm-12 col-md-6');
                            $('.dataTables_length').append(status_filter);
                            $('.select2').select2();
                            }, 500);
                           
                        }
                       
                    }
                });
            }
           
            
            var  table=$('#tickets_datatable').DataTable( {
               "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: false,
                "serverSide"		: false,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/tickets_server.php?get_tickets_data=1",
                    type		: 'GET',
                    data: function(d) {
                        d.pop_id = received_pop_id.length > 0 ? received_pop_id : $('.pop_filter').val();
                        d.area_id = received_area_id.length > 0 ? received_area_id : $('.area_filter').val();
                        d.status = $('.status_filter').val() || 'Active';
                      
                    },
                    beforeSend: function() {
                        $(".dataTables_empty").html('<img src="assets/images/loading.gif" style="background-color: transparent"/>');
                    },
                    complete: function() {
                        // Hide loading spinner
                        //$('#tickets_datatable').unblock();
                    },
                    error: function(xhr, error, thrown) {
                        console.log("AJAX Error:", error, thrown, xhr.responseText);
                        alert("Failed to load data! Check console for details.");
                    }
                },
                "order": [[0, 'desc']],
            });
        });
        /* Area filter change event*/
        $(document).on('change', '.area_filter', function(){
            // var area_filter_result = $('.area_filter').val() || '';
            // table.columns(7).search(area_filter_result).draw();
            table.ajax.reload(null, false);
        });          
        /* Status filter change event*/
        $(document).on('change', '.status_filter', function(){
            //var status_filter_result = $('.status_filter').val() || '';
           // table.columns(1).search(status_filter_result).draw();
            table.ajax.reload();
        }); 
          
        $(document).on('change', '.customer_filter', function(){
            var status_filter_result = $('.customer_filter').val() || '';
            table.columns(4).search(status_filter_result).draw();
        });   
        
        $(document).on('click', 'button[name="settings_button"]', function() {
            let dataId=$(this).data('id'); 
            $.ajax({
                url: "include/tickets_server.php?get_single_ticket=true", 
                type: "GET",
                data: { 
                    id:dataId,
                },
                dataType:'json',
                success: function(response) {
                    if (response.success == true) {
                        console.log(response); 
                        $("#settings_modal input[name='ticket_id']").val(response.data.id);
                        $("#settings_modal select[name='ticket_type']").val(response.data.ticket_type);
                        $("#settings_modal #progress").val(response.data.parcent);
                        $("#settings_modal textarea[name='comment']").val(response.data.notes);
                         $("#settings_modal select[name='assigned']").val(response.data.asignto);
                        $("#settings_modal").modal('show');
                    }
                }
            });
            
        });
        __load_assign_option()
        function __load_assign_option(){
            $.ajax({
                url: "include/tickets_server.php?get_working_group=true",
                type: "GET",
                dataType:'json',
                success: function(response) {
                    if (response.success == true) {
                        let assignedSelect = $("#settings_modal select[name='assigned']");
                        assignedSelect.empty();  
                        
                        $.each(response.data, function(index, item) {
                            assignedSelect.append(new Option(item.name, item.id));
                        });
                    } else {
                        console.log("No data found or an error occurred.");
                    }
                }
            });
        }
        $("#settings_modal_form").submit(function(e) {
            e.preventDefault();

            /* Get the submit button */
            var submitBtn = $(this).find('button[type="submit"]');
            var originalBtnText = submitBtn.html();

            submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden"></span>');
            submitBtn.prop('disabled', true);

            var form = $(this);
            var formData = new FormData(this);

            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: formData,
                processData: false,
                contentType: false,
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        $("#settings_modal").modal('hide');
                        toastr.success(response.message);
                        $('#tickets_datatable').DataTable().ajax.reload();
                    }
                },
                error: function(xhr) {
                    if (xhr.status === 422) { 
                        /* Validation error*/
                        var errors = xhr.responseJSON.errors;

                        /* Loop through the errors and show them using toastr*/
                        $.each(errors, function(field, messages) {
                            $.each(messages, function(index, message) {
                                /* Display each error message*/
                                toastr.error(message); 
                            });
                        });
                    } else {
                        /*General error message*/ 
                        toastr.error('An error occurred. Please try again.');
                    }
                },
                complete: function() {
                    submitBtn.html(originalBtnText);
                    submitBtn.prop('disabled', false);
                }
            });
        });
        

        /*** Add ticket Modal Script****/
         ticket_modal();
         loadCustomers();
         ticket_assign();
         ticket_complain_type();
         new WOW().init();
        /*GET Customer Ticket*/
        $(document).on('change','#ticket_customer_id',function(){
            var customer_id = $(this).val();
            if (customer_id) {
                $.ajax({
                    url: "include/tickets_server.php",
                    type: "GET",
                    data: { get_customer_tickets: true, customer_id: customer_id },
                    dataType:'json',
                    success: function (response) {
                        if (response.success == true) {
                            $("#previous_tickets").removeClass('d-none');
                            let tickets = response.data;
                            let tableBody = $("#customer_tickets_table tbody");
                            tableBody.empty(); 
                            if (tickets.length > 0) {
                                tickets.forEach((ticket, index) => {
                                    let row = `
                                        <tr class="wow animate__animated animate__fadeInUp animate__delay-${index  * 0.1}s ">
                                            <td>${ticket.id}</td>
                                            <td>${ticket.complain_type}</td>
                                            <td>${ticket.priority}</td>
                                            <td>${ticket.parcent}</td>
                                            <td>${ticket.acctual_work}</td>
                                            <td>${ticket.status}</td>
                                        </tr>`;
                                    tableBody.append(row);
                                });
                            } else {
                                tableBody.append(`<tr><td colspan="6" class="text-center text-danger">No tickets found</td></tr>`);
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>

<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM  area_list WHERE id=$id ");
	if ($result==true) {
		header("location:pop_area.php");
	}else{

	}
}


 ?>

<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/pop_security.php");
include("include/users_right.php");
if (isset($_GET["id"])) {
    $areaId=$_GET['id'];
    if ($POP=$con->query("SELECT * FROM area_list WHERE id='$areaId'")) {
        while($rows=$POP->fetch_array()){
            $id=$rows["id"];
            $area_name=$rows["name"];
            $billing_date=$rows["billing_date"];
        }
    }
}


?>



<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    
    </head>

    <body data-sidebar="dark">


      

        <!-- Begin page -->
        <div id="layout-wrapper">
        
           <?php  $page_title="Update Area"; include 'Header.php';?>
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                <div id="alertMsg" class="alert alert-success p-2 mt-3" style="width: 400px; display:none;">
                 <i class="mdi mdi-check-circle"></i>
                 <strong class="mx-2">Success!</strong> Update Data 
                </div>
           </div> 
            <div class="row mt-5 py-3 mr-3 ml-3">

                    <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center">Update Area</h4><br>
                        <form id="updateArea">
                            <label><b style="color: green;">Area Location*</b></label>
                            <input class="d-none" type="text" value="<?php echo $id; ?>" name="id">
                            <input id="form" name="area" class="form-control form-control-sm" type="text" value="<?php echo $area_name; ?>"><br>
                            <label><b style="color: green;">Billing Date*</b></label>
                            <input type="text" name="billing_date" class="form-control form-control-sm" value="<?php echo $billing_date ?? 0; ?>"><br>
                            <button id="up_area_button" class="btn btn-primary mr-1">Update</button>
                            <a href="pop_area.php" id="up_delete_button" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                    </div>

                </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php'; ?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <?php include 'script.php';?>
   <script type="text/javascript">
    $(document).ready(function(){
        $("#up_area_button").click(function(e){
            e.preventDefault();
            var formData=$("#updateArea").serialize();
            $.ajax({
            type:"GET",
            url:"include/add_area.php?update",
            data:formData,
            cache:false,
            success:function(){
                toastr.success(
                      'Success!',
                      'Data Update Success!',
                      'success'
                        )
                }
           });
        });
    });
</script>
    </body>
</html>
<?php
   include "include/security_token.php";
   include "include/db_connect.php";
   include "include/pop_security.php";
   include "include/users_right.php";
   
   ?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css" />

    <style>
        

    </style>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">


        <?php $page_title="Area/House"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Area/House no</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>

                             
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-header">
                                    <button type="button" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"  data-bs-toggle="modal" data-bs-target="#addModal"> Add House no</button>
                                </div>
                                <div class="card-body">
                                <table id="areaDataTable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Area Name</th>
                                            <th>House/Holding No</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="area_table">
    <?php 
    if ($area_list = $con->query("SELECT al.id AS area_id, al.name AS area_name, GROUP_CONCAT(ah.house_no SEPARATOR ', ') AS house_numbers FROM area_list al LEFT JOIN area_house ah ON al.id = ah.area_id GROUP BY al.id, al.name")) {
        while ($rows = $area_list->fetch_assoc()) {
            $house_id=$rows['id'];
            echo '<tr>';
            echo '<td>' . $rows['area_id'] . '</td>';
            echo '<td>' . $rows['area_name'] . '</td>';
            
            if (!empty($rows['house_numbers'])) {
                $house_numbers = explode(', ', $rows['house_numbers']); 
                
                echo '<td><ul>';
                foreach ($house_numbers as $house_no) {
                    echo '<li><a href="area_house_view.php?house_id=' . $house_id . '&area_id=' . $rows['area_id'] . '&house_no=' . $house_no . '">' . $house_no . '</a></li>';
                }
                echo '</ul></td>';
            } else {
                echo '<td></td>';
            }
            
            echo '<td>
                    <a href="new_page.php?area_id=' . $rows['area_id'] . '" class="btn btn-success btn-sm"><i class="fas fa-eye"></i></a>
                  </td>';
            echo '</tr>';
        }
    }
    ?>
</tbody>

                                </table>

                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <div class="modal fade" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="addModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Area</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <form id="form-area">
                                <div class="form-group mb-1">
                                    <label>Area</label>
                                    <select class="form-select" name="area_id" id="area_id" style="width: 100%;">
                                        <option value="">Select</option>
                                        <?php
                                        if ($pop = $con->query("SELECT * FROM area_list")) {
                                            while ($rows = $pop->fetch_array()) {
                                                $id = $rows['id'];
                                                $name = $rows['name'];
                                                echo '<option value="' . $id . '">' . $name . '</option>';
                                            }
                                        }
                                        ?>
                                    </select>
                                </div>
                                <div class="form-group mb-1">
                                    <label>House/Building No.</label>
                                    <input class="form-control" type="text" name="house_no" id="house_no" placeholder="Type  House-Building No." />
                                  
                                </div>
                                <div class="form-group mb-1">
                                    <label>Note</label>
                                    <input class="form-control" type="text" name="note" id="note" placeholder="Type Your Note" />
                                </div>
                                <div class="d-none">
                                    <input type="hidden" id="lat" name="lat">
                                    <input type="hidden" id="lng" name="lng">
                                </div>
                                <div class="form-group mb-1">
                                    <label>Map Location</label>
                                    <div id="show_map" style="width: 100%; height: 400px;"></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="add_area" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript">
       $(document).ready(function () {
            $("#areaDataTable").DataTable();
            $("#addModal").on('show.bs.modal', function (event) {
            /*Check if select2 is already initialized*/
            if (!$('#area_id').hasClass("select2-hidden-accessible")) {
                    $("#area_id").select2({
                        dropdownParent: $("#addModal"),
                        placeholder: "---Select---"
                    });
                }
            }); 

            $(document).on('click','#add_area',function(){
                // var formData=$("#form-area").serialize();
                var area_id=$("select[name='area_id']").val();
                var house_no=$("input[name='house_no']").val();
                var note=$("input[name='note']").val();
                var lat=$("input[name='lat']").val();
                var lng=$("input[name='lng']").val();
                var formData = "area_id=" + area_id + 
                                "&house_no=" + house_no + 
                                "&note=" + note + 
                                "&lat=" + lat + 
                                "&lng=" + lng;
                $.ajax({
                    type:'POST',
                    url:'include/add_area.php?add_area_house',
                    data:formData,
                    cache:false,
                    success:function(response){
                        if(response==1){
                            $("#addModal").modal('hide');
                            toastr.success("Successfully Added");
                            setTimeout(() => {
                                location.reload();     
                            }, 500);
                        }
                    }
                });
            });
        });
    function initMap2() {
        const initialLocation = { lat: 23.5565964, lng: 90.7866716 }; 
        const map = new google.maps.Map(document.getElementById("show_map"), {
            center: initialLocation,
            zoom: 12,
        });

        let marker;

        map.addListener("click", (event) => {
            const clickedLocation = event.latLng;
            if (!marker) {
                marker = new google.maps.Marker({
                    position: clickedLocation,
                    map: map,
                });
            } else {
                marker.setPosition(clickedLocation);
            }

            document.getElementById("lat").value = clickedLocation.lat();
            document.getElementById("lng").value = clickedLocation.lng();
        });
    }
    </script>
    <!-- Load Google Maps API --> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuBbBNNwQbS81QdDrQOMq2WlSFiU1QdIs&callback=initMap2" async defer></script>
</body>

</html>

<?php
   include "include/security_token.php";
   include "include/db_connect.php";
   include "include/pop_security.php";
   include "include/users_right.php";
   
   ?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php
    
        include 'style.php';
        
        ?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">


        <?php $page_title="Google Map "; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Google Map</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>

                             
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div id="map" style="width: 100%; height: 500px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script>
    function loadMaps() {
        initMap();  
        initMap2();
    }

   /*Multiple Markers Location*/
    function initMap() {
        const mapOptions = {
            center: { lat: 23.5330279, lng: 90.8000572 },
            zoom: 12,
        };

        const map = new google.maps.Map(document.getElementById("map"), mapOptions);

        $.ajax({
            url: 'include/add_area.php?get_locations_for_google_map=true',
            type: 'GET',
            dataType: "json",
            success: function (locations) {
                locations.forEach(location => {
                    const marker = new google.maps.Marker({
                        position: { lat: parseFloat(location.lat), lng: parseFloat(location.lng) },
                        map: map,
                        title: location.name,
                    });

                    const infoWindow = new google.maps.InfoWindow({
                        content: `<h3>${location.name}</h3><p>Coordinates: (${location.lat}, ${location.lng})</p>`,
                    });

                    marker.addListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                });
            },
            error:function(xhr,status,error){
                console.error("AJAX Error:", error);
            }
        });
    }

    function initMap2() {
        const initialLocation = { lat: 23.8103, lng: 90.4125 }; 
        const map = new google.maps.Map(document.getElementById("show_map"), {
            center: initialLocation,
            zoom: 12,
        });

        let marker;

        map.addListener("click", (event) => {
            const clickedLocation = event.latLng;
            if (!marker) {
                marker = new google.maps.Marker({
                    position: clickedLocation,
                    map: map,
                });
            } else {
                marker.setPosition(clickedLocation);
            }

            document.getElementById("lat").value = clickedLocation.lat();
            document.getElementById("lng").value = clickedLocation.lng();
        });
    }
    $(document).on('click','#add_area',function(){
        // var formData=$("#form-area").serialize();
        var pop_id=$("select[name='pop_id']").val();
        var area=$("input[name='area']").val();
        var lat=$("input[name='lat']").val();
        var lng=$("input[name='lng']").val();
        var formData="pop_id="+pop_id+"&area="+area+"&lat="+lat+"&lng="+lng;
        $.ajax({
            type:'POST',
            url:'include/add_area.php?add_area_for_google_map',
            data:formData,
            cache:false,
            success:function(response){
                if(response==1){
                    toastr.success("Area Added Success");
                    setTimeout(() => {
                        location.reload();     
                    }, 1000);
                   
                }
              
            }
        });
    });
</script>

   <!-- Load Google Maps API --> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuBbBNNwQbS81QdDrQOMq2WlSFiU1QdIs&callback=loadMaps" async defer></script>
 

</body>

</html>

<?php
include("include/security_token.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Attendance";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Attendance</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;Add New Attendance</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Employee Name</th>
                                                    <th>Duty Date</th>
                                                    <th>Shift</th>
                                                    <th>Time In</th>
                                                    <th>Time Out</th>
                                                    <th>Working Time</th>
                                                    <th>Over Time</th>
                                                    <th>Status</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
    <!-- Add Modal -->
    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New Attendance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?add_attendance=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Employee Name</label>
                            <select name="employee_id" class="form-select" type="text" style="width: 100%;" required></select>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Duty Date</label>
                            <input name="duty_date" class="form-control" type="date" value="<?php echo date('Y-m-d');?>" required>
                        </div>
                        <div class="form-group mb-2">
                            <label>Shift </label>
                            <select name="shift_id" class="form-select" type="text" required></select>
                        </div>        
                        <div class="form-group mb-2">
                            <label>Time In</label>
                            <input name="time_in" class="form-control" type="time"  required>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Time Out</label>
                            <input name="time_out" class="form-control" type="time"  required>
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?edit_employee=true" method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Employee Code</label>
                                    <input type="text" name="id" class="d-none">
                                    <input name="employee_code" placeholder="Enter Employee Code" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Employee Name</label>
                                    <input name="name" placeholder="Enter Employee Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Father's Name</label>
                                    <input name="father_name" placeholder="Enter Father's Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Mother's Name</label>
                                    <input name="mother_name" placeholder="Enter Mother's Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>NID</label>
                                    <input name="nid" placeholder="Enter NID" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Birth Date</label>
                                    <input name="birth_date" class="form-control" type="date">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Gender</label>
                                    <select name="gender" class="form-select">
                                        <option >--Select---</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Phone Number</label>
                                    <input name="phone_number" placeholder="Enter Phone Number" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Email</label>
                                    <input name="email" placeholder="Enter Email" class="form-control" type="email">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Address</label>
                                    <input name="address" placeholder="Enter Address" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Division</label>
                                    <input name="division" placeholder="Enter Division" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>District</label>
                                    <input name="district" placeholder="Enter District" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Upazila</label>
                                    <input name="upazila" placeholder="Enter Upazila" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Postal Code</label>
                                    <input name="postal_code" placeholder="Enter Postal Code" class="form-control" type="text">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Bottom Row -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Joining Date</label>
                                    <input name="joining_date" class="form-control" type="date">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Designation</label>
                                    <input name="designation" placeholder="Enter Designation" class="form-control" type="text">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Department</label>
                                    <select name="department" class="form-select" type="text">

                                    </select>
                                </div>
                                <div class="form-group mb-3">
                                    <label>Salary</label>
                                    <input name="salary" placeholder="Enter Salary" class="form-control" type="text">
                                </div>
                            </div>
                        </div>

                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/hrm_server.php?show_attendance_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Leave Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Leave Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var shift_id = $(this).data("id");
        $.ajax({
            url: "include/hrm_server.php?get_leave=true", 
            type: "GET",
            data: { id: shift_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal select[name="employee_id"]').val(response.data.employee_id);
                $('#editModal select[name="leave_type"]').val(response.data.leave_type);
                $('#editModal textarea[name="leave_reason"]').val(response.data.leave_reason);
                $('#editModal select[name="leave_status"]').val(response.data.leave_status);
                $('#editModal input[name="start_date"]').val(response.data.start_date);
                $('#editModal input[name="end_date"]').val(response.data.end_date);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/hrm_server.php', 
                data: { leave_delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });
    loadEmployee();
    function loadEmployee(){
        $.ajax({
            type: 'GET', 
            url: 'include/hrm_server.php', 
            data: { get_all_employee: true }, 
            dataType:'json',
            success: function(response) {
                var form = $("select[name='employee_id']");
                form.append("<option value=''>---Select---</option>");
                for (var i = 0; i < response.data.length; i++) {
                    form.append("<option value='" + response.data[i].id + "'>" + response.data[i].name + "</option>");
                }

            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error deleting item! " + error);
            }
        });
    }
    loadShift();
    function loadShift(){
        $.ajax({
            type: 'GET', 
            url: 'include/hrm_server.php', 
            data: { get_all_shift: true }, 
            dataType:'json',
            success: function(response) {
                var form = $("select[name='shift_id']");
                form.append("<option value=''>---Select---</option>");
                for (var i = 0; i < response.data.length; i++) {
                    form.append("<option value='" + response.data[i].id + "'>" + response.data[i].shift_name + "</option>");
                }

            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error deleting item! " + error);
            }
        });
    }
    $("#addModal").on('show.bs.modal', function (event) {
        /*Check if select2 is already initialized*/
        if (!$("select[name='employee_id']").hasClass("select2-hidden-accessible")) {
            $("select[name='employee_id']").select2({
                dropdownParent: $("#addModal"),
                placeholder: "Select Employee"
            });
        }
     }); 
    </script>
</body>

</html>

<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_SESSION['uid'])) {
    $ledgr_id = $_SESSION["uid"];
}

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    
</head>

<body data-sidebar="dark">
    <!-- Begin page -->
    <div id="layout-wrapper">
       <?php $page_title="Balance Sheet"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">From Date</label>
                                            <input type="date" class="form-control" id="fromDate">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">To Date</label>
                                            <input type="date" class="form-control" id="endDate">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">Master Ledger</label>
                                            <select class="form-select" id="masterLedger">
                                                <option value="">Select</option>
                                                <option value="1" selected>Balance Sheet</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" id="searchBtn" class="btn btn-primary mt-3">Search Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="table-responsive" id="tableArea"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Add Sub Ledger</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">

                                        <div class="form-group mb-2" style="width:100%">
                                            <label for="">Ledger Name</label>
                                            <select name="ledger_id" id="sub_ledger_id" class="form-select">
                                                <?php
                                                if ($ledgr = $con->query("SELECT * FROM ledger")) {

                                                    while ($rowsitm = $ledgr->fetch_array()) {
                                                        $ldgritmsID = $rowsitm["id"];
                                                        $ledger_name = $rowsitm["ledger_name"];
                                                        echo '<option value="' . $ldgritmsID . '">' . $ledger_name . '</option>';
                                                    }
                                                }


                                                ?>
                                            </select>
                                        </div>
                                        <div class="form-group mb-2">
                                            <label for="">Sub Ledger Name</label>
                                            <input id="item_name" type="text" class="form-control" placeholder="Enter Item Name">
                                        </div>
                                        <div class="form-group mb-2">
                                            <label for="">Description</label>
                                            <input id="subLedgerDescription" type="text" class="form-control" name="description" placeholder="description">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button id="addSubLedgerBtn" type="submit" class="btn btn-primary">Add Sub Ledger</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->

    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $(document).on('click', '#searchBtn', function() {
                var masterLedger = $('#masterLedger').val();
                var fromDate = $('#fromDate').val();
                var endDate = $('#endDate').val();

                if (fromDate.length == 0) {
                    toastr.error("From Date is Require");
                } else if (endDate.length == 0) {
                    toastr.error("To Date is Require");
                } else if (masterLedger.length == 0) {
                    toastr.error("Please Select Ledger");
                } else {
                    $("#searchBtn").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                    
                    $.ajax({
                        type: 'POST',
                        data: {
                            masterLedger: masterLedger,
                            fromDate: fromDate,
                            endDate: endDate,
                            get_balance_sheet_report: 0,
                        },
                        url: "include/transactions_server.php",
                        success: function(response) {
                            $("#searchBtn").html('Search Now');
                            $('#tableArea').html(response);
                        },
                        error: function(xhr, status, error) {
                            // handle the error response
                            console.log(error);
                        }
                    });
                }

            });
        });

        function printTable() {
            var divToPrint = document.getElementsByClassName('report_table');
            var newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Customer</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('a { text-decoration: none; color: black; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }
    </script>


</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Bank List";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Units</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;Create Bank</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead >
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Bank Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Account Number</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
     <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Create Bank</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/bank_server.php?add_bank=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Bank Name</label>
                            <input name="bank_name" placeholder="Enter Bank Name" class="form-control" type="text" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>Branch Name</label>
                            <input name="branch_name" placeholder="Enter Branch Name" class="form-control" type="text" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>Account Number</label>
                            <input name="account_number" placeholder="Enter Account Number" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Bank</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Bank</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/bank_server.php?update_bank=true" method="POST" enctype="multipart/form-data" >          
                        <div class="form-group mb-2">
                            <label>Bank Name</label>
                             <input name="id" class="d-none" type="text" >
                             <input name="bank_name" placeholder="Enter Bank Name" class="form-control" type="text" >
                        </div>   
                        <div class="form-group mb-2">
                            <label>Branch Name</label>
                            <input name="branch_name" placeholder="Enter Branch Name" class="form-control" type="text" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>Account Number</label>
                            <input name="account_number" placeholder="Enter Account Number" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/bank_server.php?show_bank_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Department Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Department Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var _id = $(this).data("id");
        $.ajax({
            url: "include/bank_server.php?get_bank=true", 
            type: "GET",
            data: { id: _id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal input[name="bank_name"]').val(response.data.bank_name);
                $('#editModal input[name="branch_name"]').val(response.data.branch_name);
                $('#editModal input[name="account_number"]').val(response.data.account_number);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/bank_server.php', 
                data: { delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    </script>
</body>

</html>

<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';

// $bank_transaction = $con->query("SELECT  b.id, b.bank_name AS bank_name,
//             COALESCE(SUM(CASE WHEN bt.transaction_type = 'credit' THEN bt.amount ELSE 0 END), 0) AS total_credit,
//             COALESCE(SUM(CASE WHEN bt.transaction_type = 'debit' THEN bt.amount ELSE 0 END), 0) AS total_debit,

//             (COALESCE(SUM(CASE WHEN bt.transaction_type = 'debit' THEN bt.amount ELSE 0 END),0)-
//              COALESCE(SUM(CASE WHEN bt.transaction_type = 'credit' THEN bt.amount ELSE 0 END), 0)) AS balance

//         FROM banks b
//         LEFT JOIN bank_transactions bt ON b.id = bt.bank_id
//         GROUP BY b.id, b.bank_name");
$bank_transaction = $con->query("SELECT 
            bt.id,
            b.bank_name AS bank_name,
            bt.transaction_type,
            bt.amount,
            bt.transaction_date,
            bt.description
        FROM bank_transactions bt
        JOIN banks b ON bt.bank_id = b.id
        ORDER BY bt.transaction_date ASC");
$balances = [];
?>

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Bank Transaction';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Bank Transaction</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-header bg-white">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group mb-2">
                                                <label for="">From Date</label>
                                                <input type="date" class="form-control" id="fromDate">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group mb-2">
                                                <label for="">To Date</label>
                                                <input type="date" class="form-control" id="endDate"
                                                    value="<?php echo date('Y-m-d'); ?>">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group mb-2">
                                                <label for="">Bank Account</label>
                                                <select class="form-select" id="bank_id">
                                                    <option value="">Select</option>
                                                    <?php
                                                    if ($get_all_bank = $con->query('SELECT * FROM banks')) {
                                                        while ($rows = $get_all_bank->fetch_array()) {
                                                            echo '<option value="' . $rows['id'] . '">' . $rows['bank_name'] . '</option>';
                                                        }
                                                    }
                                                    
                                                    ?>

                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <button type="button" id="searchBtn" class="btn btn-primary "
                                                style="margin-top: 20px;">Search Now</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body" id="tableArea">
                                    
                                </div>

                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Modal -->
    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span>
                        &nbsp;Create Bank</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/bank_server.php?add_bank=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Bank Name</label>
                            <input name="bank_name" placeholder="Enter Bank Name" class="form-control"
                                type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label>Branch Name</label>
                            <input name="branch_name" placeholder="Enter Branch Name" class="form-control"
                                type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label>Account Number</label>
                            <input name="account_number" placeholder="Enter Account Number" class="form-control"
                                type="text">
                        </div>
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Bank</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                            class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Bank</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/bank_server.php?update_bank=true" method="POST"
                        enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Bank Name</label>
                            <input name="id" class="d-none" type="text">
                            <input name="bank_name" placeholder="Enter Bank Name" class="form-control"
                                type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label>Branch Name</label>
                            <input name="branch_name" placeholder="Enter Branch Name" class="form-control"
                                type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label>Account Number</label>
                            <input name="account_number" placeholder="Enter Account Number" class="form-control"
                                type="text">
                        </div>
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#bank_id").select2();

        });
        $(document).on('click', '#searchBtn', function() {
            var bank_id = $('#bank_id').val();
            var fromDate = $('#fromDate').val();
            var endDate = $('#endDate').val();

            if (fromDate.length == 0) {
                toastr.error("From Date is Require");
            } else if (endDate.length == 0) {
                toastr.error("To Date is Require");
            } else if (bank_id.length == 0) {
                toastr.error("Please Select Bank");
            } else {
                $("#searchBtn").html(
                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');

                $.ajax({
                    type: 'POST',
                    data: {
                        bank_id: bank_id,
                        fromDate: fromDate,
                        endDate: endDate,
                        getReport: 1,
                    },
                    url: "include/bank_server.php",
                    success: function(response) {
                        $("#searchBtn").html('Search Now');
                        $('#tableArea').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }

        });
    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";


?>


<!doctype html>
<html lang="en">
    <head>
    
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">


       

        <!-- Begin page -->
        <div id="layout-wrapper">
        
           <?php $page_title="Bill Collection"; include 'Header.php';?>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                     <div class="col-md-12 grid-margin">
                        <div class="d-flex justify-content-between flex-wrap">
                           <div class="d-flex align-items-end flex-wrap">
                              <div class="mr-md-3 mr-xl-5">
                                 <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Bill Collection</p>
                                 </div>
                              </div>
                              <br>
                           </div>
                           <div class="d-flex justify-content-between align-items-end flex-wrap">
                              
                           </div>
                        </div>
                     </div>
                  </div>
            <div class="row">
                     <div class="col-md-12 stretch-card">
                        <div class="card">
                           
                           <div class="card-body">
                              <span class="card-title"></span>
                              <div class="col-md-6 float-md-right grid-margin-sm-0">
                                 <div class="form-group">
                                    
                                       
                                 </div>
                              </div>
                              <div class="table-responsive">
                                <div class="form-inline float-right mb-3" style="width: 300px;">
                                    <select id="select_user_id" class="form-select">
                                        <option value="">Select User</option>
                                        <?php 
                                        /* Fetching users from the database*/
                                        $userResult = $con->query("SELECT id, fullname FROM users WHERE user_type='1'");
                                        
                                        while ($userRow = mysqli_fetch_assoc($userResult)) {
                                            echo "<option value='" . $userRow['id'] . "'>" . $userRow['fullname'] . "</option>";
                                        }
                                        ?>
                                    </select>
                                </div>
                              <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Recharged Date</th>
                                        <th>Collect By</th>
                                        <th>Amount</th>
                                        <th></th>
                                        
                                    </tr>
                                </thead>
    <tbody id="tableBody">
    <?php 
$result = $con->query("SELECT u.id, DATE(cr.datetm) AS recharge_date, SUM(cr.purchase_price) AS total_collection, u.fullname AS recharge_by_name  FROM customer_rechrg cr JOIN users u ON cr.rchg_by = u.id WHERE cr.status = '0' AND cr.type !='0' GROUP BY u.id, DATE(cr.datetm), u.fullname ORDER BY recharge_date DESC");

while ($rows = mysqli_fetch_assoc($result)) {
    $recharge_date = $rows['recharge_date'];
    $yearMonth = date("Y-m-d", strtotime($recharge_date)); 
?>
<tr>
    <td>
        <input type="checkbox"  data-id="<?php echo $rows['id']; ?>" data-collection_date="<?php echo $rows['recharge_date']; ?>">
    </td>
    <td>
        <a href="daily_recharge.php?date=<?php echo $yearMonth; ?>&user_id=<?php echo $rows['id'];?>">
            <?php 
            $dateTm = new DateTime($recharge_date);
            echo $dateTm->format("d-M-Y");
            ?>
        </a>
    </td>
    <td><?php echo $rows["recharge_by_name"]; ?></td>
    <td><?php echo $rows["total_collection"]; ?></td>
    <td>
        <a   href="daily_recharge.php?date=<?php echo $yearMonth; ?>&user_id=<?php echo $rows['id'];?>" class="btn-sm btn btn-success"><i class="fas fa-eye"></i> </a>
    </td>
</tr>
<?php } ?>

    </tbody>
</table>


                              </div>
                           </div>
                           <div class="card-footer" style="text-align: right;">
                                <button type="submit" name="bill_button" class=" btn btn-danger">Total Cash Collection</button>
                            </div>
                        </div>
                     </div>
                  </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php';?>

</div>



<div class="modal fade bs-example-modal-lg" id="bill_modal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog " role="document">
        <div class="modal-content col-md-12">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Bill Collect
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="include/bill_collection_server.php?add_collection" method="POST" enctype="multipart/form-data">
                    <div class="form-group mb-2 d-none">
                        <input name="user_id" id="user_id" class="form-control" type="text" required>
                    </div>
                    <div class="form-group mb-2">
                        <label>Collection Date</label>
                        <input type="text"  name="collection_date" id="collection_date" class="form-control" readonly>
                    </div> 
                    <div class="form-group mb-2">
                        <label>Total Amount</label>
                        <input name="total_amount" id="total_amount" placeholder="Enter Amount" class="form-control" type="text" readonly>
                    </div>              
                    <div class="form-group mb-2">
                        <label>Received Amount</label>
                        <input name="received_amount" id="received_amount" placeholder="Enter Amount" class="form-control" type="text" required>
                    </div>              
                    <div class="form-group mb-2">
                        <label>Remarks</label>
                        <input name="note" id="note" placeholder="Enter Remarks" class="form-control" type="text" >
                    </div>              
                                 
                    <div class="modal-footer ">
                        <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

    

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
      
        
        <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript">
        $(document).ready(function(){
            $("#select_user_id").select2();
            $('#select_user_id').change(function() {
                var userId = $(this).val();

                $.ajax({
                    url: 'include/bill_collection_server.php?show_data_filter',
                    type: 'GET',
                    data: { user_id: userId },
                    success: function(response) {
                        var data = JSON.parse(response);
                        $('#tableBody').html(data.tableData);
                        $('#pagination').html(data.pagination);
                    }
                });
            });
             /* Filter With Pagination*/
            $(document).on('click', '.pagination-link', function(e) {
                e.preventDefault();
                var page = $(this).data('page');
                var userId = $('#select_user_id').val();

                $.ajax({
                    url: 'include/bill_collection_server.php?show_data_filter',
                    type: 'GET',
                    data: { user_id: userId, page: page },
                    success: function(response) {
                        var data = JSON.parse(response);
                        $('#tableBody').html(data.tableData);
                        $('#pagination').html(data.pagination);
                    }
                });
            });
             /* Only allow one checkbox to be selected*/
            $('#datatable input[type="checkbox"]').on('click', function() {
                if ($(this).is(':checked')) {
                    $('#datatable input[type="checkbox"]').not(this).prop('checked', false);
                }
            });

            /*When the bill button is clicked*/ 
            $("button[name='bill_button']").click(function(){
                 var select_id = [];
                var totalAmount = '';
                var collectionDate=[]
                $('#datatable input[type="checkbox"]:checked').each(function() {
                    select_id.push($(this).data('id'));
                    collectionDate.push($(this).data('collection_date'));

                    /* Get the row's data from the table*/
                    var row = $(this).closest('tr');
                    console.log(row); 
                    totalAmount = row.find('td:eq(3)').text().trim(); 
                });
                /* Set the values in the modal's form fields*/
                $('#total_amount').val(totalAmount);
                $("input[name='collection_date']").val(collectionDate);
                $("input[name='user_id']").val(select_id);

                if (select_id.length > 0) {
                    $("#bill_modal").modal('show');
                } else {
                    toastr.error("Please Select Checkbox");
                }
            });
             /** Store The data from the database table **/
            $('#bill_modal form').submit(function(e){
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                type:'POST',
                'url':url,
                data: formData,
                dataType:'json',
                success: function (response) {
                    /* Check if the request was successful*/
                    if (response.success) {
                        /*Hide the modal*/ 
                        $('#bill_modal').modal('hide'); 
                        /*Reset the form*/ 
                        $('#bill_modal form')[0].reset();
                        /* Show success message*/
                        toastr.success(response.message); 

                        /*Reload the page after a short delay*/ 
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    }
                },


                error: function (xhr, status, error) {
                    /** Handle  errors **/
                    if (xhr.status === 422) {
                        var errors = xhr.responseJSON.errors;
                        $.each(errors, function(key, value) {
                            toastr.error(value[0]); 
                        });
                    }
                }
                });
            });
        });

    </script>
    </body>
</html>

<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';

?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customers Billing Report';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers Billing Report</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">


                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                    <div id="totalAmount" style="font-weight: bold; color:green; font-size: 18px; margin-bottom: 10px; text-align: right;"></div>
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Customer Name</th>
                                                    <th>Target Amount</th>
                                                    <th>Collection Amount</th>

                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                            <tfoot>
                                                <tr class="bg-info text-white">
                                                    <th colspan="2" style="text-align:right">Total:</th>
                                                    <th id="total_target_amount">0.00</th>
                                                    <th id="total_collection_amount">0.00</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php require 'script.php'; ?>
    <script type="text/javascript">

    /* Generate Month Dropdown */
    function getMonthOptions(selectedMonth) {
        const months = [
            "January", "February", "March", "April", "May", "June", 
            "July", "August", "September", "October", "November", "December"
        ];
        
        let options = "";
        months.forEach((month, index) => {
            let value = (index + 1).toString().padStart(2, '0'); 
            let selected = (value === selectedMonth) ? "selected" : "";
            options += `<option value="${value}" ${selected}>${month}</option>`;
        });

        return options;
    }

    /* Generate Year Dropdown */
    function getYearOptions(selectedYear) {
        let options = "";
        let currentYear = new Date().getFullYear();
        for (let year = currentYear - 5; year <= currentYear + 5; year++) {
            let selected = (year === selectedYear) ? "selected" : "";
            options += `<option value="${year}" ${selected}>${year}</option>`;
        }
        return options;
    }

    /* Get Current Month & Year*/
    let currentMonth = new Date().getMonth() + 1; 
    let currentMonthStr = currentMonth.toString().padStart(2, '0'); 
    let currentYear = new Date().getFullYear(); 

    // Month & Year Filters
    var from_month = `<label style="margin-left: 20px;">
                        <select class="from_month form-control" style="width: 120px; display: inline;">
                            ${getMonthOptions(currentMonthStr)}
                        </select>
                    </label>`;


    var year_filter = `<label style="margin-left: 10px;">
                        <select class="year_filter form-control" style="width: 100px; display: inline;">
                            ${getYearOptions(currentYear)}
                        </select>
                    </label>`;

    setTimeout(() => {
        let filterContainer = $('.dataTables_filter');

        filterContainer.append(from_month);
        filterContainer.append(year_filter);

        // $('.from_month').select2();
        // $('.year_filter').select2();

    }, 500);


    /* DataTable Initialization */
    $('#datatable').DataTable({
        searching: true,
        paging: true,
        info: true,
        order: [[0, "desc"]],
        lengthChange: true,
        processing: true,
        serverSide: true,
        lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, 'All']
        ],
        language: {
            zeroRecords: "No matching records found"
        },
        ajax: {
            url: "include/customer_recharge_server.php?get_customer_billing_report=true",
            type: 'GET',
            data: function(d) {
                d.from_month = $('.from_month').val() || '<?php echo date('m');?>';
                d.year = $('.year_filter').val() || '<?php echo date('Y');?>';
                // d.from_month ='03';
                // d.year = '2025';
            },
            beforeSend: function() {
                $(".dataTables_empty").html(
                    '<img src="assets/images/loading.gif" style="background-color: transparent"/>'
                    );
            },
            dataSrc: function (json) {
                $('#total_target_amount').html(json.total_target_amount);
                $('#total_collection_amount').html(json.total_collection_amount);
                return json.data;
            }

        },
        drawCallback: function() {
            $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
        }
    });
    $(document).on('change','.from_month',function(){
        $('#datatable').DataTable().ajax.reload();
    });
    $(document).on('change','.year_filter',function(){
        $('#datatable').DataTable().ajax.reload();
    });

    </script>
</body>

</html>
<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM `product_brand` WHERE id=$id ");
	if ($result==true) {
		header("location:brand.php");
	}else{

	}
}


 ?>

<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $brandId=$_GET['id'];
    if ($brand=$con->query("SELECT * FROM product_brand WHERE id='$brandId'")) {
        while($rows=$brand->fetch_array()){
            $id=$rows["id"];
            $name=$rows["name"];
        }
    }
}


?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Brand Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="container">
                            
                    <div class="row mt-5 py-3 mr-3 ml-3">

                    <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center">Update Brand</h4><br>
                        <form id="brand_form">
                            <label><b style="color: green;">Brand Name*</b></label>
                            <input class="d-none" type="text" value="<?php echo $id; ?>" name="id">
                            <input id="form" name="brand" class="form-control form-control-sm" type="text" value="<?php echo $name; ?>"><br>
                            <button type="submit" id="brand_button" class="btn btn-success mr-1">Update</button>
                            <a href="brand.php" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                    </div>

                </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>
        
        
        <!-- Peity chart-->
        <script src="assets/libs/peity/jquery.peity.min.js"></script>
        
        <!--C3 Chart-->
        <script src="assets/libs/d3/d3.min.js"></script>
        <script src="assets/libs/c3/c3.min.js"></script> 
        <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
        
        <script src="assets/js/pages/dashboard.init.js"></script>
        
        <script src="assets/js/app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script type="text/javascript" src="assets/js/js-fluid-meter.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
   <script type="text/javascript">
    $(document).ready(function(){
        $("#brand_button").click(function(e){
            e.preventDefault();
            var formData=$("#brand_form").serialize();
            alert("Are You Sure!");
            $.ajax({
            type:"GET",
            url:"include/brand.php?update",
            data:formData,
            cache:false,
            success:function(){
                 Swal.fire(
                      'Success!',
                      'Data Update Success!',
                      'success'
                        )

                }
           });
        });
    });
</script>

    </body>
</html>
<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Brand</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Brand</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                              Brand</button>
                          </div>
                            </div>
                        </div>
                    </div>






                    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Add Brand</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="card">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-md-12">
                                       <form id="form-brand">
                                          <input class="form-control" type="text" name="brand" id="brand" placeholder="Type Your Brand"/>
                                       </form>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Close</button>
                              <button id="add_brand" type="button" class="btn btn-primary">Add Brand</button>
                           </div>
                        </div>
                     </div>
                  </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">




                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                  <th>ID</th>
                                                  <th>Brand Name List</th>
                                                  <th></th>
                                               </tr>
                                            </thead>
                                            <tbody>
         <?php 

                          $sql="SELECT * FROM product_brand";
                          $result=mysqli_query($con,$sql);

                          while ($rows=mysqli_fetch_assoc($result)) {

                           ?>

                           <tr>
        <td><?php echo $rows['id']; ?></td>
        <td><?php echo $rows['name']; ?></td>
       <td style="text-align:right">
        <a class="btn btn-info" href="brand_edit.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>

        <a onclick=" return confirm('Are You Sure');" class="btn btn-danger" href="brand_delete.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i>
        </a>

        </td>
        </tr>
                       <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>

     <script type="text/javascript">
   $("#brand-list").load("include/brand.php?list");
        $.ajax({
            type: "GET",
            url: "include/brand.php?list",
            cache: false,
            success: function(brandList) {
                $("#brand-list").html(brandList);
            }
        });
       $("#add_brand").click(function(){
        var brand=$("#brand").val();
        if (brand.length==0) {
            toastr.error("Brand name is required");
        }else{
            var formData=$("#form-brand").serialize();
         $.ajax({
         type:"GET",
         data:formData,
         url:"include/brand.php?add",
         cache:false,
         success: function(customerslist) {
                toastr.success("Brand Added Successfully")
                $("#addModal").modal('hide');
                  setTimeout(()=>{location.reload();},1000);

                }
      });
        }
      
   });
      </script>

    </body>
</html>
<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/it-fast.png">
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">

</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Bulk Recharge</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        
                                    <form name="BlkRchFrm" id="BlkRchFrm" >
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th><input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"> All</th>
                                                    <th>ID</th>
                                                    <th>User Name</th>
                                                    <th>Package</th>
                                                    <th>Expire Date</th>
                                                    
                                                    <th>Mobile no.</th>
                                                    <th>Ref/Voucher</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            
                                            <tbody id="b_payment-list">
                                                <?php
                                                $sql = "SELECT * FROM customers WHERE user_type=$auth_usr_type AND status !='0'";
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {

                                                ?>

                                                    <tr>
                                                        <td><input type="checkbox" Value="<?php echo $rows["id"]; ?>" name="checkAll[]" class="checkSingle"></td>
                                                        <td><?php echo $rows["id"]; ?></td>
                                                        <td><?php echo $rows["username"]; ?></td>
                                                        <td>
                                                            <?php
                                                            $packName =  $rows["package"];
                                                            $allPOP = $con->query("SELECT * FROM `radgroupcheck` WHERE id=$packName ");
                                                            while ($popRow = $allPOP->fetch_array()) {
                                                                echo  $popRow['groupname'];
                                                            }


                                                            ?>

                                                        </td>
                                                        <td>
                                                            <?php

                                                            $expireDate = $rows["expiredate"];
                                                            $todayDate = date("Y-m-d");
                                                            if ($expireDate <= $todayDate) {
                                                                echo "<span class='badge bg-danger'>Expired</span>";
                                                            } else {
                                                                echo date("d M Y", strtotime($expireDate));
                                                            }
                                                            ?>

                                                        </td>
                                                        
                                                        <td><?php echo $rows["mobile"]; ?></td>
                                                        <td>
                                                            <input type="text" name="refNo[]" class="form-control form-control-sm" value='<?php //echo date('d-M-Y'); 
                                                                                                                            ?>'>
                                                        </td>
                                                        <td><input type="text" name="price[]" class="form-control form-control-sm" value=<?php echo $rows["price"]; ?>></td>

                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                                        
                                            <tfoot>
                                                <tr>
                                                    <th colspan="8"><button style="float:right" id="btnRchgProcs" class="btn btn-success">Process Recharge</button></th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#checkedAll").change(function() {
                if (this.checked) {
                    $(".checkSingle").each(function() {
                        this.checked = true;
                    })
                } else {
                    $(".checkSingle").each(function() {
                        this.checked = false;
                    })
                }
            });

            $(".checkSingle").click(function() {
                if ($(this).is(":checked")) {
                    var isAllChecked = 0;
                    $(".checkSingle").each(function() {
                        if (!this.checked)
                            isAllChecked = 1;
                    })
                    if (isAllChecked == 0) {
                        $("#checkedAll").prop("checked", true);
                    }
                } else {
                    $("#checkedAll").prop("checked", false);
                }
            });


            $("#btnRchgProcs").click(function() {

                var rchformdata = $("#BlkRchFrm").serialize();

                alert(rchformdata);



                $.ajax({
                        url: "include/bulk_recharge.php?recharge",
                        method: 'GET',
                        data: rchformdata,

                success: function(rspnsrchg) {
                    alert(rspnsrchg);
                    //var data = JSON.parse(response);
                    //$("#quantity").val('1');
                    //$("#value").val(data.purchase_price);
                    //$("#total").val(data.purchase_price);
                },
                error: function(xhr, status, error) {
                    // handle the error response
                    console.log(error);
                }
            });

            })




        });
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";


?>


<!doctype html>
<html lang="en">
    <head>
    
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">


    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
    <style>
        /* .form-inline {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        } */
    </style>
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Cash Collection</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                     <div class="col-md-12 grid-margin">
                        <div class="d-flex justify-content-between flex-wrap">
                           <div class="d-flex align-items-end flex-wrap">
                              <div class="mr-md-3 mr-xl-5">
                                 <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Cash Collection</p>
                                 </div>
                              </div>
                              <br>
                           </div>
                           <div class="d-flex justify-content-between align-items-end flex-wrap">
                              
                           </div>
                        </div>
                     </div>
                  </div>
            <div class="row">
                     <div class="col-md-12 stretch-card">
                        <div class="card">
                           <div class="card-body">
                              <span class="card-title"></span>
                              <div class="col-md-6 float-md-right grid-margin-sm-0">
                                 <div class="form-group">
                                    
                                       
                                 </div>
                              </div>
                              <div class="table-responsive">
                              <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cashed Collected From</th>
                                        <th>Cashed Received  By</th>
                                        <th>Collection Date</th>
                                        <th>Total Amount</th>
                                        <th>Received Amount</th>
                                        <th>Remarks</th>
                                        <th></th>
                                        
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <?php 
                                    $sql = "SELECT cc.id, cc.collection_date, cc.amount, cc.received_amount, cc.note, u.id AS USERID, u.fullname AS user_name, uploader.fullname AS uploader_name FROM cash_collection cc LEFT JOIN users u ON cc.user_id = u.id LEFT JOIN users uploader ON cc.uploader_info = uploader.id ORDER BY cc.id DESC";

                                    $result = mysqli_query($con, $sql);

                                    while ($rows = mysqli_fetch_assoc($result)) {
                                        $collection_date = $rows['collection_date'];
                                        $yearMonth = date("Y-m-d", strtotime($collection_date)); 
                                    ?>
                                    <tr>
                                    <td><?php echo $rows['id']; ?></td>
                                    <td><?php echo $rows["user_name"]; ?></td>
                                    <td><?php echo $rows["uploader_name"]; ?></td>
                                        <td>
                                            <a href="daily_recharge.php?date=<?php echo $yearMonth; ?>&user_id=<?php echo $rows['USERID'];?>">
                                                <?php 
                                                $dateTm = new DateTime($collection_date);
                                                echo $dateTm->format("d-M-Y");
                                                ?>
                                            </a>
                                        </td>
                                        <td><?php echo $rows["amount"]; ?></td>
                                        <td><?php echo $rows["received_amount"]; ?></td>
                                        <td><?php echo $rows["note"]; ?></td>
                                        <td>
                                        <a  href="daily_recharge.php?date=<?php echo $yearMonth; ?>&user_id=<?php echo $rows['USERID'];?>" class="btn-sm btn btn-success"><i class="fas fa-eye"></i> </a>
                                        </td>
                                       
                                    </tr>
                                    <?php } ?>
                                </tbody>
                            </table>


                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>





<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
      
        
        <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script src="assets/libs/select2/js/select2.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#select_user_id').change(function() {
                var userId = $(this).val();

                $.ajax({
                    url: 'include/bill_collection_server.php?show_data_filter',
                    type: 'GET',
                    data: { user_id: userId },
                    success: function(response) {
                        var data = JSON.parse(response);
                        $('#tableBody').html(data.tableData);
                        $('#pagination').html(data.pagination);
                    }
                });
            });
             /* Filter With Pagination*/
            $(document).on('click', '.pagination-link', function(e) {
                e.preventDefault();
                var page = $(this).data('page');
                var userId = $('#select_user_id').val();

                $.ajax({
                    url: 'include/bill_collection_server.php?show_data_filter',
                    type: 'GET',
                    data: { user_id: userId, page: page },
                    success: function(response) {
                        var data = JSON.parse(response);
                        $('#tableBody').html(data.tableData);
                        $('#pagination').html(data.pagination);
                    }
                });
            });
             /* Only allow one checkbox to be selected*/
            $('#datatable input[type="checkbox"]').on('click', function() {
                if ($(this).is(':checked')) {
                    $('#datatable input[type="checkbox"]').not(this).prop('checked', false);
                }
            });

            /*When the bill button is clicked*/ 
            $("button[name='bill_button']").click(function(){
                 var select_id = [];
                var totalAmount = '';
                var collectionDate=[]
                $('#datatable input[type="checkbox"]:checked').each(function() {
                    select_id.push($(this).data('id'));
                    collectionDate.push($(this).data('collection_date'));

                    /* Get the row's data from the table*/
                    var row = $(this).closest('tr');
                    console.log(row); 
                    totalAmount = row.find('td:eq(2)').text().trim(); 
                });
                /* Set the values in the modal's form fields*/
                $('#total_amount').val(totalAmount);
                $("input[name='collection_date']").val(collectionDate);
                $("input[name='user_id']").val(select_id);

                if (select_id.length > 0) {
                    $("#bill_modal").modal('show');
                } else {
                    toastr.error("Please Select Checkbox");
                }
            });
             /** Store The data from the database table **/
            $('#bill_modal form').submit(function(e){
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                type:'POST',
                'url':url,
                data: formData,
                dataType:'json',
                success: function (response) {
                    /* Check if the request was successful*/
                    if (response.success) {
                        /*Hide the modal*/ 
                        $('#bill_modal').modal('hide'); 
                        /*Reset the form*/ 
                        $('#bill_modal form')[0].reset();
                        /* Show success message*/
                        toastr.success(response.message); 

                        /*Reload the page after a short delay*/ 
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    }
                },


                error: function (xhr, status, error) {
                    /** Handle  errors **/
                    if (xhr.status === 422) {
                        var errors = xhr.responseJSON.errors;
                        $.each(errors, function(key, value) {
                            toastr.error(value[0]); 
                        });
                    }
                }
                });
            });
        });

    </script>
    </body>
</html>
<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	echo $id=$_GET['id'];

	$result=$con->query("DELETE FROM `product_cat` WHERE id='$id'");
	if ($result==true) {
		header("location:category.php");
	}else{

	}
}


 ?>

<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");

if (isset($_GET["id"])) {
    $categoryId=$_GET['id'];
    if ($category=$con->query("SELECT * FROM product_cat WHERE id='$categoryId'")) {
        while($rows=$category->fetch_array()){
            $id=$rows["id"];
            $category_name=$rows["name"];
        }
    }
}


?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
           <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Update Category</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="container">
                            <div id="alertMsg" class="alert alert-success p-2 mt-3" style="width: 400px; display:none;">
                             <i class="mdi mdi-check-circle"></i>
                             <strong class="mx-2">Success!</strong> Update Data 
                            </div>
                    <div class="row mt-5 py-3 mr-3 ml-3">

                    <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center">Update Category</h4><br>
                        <form id="category_form">
                            <label><b style="color: green;">Category Name</b></label>
                            <input class="d-none" type="text" value="<?php echo $id; ?>" name="id">
                            <input id="form" name="category" class="form-control form-control-sm" type="text" value="<?php echo $category_name; ?>"><br>
                            <button id="category_button" class="btn btn-success mr-1">Update</button>
                            <a href="category.php" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                    </div>

                </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script type="text/javascript">
    $(document).ready(function(){
        $("#category_button").click(function(e){
            e.preventDefault();
            var formData=$("#category_form").serialize();
            $.ajax({
            type:"GET",
            url:"include/category.php?update",
            data:formData,
            cache:false,
            success:function(){
                  Swal.fire(
                      'Success!',
                      'Data Update Success!',
                      'success'
                        )  
            }
           });
        });
    });
</script>

    </body>
</html>


<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Category</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Category</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;&nbsp;New
                              Category</button>
                          </div>
                            </div>
                        </div>
                    </div>






                   <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Add Category</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="card">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-md-12">
                                       <form id="form-category">
                                          <input class="form-control" type="text" name="category" id="category" placeholder="Type Your Category"/>
                                       </form>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Close</button>
                              <button id="add_category" type="button" class="btn btn-primary">Add Category</button>
                           </div>
                        </div>
                     </div>
                  </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Category List</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody >
        
         <?php 

                          $sql="SELECT * FROM product_cat";
                          $result=mysqli_query($con,$sql);

                          while ($rows=mysqli_fetch_assoc($result)) {

                           ?>

                           <tr>
        <td><?php echo $rows['id']; ?></td>
        <td><?php echo $rows['name']; ?></td>
       <td style="text-align:right">
        <a class="btn btn-info" href="category_edit.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>

        <a onclick=" return confirm('Are You Sure');" class="btn btn-danger" href="category_delete.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i>
        </a>

        </td>
        </tr>
                       <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>


      <script type="text/javascript">
          $(document).ready(function(){
            $("#add_category").click(function(){
                 var category=$("#category").val();
                 if (category.length==0) {
                    toastr.error("Name is require");
                 }else{
                   var formData= $("#form-category").serialize();
                   $.ajax({
                    type:'GET',
                    data:formData,
                    url:'include/category.php?add',
                    cache:false,
                    success:function(){
                        toastr.success("Category Added");
                        $("#addModal").modal('hide');
                         setTimeout(()=>{location.reload();},1000);
                    }
                   });
                 }
            });
          });
      </script>

    </body>
</html>
<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';
//   ini_set('display_errors', '1');
//   ini_set('display_startup_errors', '1');
//   error_reporting(E_ALL);

if (isset($_GET['clid'])) {
    $clid = $_GET['clid'];
    if ($cstmr = $con->query("SELECT * FROM clients WHERE id='$clid'")) {
        while ($rows = $cstmr->fetch_array()) {
            $lstid = $rows['id'];
            $fullname = $rows['fullname'];
            $company = $rows['company'];
            $mobile = $rows['mobile'];
            $email = $rows['email'];
            $address = $rows['address'];
            $createdate = $rows['createdate'];
        }
    }
}

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title = 'Client Profile';
        include 'Header.php'; ?>
        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-flex justify-content-end align-items-center gap-2 py-2">
                                <abbr title="Create Invoice">
                                    <a href="sale.php" class="btn btn-sm btn-primary ">
                                        <i class="fas fa-money-bill-wave me-1"></i> Create Invoice
                                    </a>
                                </abbr>

                                <abbr title="Supplier Payment">
                                    <button type="button" data-bs-toggle="modal" data-bs-target="#paymentModal"
                                        class="btn btn-sm btn-success">
                                        <i class="fas fa-hand-holding-usd me-1"></i> Payment Received
                                    </button>
                                </abbr>

                                <abbr title="Edit Client">
                                    <button type="button" data-id="<?php echo $clid; ?>"
                                        class="btn btn-sm btn-info edit-btn">
                                        <i class="mdi mdi-account-edit me-1"></i> Edit
                                    </button>
                                </abbr>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="container">
                            <div class="main-body">
                                <div class="row gutters-sm">
                                    <div class="col-md-4 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="d-flex flex-column align-items-center text-center profile">
                                                    <img src="profileImages/avatar.png" alt='Profile Picture'
                                                        class="rounded-circle" width="150" />
                                                    <div class="imgUpIcon">
                                                        <button id="uploadBtn" type="button">
                                                            <i class="mdi mdi-camera"></i>
                                                        </button>
                                                    </div>
                                                    <div class="mt-3">
                                                        <h5>
                                                            <?php echo $fullname; ?>
                                                        </h5>
                                                        <p class="text-secondary mb-1"># <?php echo $clid; ?>
                                                            <br>
                                                            <?php echo $mobile; ?>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="col-12 bg-white p-0 px-2 pb-3 mb-3">
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="mdi mdi-marker-check"></i> Fullname:</p>
                                                        <a href="#"><?php echo $fullname; ?></a>
                                                    </div>
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="mdi mdi-phone"></i> Mobile:</p>
                                                        <a href="#"><?php echo $mobile; ?></a>
                                                    </div>
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="fas fa-id-card"> </i> Address: </p>
                                                        <a href="#"><?php echo $address; ?></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="row">
                                            <!-- Earnings (Monthly) Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow py-2" style="border-left:3px solid #2A0FF1;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                                    Total Sales's</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    
                                                                    $total_amount = $con->query("SELECT SUM(grand_total) AS amount FROM sales WHERE client_id='$clid' ")->fetch_array()['amount'] ?? 0;
                                                                    echo floatval($total_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Earnings (Monthly) Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow  py-2" style="border-left:3px solid #27F10F;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                                    Total Paid</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    
                                                                    $total_paid_amount = $con->query("SELECT SUM(amount) AS total_paid FROM inventory_transaction WHERE client_id='$clid' AND transaction_type  !='0' AND inventory_type='Customer'")->fetch_array()['total_paid'] ?? 0;
                                                                    echo floatval($total_paid_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Pending Requests Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow  py-2" style="border-left:3px solid red;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                    Total Due</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    echo floatval($total_amount - $total_paid_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="container">
                                            <div class="row">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <!-- Nav tabs -->
                                                        <ul class="nav nav-tabs nav-tabs-custom nav-justified"
                                                            role="tablist">
                                                            <li class="nav-item">
                                                                <a class="nav-link active" data-bs-toggle="tab"
                                                                    href="#transaction" role="tab">
                                                                    <span class="d-none d-md-block">Transaction
                                                                    </span><span class="d-block d-md-none"><i
                                                                            class="mdi mdi-home-variant h5"></i></span>
                                                                </a>
                                                            </li>
                                                            <li class="nav-item">
                                                                <a class="nav-link" data-bs-toggle="tab"
                                                                    href="#invoice" role="tab">
                                                                    <span class="d-none d-md-block">Invoice</span><span
                                                                        class="d-block d-md-none"><i
                                                                            class="mdi mdi-account h5"></i></span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                        <!-- Tab panes -->
                                                        <div class="tab-content">
                                                            <div class="tab-pane active p-3" id="transaction"
                                                                role="tabpanel">
                                                                <div class="card">
                                                                    <div class="card-body">
                                                                        <div class="row">
                                                                            <div class="table-responsive">
                                                                                <table id="transaction_datatable"
                                                                                    class="table table-bordered dt-responsive nowrap"
                                                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>ID</th>
                                                                                            <th>Amount</th>
                                                                                            <th>Note</th>
                                                                                            <th>Transaction Type</th>
                                                                                            <th>Transaction Date</th>
                                                                                            <th>Posting Date</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php
                                                                                          $totalCount=1;
                                                                                          $result =$con->query("SELECT * FROM inventory_transaction WHERE inventory_type='Customer' AND  client_id=$lstid");
                                                                                          
                                                                                          while ($rows = mysqli_fetch_assoc($result)) {
                                                                                          
                                                                                          ?>
                                                                                        <tr>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo $totalCount++;
                                                                                                ?>
                                                                                            </td>
                                                                                            <td><?php echo $rows['amount']; ?>
                                                                                            </td>
                                                                                            <td><?php echo $rows['note']; ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                if ($rows['transaction_type'] == '1') {
                                                                                                    echo "<span class='badge bg-success'>Cash</span>";
                                                                                                } elseif ($rows['transaction_type'] == '2') {
                                                                                                    echo "<span class='badge bg-info'>Bkash</span>";
                                                                                                } elseif ($rows['transaction_type'] == '3') {
                                                                                                    echo "<span class='badge bg-success'>Nagad</span>";
                                                                                                } elseif ($rows['transaction_type'] == '4') {
                                                                                                    echo "<span class='badge bg-primary'>Due Paid</span>";
                                                                                                } elseif ($rows['transaction_type'] == '0') {
                                                                                                    echo "<span class='badge bg-danger'>Crdit</span>";
                                                                                                } elseif ($rows['transaction_type'] == '5') {
                                                                                                    echo "<span class='badge bg-info'>Bank</span>";
                                                                                                }
                                                                                                ?>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo date('d F Y', strtotime($rows['transaction_date']));
                                                                                                ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo date('d F Y', strtotime($rows['create_date']));
                                                                                                
                                                                                                ?>
                                                                                            </td>
                                                                                        </tr>
                                                                                        <?php } ?>
                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="tab-pane  p-3" id="invoice"
                                                                role="tabpanel">
                                                                <div class="card">
                                                                    <div class="card-body">
                                                                        <div class="row">
                                                                            <div class="table table-responsive">
                                                                                <table id="invoice_datatable"
                                                                                    class="table table-bordered dt-responsive nowrap"
                                                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>Invoice id</th>
                                                                                            <th>Customer Name</th>
                                                                                            <th>Sub Total</th>
                                                                                            <th>Paid Amount</th>
                                                                                            <th>Due Balance</th>
                                                                                            <th>Grand Total</th>
                                                                                            <th>Create Date</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php
                                                                                       $sql = "SELECT * FROM sales WHERE client_id=?";
                                                                                       $stmt = $con->prepare($sql);
                                                                                       $stmt->bind_param("i", $lstid);  
                                                                                       $stmt->execute();
                                                                                       $result = $stmt->get_result();

                                                                                       while ($rows = $result->fetch_assoc()) {
                                                                                       ?>
                                                                                        <tr>
                                                                                            <td><?php echo htmlspecialchars($rows['id']); ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                $supplier_id = $rows['client_id'];
                                                                                                $allCustomerData = $con->prepare('SELECT fullname FROM suppliers WHERE id=?');
                                                                                                $allCustomerData->bind_param('i', $supplier_id);
                                                                                                $allCustomerData->execute();
                                                                                                $client_result = $allCustomerData->get_result();
                                                                                                
                                                                                                if ($client_row = $client_result->fetch_assoc()) {
                                                                                                    echo '<a href="client_profile.php?clid=' . htmlspecialchars($supplier_id) . '">' . htmlspecialchars($client_row['fullname']) . '</a>';
                                                                                                }
                                                                                                ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['sub_total']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['total_paid']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['total_due']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['grand_total']); ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                $date = $rows['date'];
                                                                                                $formatted_date = date('d F Y', strtotime($date));
                                                                                                echo htmlspecialchars($formatted_date);
                                                                                                ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <a class="btn-sm btn btn-primary"
                                                                                                    href="sales_inv_edit.php?clid=<?php echo htmlspecialchars($rows['id']); ?>"><i
                                                                                                        class="fas fa-edit"></i></a>
                                                                                                <a class="btn-sm btn btn-success"
                                                                                                    href="invoice/sales_inv_view.php?clid=<?php echo htmlspecialchars($rows['id']); ?>"><i
                                                                                                        class="fas fa-eye"></i></a>
                                                                                                <button type="button"
                                                                                                    name="delete_button"
                                                                                                    data-id="<?php echo htmlspecialchars($rows['id']); ?>"
                                                                                                    class="btn-sm btn btn-danger"
                                                                                                    style="margin-right: 5px;"><i
                                                                                                        class="fas fa-trash"></i></button>


                                                                                            </td>
                                                                                        </tr>
                                                                                        <?php  }  ?>

                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <!-- Modal for addPayment -->
            <div class="modal fade bs-example-modal-lg" id="paymentModal" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog " role="document">
                    <div class="modal-content col-md-12">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><span
                                    class="mdi mdi-account-check mdi-18px"></span> &nbsp;Payment Received</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="include/sale_server.php?add_due_payment=true" method="POST"
                                enctype="multipart/form-data">
                                <input type="hidden" name="client_id" id="client_id" value="<?php echo $clid; ?>">

                                <div class="form-group mb-2">
                                    <label>Due Amount</label>
                                    <input readonly name="due_amount" placeholder="Enter Due Amount"
                                        class="form-control" type="text" value="<?php
                                        echo round($total_amount - $total_paid_amount, 2);
                                        ?>" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Paid Amount</label>
                                    <input name="paid_amount" placeholder="Enter Paid Amount" class="form-control"
                                        type="text" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Select Accounts</label>
                                    <select type="text" class="form-control" id="sub_ledger_id"
                                        name="sub_ledger_id" style="width: 100%;">
                                        <?php
                                        if ($ledgr = $con->query("SELECT * FROM ledger WHERE mstr_ledger_id='1'")) {
                                            echo '<option value="">Select</option>';
                                        
                                            while ($rowsitm = $ledgr->fetch_array()) {
                                                $ldgritmsID = $rowsitm['id'];
                                                $ledger_name = $rowsitm['ledger_name'];
                                        
                                                echo '<optgroup label="' . $ledger_name . '">';
                                        
                                                // Sub Ledger items list
                                                if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                                    while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                        $sub_ldgrid = $rowssb['id'];
                                                        $ldgr_items = $rowssb['item_name'];
                                        
                                                        echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                                    }
                                                }
                                        
                                                echo '</optgroup>';
                                            }
                                        }
                                        ?>
                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Type</label>
                                    <select name="transaction_type" id="transaction_type" class="form-select"
                                        type="text" required>
                                        <option value="">---Select---</option>
                                        <option value="2">Bkash</option>
                                        <option value="3">Nagad</option>
                                        <option value="4">Due Payment</option>
                                        <option value="5">Bank</option>
                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Date</label>
                                    <input name="transaction_date" class="form-control" type="date" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Notes</label>
                                    <input name="transaction_note" class="form-control" type="text"
                                        placeholder="Enter Transaction Notes" required>
                                </div>
                                <div class="modal-footer ">
                                    <button data-bs-dismiss="modal" type="button"
                                        class="btn btn-danger">Cancel</button>
                                    <button type="submit" class="btn btn-success">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>



            <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog " role="document">
                    <div class="modal-content col-md-12">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><span
                                    class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Client</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="include/client_backend.php?update_client_data=true" method="POST"
                                enctype="multipart/form-data">
                                <div class="form-group mb-2 d-none">
                                    <input name="id" class="form-control" type="text"
                                        value="<?php echo $clid; ?>">
                                </div>
                                <div class="form-group mb-2">
                                    <label>Fullname</label>
                                    <input name="fullname" placeholder="Enter Fullname" class="form-control"
                                        type="text">
                                </div>
                                <div class="form-group mb-2">
                                    <label>Company</label>
                                    <input name="company" placeholder="Enter Company" class="form-control"
                                        type="text">
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Phone Number</label>
                                    <input class="form-control" type="text" name="phone_number" id="phone_number"
                                        placeholder="Type Phone Number" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Email</label>
                                    <input class="form-control" type="email" name="email" id="email"
                                        placeholder="Type Your Email" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Address</label>
                                    <input class="form-control" type="text" name="address" id="address"
                                        placeholder="Type Your Address" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Status</label>
                                    <select class="form-control" type="text" name="status">
                                        <option value="">---Select---</option>
                                        <option value="1">Active</option>
                                        <option value="0">Expire</option>
                                    </select>
                                </div>

                                <div class="modal-footer ">
                                    <button data-bs-dismiss="modal" type="button"
                                        class="btn btn-danger">Cancel</button>
                                    <button type="submit" class="btn btn-success">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <!-- /Right-bar -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#transaction_datatable").DataTable();
            $("#invoice_datatable").DataTable();
            $('select[name="invoice_id"]').on('change', function() {
                var invoiceId = $(this).val();

                if (invoiceId) {
                    $.ajax({
                        url: 'include/purchase_server.php',
                        type: 'GET',
                        data: {
                            get_invoice_data: true,
                            invoice_id: invoiceId
                        },
                        dataType: 'json',
                        success: function(response) {
                            if (response.status === 'success') {
                                $('input[name="total_due"]').val(response.total_due);
                            } else {
                                toastr.error(response.message);
                                $('input[name="total_due"]').val('');
                            }
                        }
                    });
                } else {
                    $('input[name="total_due"]').val('');
                }
            });

            /** Handle edit button click**/
            $(document).on('click', '.edit-btn', function() {

                var id = $(this).data('id');
                var url = "include/client_backend.php?edit_data=true&id=" + id;
                $.ajax({
                    type: 'GET',
                    url: url,
                    success: function(response) {
                        const jsonResponse = JSON.parse(response);
                        if (jsonResponse.success) {
                            $('#editModal').modal('show');
                            $('#editModal input[name="id"]').val(jsonResponse.data.id);
                            $('#editModal input[name="fullname"]').val(jsonResponse.data
                                .fullname);
                            $('#editModal input[name="company"]').val(jsonResponse.data
                                .company);
                            $('#editModal input[name="phone_number"]').val(jsonResponse.data
                                .mobile);
                            $('#editModal input[name="email"]').val(jsonResponse.data.email);
                            $('#editModal input[name="address"]').val(jsonResponse.data
                                .address);
                            $('#editModal select[name="status"]').val(jsonResponse.data.status);
                        } else {
                            toastr.error("Error fetching data for edit: " + jsonResponse
                                .message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error("Error fetching data for edit!");
                    }
                });
            });


            /** Update The data from the database table **/
            $('#editModal form').submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();

                /*Get the submit button*/
                var submitBtn = form.find('button[type="submit"]');

                /*Save the original button text*/
                var originalBtnText = submitBtn.html();

                /*Change button text to loading state*/


                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    beforeSend: function() {
                        form.find(':input').prop('disabled', true);
                    },
                    success: function(response) {
                        const jsonResponse = JSON.parse(response);
                        if (jsonResponse.success) {
                            toastr.success(jsonResponse.message);
                            $('#editModal').modal('hide');
                            $('#editModal form')[0].reset();
                            /*Reload the page after a short delay*/
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        }
                    },

                    error: function(xhr, status, error) {
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        } else {
                            toastr.error("An error occurred. Please try again.");
                        }
                    },
                });
            });

            /**********************Paid Due Amount Script****************************/

            $('#paymentModal').on('shown.bs.modal', function() {
                if (!$('#sub_ledger_id').hasClass("select2-hidden-accessible")) {
                    $('#sub_ledger_id').select2({
                        dropdownParent: $('#paymentModal')
                    });
                }
                if (!$('#transaction_type').hasClass("select2-hidden-accessible")) {
                    $('#transaction_type').select2({
                        dropdownParent: $('#paymentModal')
                    });
                }
            });
            $('#paymentModal form').submit(function(e) {
                e.preventDefault();
                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $("#paymentModal").modal('hide');
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                    },


                    error: function(xhr, status, error) {
                        /** Handle  errors **/
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        }
                    }
                });
            });
            /*Delete Script*/
            $(document).on('click', "button[name='delete_button']", function() {
                var id = $(this).data('id');
                if (confirm("Are you sure you want to delete this item?")) {

                    $.ajax({
                        type: 'POST',
                        url: 'include/sale_server.php',
                        data: {
                            delete_invoice: true,
                            invoice_id: id
                        },
                        dataType: 'json',
                        success: function(response) {
                            if (response.success) {
                                toastr.success("Deleted successfully!");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error(xhr.responseText);
                            toastr.error("Error deleting item! " + error);
                        }
                    });
                }
            });

        });
    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
?>
<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<?php include 'style.php'; ?>
    

</head>

<body data-sidebar="dark">



    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php
        $page_title="Client Tickets";
        include 'Header.php'; 
        ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Client/Ticket</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
									<button type="button" class="btn btn-primary mt-2 mb-2 mt-xl-0 mdi mdi-account-plus mdi-18px"  data-bs-toggle="modal" data-bs-target="#ticketModal">&nbsp;&nbsp;New Ticket</button>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <!-- <div id="export_buttonscc" class="mb-3"></div> -->
                                    <div class="table-responsive">
                                        <table id="tickets_datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>No.</th> 
                                                    <th>Status</th> 
                                                    <th>Created</th>
                                                    <th>Priority</th>
                                                    <th>Customer Name</th>
                                                    <th>Phone Number</th>
                                                    <th>Issues</th>
                                                                                                 
                                                    <th>Assigned </th>
                                                    <th>Ticket For</th>
                                                    <th>Acctual Work</th>
                                                    <th>Percentage</th>
                                                    <th>Note</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>

    <div class="modal fade" id="settings_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header  bg-info">
                    <h5 class="modal-title text-white " id="exampleModalLabel">Ticket Settings <i class="fas fa-cog"></i></h5>
                    
                </div>
                <form action="include/tickets_server.php?add_client_ticket_settings=true" method="POST" id="settings_modal_form">
                    <div class="modal-body">
                        <div class="form-group d-none">
                            <input type="text" name="ticket_id" value="" required>
                        </div>
                        <div class="form-group mb-2">
                               <label>Ticket Status</label>
                            <select id="ticket_type" name="ticket_type" class="form-select" required>
                                <option value="">Select</option>
                                <option value="Active">Active</option>
                                <option value="New" >New</option>
                                <option value="Open">Open</option>
                                <option value="Complete">Complete</option>
                                <option value="Close">Close</option>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Progress</label>
                                <select id="progress" name="progress" class="form-select" required>
                                    <option value="">Select</option>
                                    <option value="0%">0%</option>
                                    <option value="15%">15%</option>
                                    <option value="25%">25%</option>
                                    <option value="35%">35%</option>
                                    <option value="45%">45%</option>
                                    <option value="55%">55%</option>
                                    <option value="65%">65%</option>
                                    <option value="75%">75%</option>
                                    <option value="85%">85%</option>
                                    <option value="95%">95%</option>
                                    <option value="100%">100%</option>
                                </select>
                        </div>
                        <!-- <div class="form-group mb-2">
                            <label for="">Assigned To</label>
                            <select name="assigned" id="assigned" class="form-select" required>
                            </select>
                        </div>-->
                        <div class="form-group mb-2">
                            <label>Write Comment</label> 
                            <textarea class="form-control"  rows="5" name="comment" placeholder="Enter Your Comment" style="height: 89px;"></textarea>
                        </div> 
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="ticketModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header  bg-success">
                    <h5 class="modal-title text-white " id="exampleModalLabel">Ticket Add&nbsp;&nbsp;<i class="mdi mdi-account-plus"></i></h5>
                    
                </div>
                <form action="include/tickets_server.php?add_client_ticket_data=true" method="POST" id="ticket_modal_form">
                    <div class="modal-body">
                        <div class="from-group mb-2">
                            <label>Customer Name</label>
                            <select class="form-select" name="customer_id" id="ticket_customer_id" style="width: 100%;"></select>
						</div>
                        <div class="from-group mb-2">
                            <label for="">Ticket For</label>
                            <select id="ticket_for" name="ticket_for" class="form-select" required>
                                <option value="Home Connection">Home Connection</option>
                                <option value="POP">POP Support</option>
                                <option value="Corporate">Corporate</option>
                                
                            </select>
                        </div>
                        <div class="from-group mb-2">
                            <label for=""> Complain Type </label>
                            <select id="ticket_complain_type" name="ticket_complain_type" class="form-select" style="width: 100%;" ></select>

                        </div>
                        <div class="from-group mb-2">
                            <label for="">Ticket Priority</label>
                            <select id="ticket_priority" name="ticket_priority" type="text" class="form-select" style="width: 100%;">
                            <option >---Select---</option>
                            <option value="1">Low</option>
                            <option value="2">Normal</option>
                            <option value="3">Standard</option>
                            <option value="4">Medium</option>
                            <option value="5">High</option>
                            <option value="6">Very High</option>
                            </select>
						</div>
                        <div class="from-group mb-2">
                            <label for="">Assigned To</label>
                            <select id="ticket_assigned" name="assigned" class="form-select" style="width: 100%;"></select>
                        </div>
                        <div class="from-group mb-2">
                            <label for="">Note</label>
                            <input id="notes" type="text" name="notes" class="form-control" placeholder="Enter Your Note">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <?php include 'script.php'; ?>
    <script src="js/tickets.js"></script>
    <script type="text/javascript">
        var table;
        $(document).ready(function(){
            //loadCustomerOptions();            
            // function loadCustomerOptions() {
            //     $.ajax({
            //     url: 'include/client_backend.php?get_all_client=true',
            //     type: 'GET',
            //     dataType: 'json',
            //     success: function (response) {
            //         if (response.success==true) {
            //                 var customerOptions = '<label style="margin-left: 10px;"> ';
            //                 customerOptions += '<select class="customer_filter form-select select2">';
            //                 customerOptions += '<option value="">--Select Customer--</option>';
                            
                        
            //                 $.each(response.data, function(key, client) {
            //                     customerOptions += '<option value="'+client.id+'">'+client.fullname+'</option>';
            //                 });

            //                 customerOptions += '</select></label>';
                            
            //                 setTimeout(() => {
            //                     $('.dataTables_length').append(customerOptions);
            //                     $('.select2').select2();
            //                 }, 500);
                            
            //             }
            //     }
            // });
            // }
            var status_filter = '<label style="margin-left: 10px;"> ';
            status_filter += '<select class="status_filter form-select select2">';
            status_filter += '<option value="">--Select Status--</option>';
            status_filter += ' <option value="Active">Active</option>';
            status_filter += '<option value="New" >New</option>';
            status_filter += '<option value="Open">Open</option>';
            status_filter += '<option value="Complete">Complete</option>';
            status_filter += ' <option value="Close">Close</option>';
            status_filter += '</select></label>';


            setTimeout(() => {
            $('.dataTables_length').append(status_filter);
            $('.select2').select2();
            }, 500);
            table=$('#tickets_datatable').DataTable( {
               "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/tickets_server.php?get_client_tickets_data=1",
                    type		: 'GET',
                },
                "order": [[0, 'desc']], 
                "buttons": [
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy"></i> Copy',
                    titleAttr: 'Copy',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i> Excel',
                    titleAttr: 'Excel',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'csv',
                    text: '<i class="fas fa-file-csv"></i> CSV',
                    titleAttr: 'CSV',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'pdf',
                    exportOptions: { columns: ':visible' },
                    orientation: 'landscape',
                    pageSize: "LEGAL",
                    text: '<i class="fas fa-file-pdf"></i> PDF',
                    titleAttr: 'PDF'
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i> Print',
                    titleAttr: 'Print',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'colvis',
                    text: '<i class="fas fa-list"></i> Column Visibility',
                    titleAttr: 'Column Visibility'
                }
            ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));	
        });      
        /* Status filter change event*/
        $(document).on('change', '.status_filter', function(){
            var status_filter_result = $('.status_filter').val() || '';
            table.columns(1).search(status_filter_result).draw();
        });   
        $(document).on('change', '.customer_filter', function(){
            var status_filter_result = $('.customer_filter').val() || '';
            table.columns(4).search(status_filter_result).draw();
        });   
        
        $(document).on('click', 'button[name="settings_button"]', function() {
            let dataId=$(this).data('id'); 
            $.ajax({
                url: "include/tickets_server.php?get_single_ticket_at_client=true", 
                type: "GET",
                data: { 
                    id:dataId,
                },
                dataType:'json',
                success: function(response) {
                    if (response.success == true) {
                        console.log(response); 
                        $("#settings_modal input[name='ticket_id']").val(response.data.id);
                        $("#settings_modal select[name='ticket_type']").val(response.data.ticket_type);
                        $("#settings_modal #progress").val(response.data.parcent);
                        // $("#settings_modal textarea[name='comment']").val(response.data.notes);
                        //  $("#settings_modal select[name='assigned']").val(response.data.asignto);
                        $("#settings_modal").modal('show');
                    }
                }
            });
            
        });
        __load_assign_option()
        function __load_assign_option(){
            $.ajax({
                url: "include/tickets_server.php?get_working_group=true",
                type: "GET",
                dataType:'json',
                success: function(response) {
                    if (response.success == true) {
                        let assignedSelect = $("#settings_modal select[name='assigned']");
                        assignedSelect.empty();  
                        
                        $.each(response.data, function(index, item) {
                            assignedSelect.append(new Option(item.name, item.id));
                        });
                    } else {
                        console.log("No data found or an error occurred.");
                    }
                }
            });
        }
        $("#settings_modal_form").submit(function(e) {
            e.preventDefault();

            /* Get the submit button */
            var submitBtn = $(this).find('button[type="submit"]');
            var originalBtnText = submitBtn.html();

            submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden"></span>');
            submitBtn.prop('disabled', true);

            var form = $(this);
            var formData = new FormData(this);

            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: formData,
                processData: false,
                contentType: false,
                dataType:'json',
                success: function(response) {
                    //console.log(response);
                    if (response.success==true) {
                        $("#settings_modal").modal('hide');
                        toastr.success(response.message);
                        $('#tickets_datatable').DataTable().ajax.reload();
                    }
                },
                error: function(xhr) {
                    if (xhr.status === 422) { 
                        /* Validation error*/
                        var errors = xhr.responseJSON.errors;

                        /* Loop through the errors and show them using toastr*/
                        $.each(errors, function(field, messages) {
                            $.each(messages, function(index, message) {
                                /* Display each error message*/
                                toastr.error(message); 
                            });
                        });
                    }
                },
                complete: function() {
                    submitBtn.html(originalBtnText);
                    submitBtn.prop('disabled', false);
                }
            });
        });
        /*Delete Script*/
        $(document).on('click',"button[name='delete_button']",function(){
            var id=$(this).data('id');
            if (confirm("Are you sure you want to delete this item?")) {
                $.ajax({
                    type: 'POST', 
                    url: 'include/tickets_server.php?delete_client_ticket=true', 
                    data: { id: id }, 
                    dataType:'json',
                    success: function(response) {
                        if (response.success) {
                            toastr.success("Deleted successfully!");
                        table.draw();
                        } else {
                            toastr.error(response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error("Error deleting item! " + error);
                    }
                });
            }
        });

        /*** Add ticket Modal Script****/
         ticket_modal();
         loadClients();
         function loadClients(selectedCustomerId) {
            $.ajax({
                url: 'include/client_backend.php?get_all_client=true',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    if (response.success == true) {
                        
                        let customerSelect = $("#ticket_customer_id");
                        customerSelect.empty();
                        customerSelect.append('<option value="">---Select Client---</option>');
                        $.each(response.data, function (index, client) {
                            customerSelect.append('<option value="' + client.id + '">'+client.fullname+'</option>');
                        });
                    }
                    if (selectedCustomerId) {
                        $("#ticket_customer_id").val(selectedCustomerId);
                    }
                }
            });
        }

         ticket_assign();
         ticket_complain_type();
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">
        
        <?php $page_title="Client"; include 'Header.php';?>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                <div class="col-md-12 grid-margin">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                            <div class="mr-md-3 mr-xl-5">


                                <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Client</p>
                                </div>


                            </div>
                            <br>


                        </div>
                        <div class="d-flex justify-content-between align-items-end flex-wrap">
                            <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                            data-bs-toggle="modal" data-bs-target="#addClientModal" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                        Client</button>
                    </div>
                    </div>
                </div>
            </div>






                <?php include 'modal/client_modal.php'; ?>


				 <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Client</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
                           <form action="include/client_backend.php?update_client_data=true" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="id" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Fullname</label>
										<input name="fullname" placeholder="Enter Fullname" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Company</label>
										<input name="company" placeholder="Enter Company" class="form-control" type="text" >
									</div>
                                    <div class="form-group mb-2">
                                        <label for="">Phone Number</label>
                                        <input class="form-control" type="text" name="phone_number" id="phone_number" placeholder="Type Phone Number"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Email</label>
                                        <input class="form-control" type="email" name="email" id="email" placeholder="Type Your Email"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Address</label>
                                        <input class="form-control" type="text" name="address" id="address" placeholder="Type Your Address"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Status</label>
                                        <select class="form-control" type="text" name="status" >
                                            <option value="">---Select---</option>
                                            <option value="1">Active</option>
                                            <option value="0">Expire</option>
                                        </select>
                                    </div>
									              
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>






                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Full Name</th>
                                                    <th>Company</th>
                                                    <th>Mobile</th>
                                                    <th>Email</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            <?php

$sql = "SELECT * FROM clients";
$result = mysqli_query($con, $sql);

while ($rows = mysqli_fetch_assoc($result)) {

?>

    <tr>
        <td><?php echo $rows['id']; ?></td>
        <td><a href="client_profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
        <td><?php echo $rows["company"]; ?></td>
        <td><?php echo $rows["mobile"]; ?></td>
        <td><?php echo $rows['email']; ?></td>
        <td style="text-align:right">
            <button type="button" class="btn btn-info edit-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></button>

            <a class="btn btn-success" href="client_profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
            </a>
            <button class="btn btn-danger delete-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i>
            </button>

        </td>
    </tr>
<?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php';?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->


        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript" src="modal/client_modal.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#users_table").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/client_backend.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    
    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/client_backend.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="fullname"]').val(jsonResponse.data.fullname);
                    $('#editModal input[name="company"]').val(jsonResponse.data.company);
                    $('#editModal input[name="phone_number"]').val(jsonResponse.data.mobile);
                    $('#editModal input[name="email"]').val(jsonResponse.data.email);
                    $('#editModal input[name="address"]').val(jsonResponse.data.address);
                    $('#editModal select[name="status"]').val(jsonResponse.data.status);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
                const jsonResponse = JSON.parse(response);
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>
<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">
        
        <?php $page_title="Company Management"; include 'Header.php';?>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                <div class="col-md-12 grid-margin">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                            <div class="mr-md-3 mr-xl-5">


                                <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Company Management</p>
                                </div>


                            </div>
                            <br>



                        </div>
                        <div class="d-flex justify-content-between align-items-end flex-wrap">
                            <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                            data-bs-toggle="modal" data-bs-target="#addCompanyModal" style="margin-bottom: 12px;">&nbsp;&nbsp;Add New Company</button>
                        </div>
                    </div>
                </div>
            </div>

                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Full Name</th>
                                                    <th>Company Name</th>
                                                    <th>Address</th>
                                                    <th>Username</th>
                                                    <th>Mobile</th>
                                                    <th>Email</th>
                                                    <th>Create Date</th>
                                                    <th>Expire Date</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            <?php

$sql = "SELECT * FROM companies";
$result = mysqli_query($con, $sql);

while ($rows = mysqli_fetch_assoc($result)) {

?>

    <tr>
        <td><?php echo $rows['id']; ?></td>
        <td><a href="company_profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
        <td><?php echo $rows["company_name"]; ?></td>
        <td><?php echo $rows["address"]; ?></td>
        <td><?php echo $rows["username"]; ?></td>
        <td><?php echo $rows["mobile"]; ?></td>
        <td><?php echo $rows['email']; ?></td>
        <td>
            <?php

             $create_date= $rows['create_date'];
             echo date('d M Y', strtotime($create_date));

            ?>
        </td>
        <td>
            <?php

             $expiredate= $rows['expiredate'];
             echo date('d M Y', strtotime($expiredate));

            ?>
        </td>
        <td style="text-align:right">
            <button type="button" class="btn btn-info edit-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></button>

            <a class="btn btn-success" href="company_profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
            </a>
            <button class="btn btn-danger delete-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i>
            </button>

        </td>
    </tr>
<?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php';?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->


        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        <?php include 'modal/client_modal.php'; ?>
        
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript" src="modal/company_modal.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#datatable").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/company_server.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    
    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/company_server.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="fullname"]').val(jsonResponse.data.fullname);
                    $('#editModal input[name="company"]').val(jsonResponse.data.company);
                    $('#editModal input[name="phone_number"]').val(jsonResponse.data.mobile);
                    $('#editModal input[name="email"]').val(jsonResponse.data.email);
                    $('#editModal input[name="address"]').val(jsonResponse.data.address);
                    $('#editModal select[name="status"]').val(jsonResponse.data.status);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
                const jsonResponse = JSON.parse(response);
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>


<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';

function timeAgo($startdate)
{
    /*Convert startdate to a timestamp*/
    $startTimestamp = strtotime($startdate);
    $currentTimestamp = time();

    /* Calculate the difference in seconds*/
    $difference = $currentTimestamp - $startTimestamp;

    /*Define time intervals*/
    $units = [
        'year' => 31536000,
        'month' => 2592000,
        'week' => 604800,
        'day' => 86400,
        'hour' => 3600,
        'min' => 60,
        'second' => 1,
    ];

    /*Check for each time unit*/
    foreach ($units as $unit => $value) {
        if ($difference >= $value) {
            $time = floor($difference / $value);
            return '<img src="images/icon/online.png" height="10" width="10"/>' . ' ' . $time . ' ' . $unit . ($time > 1 ? 's' : '') . '';
        }
    }
    /*If the difference is less than a second*/
    return '<img src="images/icon/online.png" height="10" width="10"/> just now';
}
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customer Request';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customer Request</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#customer_create_modal"
                                        class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;Create Request
                                        customer</button>
                                </div>

                                <div class="modal fade bs-example-modal-lg" tabindex="-1"
                                    aria-labelledby="myLargeModalLabel" id="customer_create_modal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span
                                                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Create
                                                    Request customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input id="customer_req_fullname" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile</label>
                                                                        <input id="customer_req_mobile" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Customer Mobile" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_req_address" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Customer Address" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area</label>
                                                                        <select id="customer_req_area_id" type="text"
                                                                            class="form-select" style="width: 100%;">
                                                                            <option value="0">---Select---</option>
                                                                            <?php
                                                                            
                                                                            $get_area = $con->query('SELECT * FROM area_list');
                                                                            while ($orws = $get_area->fetch_array()) {
                                                                                echo '<option value="' . $orws['id'] . '">' . $orws['name'] . '</option>';
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Request By</label>
																		
																		<select id="customer_req_request_by" type="text"
                                                                            class="form-select" style="width: 100%;">
                                                                            <option value="0">---Select---</option>
                                                                            <?php
                                                                            
                                                                            $ename = $con->query('SELECT * FROM employees');
                                                                            while ($orwen = $ename->fetch_array()) {
                                                                                echo '<option value="' . $orwen['name'] . '">' . $orwen['name'] . '</option>';
                                                                            }
                                                                            ?>
                                                                        </select>
																		
                                                                        
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Remarks</label>
																		<input id="customer_req_remarks" type="text"
                                                                            class="form-control" placeholder="Enter Remarks" />                                                                        
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger"
                                                    data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success"
                                                    id="customer_request_add_btn">Add Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                                <div class="modal fade " tabindex="-1"
                                    aria-labelledby="myLargeModalLabel" id="customer_edit_modal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span
                                                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;   Update
                                                    Request customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_edit_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input type="text" name="customer_request_id"
                                                                            id="customer_request_id" hidden />
                                                                        <input id="customer_req_fullname" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile</label>
                                                                        <input id="customer_req_mobile" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Customer Mobile" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_req_address" type="text"
                                                                            class="form-control "
                                                                            placeholder="Enter Customer Address" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area</label>
                                                                        <select id="customer_req_area_id" type="text"
                                                                            class="form-select" style="width: 100%;">
                                                                            <option value="0">---Select---</option>
                                                                            <?php
                                                                            
                                                                            $get_area = $con->query('SELECT * FROM area_list');
                                                                            while ($orws = $get_area->fetch_array()) {
                                                                                echo '<option value="' . $orws['id'] . '">' . $orws['name'] . '</option>';
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Request By</label>
																		
																		<select id="customer_req_request_by" type="text"
                                                                            class="form-select" style="width: 100%;">
                                                                            <option value="0">---Select---</option>
                                                                            <?php
                                                                            
                                                                            $ename = $con->query('SELECT * FROM employees');
                                                                            while ($orwen = $ename->fetch_array()) {
                                                                                echo '<option value="' . $orwen['name'] . '">' . $orwen['name'] . '</option>';
                                                                            }
                                                                            ?>
                                                                        </select>
																		
                                                                        
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Remarks</label>
																		<input id="customer_req_remarks" type="text"
                                                                            class="form-control" placeholder="Enter Remarks" />                                                                        
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger"
                                                    data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success"
                                                    id="customer_request_update_btn">Update Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Req. Time</th>
                                                    <th>FullName</th>
                                                    <th>Mobile no.</th>
                                                    <th>Area</th>
                                                    <th>Address</th>
                                                    <th>Reference By</th>
                                                    <th>Remarks</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php
                                                $result = $con->query("SELECT * FROM customer_request WHERE status=0 ORDER BY id DESC");

                                                while ($rows = mysqli_fetch_assoc($result)) {

                                                ?>

                                                <tr>
                                                    <td><?php echo $rows['id']; ?></td>
                                                    <td><?php echo timeAgo($rows['req_date'])." ~ ".$rows['req_date']; ?></td>
                                                    <td><?php echo $rows['fullname']; ?></td>


                                                    <td><?php echo $rows['mobile']; ?></td>

                                                    <td>
                                                        <?php $id = $rows['area_id'];
                                                        $allArea = $con->query("SELECT * FROM area_list WHERE id='$id' ");
                                                        while ($popRow = $allArea->fetch_array()) {
                                                            echo $popRow['name'] ?? 'Unknown';
                                                        }
                                                        
                                                        ?>

                                                    </td>
                                                    <td><?php echo $rows['address']; ?></td>
                                                    <td><?php echo $rows['request_by']; ?></td>
                                                    <td><?php echo $rows['remarks']; ?></td>

                                                    <td>

                                                    <button type="button" class="btn btn-success approve-btn" data-id=<?php echo $rows['id']; ?>>Approve</button>

                                                        <button type="button" class="btn btn-primary edit-btn"
                                                            data-id=<?php echo $rows['id']; ?>><i class="fas fa-edit"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-danger delete-btn"
                                                            data-id=<?php echo $rows['id']; ?>><i class="fas fa-trash"></i>
                                                        </button>

                                                    </td>
                                                </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->

    <!-- /Right-bar -->
    <?php include 'modal/customer_modal.php'; ?>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>
    <script src="js/customer.js"></script>
    <script type="text/javascript">
        $("#customers_table").DataTable({
            "responsive": true,
            "lengthChange": false,
            "autoWidth": false
        });
        $("#customer_create_modal").on('show.bs.modal', function(event) {
            if (!$('#customer_req_area_id').hasClass("select2-hidden-accessible")) {
                $("#customer_req_area_id").select2({
                    dropdownParent: $("#customer_create_modal"),
                    placeholder: "---Select---"
                });
            }
        });
        $('#customer_request_add_btn').on('click', function() {
            /*Collect form data*/
            let fullname = $('#customer_req_fullname').val().trim();
            let mobile = $('#customer_req_mobile').val().trim();
            let address = $('#customer_req_address').val().trim();
            let area_id = $('#customer_req_area_id').val();
            let request_by = $('#customer_req_request_by').val().trim();
            let remarks = $('#customer_req_remarks').val().trim();

            /* Form validation*/
            if (fullname === '' || mobile === '' || address === '') {
                toastr.error('Please fill out all fields.');
                return;
            }

            /* Ajax request*/
            $.ajax({
                url: 'include/customers_server.php?create_customer_request=true',
                type: 'POST',
                dataType: 'json',
                data: {
                    fullname: fullname,
                    mobile: mobile,
                    address: address,
                    area_id: area_id,
                    request_by: request_by,
                    remarks:remarks
                },
                success: function(response) {
                    if (response.success = true) {
                        toastr.success(response.message);
                        $('#customer_create_modal').modal('hide');
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    }
                    if (response.success == false) {
                        toastr.success(response.message);
                    }

                },
                error: function() {
                    toastr.error('An error occurred while processing the request.');
                }
            });
        });

        $(document).on('click', '.edit-btn', function() {
            var id = $(this).data('id');
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: 'include/customers_server.php?get_customer_request_data=true',
                data: {
                    id: id
                },
                success: function(response) {
                    if (response.success === true) {
                        $("#customer_edit_modal").modal('show');
                        $("#customer_edit_modal #customer_req_fullname").val(response.data.fullname);
                        $("#customer_edit_modal #customer_req_mobile").val(response.data.mobile);
                        $("#customer_edit_modal #customer_req_address").val(response.data.address);
                        $("#customer_edit_modal #customer_req_area_id").val(response.data.area_id);
                        $("#customer_edit_modal #customer_req_request_by").val(response.data.request_by);
                        $("#customer_edit_modal #customer_req_remarks").val(response.data.remarks);
                        $("#customer_edit_modal #customer_request_id").val(response.data.id);
                    }
                    if (response.success == false) {
                        toastr.success(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        });
        $(document).on('click', '#customer_request_update_btn', function(e) {
            e.preventDefault();
               var fullname= $("#customer_edit_modal #customer_req_fullname").val();
               var mobile= $("#customer_edit_modal #customer_req_mobile").val();
               var address= $("#customer_edit_modal #customer_req_address").val();
                var area_id=$("#customer_edit_modal #customer_req_area_id").val();
                var request_by= $("#customer_edit_modal #customer_req_request_by").val();
                var remarks=$("#customer_edit_modal #customer_req_remarks").val();
               var id= $("#customer_edit_modal #customer_request_id").val();

            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: 'include/customers_server.php?update_customer_request=true',
                data: {
                    id:id,
                    fullname:fullname,
                    mobile:mobile,
                    address:address,
                    area_id:area_id,
                    request_by:request_by,
                    remarks:remarks
                },
                success: function(response) {
                    if (response.success === true) {
                        toastr.success(response.message);
                        $("#customer_edit_modal").modal('hide'); 
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error updating data! " + error);
                }
            });
        });

        $(document).on('click', '.delete-btn', function() {
            var id = $(this).data('id');
            /* Confirm deletion*/
            if (confirm("Are you sure you want to delete this item?")) {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: 'include/customers_server.php?delete_customer_request_data=true',
                    data: {
                        delete_data: true,
                        id: id
                    },
                    success: function(response) {
                        if (response.success = true) {
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        }
                        if (response.success == false) {
                            toastr.success(response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error("Error deleting item! " + error);
                    }
                });
            }
        });
        $(document).on("click", ".approve-btn", function (e) {
            var id = $(this).data('id');
            e.preventDefault();

            if (confirm("Are you sure you want to Approve?")) {

                $.ajax({
                    type: 'GET',
                    dataType: 'json',
                    url: 'include/customers_server.php?get_customer_request_data=true',
                    data: {
                        id: id
                    },
                    success: function(response) {
                        if (response.success === true) {
                            $("#customer_request_id").val(response.data.id || "");
                            $("#customer_fullname").val(response.data.fullname || "");
                            $("#customer_mobile").val(response.data.mobile || "");
                            $("select[name='customer_area']").val(response.data.area_id || "");
                            $("#customer_address").val(response.data.address || "");
                            
                            $("#addCustomerModal").modal("show");
                        }
                        if (response.success == false) {
                            toastr.success(response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error("Error deleting item! " + error);
                    }
                });
               

               
            }
        });

    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <!-- <link rel="shortcut icon" href="assets/images/favicon.ico"> -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    	<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
        <link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Product/Store</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12 grid-margin">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                            <div class="mr-md-3 mr-xl-5">


                                <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Product/Store</p>
                                </div>


                            </div>
                            <br>


                        </div>
                    </div>
                </div>
            </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                            <form action="include/product_server.php?add_product" id="productForm" enctype="multipart/form-data" method="post">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group mb-4">
                                                <label for="">Product Name</label>
                                                <input type="text"  class="form-control" name="product_name" id="product_name" placeholder="Enter Product Name" required>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group mb-4">
                                                <label for="">Brand</label>
                                                <select id="brand_id" class="form-select"
                                                    name="brand" required>
                                                    <option value="">---Select---</option>
                                                    <?php 
                                                        if ($category = $con-> query("SELECT * FROM product_brand")) {
                                                            while($rows= $category->fetch_array()){

                                                            $id=$rows["id"];
                                                            
                                                                $name = $rows["name"];
                                                                
                                                                echo '<option value='.$id.'>'.$name.'</option>';
                                                            }
                                                        }
                                                        
                                                        ?>

                                                </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group mb-4">
                                                <label for="">Category</label>
                                                <select id="category" class="form-select" name="category" required>
                                                <option value="">---Select---</option>
                                                <?php 
                                                    if ($category = $con-> query("SELECT * FROM product_cat")) {
                                                        while($rows= $category->fetch_array()){

                                                        $id=$rows["id"];
                                                        
                                                            $name = $rows["name"];
                                                            
                                                            echo '<option value='.$id.'>'.$name.'</option>';
                                                        }
                                                    }
                                                    
                                                    ?>
                                                        

                                                    </select>
                                            </div>
                                        </div>
                                    </div>

                                

                                <div class="row">

                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label>Purchase A/C</label>
                                            <select id="purchase_ac" type="text" class="form-control"name="purchase_ac" required>
                                            <?php
                                        if ($ledgr = $con->query("SELECT * FROM ledger Where `mstr_ledger_id`=2")) {
                                            echo '<option value="">Select</option>';

                                            while ($rowsitm = $ledgr->fetch_array()) {
                                                $ldgritmsID = $rowsitm["id"];
                                                $ledger_name = $rowsitm["ledger_name"];

                                                echo '<optgroup label="' . $ledger_name . '">';


                                                // Sub Ledger items list
                                                if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {


                                                    while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                        $sub_ldgrid = $rowssb["id"];
                                                        $ldgr_items = $rowssb["item_name"];

                                                        echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                                    }
                                                }



                                                echo '</optgroup>';
                                            }
                                        }
                                        ?>
                                            </select>
                                        </div>
                                    </div>            
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label>Sales Account</label>
                                            <select type="text" id="sales_ac" class="form-control" name="sales_ac" required>
                                        <?php
                                        if ($ledgr = $con->query("SELECT * FROM ledger Where `mstr_ledger_id`=1")) {
                                            echo '<option value="">Select</option>';

                                            while ($rowsitm = $ledgr->fetch_array()) {
                                                $ldgritmsID = $rowsitm["id"];
                                                $ledger_name = $rowsitm["ledger_name"];

                                                echo '<optgroup label="' . $ledger_name . '">';


                                                // Sub Ledger items list
                                                if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {


                                                    while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                        $sub_ldgrid = $rowssb["id"];
                                                        $ldgr_items = $rowssb["item_name"];

                                                        echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                                    }
                                                }



                                                echo '</optgroup>';
                                            }
                                        }
                                        ?>
                                            </select>
                                        </div>
                                    </div>            
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Purchase Price</label>
                                            <input type="number" class="form-control" id="p_price"  name="p_price" placeholder="Enter Your Price" required/>
                                        </div>
                                    </div>            
                                    
                                </div>


                                


                                <div class="row">
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Sale's Price</label>
                                            <input type="number" class="form-control" id="s_price"  name="s_price" placeholder="Enter Your Sale's Price" required/>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Store</label>
                                            <select id="store" class="form-select" name="store">
                                                <option value="">---Select---</option>
                                                <?php 
                                                    if ($store = $con-> query("SELECT * FROM store")) {
                                                        while($rows= $store->fetch_array()){

                                                            $id=$rows["id"];
                                                        
                                                            $name = $rows["name"];
                                                            
                                                            echo '<option value='.$id.'>'.$name.'</option>';
                                                        }
                                                    }
                                                    
                                                    ?>
                                                        

                                                    </select>       
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Remarks</label>
                                            <input type="text" class="form-control" id="note"  name="note" placeholder="Enter Your Note" />
                                        </div>
                                    </div>
                                </div>



                                </div>
                                <div class="card-footer">
                                    <button type="button" onclick="history.back();" class="btn btn-danger">Back</button>
                                    <button type="submit" class=" btn btn-success">Add Now</button>
                                </div>
                                </form>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script> 

    <script src="assets/js/app.js"></script>
    <script src="assets/libs/select2/js/select2.min.js"></script>
    <script type="text/javascript">
       $("#brand_id").select2();
       $("#category").select2();
       $("#sales_ac").select2();
       $("#purchase_ac").select2();
       
    /** Store The data from the database table **/
        $(document).ready(function(){
            $('#productForm').on('submit', function(e){
                e.preventDefault();

                var formData = new FormData(this);

                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        var result = JSON.parse(response);
                        if (result.success) {
                            toastr.success(result.message);
                            $('#productForm')[0].reset();
                        } else {
                            toastr.error(result.message);
                        }
                    },
                    error: function() {
                        toastr.error("Error occurred during the request.");
                    }
                });
            });
        });
 
    </script>

    </body>
</html>


<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");


?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    <style>
/* @media print {
    body {
        visibility: hidden;
    }

    #customers_table, #customers_table * {
        visibility: visible;
    }

    #customers_table {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    table, th, td {
        border: 1px solid black;
    }

    th, td {
        padding: 10px;
        text-align: left;
    }

    a {
        text-decoration: none;
        color: black;
    }

    button {
        display: none;
    }
} */
</style>
</head>

<body data-sidebar="dark">



    <!-- Begin page -->
    <div id="layout-wrapper">

       <?php $page_title="Credit Recharge List"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Credit Recharge List</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <!-- <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button> -->
                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>Customer Username</th>
                                                    <th>Phone Number</th>
                                                    <th>Recharged</th>
                                                    <th>Total Paid</th>
                                                    <th>Total Due</th>
                                                    <th>Month</th>
                                                    <th>Recharge By</th>
                                                </tr>
                                            </thead>
                                            <?php 
                                            
                                            $result = $con->query("SELECT 
    c.id AS customer_id, 
    c.username, 
    MAX(u.fullname) AS fullname,
    c.mobile, 
    MAX(cr.datetm) AS datetm,
    GROUP_CONCAT(
        DISTINCT DATE_FORMAT(DATE_SUB(cr.datetm, INTERVAL 1 MONTH), '%M %Y') 
        ORDER BY cr.rchrg_until DESC SEPARATOR ', '
    ) AS due_months,  --      ,   
    COALESCE(SUM(CASE WHEN cr.type != '4' THEN cr.purchase_price ELSE 0 END), 0) AS total_recharge,
    COALESCE(SUM(CASE WHEN cr.type != '0' THEN cr.purchase_price ELSE 0 END), 0) AS total_paid,
    (COALESCE(SUM(CASE WHEN cr.type != '4' THEN cr.purchase_price ELSE 0 END), 0) - 
     COALESCE(SUM(CASE WHEN cr.type != '0' THEN cr.purchase_price ELSE 0 END), 0)) AS total_due,
    COALESCE(SUM(CASE WHEN cr.type = '4' THEN cr.purchase_price ELSE 0 END), 0) AS total_due_paid
FROM 
    customers c
LEFT JOIN 
    customer_rechrg cr ON c.id = cr.customer_id
LEFT JOIN 
    users u ON cr.rchg_by = u.id
-- WHERE 
--     1=1 $whereClause
GROUP BY 
    c.id, c.username, c.mobile  
HAVING 
    total_due > 0;



");

while ($row = $result->fetch_assoc()) {
    echo "<tr>";
    echo "<td>{$row['username']}</td>";
    echo "<td>{$row['mobile']}</td>";
    echo "<td>{$row['total_recharge']}</td>";
    echo "<td>{$row['total_paid']}</td>";
    echo "<td>{$row['total_due']}</td>";
    echo "<td>{$row['due_months']}</td>";
    echo "<td>{$row['fullname']}</td>";
    echo "</tr>";
}
                                            
                                            
                                            
                                            ?>
                                            <!-- <tbody id="customer-data"></tbody>
                                            <tfoot id="total-footer"> </tfoot> -->
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript">
        var from_date_filter = '<label style="margin-left: 10px;">';
        from_date_filter += '<input type="date" id="from_date" class="form-control from_date_filter">';
        from_date_filter += '</input></label>';

        var to_date_filter = '<label style="margin-left: 10px;">';
        to_date_filter += '<input type="date" id="to_date" class="form-control to_date_filter">';
        to_date_filter += '</input></label>';

        var _filter_button = '<button style="margin-left: 10px;" class="btn btn-success" id="search_btn">Search</button>';

        var export_button = '<button style="margin-left: 10px;" class="btn btn-info" id="export_to_excel">Export</button>';

        setTimeout(() => {
            $('.dataTables_length').append(from_date_filter);
            $('.dataTables_length').append(to_date_filter);
            $('.dataTables_length').append(_filter_button);
            $('.dataTables_length').append(export_button);
        }, 500);
        // $('#customers_table').DataTable({
        //     initComplete: function() {
        //         $('.dataTables_length').append(from_date_filter);
        //         $('.dataTables_length').append(to_date_filter);
        //         $('.dataTables_length').append(_filter_button);
        //         $('.dataTables_length').append(export_button);
        //     }
        // });
       
        show_credit_recharge_list();
        function show_credit_recharge_list(from_date,to_date){
            $.ajax({
                url: 'include/customer_recharge_server.php?get_credit_recharge_list=true', 
                type: 'GET',
                data:  {
                    from_date :from_date,
                    to_date : to_date, 
                },
                dataType: 'json',
                success: function (response) {
                    $('#customer-data').html(response.rows);
                    $('#total-footer').html(response.footer); 
                    if ($.fn.DataTable.isDataTable('#customers_table')) {
                        $('#customers_table').DataTable().empty(); 
                    }
                    $('#customers_table').DataTable(); 
                },
                error: function () {
                    alert('Failed to load customer data.');
                },
            });
        }
        $(document).on('click','#search_btn',function(){
            var from_date=  $('.from_date_filter').val(); 
          
            var to_date=  $('.to_date_filter').val(); 
            if (!from_date) {
                toastr.error("From Date is required.");
            } else if (!to_date) {
                toastr.error("To Date is required.");
            } else {
                show_credit_recharge_list(from_date, to_date);
            }
        });
        // $("#search_btn").on('change',function(){
        //   var from_date=  $('.from_date_filter').val(); 
        //   var to_date=  $('.to_date_filter').val(); 
        //   if(from_date.length==''){
        //     toastr.error("From Date is Require"); 
        //   }else if(to_date.length==''){
        //     toastr.error("To Date is Require"); 
        //   }else{
        //     show_credit_recharge_list(from_date,to_date); 
        //   }
        // });
        
        function printTable() {
            var divToPrint = document.getElementById('customers_table');
            var newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Print Table</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('a { text-decoration: none; color: black; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }



        $(document).on('click','#export_to_excel',function(){
                    let csvContent = "data:text/csv;charset=utf-8,";
                
                /* Add header row*/
                csvContent += [
                     'Username', 'Phone Number', 'Recharged', 'Total Paid', 'Total Due'
                ].join(",") + "\n";
                
                /*Add data rows*/ 
                $('#customers_table tbody tr').each(function() {
                    let row = [];
                    $(this).find('td').each(function() {
                        row.push($(this).text().trim());
                    });
                    csvContent += row.join(",") + "\n";
                });

                /* Create a link element and simulate click to download the CSV file*/
                let encodedUri = encodeURI(csvContent);
                let link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "customers.csv");
                document.body.appendChild(link); 
                link.click();
                document.body.removeChild(link);
            });
    </script>
	
</body>

</html>

<?php 


include 'include/db_connect.php';

if (isset($_GET['clid'])) {
	 $id=$_GET['clid'];

	$result=$con->query("DELETE FROM `customers` WHERE id=$id ");
	if ($result==true) {
		header("location:customers.php");
	}else{

	}
}


 ?>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");


?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


   

    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php $page_title="Custmer Disable"; include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Disabled</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                               
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
													<th><input type="checkbox" id="checkedAll" name="checkedAll"> All</th>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    <th>Expired Date</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php
                                                $condition=[];
                                                if(isset($_GET['list']) && !empty($_GET['list'])){
                                                    $ExpMnthYr = mysqli_real_escape_string($con, $_GET["list"]);
                                                    $conditions[] = "expiredate LIKE '%$ExpMnthYr%'";
                                                }else{
                                                    $conditions[] = "status='0'";
                                                }

                                                if(isset($_GET['area_id']) && !empty($_GET['area_id'])){
                                                    $area_id = mysqli_real_escape_string($con, $_GET["area_id"]);
                                                    $conditions[] = "area=$area_id";
                                                }
                                                if(isset($_GET['pop_id']) && !empty($_GET['pop_id'])){
                                                    $pop_id = mysqli_real_escape_string($con, $_GET["pop_id"]);
                                                    $conditions[] = "pop=$pop_id";
                                                }

                                                if(!empty($conditions)){
                                                    $condition = implode(" AND ", $conditions);
                                                    $sql="SELECT * FROM customers WHERE $condition";
                                                }

                                               
											   
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {
													$username = $rows["username"];

                                                ?>

                                                    <tr>
													<td><input type="checkbox" Value="<?php echo $rows["id"]; ?>" name="checkAll[]" class="checkSingle"></td>
                                                        <td><?php echo $rows['id']; ?></td>
                                                        <td>
														<?php 
                                                            
                                                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$username'");
                                                            $chkc = $onlineusr->num_rows;
                                                            if($chkc==1)
                                                            {
                                                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                                                            } else{
                                                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';

                                                            }
                                                 
                                                            
                                                            ?>
														
														
														
														<a href="profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
                                                        <td>
                                                            <?php

                                                            echo  $rows["package_name"];

                                                            ?>

                                                        </td>
                                                        <td>
                                                            <?php

                                                            $expireDate = $rows["expiredate"];
                                                            $todayDate = date("Y-m-d");
                                                            if ($expireDate <= $todayDate) {
                                                                echo "<span class='badge bg-danger'>Expired</span>";
                                                            } else {
                                                                echo $expireDate;
                                                            }
                                                            ?>
                                                        </td>
                                                        <td><?php echo $rows["username"]; ?></td>
                                                        <td><?php echo $rows["mobile"]; ?></td>
                                                        <td>
                                                            <?php
                                                            $popID = $rows["pop"];
                                                            $allPOP = $con->query("SELECT * FROM add_pop WHERE id=$popID ");
                                                            while ($popRow = $allPOP->fetch_array()) {
                                                                echo $popRow['pop'];
                                                            }

                                                            ?>
                                                        </td>
                                                        <td>
                                                            <?php $id = $rows["area"];
                                                            $allArea = $con->query("SELECT * FROM area_list WHERE id='$id' ");
                                                            while ($popRow = $allArea->fetch_array()) {
                                                                echo $popRow['name'];
                                                            }

                                                            ?>

                                                        </td>

                                                        <td>
                                                            <a class="btn btn-info" href="profile_edit.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                                                            <a class="btn btn-success" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
                                                            </a>

                                                            <!--<a href="customer_delete.php?clid=<?php echo $rows['id']; ?>" class="btn btn-danger deleteBtn" onclick=" return confirm('Are You Sure');" data-id=<?php echo $rows['id']; ?>><i class="fas fa-trash"></i>
                                                            </a>-->

                                                        </td>
                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer" style="text-align: right;">
                                    <button class="btn btn-primary" id="send_message_btn" >Send Message</button>
                                    <button class="btn btn-success" id="export_to_excel" >Export To Excel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Modal for Send Message -->
     <div class="modal fade bs-example-modal-lg" id="sendMessageModal" tabindex="-1" role="dialog"
               aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog " role="document">
                  <div class="modal-content col-md-12">
                     <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span
                           class="mdi mdi-account-check mdi-18px"></span> &nbsp;Send Message</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <div class="alert alert-info" id="selectedCustomerCount"></div>
                        <form id="paymentForm"  method="POST">
                           
                           <div class="form-group mb-2">
                              <label>Message Template</label>
                              <select class="form-select" name="message_template" >
                                <option>---Select---</option>
                                <?php 
                                    if ($allCstmr=$con->query("SELECT * FROM message_template WHERE user_type=1")) {
                                    while ($rows=$allCstmr->fetch_array()) {
                                        echo '<option value='.$rows['id'].'>'.$rows['template_name'].'</option>';
                                    }
                                }

                                    ?>
                            </select>
                           </div>
                           <div class="form-group mb-2">
                              <label>Message</label>
                              <textarea id="message" rows="5" placeholder="Enter Your Message" class="form-control"></textarea>
                           </div>
                           <div class="modal-footer ">
                              <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                              <button type="button" name="send_message_btn" class="btn btn-success">Send Message</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>
    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
	
	$(document).ready(function() {
            $(document).on('click','#export_to_excel',function(){
                    let csvContent = "data:text/csv;charset=utf-8,";
                
                /* Add header row*/
                csvContent += [
                    'ID', 'Name', 'Package', 'Expired Date', 'User Name', 'Mobile no.', 'POP/Branch', 'Area/Location'
                ].join(",") + "\n";
                
                /*Add data rows*/ 
                $('#customers_table tbody tr').each(function() {
                    let row = [];
                    $(this).find('td').each(function() {
                        row.push($(this).text().trim());
                    });
                    csvContent += row.join(",") + "\n";
                });

                /* Create a link element and simulate click to download the CSV file*/
                let encodedUri = encodeURI(csvContent);
                let link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "customers.csv");
                document.body.appendChild(link); // Required for Firefox
                link.click();
                document.body.removeChild(link);
            });
			
            $("#checkedAll").change(function() {
                $(".checkSingle").prop('checked', $(this).prop("checked"));
            });
            $(".checkSingle").change(function() {
                if ($(".checkSingle:checked").length == $(".checkSingle").length) {
                    $("#checkedAll").prop("checked", true);
                } else {
                    $("#checkedAll").prop("checked", false);
                }
            });
            $("#send_message_btn").click(function() {
                var selectedCustomers = [];
                $(".checkSingle:checked").each(function() {
                    selectedCustomers.push($(this).val());
                });
                var countText = "You have selected " + selectedCustomers.length + " customers.";
                $("#selectedCustomerCount").text(countText);
                console.log(selectedCustomers); 
                $('#sendMessageModal').modal('show'); 

            });
            $('button[name="send_message_btn"]').on('click',function(e){
                e.preventDefault(); 
                 /*AJAX request to send selected customers to backend*/ 
                 $.ajax({
                    url: 'include/customers_server.php?send_message=true',
                    method: 'POST',
                    data: {
                        /*sending the array of customer IDs*/ 
                        customer_ids: selectedCustomers, 
                        message: $("#message").val(),
                    },
                    success: function(response) {
                        alert("Message sent successfully to selected customers.");
                    },
                    error: function(xhr, status, error) {
                        console.error("An error occurred: " + error);
                        alert("There was an error sending the message.");
                    }
                });
            });
            $('select[name="message_template"]').on('change', function() {
                var name=$(this).val();
                var currentMsgTemp="0";
                $.ajax({
                    type:'POST',
                    data:{name:name,currentMsgTemp:currentMsgTemp},
                    url:'include/message.php',
                    success:function(response){
                        console.log(response);
                        $("#message").val(response);
                    }
                });
            });
           
            
			});
			
			
        $("#customers_table").DataTable();
		
		

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });




        $("#customer_add").click(function() {
            var fullname = $("#customer_fullname").val();
            var package = $("#customer_package").val();
            var username = $("#customer_username").val();
            var password = $("#customer_password").val();
            var mobile = $("#customer_mobile").val();
            var address = $("#customer_address").val();
            var expire_date = $("#customer_expire_date").val();
            var area = $("#customer_area").val();
            var pop = $("#customer_pop").val();
            var nid = $("#customer_nid").val();
            var con_charge = $("#customer_con_charge").val();
            var price = $("#customer_price").val();
            var remarks = $("#customer_remarks").val();
            var status = $("#customer_status").val();
            var user_type = <?php echo $auth_usr_type; ?>;

            customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status)

        });

        function customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status) {
            if (fullname.length == 0) {
                toastr.error("Customer name is require");
            } else if (package.length == 0) {
                toastr.error("Customer Package is require");
            } else if (username.length == 0) {
                toastr.error("Username is require");
            } else if (password.length == 0) {
                toastr.error("Password is require");
            } else if (mobile.length == 0) {
                toastr.error("Mobile number is require");
            } else if (expire_date.length == 0) {
                toastr.error("Expire Date is require");
            } else if (pop.length == 0) {
                toastr.error("POP/Branch is require");
            } else if (area.length == 0) {
                toastr.error("Area is require");
            } else if (con_charge.length == 0) {
                toastr.error("Connection Charge is require");
            } else if (price.length == 0) {
                toastr.error("price is require");
            } else if (status.length == 0) {
                toastr.error("Status is require");
            } else {
                $("#customer_add").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                var addCustomerData = 0;
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php',
                    data: {
                        addCustomerData: addCustomerData,
                        fullname: fullname,
                        package: package,
                        username: username,
                        password: password,
                        mobile: mobile,
                        address: address,
                        expire_date: expire_date,
                        area: area,
                        pop: pop,
                        con_charge: con_charge,
                        price: price,
                        remarks: remarks,
                        nid: nid,
                        status: status,
                        user_type: user_type,
                    },
                    success: function(responseData) {
                        if (responseData == 1) {
                            toastr.success("Added Successfully");
                            $("#addCustomerModal").modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            toastr.error(responseData);
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <!-- <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div> -->

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customers Dues/Unpaid</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['fullname'])) {
                                    echo $_SESSION['fullname'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="profileImages/avatar.png" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <!-- <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>
                                </div> -->

                                <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addCustomerModal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input id="customer_fullname" type="text" class="form-control " placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Username <span id="usernameCheck"></span></label>
                                                                        <input id="customer_username" type="text" class="form-control " name="username" placeholder="Enter Your Username" oninput="checkUsername();" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Password</label>
                                                                        <input id="customer_password" type="password" class="form-control " name="password" placeholder="Enter Your Password" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile no.</label>
                                                                        <input id="customer_mobile" type="text" class="form-control " name="mobile" placeholder="Enter Your Mobile Number" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Expired Date</label>
                                                                        <select id="customer_expire_date" class="form-select">
                                                                            <option value="<?php echo date("d"); ?>"><?php echo date("d"); ?></option>
                                                                            <?php
                                                                            if ($exp_cstmr = $con->query("SELECT * FROM customer_expires")) {
                                                                                while ($rowsssss = $exp_cstmr->fetch_array()) {


                                                                                    $exp_date = $rowsssss["days"];

                                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                                }
                                                                            }

                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_address" type="text" class="form-control" name="address" placeholder="Enter Your Addres" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>POP/Branch</label>
                                                                        <select id="customer_pop" class="form-select">
                                                                            <option value="">Select Pop/Branch</option>
                                                                            <?php
                                                                            if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                                                while ($rows = $pop->fetch_array()) {


                                                                                    $id = $rows["id"];
                                                                                    $name = $rows["pop"];

                                                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                                                }
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area/Location</label>
                                                                        <select id="customer_area" class="form-select" name="area">
                                                                            <option>Select Area</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Nid Card Number</label>
                                                                        <input id="customer_nid" type="text" class="form-control" name="nid" placeholder="Enter Your Nid Number" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package</label>
                                                                        <select id="customer_package" class="form-select">


                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Connection Charge</label>
                                                                        <input id="customer_con_charge" type="text" class="form-control" name="con_charge" placeholder="Enter Connection Charge" value="500" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package Price</label>
                                                                        <input disabled id="customer_price" type="text" class="form-control" value="00" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Remarks</label>
                                                                        <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"></textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Status</label>
                                                                        <select id="customer_status" class="form-select">
                                                                            <option value="">Select Status</option>
                                                                            <option value="0">Disable</option>
                                                                            <option value="1">Active</option>
                                                                            <option value="2">Expire</option>
                                                                            <option value="3">Request</option>
                                                                        </select>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success" id="customer_add">Add Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    
                                                    <th>Due Amount</th>
                                                    <th>Expired Date</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">

                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="3"></td>
                                                    <td colspan="3">
                                                        <span  id="totalPrice"></span>
                                                    </td>
                                                    <td colspan="3"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>
    <script src="assets/libs/select2/js/select2.min.js"></script>
    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>

     <script type="text/javascript">
        var table;
        $(document).ready(function(){

            function loadareaOptions() {
                $.ajax({
                    url: 'include/area_server.php?get_area_data=1', 
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var popOptions = '<label style="margin-left: 20px;"> ';
                            popOptions += '<select class="area_filter form-select">';
                            popOptions += '<option value="">--Select Area--</option>';
                            
                        
                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="'+data.id+'">'+data.name+'</option>';
                            });

                            popOptions += '</select></label>';
                            
                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.area_filter').select2(); 
                            }, 500);
                        }
                       
                    }
                });
            }
            loadareaOptions();

                table=$('#customers_table').DataTable( {
                    "searching": true,
                    "paging": true,
                    "info": false,
                    "lengthChange":true ,
                    "processing"		: true,
                    "serverSide"		: true,
                    "zeroRecords":    "No matching records found",
                    "ajax"				: {
                        url			: "include/customers_dues_server.php",
                        type		: 'GET',
                        dataSrc     :function(json){
                            var totalPrice = json.total_price;
                            $('#totalPrice').html(totalPrice);
                            return json.data;
                        }
                    },
                    "buttons": [			
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy"></i> Copy',
                    titleAttr: 'Copy',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i> Excel',
                    titleAttr: 'Excel',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'csv',
                    text: '<i class="fas fa-file-csv"></i> CSV',
                    titleAttr: 'CSV',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'pdf',
                    exportOptions: { columns: ':visible' },
                    orientation: 'landscape',
                    pageSize: "LEGAL",
                    text: '<i class="fas fa-file-pdf"></i> PDF',
                    titleAttr: 'PDF'
                }, 
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i> Print',
                    titleAttr: 'Print',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'colvis',
                    text: '<i class="fas fa-list"></i> Column Visibility',
                    titleAttr: 'Column Visibility'
                }
                ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));	
        });
         /* POP filter change event*/
         $(document).on('change','.area_filter',function(){
        
        var area_filter_result = $('.area_filter').val() == null ? '' : $('.area_filter').val();

            table.columns(7).search(area_filter_result).draw();
        
        });  

    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

       <?php $page_title="Customers Dues/Unpaid"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <!-- <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>
                                </div> -->

                                <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addCustomerModal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input id="customer_fullname" type="text" class="form-control " placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Username <span id="usernameCheck"></span></label>
                                                                        <input id="customer_username" type="text" class="form-control " name="username" placeholder="Enter Your Username" oninput="checkUsername();" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Password</label>
                                                                        <input id="customer_password" type="password" class="form-control " name="password" placeholder="Enter Your Password" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile no.</label>
                                                                        <input id="customer_mobile" type="text" class="form-control " name="mobile" placeholder="Enter Your Mobile Number" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Expired Date</label>
                                                                        <select id="customer_expire_date" class="form-select">
                                                                            <option value="<?php echo date("d"); ?>"><?php echo date("d"); ?></option>
                                                                            <?php
                                                                            if ($exp_cstmr = $con->query("SELECT * FROM customer_expires")) {
                                                                                while ($rowsssss = $exp_cstmr->fetch_array()) {


                                                                                    $exp_date = $rowsssss["days"];

                                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                                }
                                                                            }

                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_address" type="text" class="form-control" name="address" placeholder="Enter Your Addres" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>POP/Branch</label>
                                                                        <select id="customer_pop" class="form-select">
                                                                            <option value="">Select Pop/Branch</option>
                                                                            <?php
                                                                            if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                                                while ($rows = $pop->fetch_array()) {


                                                                                    $id = $rows["id"];
                                                                                    $name = $rows["pop"];

                                                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                                                }
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area/Location</label>
                                                                        <select id="customer_area" class="form-select" name="area">
                                                                            <option>Select Area</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Nid Card Number</label>
                                                                        <input id="customer_nid" type="text" class="form-control" name="nid" placeholder="Enter Your Nid Number" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package</label>
                                                                        <select id="customer_package" class="form-select">


                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Connection Charge</label>
                                                                        <input id="customer_con_charge" type="text" class="form-control" name="con_charge" placeholder="Enter Connection Charge" value="500" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package Price</label>
                                                                        <input disabled id="customer_price" type="text" class="form-control" value="00" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Remarks</label>
                                                                        <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"></textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Status</label>
                                                                        <select id="customer_status" class="form-select">
                                                                            <option value="">Select Status</option>
                                                                            <option value="0">Disable</option>
                                                                            <option value="1">Active</option>
                                                                            <option value="2">Expire</option>
                                                                            <option value="3">Request</option>
                                                                        </select>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success" id="customer_add">Add Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    
                                                    <th>Due Amount</th>
                                                    <th>Expired Date</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">

                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td colspan="3"></td>
                                                    <td colspan="3">
                                                        <span  id="totalPrice"></span>
                                                    </td>
                                                    <td colspan="3"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>

     <script type="text/javascript">
        var table;
        $(document).ready(function(){

            function loadareaOptions() {
                $.ajax({
                    url: 'include/area_server.php?get_area_data=1', 
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var popOptions = '<label style="margin-left: 20px;"> ';
                            popOptions += '<select class="area_filter form-select">';
                            popOptions += '<option value="">--Select Area--</option>';
                            
                        
                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="'+data.id+'">'+data.name+'</option>';
                            });

                            popOptions += '</select></label>';
                            print_button = '<label style="margin-left: 20px;"> ';
                            print_button += '<button class="btn-sm btn btn-success" onclick="printTable()"><i class="fas fa-solid fa-print"></i></button>';
                            print_button += '</label>';
                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.area_filter').select2(); 
                            }, 500);
                            setTimeout(() => {
                                $('.dataTables_length').append(print_button);
                                $('.area_filter').select2(); 
                            }, 500);
                        }
                       
                    }
                });
            }
            loadareaOptions();

                table=$('#customers_table').DataTable( {
                    "searching": true,
                    "paging": true,
                    "info": false,
                    "lengthChange":true ,
                    "processing"		: true,
                    "serverSide"		: true,
                    "zeroRecords":    "No matching records found",
                    "ajax"				: {
                        url			: "include/customers_dues_server.php?show_customer_dues_data=true",
                        type		: 'GET',
                        dataSrc     :function(json){
                            var totalPrice = json.total_price;
                            $('#totalPrice').html(totalPrice);
                            return json.data;
                        }
                    },
                    "buttons": [			
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy"></i> Copy',
                    titleAttr: 'Copy',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i> Excel',
                    titleAttr: 'Excel',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'csv',
                    text: '<i class="fas fa-file-csv"></i> CSV',
                    titleAttr: 'CSV',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'pdf',
                    exportOptions: { columns: ':visible' },
                    orientation: 'landscape',
                    pageSize: "LEGAL",
                    text: '<i class="fas fa-file-pdf"></i> PDF',
                    titleAttr: 'PDF'
                }, 
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i> Print',
                    titleAttr: 'Print',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'colvis',
                    text: '<i class="fas fa-list"></i> Column Visibility',
                    titleAttr: 'Column Visibility'
                }
                ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));	
        });
         /* POP filter change event*/
         $(document).on('change','.area_filter',function(){
        
        var area_filter_result = $('.area_filter').val() == null ? '' : $('.area_filter').val();

            table.columns(7).search(area_filter_result).draw();
        
        });  
        function printTable() {
            var divToPrint = document.getElementById('customers_table');
            var newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Print Table</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('a { text-decoration: none; color: black; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }

    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Free Customer</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>

                                   

                                </div>

                                <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addCustomerModal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input id="customer_fullname" type="text" class="form-control " placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Username <span id="usernameCheck"></span></label>
                                                                        <input id="customer_username" type="text" class="form-control " name="username" placeholder="Enter Your Username" oninput="checkUsername();" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Password</label>
                                                                        <input id="customer_password" type="password" class="form-control " name="password" placeholder="Enter Your Password" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile no.</label>
                                                                        <input id="customer_mobile" type="text" class="form-control " name="mobile" placeholder="Enter Your Mobile Number" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Expired Date</label>
                                                                        <select id="customer_expire_date" class="form-select">
                                                                            <option value="<?php echo date("d"); ?>"><?php echo date("d"); ?></option>
                                                                            <?php
                                                                            if ($exp_cstmr = $con->query("SELECT * FROM customer_expires")) {
                                                                                while ($rowsssss = $exp_cstmr->fetch_array()) {


                                                                                    $exp_date = $rowsssss["days"];

                                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                                }
                                                                            }

                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_address" type="text" class="form-control" name="address" placeholder="Enter Your Addres" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>POP/Branch</label>
                                                                        <select id="customer_pop" class="form-select">
                                                                            <option value="">Select Pop/Branch</option>
                                                                            <?php
                                                                            if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                                                while ($rows = $pop->fetch_array()) {


                                                                                    $id = $rows["id"];
                                                                                    $name = $rows["pop"];

                                                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                                                }
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area/Location</label>
                                                                        <select id="customer_area" class="form-select" name="area">
                                                                            <option>Select Area</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Nid Card Number</label>
                                                                        <input id="customer_nid" type="text" class="form-control" name="nid" placeholder="Enter Your Nid Number" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package</label>
                                                                        <select id="customer_package" class="form-select">


                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Connection Charge</label>
                                                                        <input id="customer_con_charge" type="text" class="form-control" name="con_charge" placeholder="Enter Connection Charge" value="500" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package Price</label>
                                                                        <input disabled id="customer_price" type="text" class="form-control" value="00" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Remarks</label>
                                                                        <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"></textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Status</label>
                                                                        <select id="customer_status" class="form-select">
                                                                            <option value="">Select Status</option>
                                                                            <option value="0">Disable</option>
                                                                            <option value="1">Active</option>
                                                                            <option value="2">Expire</option>
                                                                            <option value="3">Request</option>
                                                                        </select>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success" id="customer_add">Add Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
													<th><input type="checkbox" id="checkedAll" name="checkedAll"> All</th>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    <th>Amount</th>
                                                    <th>Expired Date</th>
                                                    <th>Expired Date</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                               
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer" style="text-align: right;">
                                    <button class="btn btn-primary" id="send_message_btn" >Send Message</button>
                                    <button class="btn btn-success" id="export_to_excel" >Export To Excel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Modal for Send Message -->
     <div class="modal fade bs-example-modal-lg" id="sendMessageModal" tabindex="-1" role="dialog"
               aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog " role="document">
                  <div class="modal-content col-md-12">
                     <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span
                           class="mdi mdi-account-check mdi-18px"></span> &nbsp;Send Message</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <div class="alert alert-info" id="selectedCustomerCount"></div>
                        <form id="paymentForm"  method="POST">
                           
                           <div class="form-group mb-2">
                              <label>Message Template</label>
                              <select class="form-select" name="message_template" >
                                <option>---Select---</option>
                                <?php 
                                    if ($allCstmr=$con->query("SELECT * FROM message_template WHERE user_type=1")) {
                                    while ($rows=$allCstmr->fetch_array()) {
                                        echo '<option value='.$rows['id'].'>'.$rows['template_name'].'</option>';
                                    }
                                }

                                    ?>
                            </select>
                           </div>
                           <div class="form-group mb-2">
                              <label>Message</label>
                              <textarea id="message" rows="5" placeholder="Enter Your Message" class="form-control"></textarea>
                           </div>
                           <div class="modal-footer ">
                              <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                              <button type="button" name="send_message_btn" class="btn btn-success">Send Message</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
	
	$(document).ready(function() {
            $(document).on('click','#export_to_excel',function(){
                    let csvContent = "data:text/csv;charset=utf-8,";
                
                /* Add header row*/
                csvContent += [
                    'ID', 'Name', 'Package', 'Expired Date', 'User Name', 'Mobile no.', 'POP/Branch', 'Area/Location'
                ].join(",") + "\n";
                
                /*Add data rows*/ 
                $('#customers_table tbody tr').each(function() {
                    let row = [];
                    $(this).find('td').each(function() {
                        row.push($(this).text().trim());
                    });
                    csvContent += row.join(",") + "\n";
                });

                /* Create a link element and simulate click to download the CSV file*/
                let encodedUri = encodeURI(csvContent);
                let link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "customers.csv");
                document.body.appendChild(link); // Required for Firefox
                link.click();
                document.body.removeChild(link);
            });
			
            $("#checkedAll").change(function() {
                $(".checkSingle").prop('checked', $(this).prop("checked"));
            });
            $(".checkSingle").change(function() {
                if ($(".checkSingle:checked").length == $(".checkSingle").length) {
                    $("#checkedAll").prop("checked", true);
                } else {
                    $("#checkedAll").prop("checked", false);
                }
            });
            $("#send_message_btn").click(function() {
                var selectedCustomers = [];
                $(".checkSingle:checked").each(function() {
                    selectedCustomers.push($(this).val());
                });
                var countText = "You have selected " + selectedCustomers.length + " customers.";
                $("#selectedCustomerCount").text(countText);
                console.log(selectedCustomers); 
                $('#sendMessageModal').modal('show'); 

            });
            $('button[name="send_message_btn"]').on('click',function(e){
                e.preventDefault(); 
                 /*AJAX request to send selected customers to backend*/ 
                 $.ajax({
                    url: 'include/customers_server.php?send_message=true',
                    method: 'POST',
                    data: {
                        /*sending the array of customer IDs*/ 
                        customer_ids: selectedCustomers, 
                        message: $("#message").val(),
                    },
                    success: function(response) {
                        alert("Message sent successfully to selected customers.");
                    },
                    error: function(xhr, status, error) {
                        console.error("An error occurred: " + error);
                        alert("There was an error sending the message.");
                    }
                });
            });
            $('select[name="message_template"]').on('change', function() {
                var name=$(this).val();
                var currentMsgTemp="0";
                $.ajax({
                    type:'POST',
                    data:{name:name,currentMsgTemp:currentMsgTemp},
                    url:'include/message.php',
                    success:function(response){
                        console.log(response);
                        $("#message").val(response);
                    }
                });
            });
           
            
			});
			
			
		
		

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });




        $("#customer_add").click(function() {
            var fullname = $("#customer_fullname").val();
            var package = $("#customer_package").val();
            var username = $("#customer_username").val();
            var password = $("#customer_password").val();
            var mobile = $("#customer_mobile").val();
            var address = $("#customer_address").val();
            var expire_date = $("#customer_expire_date").val();
            var area = $("#customer_area").val();
            var pop = $("#customer_pop").val();
            var nid = $("#customer_nid").val();
            var con_charge = $("#customer_con_charge").val();
            var price = $("#customer_price").val();
            var remarks = $("#customer_remarks").val();
            var status = $("#customer_status").val();
            var user_type = <?php echo $auth_usr_type; ?>;

            customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status)

        });

        function customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status) {
            if (fullname.length == 0) {
                toastr.error("Customer name is require");
            } else if (package.length == 0) {
                toastr.error("Customer Package is require");
            } else if (username.length == 0) {
                toastr.error("Username is require");
            } else if (password.length == 0) {
                toastr.error("Password is require");
            } else if (mobile.length == 0) {
                toastr.error("Mobile number is require");
            } else if (expire_date.length == 0) {
                toastr.error("Expire Date is require");
            } else if (pop.length == 0) {
                toastr.error("POP/Branch is require");
            } else if (area.length == 0) {
                toastr.error("Area is require");
            } else if (con_charge.length == 0) {
                toastr.error("Connection Charge is require");
            } else if (price.length == 0) {
                toastr.error("price is require");
            } else if (status.length == 0) {
                toastr.error("Status is require");
            } else {
                $("#customer_add").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                var addCustomerData = 0;
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php',
                    data: {
                        addCustomerData: addCustomerData,
                        fullname: fullname,
                        package: package,
                        username: username,
                        password: password,
                        mobile: mobile,
                        address: address,
                        expire_date: expire_date,
                        area: area,
                        pop: pop,
                        con_charge: con_charge,
                        price: price,
                        remarks: remarks,
                        nid: nid,
                        status: status,
                        user_type: user_type,
                    },
                    success: function(responseData) {
                        if (responseData == 1) {
                            toastr.success("Added Successfully");
                            $("#addCustomerModal").modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            toastr.error(responseData);
                        }
                    }
                });
            }
        }
    </script>


    <script type="text/javascript">
        var table;
        $(document).ready(function(){

            function loadPopOptions() {
                $.ajax({
                    url: 'include/pop_server.php?get_pop_data=1', 
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var popOptions = '<label style="margin-left: 20px;"> ';
                            popOptions += '<select class="pop_filter form-select">';
                            popOptions += '<option value="">--Select POP--</option>';
                            
                        
                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="'+data.id+'">'+data.pop+'</option>';
                            });

                            popOptions += '</select></label>';
                            
                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.select2').select2();
                            }, 500);
                        }
                       
                    }
                });
            }
            loadPopOptions();

                table=$('#customers_table').DataTable( {
                    "searching": true,
                    "paging": true,
                    "info": false,
                    "lengthChange":true ,
                    "processing"		: true,
                    "serverSide"		: true,
                    "zeroRecords":    "No matching records found",
                    "ajax"				: {
                        url			: "include/customer_free_con_server.php",
                        type		: 'GET',
                    },
                    "buttons": [			
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy"></i> Copy',
                    titleAttr: 'Copy',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i> Excel',
                    titleAttr: 'Excel',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'csv',
                    text: '<i class="fas fa-file-csv"></i> CSV',
                    titleAttr: 'CSV',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'pdf',
                    exportOptions: { columns: ':visible' },
                    orientation: 'landscape',
                    pageSize: "LEGAL",
                    text: '<i class="fas fa-file-pdf"></i> PDF',
                    titleAttr: 'PDF'
                }, 
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i> Print',
                    titleAttr: 'Print',
                    exportOptions: { columns: ':visible' }
                }, 
                {
                    extend: 'colvis',
                    text: '<i class="fas fa-list"></i> Column Visibility',
                    titleAttr: 'Column Visibility'
                }
                ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));	
        });
         /* POP filter change event*/
        $(document).on('change','.pop_filter',function(){
        
        var pop_filter_result = $('.pop_filter').val() == null ? '' : $('.pop_filter').val();

            table.columns(9).search(pop_filter_result).draw();
        
        });

    </script>
</body>

</html>

<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';

?>







<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customer Import';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-header">
                                    <button type="button" class="btn btn-success mb-2" data-bs-toggle="modal"
                                        data-bs-target="#fileImportModal">
                                        <img src="https://img.icons8.com/?size=100&id=117561&format=png&color=000000"
                                            class="img-fluid icon-img" style="height: 20px !important;">
                                        Import Excel File
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Name</th>
                                                    <th>User Name</th>
                                                    <th>Password</th>
                                                    <th>Package</th>
                                                    <th>Mobile</th>
                                                    <th>POP</th>
                                                    <th>Area</th>
                                                    <th>Price</th>
                                                    <th>Expired</th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php
        $directory = "csv/"; 
        $files = scandir($directory); 
        $upldNo = 1;

        foreach ($files as $file) {
            if (pathinfo($file, PATHINFO_EXTENSION) === "csv") {
                $CSVvar = fopen($directory . $file, "r");
                if ($CSVvar !== FALSE) {
                    $i = 0;
                    while ($data = fgetcsv($CSVvar)) {
                        if ($i > 0) { 
                            ?>
                                                <tr>
                                                    <td><?php echo $upldNo++; ?></td>
                                                    <td><?php echo htmlspecialchars($data[0]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[1]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[2]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[3]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[4]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[5]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[6]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[7]); ?></td>
                                                    <td><?php echo htmlspecialchars($data[8]); ?></td>
                                                </tr>
                                                <?php
                        }
                        $i++;
                    }
                }
                fclose($CSVvar);
            }
        }
        ?>
                                            </tbody>
                                        </table>


                                    </div>

                                    <div style="float:letf; width:200px;"><button type="button" id="btn_import"
                                            class="btn btn-success">Process</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>


    <!--------------------CSV File Import Modal---------------------------->
    <div class="modal fade " id="fileImportModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="mdi mdi-upload"></i> File Import
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="file_import_form" method="POST">
                        <div class="form-group mb-2">
                            <label>Upload Your File:</label>
                            <input type="file" name="import_file_name" id="import_file_name" class="form-control" />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="submit" name="file_upload_submit_btn" class="btn btn-success"><i
                            class="mdi mdi-upload"></i> Upload Now</button>
                </div>
            </div>
        </div>
    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#customers_table").DataTable();
            $(document).on('click', '#btn_import', function() {
                if (confirm("Are you sure you want to import?")) {
                    $.ajax({
                        type: 'POST',
                        url: "include/cstmr_import.php",
                        data: {
                            customImprt: 0
                        },
                        success: function(response) {
                            toastr.success("Successfully Imported");
                        }
                    });
                }
            });
            $("button[name='file_upload_submit_btn']").click(function(e) {
                e.preventDefault();
                
                var imageData = $("#import_file_name").prop('files')[0];
                var form_data = new FormData();
                form_data.append('import_file_name', imageData);

                $.ajax({
                    url: "include/cstmr_import.php?file_import",
                    type: "POST",
                    data: form_data,
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        
                        if (response.success) {
                            toastr.success(response.message);
                            location.reload();
                        }
                        if(response.success==false){
                            toastr.error(response.message);
                        }
                        $('#fileImportModal').modal('hide');
                    },
                    error: function() {
                        alert("File upload failed, please try again.");
                    }
                });
            });
        });
    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");


?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">



    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customer New Connection'; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Expired</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button type="submit" class="btn btn-primary mb-2" name="export_to_excel">Export Excel</button>
                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                   
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    <th>Create Date</th>
                                                    <th>Expired Date</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php
												if(isset($_GET["list"]))
												{
													$MnthYr=$_GET["list"];
													

                                                    $sql = "SELECT * FROM customers 
                                                    WHERE DATE_FORMAT(createdate, '%Y-%m') = '$MnthYr'
                                                    AND expiredate >= NOW()";


												}
												else{
													//$sql="SELECT * FROM customers WHERE expiredate<NOW()";
												}
                                               
											   
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {
													$username = $rows["username"];

                                                ?>

                                                    <tr>
													
                                                        <td><?php echo $rows['id']; ?></td>
                                                        <td>
														<?php 
                                                            
                                                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$username'");
                                                            $chkc = $onlineusr->num_rows;
                                                            if($chkc==1)
                                                            {
                                                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                                                            } else{
                                                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';

                                                            }
                                                 
                                                            
                                                            ?>
														
														
														
														<a href="profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
                                                        <td>
                                                            <?php

                                                            echo  $rows["package_name"];
                                                            // if ($allData = $con->query("SELECT * FROM radgroupcheck WHERE id='$packageId'")) {
                                                            //     while ($packageName = $allData->fetch_array()) {
                                                            //         echo  $packageName['groupname'];
                                                            //     }
                                                            // }

                                                            ?>

                                                        </td>
                                                        <td>
                                                            <?php 
                                                           echo  date_format(date_create($rows["createdate"]), "Y-m-d"); 
                                                            ?>

                                                        </td>
                                                        <td>
                                                            <?php

                                                            $expireDate = $rows["expiredate"];
                                                            $todayDate = date("Y-m-d");
                                                            if ($expireDate <= $todayDate) {
                                                                echo "<span class='badge bg-danger'>Expired</span>";
                                                            } else {
                                                                echo $expireDate;
                                                            }
                                                            ?>
                                                        </td>
                                                        <td><?php echo $rows["username"]; ?></td>
                                                        <td><?php echo $rows["mobile"]; ?></td>
                                                        <td>
                                                            <?php
                                                            $popID = $rows["pop"];
                                                            $allPOP = $con->query("SELECT * FROM add_pop WHERE id=$popID ");
                                                            while ($popRow = $allPOP->fetch_array()) {
                                                                echo $popRow['pop'];
                                                            }

                                                            ?>
                                                        </td>
                                                        <td>
                                                            <?php $id = $rows["area"];
                                                            $allArea = $con->query("SELECT * FROM area_list WHERE id='$id' ");
                                                            while ($popRow = $allArea->fetch_array()) {
                                                                echo $popRow['name'];
                                                            }

                                                            ?>

                                                        </td>
                                                        

                                                        <td>
                                                            <a class="btn btn-info" href="profile_edit.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                                                            <a class="btn btn-success" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
                                                            </a>

                                                            <!--<a href="customer_delete.php?clid=<?php echo $rows['id']; ?>" class="btn btn-danger deleteBtn" onclick=" return confirm('Are You Sure');" data-id=<?php echo $rows['id']; ?>><i class="fas fa-trash"></i>
                                                            </a>-->

                                                        </td>
                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                            <tfoot>
                                               
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    
    <?php include 'script.php';?>
    <script type="text/javascript">
	
	$(document).ready(function() {
		
			
            $("#checkedAll").change(function() {
                if (this.checked) {
                    $(".checkSingle").each(function() {
                        this.checked = true;
                    })
                } else {
                    $(".checkSingle").each(function() {
                        this.checked = false;
                    })
                }
            });

            $(".checkSingle").click(function() {
                if ($(this).is(":checked")) {
                    var isAllChecked = 0;
                    $(".checkSingle").each(function() {
                        if (!this.checked)
                            isAllChecked = 1;
                    })
                    if (isAllChecked == 0) {
                        $("#checkedAll").prop("checked", true);
                    }
                } else {
                    $("#checkedAll").prop("checked", false);
                }
            });
			});
			
			
        $("#customers_table").DataTable();
		
		

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });




        $("#customer_add").click(function() {
            var fullname = $("#customer_fullname").val();
            var package = $("#customer_package").val();
            var username = $("#customer_username").val();
            var password = $("#customer_password").val();
            var mobile = $("#customer_mobile").val();
            var address = $("#customer_address").val();
            var expire_date = $("#customer_expire_date").val();
            var area = $("#customer_area").val();
            var pop = $("#customer_pop").val();
            var nid = $("#customer_nid").val();
            var con_charge = $("#customer_con_charge").val();
            var price = $("#customer_price").val();
            var remarks = $("#customer_remarks").val();
            var status = $("#customer_status").val();
            var user_type = <?php echo $auth_usr_type; ?>;

            customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status)

        });

        function customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status) {
            if (fullname.length == 0) {
                toastr.error("Customer name is require");
            } else if (package.length == 0) {
                toastr.error("Customer Package is require");
            } else if (username.length == 0) {
                toastr.error("Username is require");
            } else if (password.length == 0) {
                toastr.error("Password is require");
            } else if (mobile.length == 0) {
                toastr.error("Mobile number is require");
            } else if (expire_date.length == 0) {
                toastr.error("Expire Date is require");
            } else if (pop.length == 0) {
                toastr.error("POP/Branch is require");
            } else if (area.length == 0) {
                toastr.error("Area is require");
            } else if (con_charge.length == 0) {
                toastr.error("Connection Charge is require");
            } else if (price.length == 0) {
                toastr.error("price is require");
            } else if (status.length == 0) {
                toastr.error("Status is require");
            } else {
                $("#customer_add").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                var addCustomerData = 0;
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php',
                    data: {
                        addCustomerData: addCustomerData,
                        fullname: fullname,
                        package: package,
                        username: username,
                        password: password,
                        mobile: mobile,
                        address: address,
                        expire_date: expire_date,
                        area: area,
                        pop: pop,
                        con_charge: con_charge,
                        price: price,
                        remarks: remarks,
                        nid: nid,
                        status: status,
                        user_type: user_type,
                    },
                    success: function(responseData) {
                        if (responseData == 1) {
                            toastr.success("Added Successfully");
                            $("#addCustomerModal").modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            toastr.error(responseData);
                        }
                    }
                });
            }
        }


        $(document).on('click', 'button[name="export_to_excel"]', function() {
            let csvContent = "data:text/csv;charset=utf-8,";

            /* Add header row */
            csvContent += [
             'ID', 'Name', 'Package', 'Amount', 'Expired Date', 'Expired Date', 'Username', 'Mobile no.',
                'POP/Branch', 'Area/Location'
            ].join(",") + "\n";



            /* Add selected data rows */
            $('#customers_table tbody tr').each(function() {
                let row = [];
                $(this).find('td').each(function() {
                    row.push($(this).text().trim());
                });
                csvContent += row.join(",") + "\n";
            });


            /* Create a link element and simulate click to download the CSV file */
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "customers.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";

?>
<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">


    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customer Recharge</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row" id="searchRow">
                        <div class="col-md-6 col-sm m-auto">
                            <div class="card shadow">
                                <div class="card-header bg-dark text-white">Customer Recharge</div>
                                <div class="card-body">
                                    <form action="">
                                        <div class="form-gruop mb-2">
                                            <label>Select Customer</label>

                                            <select type="text" id="recharge_customer" class="form-select select2">
                                                <option value="">---Select---</option>
                                                <?php

											if ($allData = $con->query("SELECT * FROM customers ")) {
												while ($rows = $allData->fetch_array()) {
											echo ' <option value="'.$rows['id'].'">['.$rows['id'].'] - '.$rows['username'].' || '.$rows['fullname'].', ('.$rows['mobile'].')</option>';
												}
											}


											?>
                                            </select>
                                        </div>
                                        <div class="form-group mb-1">
                                            <label>Month</label>
                                            <select id="recharge_customer_month" class="form-select">
                                                <option value="">Select</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                            </select>
                                        </div>
                                        <div class="form-group ">
                                            <label for="">Package</label>
                                            <select disabled="Disable" id="recharge_customer_package" class="form-select ">

                                            </select>
                                        </div>
                                        <div class="form-group mb-1 ">
                                            <label>Package Price:</label>

                                            <input id="recharge_customer_package_price" disabled="Disable" type="text" class="form-control form-control-sm" value="">
                                        </div>
                                        <div class="form-group mb-1 ">
                                            <label>Ref:</label>

                                            <input id="ref"  type="text" class="form-control form-control-sm" value="">
                                        </div>
                                        <div class="form-group mb-1 d-none">
                                            <label>Pop id:</label>

                                            <input id="recharge_customer_pop_id" disabled="Disable" type="text" class="form-control form-control-sm" value="">
                                        </div>
                                        <div class="form-group mb-1 ">
                                            <label>Payable Amount:</label>
                                            <input id="recharge_customer_amount" disabled type="text" class="form-control form-control-sm" value="" />
                                        </div>
                                        <div class="form-group mb-1">
                                            <label>Transaction Type:</label>
                                            <select id="recharge_customer_transaction_type" class="form-select">
                                                <option value="">Select</option>
                                                <option value="1">Cash</option>
                                                <option value="0">On Credit</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <button class="btn btn-success" style="width: 100%;" type="button" id="add_recharge_btn"><i class="mdi mdi mdi-battery-charging-90"></i>&nbsp;&nbsp;Recharge Now</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script src="assets/libs/select2/js/select2.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {

            $("#recharge_customer").select2();

            $("#recharge_customer").on('change', function() {
                var id = $("#recharge_customer").val();
                getCustomerPackage(id);
                getCustomerPackagePrice(id);
                getCustomerPopId(id);

            });

            //get Package name
            function getCustomerPackage(recevedId) {
                var customerId = recevedId;
                $.ajax({
                    url: 'include/customers_server.php',
                    method: 'POST',
                    data: {
                        id: customerId,
                        getCustomerSpecificId: 0
                    },
                    //dataType: 'json',
                    success: function(responseData) {
                        $("#recharge_customer_package").html(responseData);
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        // Handle any errors here
                        console.error('An error occurred:', errorThrown);
                    }
                });
            }
            //get Package price
            function getCustomerPackagePrice(recevedId) {
                var customerId = recevedId;
                $.ajax({
                    url: 'include/customers_server.php',
                    method: 'POST',
                    data: {
                        id: customerId,
                        getCustomerPackagePrice: 0
                    },
                    //dataType: 'json',
                    success: function(responseData) {
                        $("#recharge_customer_package_price").val(responseData);
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        // Handle any errors here
                        console.error('An error occurred:', errorThrown);
                    }
                });
            }
            //get Package price
            function getCustomerPopId(recevedId) {
                var customerId = recevedId;
                $.ajax({
                    url: 'include/customers_server.php',
                    method: 'POST',
                    data: {
                        id: customerId,
                        getCustomerPop: 0
                    },
                    //dataType: 'json',
                    success: function(responseData) {
                        $("#recharge_customer_pop_id").val(responseData);
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        // Handle any errors here
                        console.error('An error occurred:', errorThrown);
                    }
                });
            }
            //get recharge Calculation
            getCalculation();

            function getCalculation() {
                $(document).on('change', "#recharge_customer_month", function() {
                    var month = $("#recharge_customer_month").val();
                    var price = $("#recharge_customer_package_price").val();
                    var totalAmount = Number(month * price);
                    $("#recharge_customer_amount").val(totalAmount);
                });
            }

            //customer recharge script

            $(document).on('click', '#add_recharge_btn', function() {
                var customer_id = $("#recharge_customer").val();
                var month = $("#recharge_customer_month").val();
                var package = $("#recharge_customer_package").val();
                var mainAmount = $("#recharge_customer_amount").val();
                var tra_type = $("#recharge_customer_transaction_type").val();
                var pop_id = $("#recharge_customer_pop_id").val();
                var ref = $("#ref").val();
                sendData(customer_id, month, package, mainAmount, tra_type, pop_id,ref);
            });
            const sendData = (customer_id, month, package, mainAmount, tra_type, pop_id,ref) => {

                if (month.length == 0) {
                    toastr.error("Select Month");
                } else if (customer_id.length == 0) {
                    toastr.error("Select Customer");
                } else if (tra_type.length == 0) {
                    toastr.error("Select Transaction");
                } else {
                    $("#add_recharge_btn").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                    $.ajax({
                        type: 'POST',
                        url: 'include/customer_recharge_server.php',
                        data: {
                            customer_id: customer_id,
                            month: month,
                            package: package,
                            amount: mainAmount,
                            tra_type: tra_type,
                            pop_id: pop_id,
                            RefNo: ref,
                            add_recharge_data:0
                        },
                        success: function(response) {
                            if (response == 1) {
                                $("#add_recharge_btn").html('Recharge Now');
                                toastr.success("Recharge Successful");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response);
                                $("#add_recharge_btn").html('Recharge Now');
                            }



                        }
                    });



                }

            }

        });
    </script>
</body>

</html>

<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';
?>

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customers';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-primary mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers</p>
                                            <?php if($_GET['new_customer_month']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;New Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['expire_customer_month']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp; Monthly Expired Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['online']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Online Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['offline']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Offline Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['active']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Active Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['expired']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Expired Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['disabled']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Disabled Customers</p>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal"
                                        class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>



                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">

                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th><input type="checkbox" id="checkedAll" name="checkedAll"
                                                            class="form-check-input"></th>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    <th>Amount</th>
                                                    <th>Create Date</th>
                                                    <th>Expired Date</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th>Liablities</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer flex-wrap justify-content-between align-items-center">
                                    <button class="btn btn-primary mb-2" id="send_message_btn">
                                        <i class="fa fa-envelope"></i>&nbsp;Send Message
                                    </button>
                                   <button type="button" class="btn btn-info mb-2" name="customer_billing_btn">
                                        <i class="fa fa-exchange-alt"></i>&nbsp;Change Billing
                                    </button>


                                    <button type="button" class="btn btn-success mb-2" name="export_to_excel">
                                        <img src="https://img.icons8.com/?size=100&id=117561&format=png&color=000000"
                                            class="img-fluid icon-img" style="height: 20px !important;">
                                        
                                    </button>

                                    <button type="button" onclick="printSelectedRows()" class="btn btn-danger mb-2">
                                        <i class="fas fa-print"></i>&nbsp;
                                    </button>

                                    <button type="button" class="btn btn-info mb-2" name="recharge_btn">
                                        <i class="mdi mdi-battery-charging-20"></i>&nbsp;Recharge
                                    </button>

                                    <!-- <button type="button" class="btn btn-info mb-2"data-bs-toggle="modal"
                                        data-bs-target="#ticketModal">
                                        <i class="mdi mdi-ticket"></i>&nbsp;Add Ticket
                                    </button> -->

                                    <button type="button" class="btn btn-success mb-2" name="pop_change_btn">
                                        <i class="fas fa-angle-double-right"></i>&nbsp;Change POP/Branch
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Modal for Send Message -->
    <div class="modal fade bs-example-modal-lg" id="sendMessageModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span>
                        &nbsp;Send Message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="selectedCustomerCount"></div>
                    <form id="paymentForm" method="POST">

                        <div class="form-group mb-2">
                            <label>Message Template</label>
                            <select class="form-select" name="message_template">
                                <option>---Select---</option>
                                <?php
                                if ($allCstmr = $con->query('SELECT * FROM message_template WHERE user_type=1')) {
                                    while ($rows = $allCstmr->fetch_array()) {
                                        echo '<option value=' . $rows['id'] . '>' . $rows['template_name'] . '</option>';
                                    }
                                }
                                
                                ?>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Message</label>
                            <textarea id="message" rows="5" placeholder="Enter Your Message" class="form-control"></textarea>
                        </div>
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="button" name="send_message_btn" class="btn btn-success">Send
                                Message</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!------------------ Modal for Recharge ------------------>
    <div class="modal fade " id="rechargeModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Recharge
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="selectedCustomerCount"></div>
                    <form id="recharge-form" method="POST">
                        <div id="holders">
                            <div class="form-group mb-1">
                                <label>Month</label>
                                <select id="month" class="form-select" name='month'>
                                    <option value="">Select</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group mb-1 ">
                            <label>Ref No.:</label>
                            <input id="RefNo" type="text" class="form-control" name="RefNo"
                                placeholder="Enter Ref No" />
                        </div>
                        <div class="form-group mb-1">
                            <label>Transaction Type:</label>
                            <select id="tra_type" name="tra_type" class="form-select">
                                <option>---Select---</option>
                                <option value="1">Cash</option>
                                <option value="0">On Credit</option>
                                <option value="2">Bkash</option>
                                <option value="3">Nagad</option>
                                <option value="4">Due Payment</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" name="recharge_submit_btn" class="btn btn-success">Recharge Now</button>
                </div>
            </div>
        </div>
    </div>
    <!--------------------Add Payment received Modal---------------------------->
    <div class="modal fade " id="addPaymentModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Payment Received
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="selectedCustomerCount"></div>
                    <form id="cash_received_form" method="POST">
                        <div class="form-group mb-2">
                            <label>Amount:</label>
                            <input type="text" name="received_amount" placeholder="Enter Your Amount"
                                class="form-control" required>
                        </div>
                        <div class="form-group mb-2">
                            <label>Transaction Type:</label>
                            <select id="received_tra_type" class="form-select" required>
                                <option>---Select---</option>
                                <option value="1">Cash</option>
                                <option value="2">Bkash</option>
                                <option value="3">Nagad</option>
                                <option value="4">Bank</option>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Remarks</label>
                            <textarea name="received_remarks" class="form-control" placeholder="Enter Remarks"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" name="cash_received_submit_btn" class="btn btn-success"><i
                            class="mdi mdi-cash"></i> Payment Now</button>
                </div>
            </div>
        </div>
    </div>
    <!--------------------CSV File Import Modal---------------------------->
    <div class="modal fade " id="fileImportModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="mdi mdi-upload"></i> File Import
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="file_import_form" method="POST">
                        <div class="form-group mb-2">
                            <label>Upload Your File:</label>
                            <input type="file" name="import_file_name" class="form-control" />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" name="file_upload_submit_btn" class="btn btn-success"><i
                            class="mdi mdi-upload"></i> Upload Now</button>
                </div>
            </div>
        </div>
    </div>
    <!------------------ Modal for Change Customer POP/Branch ------------------>
    <div class="modal fade " id="changePopModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="mdi mdi-swap-horizontal"></i> Change POP/Branch
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="selectedCustomerCount"></div>
                    <form id="change_pop_form" method="POST">
                        <div class="form-group mb-1">
                            <label>Transfer To POP/Branch</label>
                            <select type="text" name="pop_id" class="form-select" style="width: 100%;"></select>
                        </div>
                        <div class="form-group mb-1">
                            <label>Area</label>
                            <select type="text" name="area_id" class="form-select" style="width: 100%;"></select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" name="pop_change_submit_btn" class="btn btn-success"> <i
                            class="mdi mdi-swap-horizontal"></i> Change POP/Branch</button>
                </div>
            </div>
        </div>
    </div>
    <!--------------------Customer Billing Modal Modal---------------------------->
    <div class="modal fade " id="customerBillingModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        Customer Billing Change
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="selectedCustomerCount"></div>
                    <form id="customer_billing_form" method="POST">
                        <div class="form-group mb-2">
                            <label>Billing Date:</label>
                            <select type="text" name="customer_billing_date" class="form-select" required>
                                <option value="">---Select---</option>
                                <?php
                                for ($i = 1; $i <= 31; $i++) {
                                    echo '<option value="' . $i . '">' . $i . '</option>';
                                }
                                ?>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" name="customer_billing_submit_btn" class="btn btn-success"><i
                            class="mdi mdi-update"></i> Change Now</button>
                </div>
            </div>
        </div>
    </div>
    <!------------------ Modal Customer Tickets ------------------>
    <?php require 'modal/tickets_modal.php'; ?>
    <?php require 'modal/customer_modal.php'; ?>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>
    <script src="js/tickets.js"></script>
    <script src="js/customer.js"></script>
    <script src="js/Ajax.js"></script>



    <script type="text/javascript">
        var table;
        $(document).ready(function() {
            //$("#customer_details_show_modal").modal('show');
            var get_pop_id = "<?php echo isset($_GET['pop_id']) ? $_GET['pop_id'] : ''; ?>";
            var get_area_id = "<?php echo isset($_GET['area_id']) ? $_GET['area_id'] : ''; ?>";

            if (get_pop_id.length > 0 || get_area_id.length > 0) {

            } else {
                loadPopOptions();
                loadAreaOptions();
            }



            function loadPopOptions() {
                $.ajax({
                    url: 'include/pop_server.php?get_pop_data=1',
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success == true) {
                            var popOptions = '<label style="margin-left: 10px;"> ';
                            popOptions += '<select class="pop_filter">';
                            popOptions += '<option value="">--Select POP--</option>';


                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="' + data.id + '">' + data.pop +
                                    '</option>';
                            });

                            popOptions += '</select></label>';

                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.pop_filter').select2();
                            }, 500);
                        }

                    }
                });
            }

            function loadAreaOptions() {
                $.ajax({
                    url: 'include/area_server.php?get_area_data=1',
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success == true) {
                            var popOptions = '<label style="margin-left: 10px;"> ';
                            popOptions += '<select class="area_filter form-select">';
                            popOptions += '<option value="">--Select Area--</option>';


                            $.each(response.data, function(key, data) {
                                popOptions += '<option value="' + data.id + '">' + data.name +
                                    '</option>';
                            });

                            popOptions += '</select></label>';

                            setTimeout(() => {
                                $('.dataTables_length').append(popOptions);
                                $('.area_filter').select2();
                            }, 1000);

                            var status_filter = '<label style="margin-left: 10px;"> ';
                            status_filter += '<select class="status_filter form-select">';
                            status_filter += '<option value="">--Status--</option>';
                            status_filter += '<option value="online" >Online</option>';
                            status_filter += '<option value="offline">Offline</option>';
                            status_filter += '<option value="expired">Expired</option>';
                            status_filter += ' <option value="unpaid">Unpaid</option>';
                            status_filter += ' <option value="due">Due</option>';
                            status_filter += ' <option value="free">Free</option>';
                            status_filter += ' <option value="active">Active</option>';
                            status_filter += ' <option value="disabled">Disabled</option>';
                            status_filter += '</select></label>';

                            setTimeout(() => {
                                $('.dataTables_length').parent().removeClass(
                                    'col-sm-12 col-md-6');
                                $('.dataTables_filter').parent().removeClass(
                                    'col-sm-12 col-md-6');
                                $('.dataTables_length').append(status_filter);
                                $('.status_filter').select2();
                            }, 1000);
                        }

                    }
                });
            }
            $(document).on('change', '.pop_filter', function() {
                var pop_id = $(this).val();
                $.ajax({
                    url: 'include/area_server.php?get_area_data=1&pop_id=' + pop_id,
                    type: 'GET',
                    dataType: 'json',
                    success: function(response) {
                        if (response.success == true) {
                            var areaOptions = '<option value="">--Select Area--</option>';
                            $.each(response.data, function(key, data) {
                                areaOptions += '<option value="' + data.id + '">' + data
                                    .name + '</option>';
                            });
                            setTimeout(() => {
                                $('.area_filter').html(areaOptions);
                                $('.area_filter').select2();
                            }, 500);
                        }
                    }
                });
            });
            var checkedBoxes = {};
            table = $('#customers_table').DataTable({
                "searching": true,
                "paging": true,
                "info": true,
                "order": [
                    [0, "desc"]
                ],
                "lengthChange": true,
                "processing": false,
                "serverSide": false,
                columnDefs: [{
                    orderable: false,
                    className: 'select-checkbox',
                    targets: 10,
                }],
                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                select: {
                    style: 'os',
                    selector: 'td.select-checkbox'
                },
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/customer_server_new.php?get_customers_data=true",
                    type: 'GET',
                    data: function(d) {

                        /********************Filter For Active Customer*******************************/
                        <?php if (isset($_GET['active']) && !empty($_GET['active'])): ?>
                        d.status = <?php echo $_GET['active']; ?>;
                        $("#customers_table_length").hide();
                        <?php else: ?>
                        d.status = $('.status_filter').val();
                        <?php endif; ?>

                        /********************Filter For POP ID Customer*******************************/
                        <?php if (isset($_GET['pop_id']) && !empty($_GET['pop_id'])): ?>
                        d.pop_id = <?php echo $_GET['pop_id']; ?>;
                        <?php else: ?>
                        d.pop_id = $('.pop_filter').val();
                        <?php endif; ?>
                        /********************Filter For AREA ID Customer*******************************/
                        <?php if (isset($_GET['area_id']) && !empty($_GET['area_id'])): ?>
                        d.area_id = <?php echo $_GET['area_id']; ?>;
                        <?php else: ?>
                        d.area_id = $('.area_filter').val();
                        <?php endif; ?>
                        /********************Filter For Online Customer*******************************/
                        <?php if (isset($_GET['online']) && !empty($_GET['online'])): ?>
                        d.status = "online";
                        //$("#customers_table_length").hide();
                        <?php else: ?>
                        //d.status = $('.status_filter').val();
                        <?php endif; ?>
                        /********************Filter For Online Customer*******************************/
                        <?php if (isset($_GET['offline']) && !empty($_GET['offline'])): ?>
                        d.status = "offline";
                        //$("#customers_table_length").hide();
                        <?php else: ?>
                        //d.status = $('.status_filter').val();
                        <?php endif; ?>
                        /********************Filter For expired Customer*******************************/
                        <?php if (isset($_GET['expired']) && !empty($_GET['expired'])): ?>
                        d.status = "expired";
                        //$("#customers_table_length").hide();
                        <?php else: ?>
                        //d.status = $('.status_filter').val();
                        <?php endif; ?>
                        /********************Filter For Disabled Customer*******************************/
                        <?php if (isset($_GET['disabled']) && !empty($_GET['disabled'])): ?>
                        d.status = "disabled";
                        //$("#customers_table_length").hide();
                        <?php else: ?>
                        //d.status = $('.status_filter').val();
                        <?php endif; ?>

                        /********************Filter Monthly Expire Customer*******************************/
                        <?php if (isset($_GET['expire_customer_month']) && !empty($_GET['expire_customer_month'])): ?>
                        let expire_customer_month = "<?php echo $_GET['expire_customer_month']; ?>";
                        d.expire_customer_month = expire_customer_month;
                       // $("#customers_table_length").hide();
                        <?php endif; ?>

                        /********************Filter Monthly New Customer*******************************/
                        <?php if (isset($_GET['new_customer_month']) && !empty($_GET['new_customer_month'])): ?>
                        let new_customer_month = "<?php echo $_GET['new_customer_month']; ?>";
                        d.new_customer_month = new_customer_month;
                        //$("#customers_table_length").hide();
                        <?php endif; ?>

                    },
                    beforeSend: function() {
                        $(".dataTables_empty").html(
                            '<img src="assets/images/loading.gif" style="background-color: transparent"/>'
                            );
                    },

                },
                "drawCallback": function() {
                    $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
                    /* Restore checked state*/
                    $('.customer-checkbox').each(function() {
                        var id = $(this).val();
                        if (checkedBoxes[id]) {
                            $(this).prop('checked', true);
                        }
                    });
                },
                "buttons": [{
                        extend: 'excelHtml5',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        titleAttr: 'Export to Excel',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        titleAttr: 'Print',
                        exportOptions: {
                            columns: ':visible'
                        }
                    }
                ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));
            /* Check/Uncheck All Checkboxes*/
            $(document).on('change', '#checkedAll', function() {
                var isChecked = $(this).is(':checked');
                $('.customer-checkbox').prop('checked', isChecked);
                $('.customer-checkbox').each(function() {
                    var id = $(this).val();
                    checkedBoxes[id] = isChecked;
                });
            });

            /* Handle Individual Checkbox Change*/
            $(document).on('cilck', '.customer-checkbox', function() {
                var id = $(this).val();
                checkedBoxes[id] = $(this).is(':checked');

                var allChecked = $('.customer-checkbox:checked').length === $('.customer-checkbox').length;
                $('#checkedAll').prop('checked', allChecked);
            });
        });

        /* POP filter change event*/
        $(document).on('change', '.pop_filter', function() {

            var pop_filter_result = $('.pop_filter').val() == null ? '' : $('.pop_filter').val();

            // table.columns(9).search(pop_filter_result).draw();
            table.ajax.reload(null, false);

        });
        /* Area change event*/
        $(document).on('change', '.area_filter', function() {

            var area_filter_result = $('.area_filter').val() == null ? '' : $('.area_filter').val();

            // table.columns(10).search(area_filter_result).draw();

            table.ajax.reload(null, false);

        });
        /* Area change event*/
        $(document).on('change', '.status_filter', function() {
            var status_filter_result = $('.status_filter').val() == null ? '' : $('.status_filter').val();
            table.ajax.reload(null, false);
        });
        $(document).on('click', 'button[name="export_to_excel"]', function() {
            let csvContent = "data:text/csv;charset=utf-8,";

            /* Add header row */
            csvContent += [
                '', 'ID', 'Name', 'Package', 'Amount', 'Expired Date', 'Expired Date', 'Username', 'Mobile no.',
                'POP/Branch', 'Area/Location'
            ].join(",") + "\n";



            /* Add selected data rows */
            $('#customers_table tbody tr').each(function() {
                let row = [];
                $(this).find('td').each(function() {
                    row.push($(this).text().trim());
                });
                csvContent += row.join(",") + "\n";
            });


            /* Create a link element and simulate click to download the CSV file */
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "customers.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });


        function printTable() {
            var divToPrint = document.getElementById('customers_table');
            var newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Customer</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('a { text-decoration: none; color: black; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }

        function printSelectedRows() {
            let selectedContent = `
                <table class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Package</th>
                            <th>Amount</th>
                            <th>Expired Date</th>
                            <th>Expired Date</th>
                            <th>User Name</th>
                            <th>Mobile no.</th>
                            <th>POP/Branch</th>
                            <th>Area/Location</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            let hasSelectedRows = false;

            $('#customers_table tbody tr').each(function() {
                let checkbox = $(this).find('input[type="checkbox"]');
                if (checkbox.is(':checked')) {
                    hasSelectedRows = true;
                    selectedContent += "<tr>";
                    $(this).find('td').each(function() {
                        selectedContent += `<td>${$(this).text().trim()}</td>`;
                    });
                    selectedContent += "</tr>";
                }
            });

            if (!hasSelectedRows) {
                toastr.error("Please select at least one row to print.");
                return;
            }

            selectedContent += `
                    </tbody>
                </table>
            `;


            let newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Customer Data</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(selectedContent);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }
        $(document).on('click', '#send_message_btn', function(event) {
            event.preventDefault();
            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var countText = "You have selected " + selectedCustomers.length + " customers.";
            $("#selectedCustomerCount").text(countText);
            $('#sendMessageModal').modal('show');

        });
        $(document).on('click', 'button[name="send_message_btn"]', function(e) {
            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });

            e.preventDefault();
            $.ajax({
                url: 'include/message_server.php?bulk_message=true',
                method: 'POST',
                dataType: 'json',
                data: {
                    /*sending the array of customer IDs*/
                    customer_ids: selectedCustomers,
                    message: $("#message").val(),
                },
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#sendMessageModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                }
            });
        });
        $('select[name="message_template"]').on('change', function() {
            var name = $(this).val();
            var currentMsgTemp = "0";
            $.ajax({
                type: 'POST',
                data: {
                    name: name,
                    currentMsgTemp: currentMsgTemp
                },
                url: 'include/message.php',
                success: function(response) {
                    $("#message").val(response);
                }
            });
        });
        /************************** Customer Recharage Section **************************/
        $(document).on('click', 'button[name="recharge_btn"]', function(e) {
            event.preventDefault();
            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            if (selectedCustomers.length == 0) {
                toastr.error("Please select at least one customer to recharge.");
                return false;
            }
            var countText = "You have selected " + selectedCustomers.length + " customers.";
            $("#rechargeModal #selectedCustomerCount").text(countText);
            $('#rechargeModal').modal('show');
        });

        $(document).on('click', 'button[name="recharge_submit_btn"]', function(e) {
            event.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );

            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var data = $('#recharge-form').serialize() + '&selectedCustomers=' + JSON.stringify(selectedCustomers);
            $.ajax({
                url: 'include/customer_recharge_server.php?add_customer_recharge=true',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#rechargeModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else if (response.success == false) {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                },
                complete: function() {

                    $button.prop('disabled', false);
                    $button.html('Recharge Now');
                }
            });
        });
        /************************** Cash Received **************************/
        $(document).on('click', 'button[name="cash_received_btn"]', function(e) {
            event.preventDefault();
            var customers = [];
            $(".checkSingle:checked").each(function() {
                customers.push($(this).val());
            });
            if (customers.length == 0) {
                toastr.error("Please select at least one customer");
                return false;
            }
            if (customers.length > 1) {
                toastr.error("Sorry!! You Don't Selected One More");
                return false;
            }

            var countText = "You have selected " + customers.length + " customer.";
            $("#addPaymentModal #selectedCustomerCount").text(countText);
            $('#addPaymentModal').modal('show');
        });

        $(document).on('click', 'button[name="cash_received_submit_btn"]', function(e) {
            event.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );

            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var data = $('#cash_received_form').serialize() + '&selectedCustomers=' + JSON.stringify(
                selectedCustomers);
            $.ajax({
                url: 'include/customer_recharge_server.php?cash_received=true',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#addPaymentModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else if (response.success == false) {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                },
                complete: function() {

                    $button.prop('disabled', false);
                    $button.html('<i class="mdi mdi-cash"></i>Payment Now');
                }
            });
        });
        /************************** CSV File Upload **************************/
        $(document).on('click', 'button[name="file_upload_submit_btn"]', function(e) {
            event.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );
            var formData = new FormData($('#file_import_form')[0]);

            $.ajax({
                url: 'include/customer_server_new.php?import_file_data=true',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#fileImportModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                },
                complete: function() {
                    $button.prop('disabled', false);
                    $button.html('<i class="mdi mdi-upload"></i> Upload Now');
                }
            });

        });
        /************************** Charge Customer POP/Branch **************************/
        $(document).on('click', 'button[name="pop_change_btn"]', function(e) {
            event.preventDefault();
            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var countText = "You have selected " + selectedCustomers.length + " customers.";
            $("#changePopModal #selectedCustomerCount").text(countText);
            if (selectedCustomers.length == 0) {
                toastr.error("Please select at least one customer");
                return false;
            }
            $.ajax({
                url: 'include/pop_server.php?get_pop_data=1',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success == true) {
                        var popOptions = '<option value="">--Select POP--</option>';

                        $.each(response.data, function(key, data) {
                            popOptions += '<option value="' + data.id + '">' + data.pop +
                                '</option>';
                        });

                        $('select[name="pop_id"]').html(popOptions);
                        $('#changePopModal').modal('show');
                        $('#changePopModal').on('shown.bs.modal', function() {
                            if (!$('select[name="pop_id"]').hasClass(
                                    "select2-hidden-accessible")) {
                                $('select[name="pop_id"]').select2({
                                    dropdownParent: $('#changePopModal')
                                });
                            }
                        });
                        get_area();
                    }
                }
            });
        });
        $("#changePopModal select[name='pop_id']").change(function() {
            var pop_id = $(this).val();
            get_area(pop_id);
        });

        function get_area(pop_id) {
            $.ajax({
                url: 'include/area_server.php?get_area_data=1',
                type: 'GET',
                data: {
                    pop_id: pop_id
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success == true) {
                        var areaOptions = '<option value="">--Select Area--</option>';

                        $.each(response.data, function(key, data) {
                            areaOptions += '<option value="' + data.id + '">' + data.name +
                                '</option>';
                        });
                        $('select[name="area_id"]').html(areaOptions);
                        $('#changePopModal').on('shown.bs.modal', function() {
                            if (!$('select[name="area_id"]').hasClass(
                                    "select2-hidden-accessible")) {
                                $('select[name="area_id"]').select2({
                                    dropdownParent: $('#changePopModal')
                                });
                            }
                        });

                    }

                }
            });
        }

        $(document).on('click', 'button[name="pop_change_submit_btn"]', function(e) {
            event.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );

            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var data = $('#change_pop_form').serialize() + '&selectedCustomers=' + JSON.stringify(
                selectedCustomers);
            $.ajax({
                url: 'include/customer_server_new.php?change_pop_request=true',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#changePopModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else if (response.success == false) {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                },
                complete: function() {

                    $button.prop('disabled', false);
                    $button.html('<i class="mdi mdi-swap-horizontal"></i> Change POP/Branch');

                }
            });
        });
        /************************** Add ticket Modal Script **************************/
        ticket_modal();
        loadCustomers();
        ticket_assign();
        ticket_complain_type();
        /************************** Customer Billing And Expire Section **************************/
        $(document).on('click', 'button[name="customer_billing_btn"]', function(e) {
            event.preventDefault();
            var customers = [];
            $(".checkSingle:checked").each(function() {
                customers.push($(this).val());
            });
            if (customers.length == 0) {
                toastr.error("Please select at least one customer");
                return false;
            }
            // if (customers.length > 1) {
            //     toastr.error("Sorry!! You Don't Selected One More");
            //     return false;
            // }

            var countText = "You have selected " + customers.length + " customer.";
            $("#customerBillingModal #selectedCustomerCount").text(countText);
            $('#customerBillingModal').modal('show');
        });

        $(document).on('click', 'button[name="customer_billing_submit_btn"]', function(e) {
            e.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );

            var customers = [];
            $(".checkSingle:checked").each(function() {
                customers.push($(this).val());
            });

            var data = $('#customer_billing_form').serialize() + '&customers=' + JSON.stringify(customers);

            $.ajax({
                url: 'include/customer_server_new.php?customer_billing_request=true',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#customerBillingModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else if (response.success === false) {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    toastr.error("There was an error sending the message.");
                },
                complete: function() {
                    $button.prop('disabled', false);
                    $button.html('<i class="mdi mdi-update"></i> Change Now');
                }
            });
        });
    </script>
</body>

</html>
<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';

?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customer Payment';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers Payment</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">


                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                    <div id="totalAmount" style="font-weight: bold; color:green; font-size: 18px; margin-bottom: 10px; text-align: right;"></div>
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Recharged date</th>
                                                    <th>Customer Username</th>
                                                    <th>Months</th>
                                                    <th>Type</th>
                                                    <th>Paid until</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recharge-list">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <?php
        $options = '';
        $get_data = $con->query("SELECT id, fullname FROM users WHERE user_type='1'");

        while ($row = $get_data->fetch_assoc()) {
            $options .= '<option value="' . $row['id'] . '">' . $row['fullname'] . '</option>';
        }
    ?>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php require 'script.php'; ?>
    <script type="text/javascript">

    /* From Date */
    var from_date = `<label style="margin-left: 20px;">
                        <input class="from_date form-control" type="date" value="<?php echo date('Y-m-d');?>" style="width: 150px; display: inline;">
                    </label>`;

    /* To Date */
    var to_date = `<label style="margin-left: 10px;">
                        <input class="to_date form-control" value="<?php echo date('Y-m-d');?>" type="date" style="width: 150px; display: inline;">
                    </label>`;
    var status = `<label style="margin-left: 10px;">
                        <select class="status_filter form-control" style="width: 150px; display: inline;">
                            <option >---Select Type---</option>
                            <option value="Credit">Credit</option>
                            <option value="1">Cash</option>
                            <option value="2">Bkash</option>
                            <option value="3">Nagad</option>
                            <option value="4">Due Paid</option>
                        </select>
                    </label>`;

     /* Bill Collect Dropdown */
     var bill_collect = `<label style="margin-left: 10px;">
                                <select class="bill_collect form-control" style="width: 150px; display: inline;">
                                    <option>---Collection---</option>
                                    <?= $options; ?>
                                </select>
                            </label>`;

    setTimeout(() => {
        let filterContainer = $('.dataTables_filter');
        let lengthContainer = $('.dataTables_length');

        lengthContainer.parent().removeClass('col-sm-12 col-md-6');
        filterContainer.parent().removeClass('col-sm-12 col-md-6');

        filterContainer.append(from_date);
        filterContainer.append(to_date);
        filterContainer.append(status);
        filterContainer.append(bill_collect);

        $('.status_filter').select2();
        $('.bill_collect').select2();
    }, 500); 

    /* DataTable Initialization */
    $('#datatable').DataTable({
        searching: true,
        paging: true,
        info: true,
        order: [[0, "desc"]],
        lengthChange: true,
        processing: false,
        serverSide: false,
        lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, 'All']
        ],
        language: {
            zeroRecords: "No matching records found"
        },
        ajax: {
            url: "include/customer_recharge_server.php?get_recharge_data=true",
            type: 'GET',
            data: function(d) {
                d.from_date = $('.from_date').val() || '<?php echo date('Y-m-d');?>';
                d.to_date = $('.to_date').val() || '<?php echo date('Y-m-d');?>';
                d.type = $('.status_filter').val();
                d.bill_collect = $('.bill_collect').val();
            },
            beforeSend: function() {
                $(".dataTables_empty").html(
                    '<img src="assets/images/loading.gif" style="background-color: transparent"/>'
                    );
            },
            
            dataSrc: function(json) {
                $('#totalAmount').text('Total Amount: ' + json.totalAmount + ' BDT');

                return json.data;
            }

        },
        drawCallback: function() {
            $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
        }
    });
    $(document).on('change','.from_date',function(){
        $('#datatable').DataTable().ajax.reload();
    });
    $(document).on('change','.to_date',function(){
        $('#datatable').DataTable().ajax.reload();
    });
    $(document).on('change','.status_filter',function(){
        $('#datatable').DataTable().ajax.reload();
    });
    $(document).on('change','.bill_collect',function(){
        $('#datatable').DataTable().ajax.reload();
    });

    </script>
</body>

</html>
<?php
   include "include/security_token.php";
   include "include/db_connect.php";
   include "include/pop_security.php";
   include "include/users_right.php";
   
   ?>
<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>FAST-ISP-BILLING-SYSTEM</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <?php include 'style.php';?>
   </head>
   <body data-sidebar="dark">
      
      <!-- Begin page -->
      <div id="layout-wrapper">
      <?php $page_title="Customers"; include 'Header.php';?>
      <!-- ========== Left Sidebar Start ========== -->
      <div class="vertical-menu">
         <div data-simplebar class="h-100">
            <!--- Sidemenu -->
            <?php include 'Sidebar_menu.php';?>
            <!-- Sidebar -->
         </div>
      </div>
      <!-- Left Sidebar End -->
      <!-- ============================================================== -->
      <!-- Start right Content here -->
      <!-- ============================================================== -->
      <div class="main-content">
         <div class="page-content">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-md-12 grid-margin">
                     <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                           <div class="mr-md-3 mr-xl-5">
                              <div class="d-flex">
                                 <i class="mdi mdi-home text-muted hover-cursor"></i>
                                 <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                 </p>
                                 <p class="text-primary mb-0 hover-cursor">Customers</p>
                              </div>
                           </div>
                           <br>
                        </div>
                        <div class="d-flex justify-content-between align-items-end flex-wrap">
                           <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>
                        </div>
                        <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addCustomerModal" aria-hidden="true">
                           <div class="modal-dialog">
                              <div class="modal-content">
                                 <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New customer</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                 </div>
                                 <div class="">
                                    <form id="customer_form">
                                       <div class="card">
                                          <div class="card-body">
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Full Name</label>
                                                      <input id="customer_fullname" type="text" class="form-control " placeholder="Enter Your Fullname" />
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Username <span id="usernameCheck"></span></label>
                                                      <input id="customer_username" type="text" class="form-control " name="username" placeholder="Enter Your Username" oninput="checkUsername();" />
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Password</label>
                                                      <input id="customer_password" type="password" class="form-control " name="password" placeholder="Enter Your Password" />
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Mobile no.</label>
                                                      <input id="customer_mobile" type="text" class="form-control " name="mobile" placeholder="Enter Your Mobile Number" />
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Expired Date</label>
                                                      <select id="customer_expire_date" class="form-select">
                                                         <option value="<?php echo date("d"); ?>"><?php echo date("d"); ?></option>
                                                         <?php
                                                            if ($exp_cstmr = $con->query("SELECT * FROM customer_expires")) {
                                                                while ($rowsssss = $exp_cstmr->fetch_array()) {
                                                            
                                                                    $exp_date = $rowsssss["days"];
                                                            
                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                }
                                                            }
                                                            
                                                            ?>
                                                      </select>
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Address</label>
                                                      <input id="customer_address" type="text" class="form-control" name="address" placeholder="Enter Your Addres" />
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6 ">
                                                   <div class="form-group mb-2">
                                                      <label>POP/Branch</label>
                                                      <select id="customer_pop" class="form-select">
                                                         <option value="">Select Pop/Branch</option>
                                                         <?php
                                                            if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                                while ($rows = $pop->fetch_array()) {
                                                            
                                                                    $id = $rows["id"];
                                                                    $name = $rows["pop"];
                                                            
                                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                                }
                                                            }
                                                            ?>
                                                      </select>
                                                   </div>
                                                </div>
                                                <div class="col-md-6 ">
                                                   <div class="form-group mb-2">
                                                      <label>Area/Location</label>
                                                      <select id="customer_area" class="form-select" name="area">
                                                         <option>Select Area</option>
                                                      </select>
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Nid Card Number</label>
                                                      <input id="customer_nid" type="text" class="form-control" name="nid" placeholder="Enter Your Nid Number" />
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Package</label>
                                                      <select id="customer_package" class="form-select">
                                                      </select>
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Connection Charge</label>
                                                      <input id="customer_con_charge" type="text" class="form-control" name="con_charge" placeholder="Enter Connection Charge" value="500" />
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                      <label>Package Price</label>
                                                      <input disabled id="customer_price" type="text" class="form-control" value="00" />
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="row">
                                                <div class="col-md-6">
                                                   <div class="form-group">
                                                      <label>Remarks</label>
                                                      <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"></textarea>
                                                   </div>
                                                </div>
                                                <div class="col-md-6">
                                                   <div class="form-group">
                                                      <label>Status</label>
                                                      <select id="customer_status" class="form-select">
                                                         <option value="">Select Status</option>
                                                         <option value="0">Disable</option>
                                                         <option value="1">Active</option>
                                                         <option value="2">Expire</option>
                                                         <option value="3">Request</option>
                                                      </select>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </form>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-success" id="customer_add">Add Customer</button>
                                 </div>
                              </div>
                              <!-- /.modal-content -->
                           </div>
                           <!-- /.modal-dialog -->
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row">
                  <div class="col-md-12">
                     <div class="card">
                        <div class="card-body">
                           <div class="col-md-12 float-md-right grid-margin-sm-0">
                              <div class="row">
                                 <div class="col-md-4">
                                    <div class="form-group mb-2">
                                       <label>PoP/Branch</label>
                                       <select id="srch_poplst" class="form-select">
                                          <option value="">Select PoP/Branch</option>
                                          <?php
                                             if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                 while ($rows = $pop->fetch_array()) {
                                             
                                                     $id = $rows["id"];
                                                     $name = $rows["pop"];
                                             
                                                     echo '<option value="' . $id . '">' . $name . '</option>';
                                                 }
                                             }
                                             ?>
                                       </select>
                                    </div>
                                 </div>
                                 <div class="col-md-4">
                                    <div class="form-group mb-2">
                                       <label>Area</label>
                                       <select id="srch_area" class="form-select" name="area">
                                          <option value="all">All</option>
                                       </select>
                                    </div>
                                 </div>
                                 <div class="col-md-4">
                                    <div class="form-group mb-2">
                                       <label>Status</label>
                                       <select id="customer_sttssrch" class="form-select" name="customer_sttssrch">
                                          <option value="all">All</option>
                                          <option value="recharge">Recharge</option>
                                          <option value="online">Online</option>
                                          <option value="offline">Offline</option>
                                          <option value="expired">Expired</option>
                                          <option value="due">DUE</option>
                                          <option value="unpaid">Unpaid</option>
                                          <option value="active">Active</option>
                                          <option value="disabled">Disabled</option>
                                       </select>
                                    </div>
                                 </div>
                              </div>
                              <?php // PoP, Area, Status(Active, Expired, Online, Offline, Locked, DUE, Free user, Unpaid), after create redirect to customer profile page    ?>
                              <div class="table-responsive ">
                                 <form name="actionFrm" id="actionFrm" >
                                    <div id="customer_tbl_list">
                                    </div>
                                    </br>
                                    <div style="float:Right; width:auto;" >
                                       <table width="auto">
                                          <tr>
                                             <td>
                                                <select id="customer_actions" name="actions" class="form-select">
                                                   <option value="">Select Status</option>
                                                   <option value="1">Recharge</option>
                                                   <option value="2">SMS</option>
                                                   <option value="3">Print</option>
                                                   <option value="4">Packages</option>
                                                   <option value="5">Change PoP/Branch</option>
                                                   <option value="6">Active</option>
                                                   <option value="7">Disable</option>
                                                </select>
                                             </td>
                                             <td>
                                                <select id="customer_popact" name="pop" class="form-select">
                                                   <option value="">Select PoP/Branch</option>
                                                   <?php
                                                      if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                          while ($rows = $pop->fetch_array()) {
                                                      
                                                              $id = $rows["id"];
                                                              $name = $rows["pop"];
                                                      
                                                              echo '<option value="' . $id . '">' . $name . '</option>';
                                                          }
                                                      }
                                                      ?>
                                                </select>
                                             </td>
                                             <td>
                                                <select id="customer_areaact" class="form-select" name="area">
                                                   <option>Select Area</option>
                                                </select>
                                             </td>
                                             <td align="right">
                                                <button class="btn btn-danger mdi mdi-book-cog-outline " id="processBtn" >&nbsp;&nbsp;Process</button>
                                             </td>
                                          </tr>
                                       </table>
                                 </form>
                                 </br>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <footer class="footer">
               <div class="container-fluid">
                  <div class="row">
                     <div class="col-sm-6">
                        <script>
                           document.write(new Date().getFullYear())
                        </script>  IT-FAST.
                     </div>
                     <div class="col-sm-6">
                        <div class="text-sm-end d-none d-sm-block">
                           Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/itfastbd">iT-Fast</a>
                        </div>
                     </div>
                  </div>
               </div>
            </footer>
         </div>
         <!-- end main content-->
      </div>
      <!-- END layout-wrapper -->
      <!-- Right Sidebar -->
      <div class="right-bar">
         <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
               <a href="javascript:void(0);" class="right-bar-toggle float-end">
               <i class="mdi mdi-close noti-icon"></i>
               </a>
               <h5 class="m-0">Settings</h5>
            </div>
            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>
            <div class="p-4">
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                  <label class="form-check-label" for="light-mode-switch">Light Mode</label>
               </div>
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                  <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
               </div>
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                  <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
               </div>
            </div>
         </div>
         <!-- end slimscroll-menu-->
      </div>
      <!-- /Right-bar -->
      <div id="deleteModal" class="modal fade">
         <div class="modal-dialog modal-confirm">
            <div class="modal-content">
               <div class="modal-header flex-column">
                  <div class="icon-box">
                     <i class="fa fa-trash"></i>
                  </div>
                  <h4 class="modal-title w-100">Are you sure?</h4>
                  <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                  <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
               </div>
               <div class="modal-body">
                  <p>Do you really want to delete these records? This process cannot be undone.</p>
               </div>
               <div class="modal-footer justify-content-center">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
               </div>
            </div>
         </div>
      </div>
      <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="customerPrint_Modal" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Print customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="customerDataContainer">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="button"  class="btn btn-success" id="printCustomerButton">Print Customer</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

      <!-- Right bar overlay-->
      <div class="rightbar-overlay"></div>
      <!-- JAVASCRIPT -->
      <script src="assets/libs/jquery/jquery.min.js"></script>
      <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
      <script src="assets/libs/metismenu/metisMenu.min.js"></script>
      <script src="assets/libs/simplebar/simplebar.min.js"></script>
      <script src="assets/libs/node-waves/waves.min.js"></script>
      <!-- Required datatable js -->
      <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
      <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
      <!-- Buttons examples -->
      <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
      <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
      <script src="assets/libs/jszip/jszip.min.js"></script>
      <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
      <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
      <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
      <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
      <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
      <!-- Responsive examples -->
      <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
      <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
      <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
      <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
      <!-- Datatable init js -->
      <script src="assets/js/pages/datatables.init.js"></script>
      <script src="assets/js/app.js"></script>
      <script type="text/javascript">
         $(document).ready(function() {
            $("#printCustomerButton").click(function(){
                printCustomerData();
            });
         	$("#customer_popact").hide();
         	$("#customer_areaact").hide();
         
         	//Search Customer by POP
         	$(document).on('change', '#srch_poplst', function() {
                    var searchdta = 'srch_poplst='+$(this).val() + '&srch_area_id='+$("#srch_area").val() + '&customer_sttssrch='+$("#customer_sttssrch").val();
                  //   alert(searchdta);return false; 
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_list_table.php",
                        data: searchdta,
                        success: function(response) {
                             $("#customer_tbl_list").html(response);
                        }
                    });
                });
         
         	// Search customer with Area Criteria
         	$(document).on('change', '#srch_area', function() {
                    var searchdta = 'srch_area_id='+$(this).val() + '&srch_poplst='+$("#srch_poplst").val() + '&customer_sttssrch='+$("#customer_sttssrch").val();
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_list_table.php",
                        data: searchdta,
                        success: function(response) {
                             $("#customer_tbl_list").html(response);
                        }
                    });
                });
         
         	// Search customer with Status Criteria
         	$(document).on('change', '#customer_sttssrch', function() {
                    var searchdta = 'customer_sttssrch='+$(this).val() + '&srch_poplst='+$("#srch_poplst").val() + '&srch_area_id='+$("#srch_area").val();
                    //alert(searchdta);
         		$.ajax({
                        type: 'POST',
                        url: "include/customers_list_table.php",
                        data: searchdta,
                        success: function(response) {
                             $("#customer_tbl_list").html(response);
                        }
                    });
                });
         
         
         
         	//Search  by POP & Load area
         	$(document).on('change', '#srch_poplst', function() {
                    var popiD = $(this).val();
         		if(popiD !=0)
         		{
         			 $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            srch_pop_name: popiD
                        },
                        success: function(response) {
                             $("#srch_area").html(response);
                        }
                    });
         
         		}
         
         
                });
         	// Action for customers
         	//POP load
         	$(document).on('change', '#customer_actions', function() {
                    if($(this).val()== 4)
         		{
         			$("#customer_popact").show();
         			$("#customer_areaact").show();
         		}
         		else{ $("#customer_popact").hide();
         		$("#customer_areaact").hide();}
         
                });
         
         
         	//Area load
         	$(document).on('change', '#customer_popact', function() {
                    var popiD = $(this).val();
         		if(popiD !=0)
         		{
         			 $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            current_pop_name: popiD
                        },
                        success: function(response) {
                             $("#customer_areaact").html(response);
                        }
                    });
         
         		}
         
         
                });
         
         	// Form Submission
         	$("#processBtn").click(function(e) {
                e.preventDefault(); 
                $.ajax({
                    type: 'POST',
                    url: "include/customers_actions.php",
                    data: {
                        action: $('#customer_actions').val(),
                        pop: $('#srch_poplst').val(),
                        area: $('#srch_area').val(),
                        process:'print',
                    },
                    success: function(response) {

                        var data = JSON.parse(response);
                        var modalBody = '<table class="table table-responsive table-bordered">';
                        modalBody += '<thead><tr>';
                        modalBody += '<th>ID</th>';
                        modalBody += '<th>Full Name</th>';
                        modalBody += '<th>Expire Date</th>';
                        modalBody += '<th>Username</th>';
                        modalBody += '<th>Phone</th>';
                        modalBody += '<th>Comment</th>';
                        modalBody += '</tr></thead>';
                        modalBody += '<tbody>';
                        data.forEach(function(customer) {
                           var expireDate = new Date(customer.expiredate);
                           var todayDate = new Date();

                             modalBody += '<tr>';
                             modalBody += '<td>' + customer.id + '</td>';
                             modalBody += '<td>' + customer.fullname + '</td>';
                             if (expireDate <= todayDate) {
                                 modalBody += '<td><span class="badge bg-danger">Expired</span></td>';
                              } else {
                                 modalBody += '<td>' + customer.expiredate + '</td>';
                              }
                             modalBody += '<td>' + customer.username + '</td>';
                             modalBody += '<td>' + customer.mobile + '</td>';
                             modalBody += '<td><input type="text" class="form-control"></td>';
                             modalBody += '</tr>';
                        });
                        modalBody += '</tbody></table>';

                        $('#customerPrint_Modal #customerDataContainer').html(modalBody);
                        $("#customerPrint_Modal").modal('show'); 
                    },
                    error: function(xhr, status, error) {
                        console.error("An error occurred: " + error);
                    }
                });
         	});
         
            // Print function
            function printCustomerData() {
                var printContents = document.getElementById('customerDataContainer').innerHTML;
                var originalContents = document.body.innerHTML;

                document.body.innerHTML = printContents;

                window.print();

                document.body.innerHTML = originalContents;
            }
         
         
         
                    $("#checkedAll").change(function() {
                        if (this.checked) {
                            $(".checkSingle").each(function() {
                                this.checked = true;
                            })
                        } else {
                            $(".checkSingle").each(function() {
                                this.checked = false;
                            })
                        }
                    });
         
                    $(".checkSingle").click(function() {
                        if ($(this).is(":checked")) {
                            var isAllChecked = 0;
                            $(".checkSingle").each(function() {
                                if (!this.checked)
                                    isAllChecked = 1;
                            })
                            if (isAllChecked == 0) {
                                $("#checkedAll").prop("checked", true);
                            }
                        } else {
                            $("#checkedAll").prop("checked", false);
                        }
                    });
         		});
         
         
         
         
                $("#customers_table").DataTable();
         
                $(document).on('keyup', '#customer_username', function() {
                    var customer_username = $("#customer_username").val();
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            current_username: customer_username
                        },
                        success: function(response) {
                            $("#usernameCheck").html(response);
                        }
                    });
                });
         
                $(document).on('change', '#customer_pop', function() {
                    var pop_id = $("#customer_pop").val();
                    //alert(pop_id);
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            current_pop_name: pop_id
                        },
                        success: function(response) {
                             $("#customer_area").html(response);
                        }
                    });
                });
                $(document).on('change', '#customer_pop', function() {
                    var pop_id = $("#customer_pop").val();
                   // alert(pop_id);
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            pop_name: pop_id,
                            getCustomerPackage:0
                        },
                        success: function(response) {
                             $("#customer_package").html(response);
                        }
                    });
                });
         
         
                $(document).on('change', '#customer_package', function() {
                    var packageId = $("#customer_package").val();
                    var pop_id = $("#customer_pop").val();
                   // alert(pop_id);
                    $.ajax({
                        type: 'POST',
                        url: "include/customers_server.php",
                        data: {
                            package_id: packageId,
                            pop_id: pop_id,
                            getPackagePrice:0
                        },
                        success: function(response) {
                             $("#customer_price").val(response);
                        }
                    });
                });
         
         
         
         
                $("#customer_add").click(function() {
                    var fullname = $("#customer_fullname").val();
                    var package = $("#customer_package").val();
                    var username = $("#customer_username").val();
                    var password = $("#customer_password").val();
                    var mobile = $("#customer_mobile").val();
                    var address = $("#customer_address").val();
                    var expire_date = $("#customer_expire_date").val();
                    var area = $("#customer_area").val();
                    var pop = $("#customer_pop").val();
                    var nid = $("#customer_nid").val();
                    var con_charge = $("#customer_con_charge").val();
                    var price = $("#customer_price").val();
                    var remarks = $("#customer_remarks").val();
                    var status = $("#customer_status").val();
                    var user_type = <?php echo $auth_usr_type; ?>;
         
                    customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status)
         
                });
         
                function customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status) {
                    if (fullname.length == 0) {
                        toastr.error("Customer name is require");
                    } else if (package.length == 0) {
                        toastr.error("Customer Package is require");
                    } else if (username.length == 0) {
                        toastr.error("Username is require");
                    } else if (password.length == 0) {
                        toastr.error("Password is require");
                    } else if (mobile.length == 0) {
                        toastr.error("Mobile number is require");
                    } else if (expire_date.length == 0) {
                        toastr.error("Expire Date is require");
                    } else if (pop.length == 0) {
                        toastr.error("POP/Branch is require");
                    } else if (area.length == 0) {
                        toastr.error("Area is require");
                    } else if (con_charge.length == 0) {
                        toastr.error("Connection Charge is require");
                    } else if (price.length == 0) {
                        toastr.error("price is require");
                    } else if (status.length == 0) {
                        toastr.error("Status is require");
                    } else {
                        $("#customer_add").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                        var addCustomerData = 0;
                        $.ajax({
                            type: 'POST',
                            url: 'include/customers_server.php',
                            data: {
                                addCustomerData: addCustomerData,
                                fullname: fullname,
                                package: package,
                                username: username,
                                password: password,
                                mobile: mobile,
                                address: address,
                                expire_date: expire_date,
                                area: area,
                                pop: pop,
                                con_charge: con_charge,
                                price: price,
                                remarks: remarks,
                                nid: nid,
                                status: status,
                                user_type: user_type,
                            },
                            success: function(responseData) {
                                if (responseData == 1) {
                                    toastr.success("Added Successfully");
                                    $("#addCustomerModal").modal('hide');
                                    setTimeout(() => {
                                        location.reload();
                                    }, 1000);
                                } else {
                                    toastr.error(responseData);
                                }
                            }
                        });
                    }
                }
            
      </script>
   </body>
</html>
<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";


?>


<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Daily Recharge</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                     <div class="col-md-12 grid-margin">
                        <div class="d-flex justify-content-between flex-wrap">
                           <div class="d-flex align-items-end flex-wrap">
                              <div class="mr-md-3 mr-xl-5">
                                 <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Daily Recharge</p>
                                 </div>
                              </div>
                              <br>
                           </div>
                           <div class="d-flex justify-content-between align-items-end flex-wrap">
                              
                           </div>
                        </div>
                     </div>
                  </div>
            <div class="row">
                     <div class="col-md-12 stretch-card">
                        <div class="card">
                           <div class="card-body">
                              <span class="card-title"></span>
                              <div class="col-md-6 float-md-right grid-margin-sm-0">
                                 <div class="form-group">
                                    
                                       
                                 </div>
                              </div>
                              <div class="table-responsive">
                              <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
    <thead>
        <tr>
            <th>Customer Name</th>
            <th>Recharged Date</th>
            <th>Months</th>
            <th>Paid Until</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
    <?php 
    /* Get the date and user_id parameters from the URL*/
    $date = $_GET['date']; // Format: YYYY-MM-d
    $user_id = isset($_GET['user_id']) ? $_GET['user_id'] : null;

    /* Prepare the SQL query based on whether user_id is provided*/
    if ($user_id) {
        $sql = "SELECT * FROM customer_rechrg WHERE DATE_FORMAT(datetm, '%Y-%m-%d') = '$date' AND rchg_by = $user_id";
    } else {
        $sql = "SELECT * FROM customer_rechrg WHERE DATE_FORMAT(datetm, '%Y-%m-%d') = '$date'";
    }

    $result = mysqli_query($con, $sql);

    // Loop through the results
    while ($rows = mysqli_fetch_assoc($result)) {
        $getCstmrId = $rows["customer_id"];
        $customerName = '';

        // Fetch customer name from the customers table
        $customerQuery = "SELECT fullname FROM customers WHERE id='$getCstmrId'";
        $customerResult = mysqli_query($con, $customerQuery);
        if ($customerRow = mysqli_fetch_assoc($customerResult)) {
            $customerName = $customerRow['fullname'];
        }
    ?>
    <tr>
        <td>
            <a href="profile.php?clid=<?php echo $getCstmrId; ?>">
                <?php echo $customerName; ?>
            </a>
        </td>
        <td>
            <?php 
            $recharge_date_time = $rows['datetm'];
            $dateTm = new DateTime($recharge_date_time);
            echo $dateTm->format("H:i A, d-M-Y");
            ?> 
        </td>
        <td><?php echo $rows["months"]; ?></td>
        <td><?php echo $rows["rchrg_until"]; ?></td>
        <td><?php echo $rows["purchase_price"]; ?></td>
    </tr>
    <?php } ?>
</tbody>

</table>

                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>
        
        
        <!-- Peity chart-->
        <script src="assets/libs/peity/jquery.peity.min.js"></script>
        
        <!--C3 Chart-->
        <script src="assets/libs/d3/d3.min.js"></script>
        <script src="assets/libs/c3/c3.min.js"></script> 
        <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
        
        <script src="assets/js/pages/dashboard.init.js"></script>
        
        <script src="assets/js/app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script type="text/javascript" src="assets/js/js-fluid-meter.js"></script>
    </body>
</html>
<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Department";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Department</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New Department</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Department Name</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- <div class="card-footer" style="text-align: right;">
                                    <button class="btn btn-primary" id="send_message_btn" >Send Message</button>
                                    <button class="btn btn-success" id="export_to_excel" >Export To Excel</button>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
     <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Department</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?add_department=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Department Name</label>
                            <input name="department_name" placeholder="Enter Department Name" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Department</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?update_department=true" method="POST" enctype="multipart/form-data" >          
                        <div class="form-group mb-2">
                            <label>Department Name</label>
                             <input name="id" class="d-none" type="text" >
                            <input name="department_name" placeholder="Enter Department Name" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/hrm_server.php?show_department_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Department Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Department Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var department_id = $(this).data("id");
        $.ajax({
            url: "include/hrm_server.php?get_department=true", 
            type: "GET",
            data: { id: department_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal input[name="department_name"]').val(response.data.department_name);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/hrm_server.php', 
                data: { delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Employee";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Employee</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;Add New Employee</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Phone Number</th>
                                                    <th>Email</th>
                                                    <th>Designation</th>
                                                    <th>Department</th>
                                                    <th>Postal Code</th>
                                                    <th>Joining Date</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
    <!-- Add Modal -->
<div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content col-md-12">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New Employee
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="include/hrm_server.php?add_employee=true" method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label>Employee Code</label>
                                <input name="employee_code" placeholder="Enter Employee Code" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Employee Name</label>
                                <input name="name" placeholder="Enter Employee Name" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Father's Name</label>
                                <input name="father_name" placeholder="Enter Father's Name" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Mother's Name</label>
                                <input name="mother_name" placeholder="Enter Mother's Name" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>NID</label>
                                <input name="nid" placeholder="Enter NID" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Birth Date</label>
                                <input name="birth_date" class="form-control" type="date">
                            </div>
                            <div class="form-group mb-3">
                                <label>Gender</label>
                                <select name="gender" class="form-select">
                                    <option >--Select---</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label>Phone Number</label>
                                <input name="phone_number" placeholder="Enter Phone Number" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Email</label>
                                <input name="email" placeholder="Enter Email" class="form-control" type="email">
                            </div>
                            <div class="form-group mb-3">
                                <label>Address</label>
                                <input name="address" placeholder="Enter Address" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Division</label>
                                <input name="division" placeholder="Enter Division" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>District</label>
                                <input name="district" placeholder="Enter District" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Upazila</label>
                                <input name="upazila" placeholder="Enter Upazila" class="form-control" type="text">
                            </div>
                            <div class="form-group mb-3">
                                <label>Postal Code</label>
                                <input name="postal_code" placeholder="Enter Postal Code" class="form-control" type="text">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Bottom Row -->
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label>Joining Date</label>
                                <input name="joining_date" class="form-control" type="date">
                            </div>
                            <div class="form-group mb-3">
                                <label>Designation</label>
                                <input name="designation" placeholder="Enter Designation" class="form-control" type="text">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label>Department</label>
                                <select name="department" class="form-select" type="text">

                                </select>
                            </div>
                            <div class="form-group mb-3">
                                <label>Salary</label>
                                <input name="salary" placeholder="Enter Salary" class="form-control" type="text">
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Employee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?edit_employee=true" method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Employee Code</label>
                                    <input type="text" name="id" class="d-none">
                                    <input name="employee_code" placeholder="Enter Employee Code" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Employee Name</label>
                                    <input name="name" placeholder="Enter Employee Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Father's Name</label>
                                    <input name="father_name" placeholder="Enter Father's Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Mother's Name</label>
                                    <input name="mother_name" placeholder="Enter Mother's Name" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>NID</label>
                                    <input name="nid" placeholder="Enter NID" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Birth Date</label>
                                    <input name="birth_date" class="form-control" type="date">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Gender</label>
                                    <select name="gender" class="form-select">
                                        <option >--Select---</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Phone Number</label>
                                    <input name="phone_number" placeholder="Enter Phone Number" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Email</label>
                                    <input name="email" placeholder="Enter Email" class="form-control" type="email">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Address</label>
                                    <input name="address" placeholder="Enter Address" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Division</label>
                                    <input name="division" placeholder="Enter Division" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>District</label>
                                    <input name="district" placeholder="Enter District" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Upazila</label>
                                    <input name="upazila" placeholder="Enter Upazila" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Postal Code</label>
                                    <input name="postal_code" placeholder="Enter Postal Code" class="form-control" type="text">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Bottom Row -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Joining Date</label>
                                    <input name="joining_date" class="form-control" type="date">
                                </div>
                                <div class="form-group mb-3">
                                    <label>Designation</label>
                                    <input name="designation" placeholder="Enter Designation" class="form-control" type="text">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label>Department</label>
                                    <select name="department" class="form-select" type="text">

                                    </select>
                                </div>
                                <div class="form-group mb-3">
                                    <label>Salary</label>
                                    <input name="salary" placeholder="Enter Salary" class="form-control" type="text">
                                </div>
                            </div>
                        </div>

                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/hrm_server.php?show_employee_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });

    /**  Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });

    /**  Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var shift_id = $(this).data("id");
        $.ajax({
            url: "include/hrm_server.php?get_employee=true", 
            type: "GET",
            data: { id: shift_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(response.data.id);
                    $('#editModal input[name="employee_code"]').val(response.data.employee_code);
                    $('#editModal input[name="name"]').val(response.data.name);
                    $('#editModal input[name="father_name"]').val(response.data.father_name);
                    $('#editModal input[name="mother_name"]').val(response.data.mother_name);
                    $('#editModal input[name="nid"]').val(response.data.nid);
                    $('#editModal input[name="birth_date"]').val(response.data.birth_date);
                    $('#editModal select[name="gender"]').val(response.data.gender);
                    $('#editModal input[name="phone_number"]').val(response.data.phone_number);
                    $('#editModal input[name="email"]').val(response.data.email);
                    $('#editModal input[name="address"]').val(response.data.address);
                    $('#editModal input[name="division"]').val(response.data.division);
                    $('#editModal input[name="district"]').val(response.data.district);
                    $('#editModal input[name="upazila"]').val(response.data.upazila);
                    $('#editModal input[name="postal_code"]').val(response.data.postal_code);
                    $('#editModal input[name="joining_date"]').val(response.data.joining_date);
                    $('#editModal input[name="designation"]').val(response.data.designation);
                    $('#editModal select[name="department"]').val(response.data.department);
                    $('#editModal input[name="salary"]').val(response.data.salary);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });
    
    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/hrm_server.php', 
                data: { employee_delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });
    loadEmployee();
    function loadEmployee(){
        $.ajax({
            type: 'GET', 
            url: 'include/hrm_server.php', 
            data: { get_all_department: true }, 
            dataType:'json',
            success: function(response) {
                var form = $("select[name='department']");
                form.append("<option value=''>Select</option>");
                for (var i = 0; i < response.data.length; i++) {
                    form.append("<option value='" + response.data[i].id + "'>" + response.data[i].department_name + "</option>");
                }
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error deleting item! " + error);
            }
        });
    }

    </script>
</body>

</html>

<?php

require('routeros/routeros_api.class.php');

$API = new RouterosAPI();

//$API->debug = true;

if ($API->connect('103.146.17.2', 'radiustest', 'rd123')) {

   //$API->write('/interface/getall');
   $API->write('/system/resource/print');

   $READ = $API->read(true);

   
   $ARRAY = $API->parseResponse($READ);

   print_r($READ);

   echo"<br>";
   echo"<br>";

   echo $READ['0']['uptime']."<br>";
   echo $READ['0']['platform']."<br>";
echo $READ['0']['version']."<br>";
echo $READ['0']['architecture-name']."<br>";
echo $READ['0']['cpu']."<br>";
echo $READ['0']['cpu-count']."Core <br>";
echo $READ['0']['cpu-frequency']/(1000)." GHz <br>";
   //echo $API->read('cpu');

   $API->disconnect();

   
   
   $host="103.146.17.2";

      exec("ping -c 1 " . $host, $output, $result);

      //print_r($output);

      if ($result == 0)

      echo "Ping successful!";

      else

      echo "Ping unsuccessful!";

}

?>
<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	  $id=$_GET['id'];

	$result=$con->query("DELETE FROM `customer_expires` WHERE id=$id ");
	if ($result==true) {
		header("location:expired.php");
	}else{

	}
}


 ?>

 <?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $expiredId=$_GET['id'];
    if ($customer_expires=$con->query("SELECT * FROM customer_expires WHERE id='$expiredId'")) {
        while($rows=$customer_expires->fetch_array()){
            $id=$rows["id"];
            $days=$rows["days"];
        }
    }
}


?>



<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Expire date Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="container">
                    <div class="row mt-5 py-3 mr-3 ml-3">

                    <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center">Update Expired</h4><br>
                        <form id="expired_form">
                            <label><b style="color: green;">Expired Days*</b></label>
                            <input class="d-none" type="text" value="<?php echo $expiredId; ?>" name="id">
                            <input id="form" name="days" class="form-control form-control-sm" type="text" value="<?php echo $days; ?>"><br>
                            <button id="expired_button" class="btn btn-success mr-1">Update</button>
                            <a href="expired.php" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                    </div>

                </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
      <script type="text/javascript">
    $(document).ready(function(){
        $("#expired_button").click(function(e){
            e.preventDefault();
            var formData=$("#expired_form").serialize();
            $.ajax({
            type:"GET",
            url:"include/expired_customer.php?update",
            data:formData,
            cache:false,
            success:function(){
                  toastr.success("Update Success");
            }
           });
        });
    });
</script>

    </body>
</html>
<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- DataTables -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Responsive datatable examples -->
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
         <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Expire date</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customer Expired </p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;Add Expire date</button>
                          </div>
                            </div>
                        </div>
                    </div>






                    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Add Expire Date</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="card">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-md-12">
                                       <form id="form-expired">
                                          <input class="form-control" type="text" name="expired" id="expired" placeholder="Type Your Expired date"/>
                                       </form>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Close</button>
                              <button id="add_expired_btn" type="button" class="btn btn-primary">Add</button>
                           </div>
                        </div>
                     </div>
                  </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                  <th>ID</th>
                                          			<th>Expired Date</th>
                                          			<th></th>
                                               </tr>
                                            </thead>
                                            <tbody>
                                    <?php 

                                       $qUery="SELECT * FROM customer_expires";
                                      $result= mysqli_query($con,$qUery);
                                        while ($rowss=mysqli_fetch_assoc($result)) {

                                        ?> 
                                         <tr>
        <td><?php echo $rowss['id']; ?></td>
        <td><?php echo $rowss['days']?></td>
        <td style="text-align:right;">
            
        <a class="btn btn-info " href="expired_edit.php?id=<?php echo $rowss['id']; ?>"><i class="fas fa-edit"></i></a>
       
        <a onclick=" return confirm('Are You Sure');"  href="expired_delete.php?id=<?php echo $rowss['id']; ?>" class="btn btn-danger"><i class="fas fa-trash"></i></a>

        </td>
        </tr>
                                    <?php } ?>
                                    </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>

<div id="deleteModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box">
                    <i class="fa fa-trash"></i>
                </div>
                <h4 class="modal-title w-100">Are you sure?</h4>
                <h4 class="modal-title w-100 d-none" id="DeleteId"></h4>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
            </div>
            <div class="modal-body">
                <p>Do you really want to delete these records? This process cannot be undone.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
            </div>
        </div>
    </div>
</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
     <script type="text/javascript">
    $(document).ready(function(){
        // $("#expired_table").DataTable();

        // $("#expired-list").load("include/expired_customer.php?list");
        // $.ajax({
        //     type: "GET",
        //     url: "include/expired_customer.php?list",
        //     cache: false,
        //     success: function() {
        //         $("#expired-list").load("include/expired.php?list");
        //     }
        // });
//dele script 
// $(".deleteId").click(function(){
//     var id=$(this).data('id');
//     //alert(id);
//     $("#deleteModal").modal('show');
//     $("#DeleteId").html(id);
//     deleteData(id)
// });





   $("#add_expired_btn").click(function(){
        var expired=$("#expired").val();
        if (expired.length==0) {
            toastr.error("Expire is require");
        }else{
            var formData=$("#form-expired").serialize();
                     $.ajax({
                     type:"GET",
                     data:formData,
                     url:"include/expired_customer.php?add",
                     cache:false,
                     success: function() {
                        //$("#expired-list").load("include/expired.php?list");
                        $("#addModal").modal('hide');
                            toastr.success("Data Insert Success");
                        setTimeout(()=>{location.reload();},1000);
                              
                        }
                  });
        }
      
   });
    });
    function deleteData(deleteId){
        //delete Confirm button
        $("#DeleteConfirm").click(function(){
            //var deleteId=$("#DeleteId").html();
                    $.ajax({
                    type: "GET",
                    url: "include/expired_customer.php?delete",
                    data: {id:deleteId},
                    cache: false,
                    success: function(response) {
                          if(response=1){
                            toastr.success(" Delete Successfully");
                            location.reload();
                          }else{
                            toastr.error(" try again");
                          }
                          $("#deleteModal").modal('hide');
                          
                    }
                });
            
        });
    }
</script>

    </body>
</html>


<?php 

include "include/db_connect.php";

if (isset($_POST["send"])) {
    $email=$_POST["email"];

    $query=$con->query("SELECT * FROM users WHERE email='$email'");
    $row=$query->fetch_array();
    $email_to=$row["email"];
    $password=$row["password"];


    $body="Email Recovery";

    $msg="Your Password is $password";

    $header="From, starCommunication@gmail.com";
    // if (mail($email_to, $body,  $msg, )) {
    //     echo "<script>alert('Please Check Your Email');</script>";
    // }else{
    //     echo "<script>alert('Something else please try agian');</script>";
    // }
    $result=mail($email_to, $body,  $msg);
    if ($result==true) {
        echo "<script>alert('please check your email');</script>";
    }else{
         echo "<script>alert('no');</script>";
    }
}

 ?>



<!DOCTYPE html>
<html>
<head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>FAST-ISP-Billing</title>
      <!-- plugins:css -->
      <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
      <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
      <!-- endinject -->
      <!-- plugin css for this page -->
      <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
      <!-- End plugin css for this page -->
      <!-- inject:css -->
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/custom.css">
      <!-- endinject -->
      <link rel="shortcut icon" href="images/favicon.png" />
   </head>
<body>
<div class="container">
    <div class="row mt-5 py-3 mr-3 ml-3">

        <div class="col-md-6 m-auto mb-4" id="formArea">

            <h4 class="text-center">Forgot Your Password?</h4><br>

            <form id="forgot_form" method="POST">
                <label>
                    <b style="color: green;">Enter Your Email*</b>
                </label>

                <input id="form" name="email" class="form-control form-control-sm" type="email" placeholder="Enter Your Email"><br>

                <button name="send" class="btn btn-success mr-1">Send</button>
            </form>
        </div>

    </div>
</div>
</body>
</html>

<?php
   include "include/security_token.php";
   include "include/db_connect.php";
   include "include/pop_security.php";
   include "include/users_right.php";
   
   ?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php
    
        include 'style.php';
        
        ?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">


        <?php $page_title="Google Map "; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Google Map</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>

                             
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-header">
                                    <button type="button" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"  data-bs-toggle="modal" data-bs-target="#addModal"> Add Area</button>
                                </div>
                                <div class="card-body">
                                    <div id="map" style="width: 100%; height: 500px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <div class="modal fade" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="addModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Area</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <form id="form-area">
                                <div class="form-group mb-1">
                                    <label>POP</label>
                                    <select class="form-select" name="pop_id" id="pop_id">
                                        <option value="">Select</option>
                                        <?php
                                        if ($pop = $con->query("SELECT * FROM add_pop WHERE user_type='1'  ")) {
                                            while ($rows = $pop->fetch_array()) {
                                                $id = $rows['id'];
                                                $name = $rows['pop'];
                                                echo '<option value="' . $id . '">' . $name . '</option>';
                                            }
                                        }
                                        ?>
                                    </select>
                                </div>
                                <div class="form-group mb-1">
                                    <label>Area</label>
                                    <input class="form-control" type="text" name="area" id="area" placeholder="Type Your Area" />
                                    <input type="hidden" id="lat" name="lat">
                                    <input type="hidden" id="lng" name="lng">
                                </div>
                                <div class="form-group">
                                    <label>Map Location</label>
                                    <div id="show_map" style="width: 100%; height: 400px;"></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="add_area" class="btn btn-primary">Save Location</button>
            </div>
        </div>
    </div>
</div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script>
    function loadMaps() {
        initMap();  
        initMap2();
    }

   /*Multiple Markers Location*/
    function initMap() {
        const mapOptions = {
            center: { lat: 23.5330279, lng: 90.8000572 },
            zoom: 12,
        };

        const map = new google.maps.Map(document.getElementById("map"), mapOptions);

        //$con->query("SELECT * FROM google_map")
        // const locations = [
        //     { name: "Store 1", lat: 23.8103, lng: 90.4125 },
        //     { name: "Store 2", lat: 23.8150, lng: 90.4250 },
        //     { name: "Store 3", lat: 23.8200, lng: 90.4050 },
        //     { name: "Store 4", lat: 23.8050, lng: 90.4300 },
        // ];

        // locations.forEach(location => {
        //     const marker = new google.maps.Marker({
        //         position: { lat: location.lat, lng: location.lng },
        //         map: map,
        //         title: location.name,
        //     });

        //     const infoWindow = new google.maps.InfoWindow({
        //         content: `<h3>${location.name}</h3><p>Coordinates: (${location.lat}, ${location.lng})</p>`,
        //     });

        //     marker.addListener("click", () => {
        //         infoWindow.open(map, marker);
        //     });
        // });

        $.ajax({
            url: 'include/add_area.php?get_locations_for_google_map=true',
            type: 'GET',
            dataType: "json",
            success: function (locations) {
                locations.forEach(location => {
                    const marker = new google.maps.Marker({
                        position: { lat: parseFloat(location.lat), lng: parseFloat(location.lng) },
                        map: map,
                        title: location.name,
                    });

                    const infoWindow = new google.maps.InfoWindow({
                        content: `<h3>${location.name}</h3><p>Coordinates: (${location.lat}, ${location.lng})</p>`,
                    });

                    marker.addListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                });
            },
            error:function(xhr,status,error){
                console.error("AJAX Error:", error);
            }
        });
    }

    function initMap2() {
        const initialLocation = { lat: 23.8103, lng: 90.4125 }; 
        const map = new google.maps.Map(document.getElementById("show_map"), {
            center: initialLocation,
            zoom: 12,
        });

        let marker;

        map.addListener("click", (event) => {
            const clickedLocation = event.latLng;
            if (!marker) {
                marker = new google.maps.Marker({
                    position: clickedLocation,
                    map: map,
                });
            } else {
                marker.setPosition(clickedLocation);
            }

            document.getElementById("lat").value = clickedLocation.lat();
            document.getElementById("lng").value = clickedLocation.lng();
        });
    }
    $(document).on('click','#add_area',function(){
        // var formData=$("#form-area").serialize();
        var pop_id=$("select[name='pop_id']").val();
        var area=$("input[name='area']").val();
        var lat=$("input[name='lat']").val();
        var lng=$("input[name='lng']").val();
        var formData="pop_id="+pop_id+"&area="+area+"&lat="+lat+"&lng="+lng;
        $.ajax({
            type:'POST',
            url:'include/add_area.php?add_area_for_google_map',
            data:formData,
            cache:false,
            success:function(response){
                if(response==1){
                    toastr.success("Area Added Success");
                    setTimeout(() => {
                        location.reload();     
                    }, 1000);
                   
                }
              
            }
        });
    });
</script>

   <!-- Load Google Maps API --> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuBbBNNwQbS81QdDrQOMq2WlSFiU1QdIs&callback=loadMaps" async defer></script>
 

</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Leave";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Leave</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;Add New Leave</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Employee Name</th>
                                                    <th>Leave Type</th>
                                                    <th>Leave Reason</th>
                                                    <th>Status</th>
                                                    <th>Start Time</th>
                                                    <th>End Time</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
     <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New Leave</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?add_leave=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Employee Name</label>
                            <select name="employee_id" class="form-select" type="text" style="width: 100%;" required></select>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Leave Type</label>
                            <select name="leave_type" class="form-select" type="text" required>
                                <option >---Select---</option>
                                <option value="Sick">Sick</option>
                                <option value="Casual">Casual</option>
                                <option value="Paid">Paid</option>
                                <option value="Unpaid">Unpaid</option>
                            </select>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Leave Reason</label>
                            <textarea name="leave_reason" class="form-control" type="text" placeholder="Enter Leave Reason" required></textarea>
                        </div>    
                        <div class="form-group mb-2">
                            <label>Leave Status</label>
                            <select name="leave_status" class="form-select" type="text" required>
                                <option >---Select---</option>
                                <option value="Pending">Pending</option>
                                <option value="Approved">Approved</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>        
                        <div class="form-group mb-2">
                            <label>Start Date</label>
                            <input name="start_date" class="form-control" type="date"  required>
                        </div>           
                        <div class="form-group mb-2">
                            <label>End Date</label>
                            <input name="end_date" class="form-control" type="date"  required>
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Leave</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                <form action="include/hrm_server.php?edit_leave=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Employee Name</label>
                            <input type="text" class="d-none" name="id">
                            <select name="employee_id" class="form-select" type="text" style="width: 100%;" required></select>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Leave Type</label>
                            <select name="leave_type" class="form-select" type="text" required>
                                <option >---Select---</option>
                                <option value="Sick">Sick</option>
                                <option value="Casual">Casual</option>
                                <option value="Paid">Paid</option>
                                <option value="Unpaid">Unpaid</option>
                            </select>
                        </div>           
                        <div class="form-group mb-2">
                            <label>Leave Reason</label>
                            <textarea name="leave_reason" class="form-control" type="text" placeholder="Enter Leave Reason" required></textarea>
                        </div>    
                        <div class="form-group mb-2">
                            <label>Leave Status</label>
                            <select name="leave_status" class="form-select" type="text" required>
                                <option >---Select---</option>
                                <option value="Pending">Pending</option>
                                <option value="Approved">Approved</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                        </div>        
                        <div class="form-group mb-2">
                            <label>Start Date</label>
                            <input name="start_date" class="form-control" type="date"  required>
                        </div>           
                        <div class="form-group mb-2">
                            <label>End Date</label>
                            <input name="end_date" class="form-control" type="date"  required>
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/hrm_server.php?show_leave_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Leave Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Leave Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var shift_id = $(this).data("id");
        $.ajax({
            url: "include/hrm_server.php?get_leave=true", 
            type: "GET",
            data: { id: shift_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal select[name="employee_id"]').val(response.data.employee_id);
                $('#editModal select[name="leave_type"]').val(response.data.leave_type);
                $('#editModal textarea[name="leave_reason"]').val(response.data.leave_reason);
                $('#editModal select[name="leave_status"]').val(response.data.leave_status);
                $('#editModal input[name="start_date"]').val(response.data.start_date);
                $('#editModal input[name="end_date"]').val(response.data.end_date);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/hrm_server.php', 
                data: { leave_delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });
    loadEmployee();
    function loadEmployee(){
        $.ajax({
            type: 'GET', 
            url: 'include/hrm_server.php', 
            data: { get_all_employee: true }, 
            dataType:'json',
            success: function(response) {
                var form = $("select[name='employee_id']");
                form.append("<option value=''>---Select---</option>");
                for (var i = 0; i < response.data.length; i++) {
                    form.append("<option value='" + response.data[i].id + "'>" + response.data[i].name + "</option>");
                }

            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error deleting item! " + error);
            }
        });
    }
    $("#addModal").on('show.bs.modal', function (event) {
        /*Check if select2 is already initialized*/
        if (!$("select[name='employee_id']").hasClass("select2-hidden-accessible")) {
            $("select[name='employee_id']").select2({
                dropdownParent: $("#addModal"),
                placeholder: "Select Employee"
            });
        }
     }); 
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>
<?php

include "include/db_connect.php";
if (isset($_GET['id'])) {
    $id = $_GET["id"];
    if ($ledgr = $con->query("SELECT * FROM ledger WHERE id='$id'")) {


        while ($rows = $ledgr->fetch_assoc()) {
            $ledger_id = $rows["id"];
            $ledger = $rows["mstr_ledger_id"];
            $name = $rows["ledger_name"];
        }
    }
    //$con->close();
}

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

       <?php $page_title="Ledger View"; include 'Header.php'; ?>


        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Ledger View</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;New Sub Ledger</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" id="addModal">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content col-md-10">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-lan mdi-18px"></span> &nbsp;New Sub Ledger</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div>
                                    <!--ledger form start-->
                                    <form id="ledger-frm">
                                        <div>
                                            <div class="card">
                                                <div class="card-body">
                                                    <form class="form-sample">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="form-group ">
                                                                    <input type="hidden" class="form-control" name="ledgerId" placeholder="Ledger Id" value="<?php echo $id; ?>">
                                                                </div>
                                                                <div class="form-group ">
                                                                    <input type="text" class="form-control" name="name" placeholder="Item Name" id="name">
                                                                </div><br>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <input class="form-control" placeholder="Enter description" name="discription" id="description">

                                                                    </input>
                                                                </div><br>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="button" class="btn btn-primary" id="save">Save</button>
                                        </div>
                                    </form>
                                    <!--ledger form end-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title">Sub Ledger</span>
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="row mt-5  p-2">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col">
                                                    <h6 class="mb-0">Master Ledger:  <span class="col text-secondary">
                                                        <?php 
                                                        if($ledger==1){
                                                            echo "Income";
                                                        } else if($ledger==2){
                                                            echo "Expense";
                                                        }else if($ledger==3){
                                                            echo "Asset";
                                                        }else if($ledger==4){
                                                            echo "Liabilities";
                                                        }
                                                        ?>
                                                </span> </h6>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="row">
                                                <div class="col">
                                                    <h6 class="mb-0">Ledger:   <span class="col text-secondary"><?php echo $name; ?></span> </h6>
                                                </div>
                                            </div>
                                            
                                            
                                        </div>
                                    </div>

                                    <div class="table-responsive mt-4">
                                        <div class="table-responsive">
                                            <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>Item Name</th>
                                                        <th></th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <?php

                                                    if ($sbledger = $con->query("SELECT * FROM  legder_sub WHERE ledger_id='$ledger_id'")) {
                                                        while ($rows = $sbledger->fetch_assoc()) {
                                                            $id = $rows["id"];
                                                            $ledgerId = $rows["ledger_id"];
                                                            $name = $rows["item_name"];
                                                            $description = $rows["description"];

                                                            echo '
                                                            <tr>
                                                            <td>' . $name . '</td>
                                                            <td><a class="btn-sm btn btn-success" href="#"><i class="fas fa-eye"></i></a></td>
                                                            
                                                            </tr>
                                                            ';
                                                        }
                                                    }


                                                    ?>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#ledger_view").DataTable();
           

            // $("#save").click(function() {
            //     var name = $("#name").val();
            //     var description = $("#description").val();
            //     if (name.length == 0) {
            //         toastr.error("name is required");
            //     }  else {
            //         var formData = $("#ledger-frm").serialize();
            //         console.log(formData); 
            //         return false; 
            //         $.ajax({
            //             type: "GET",
            //             url: "include/sub_ledger.php?add",
            //             data: formData,
            //             cache: false,
            //             success: function(response) {
            //                 if (response == 1) {
            //                     $("#addModal").modal('hide');
            //                     toastr.success("Sub Ledger Add Successfully");
            //                     setTimeout(() => {
            //                         location.reload();
            //                     }, 1000);
            //                 } else {
            //                     toastr.error("Please Try Again");
            //                 }


                            
            //             }
            //         });
            //     }


            // });
            $("#save").click(function() {
                var item_name = $("#name").val();
                var subLedgerDescription = $("#description").val();
                if (item_name.length == 0 ||item_name == null || item_name == undefined) {
                    toastr.error('Item is require');
                    return false; 
                } 
                var addSubLedgerData = 0;
                $.ajax({
                    type: "POST",
                    data: {
                        addSubLedgerData: addSubLedgerData,
                        sub_ledger_id: <?php echo $ledger_id;?>,
                        item_name: item_name,
                        description: subLedgerDescription
                    },
                    url: "include/transactions_server.php",
                    cache: false,
                    success: function(response) {
                        if (response == 1) {
                            toastr.success("Add Successfully ");
                            $('#addModal').modal('hide');
                        } else {
                            toastr.error("Please Try Again");
                        }
                    }
                });


            });
        });
    </script>

</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">

</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Ledger</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>



        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Ledger</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp; &nbsp;New Ledger</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="addModal">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-lan mdi-18px"></span> &nbsp;New Ledger</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form id="ledger-frm" method="POST">
                                    <div>
                                        <div class="card">
                                            <div class="card-body">

                                                <form class="form-sample">

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="form-group ">
                                                                <label>Master Ledger</label>
                                                                <select id="masterLedger" name="ledger" class="form-select">
                                                                    <option value="">Select</option>
                                                                    <option value="1">Income</option>
                                                                    <option value="2">Expense</option>
                                                                    <option value="3">Asset</option>
                                                                    <option value="4">Liabilities</option>

                                                                </select>
                                                            </div><br>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <input id="ledgerName" type="text" class="form-control" name="name" placeholder="Enter Your Name">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" id="ledger-save">Add Ledger</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">


                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>NO.</th>
                                                    <th>Ledger</th>
                                                    <th>Master Ledger</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="ledger-list">
                                                <?php

                                                if ($ledgr = $con->query("SELECT * FROM ledger")) {


                                                    while ($rows = $ledgr->fetch_assoc()) {
                                                        $id = $rows["id"];
                                                        $mstr_ledger_id = $rows["mstr_ledger_id"];
                                                        $name = $rows["ledger_name"];
                                                        $masterLedgerName="";
                                                        if ($mstr_ledger_id==1) {
                                                           $masterLedgerName="Income";
                                                        }else if($mstr_ledger_id==2){
                                                           $masterLedgerName="Expense";
                                                        }
                                                        else if($mstr_ledger_id==3){
                                                           $masterLedgerName="Asset";
                                                        }
                                                        else if($mstr_ledger_id==4){
                                                           $masterLedgerName="Liabilities";
                                                        }
                                                        echo '
     <tr>
       <td> ' . $id . '</td>
     <td><a  href="ledger_view.php?id=' . $id . '">' . $name . '</a></td>
     <td>' . $masterLedgerName . '</td>
     <td style="text-align:right;">
     <a class="btn-sm btn btn-success " href="ledger_view.php?id=' . $id . '"><i class="fas fa-eye"></i></a>
     
     </td>
     </tr>
     ';
                                                    }
                                                }

                                                ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#ledger_table").DataTable();
            // $("#ledger-list").load("include/ledger_server.php?list");
            
            $(document).on('click','#ledger-save',function(){
                var masterLedger = $("#masterLedger").val();
                var ledgerName = $("#ledgerName").val();
                if (masterLedger.length == 0) {
                    toastr.error('Master Ledger is required ');
                } else if (ledgerName.length == 0) {
                    toastr.error('Ledger Name is required ');
                } else {
                    
                    $.ajax({
                        type: "POST",
                        url: "include/ledger_server.php",
                        data: {
                            masterLedger:masterLedger,
                            ledgerName:ledgerName,
                            addLedgerData:0
                        },
                        cache: false,
                        success: function(response) {
                            if (response == 1) {
                                toastr.success("Ledger Add Success");
                                $("#addModal").modal('hide');
                                //$("#ledger-list").load("include/ledger_server.php?list");
                            }else{
                                toastr.error("Please Try Again");
                            }

                        }
                    });
                }
            });
        });
    </script>
</body>

</html>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Registration Page</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/fontawesome-free/css/all.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="https://adminlte.io/themes/v3/dist/css/adminlte.min.css?v=3.2.0">
  <style> 
    .login-box .card, .register-box .card {
    
    border: 2px #bfbfbf dotted !important;
}
  </style>
</head>
<body class="hold-transition register-page">
<div class="register-box">
  <!-- <div class="register-logo">
   <img  width="90px" src="http://103.146.16.154/profileImages/avatar.png">
  </div> -->

  <div class="card">
    <div class="card-body register-card-body">
    <div class="register-logo">
   <img  width="90px" src="http://103.146.16.154/profileImages/avatar.png">
  </div>
      <p class="login-box-msg">Welcome To SR Communication</p>

      <form action="" method="post">
        <div class="input-group mb-3">
          <input readonly type="text" class="form-control" placeholder="Full name" value="Rakib Mahmud">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-user"></span>
            </div>
          </div>
        </div>
        <div class="input-group mb-3">
          <input readonly type="text" class="form-control" placeholder="Package" value="1MBPS">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-lock"></span>
            </div>
          </div>
        </div>
        <div class="input-group mb-3">
          <input type="password" class="form-control" placeholder="Retype password">
          <div class="input-group-append">
            <div class="input-group-text">
                <i class="fas fa-clock"></i>
            </div>
          </div>
        </div>
      </form>

      <div class="social-auth-links text-center">
      
        
        <a href="#" class="btn btn-block btn-danger">
        <img src="images/Bkash-Logo.jpg" alt="Bkash" style="width: 20px; margin-right: 8px;">
          Pay With Bkash
        </a>
      </div>
    </div>
    <!-- /.form-box -->
  </div><!-- /.card -->
</div>
<!-- /.register-box -->

<!-- jQuery -->
<script src="https://adminlte.io/themes/v3/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="https://adminlte.io/themes/v3/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="https://adminlte.io/themes/v3/dist/js/adminlte.min.js?v=3.2.0"></script>
</body>
</html>
<?php

if(!isset($_SESSION)){
    session_start();
}
include "include/db_connect.php";

if (isset($_POST["login"])) {
    $username = trim($_POST["username"]);
    $password = trim($_POST["password"]);

    if (!empty($username) && !empty($password)) {
        /* Fetch user securely using prepared statement*/
        $stmt = $con->prepare("SELECT id, username, fullname, role, password FROM users WHERE username = ? LIMIT 1");
        $stmt->bind_param("s", $username);
        $stmt->execute();
        $result = $stmt->get_result();

        if ($result->num_rows === 1) {
            $row = $result->fetch_assoc();
            /*Set session variables*/ 
            $_SESSION["uid"] = $row["id"];
            $_SESSION["username"] = $row["username"];
            $_SESSION["fullname"] = $row["fullname"];
            $_SESSION["csrf_token"] = bin2hex(random_bytes(32));

            /*Log user's IP*/ 
            $loggeIP = $_SERVER['REMOTE_ADDR'];
            $stmt = $con->prepare("INSERT INTO user_login_log(username, time, ip, status) VALUES (?, NOW(), ?, 'Success')");
            $stmt->bind_param("ss", $username, $loggeIP);
            $stmt->execute();

            /*Update last login time & store CSRF token*/ 
            $stmt = $con->prepare("UPDATE users SET lastlogin = NOW(), csrf_token = ? WHERE username = ?");
            $stmt->bind_param("ss", $_SESSION['csrf_token'], $username);
            $stmt->execute();

            header("Location: index.php");
            exit();
        } else {
            $wrong_info = "Username or Password is incorrect!";
        }

        /* Log failed login attempt*/
        $stmt = $con->prepare("INSERT INTO user_login_log(username, time, ip, status) VALUES (?, NOW(), ?, 'Failed')");
        $stmt->bind_param("ss", $username, $_SERVER['REMOTE_ADDR']);
        $stmt->execute();
    } else {
        $wrong_info = "Please enter both username and password!";
    }
}

if (isset($_SESSION["uid"])) {
    $stmt = $con->prepare("SELECT csrf_token FROM users WHERE id=?");
    $stmt->bind_param("i", $_SESSION["uid"]);
    $stmt->execute();
    $result = $stmt->get_result();
    $user = $result->fetch_assoc();

    if ($user && $_SESSION["csrf_token"] === $user["csrf_token"]) {
        header("Location: index.php");
        exit();
    }
}

?>


<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>Login | ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body>

        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

         <!-- Begin page -->
         <div class="accountbg" style="background: url('assets/images/logo-it.png');background-size: cover;background-position: center;"></div>

        <div class="account-pages mt-2 pt-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-5 col-xl-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="text-center mt-4">
                                    <div class="mb-3">
                                        <a href="#"><img src="assets/images/it-fast.png" height="30" alt="logo"></a>
                                    </div>
                                </div>
                                <div class="p-3">
                                    <h4 class="font-size-18 mt-2 text-center">Welcome Back !</h4>
                                    <p class="text-muted text-center mb-4">Sign in to continue to ISP-BILLING-SOFTWARE</p>
    
                                    <form method="POST" action="<?php $_SERVER['PHP_SELF']; ?>">
    
                                        <div class="mb-3">
                                            <label class="form-label" for="username">Username</label>
                                            <input type="text" class="form-control" id="username" name="username" placeholder="Enter username">
                                        </div>
    
                                        <div class="mb-3">
                                            <label class="form-label" for="password">Password</label>
                                            <input type="password" class="form-control" id="password" name="password" placeholder="Enter password">
                                        </div>
                                        <div>
                                            <?php if (isset($wrong_info)) {
                                                echo '<p style="color:red;">'.$wrong_info.'</p>';
                                            } ?>
                                        </div>
    
                                        <div class="row mt-4">
                                            <div class="col-sm-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="customControlInline">
                                                    <label class="form-check-label" for="customControlInline">
                                                        Remember me
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 text-end">
                                                <button name="login" class="btn btn-primary w-md waves-effect waves-light" type="submit">Log In</button>
                                            </div>
                                        </div>
    
                                        <div class="mb-0 row">
                                            <div class="col-12 mt-4">
                                                <a href="pages-recoverpw.html" class="text-muted"><i class="mdi mdi-lock"></i> Forgot your password?</a>
                                            </div>
                                        </div>
                                    </form>
    
                                </div>
    
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </div>

                             
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <script src="assets/js/app.js"></script>

        <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>

    </body>
</html>
<?php
session_start();
$_SESSION["uid"] = "";	
$_SESSION["username"] = "";	

session_destroy();
header("location: login.php");


?>
<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	  $id=$_GET['id'];

	$result=$con->query("DELETE FROM  message_template WHERE id=$id ");
	if ($result==true) {
		header("location:message_template.php");
	}else{

	}
}



 ?>

 <?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
if (isset($_GET["id"])) {
    $expiredId=$_GET['id'];
    if ($messae_template=$con->query("SELECT * FROM message_template WHERE id='$expiredId'")) {
        while($rows=$messae_template->fetch_array()){
            $id=$rows["id"];
            $template_name  =$rows["template_name"];
            $text  =$rows["text"];
        }
    }
}


?>



<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css"> 
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Expire date Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 m-auto" id="formArea">
                            <h4 class="text-center">Update Message Template</h4><br>
                        <form id="expired_form">
                            <div class="form-group mb-2">
                                <input type="text" id="updateId" value="<?php echo $id;?>" class="d-none">
                                <label>Template Name</label>
                                <input type="text" id="templateName" class="form-control" value="<?php echo $template_name; ?>">
                            </div>
                            <div class="form-group mb-2">
                                <label>Template Message</label>
                                <textarea id="templateMessage" class="form-control" style="height: 140px;"><?php echo $text; ?></textarea> 
                            </div>
                            <button type="button" id="updateBtn" class="btn btn-success mr-1">Update</button>
                            <a href="message_template.php" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
      <script type="text/javascript">
    $(document).ready(function(){
        $("#updateBtn").click(function(){
            var updateId=$("#updateId").val();
            var templateName=$("#templateName").val();
            var templateMessage=$("#templateMessage").val();
            if (templateName.length==0) {
                toastr.error("Template Name is require");
            }else if (templateMessage.length==0){
                toastr.error("Template Message is require");
            }else{
                var updateMessageTemplate="0";
                $.ajax({
                    type:"POST",
                    url:"include/message.php",
                    data:{id:updateId,name:templateName,message:templateMessage,updateMessageTemplate:updateMessageTemplate},
                    success:function(response){
                        toastr.success(response);
                    }
                });  
            }
            
        });
    });
</script>

    </body>
</html>
<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Message Template</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Message Template</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;&nbsp;New Template</button>
                          </div>
                            </div>
                        </div>
                    </div>






                   <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Add Template</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="modal-body">
                               <form >
                                <div class="form-group mb-2">
                                    <label>Template Name</label>
                                    <input class="form-control" type="text" id="templateName" placeholder="Type Your Text Here"/>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Message Template</label>
                                    <textarea class="form-control" type="text" id="textMessage" placeholder="Type Your Text Here" style="height: 105px;"></textarea> 
                                </div>
                                <div class="form-group mb-2 d-none">
                                    <input class="form-control" type="text" id="user_type" value="<?php echo $auth_usr_type; ?>" />
                                </div>
                                </form>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Close</button>
                              <button id="add_template" type="button" class="btn btn-primary">Add Template</button>
                           </div>
                        </div>
                     </div>
                  </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Template Name</th>
                                                    <th>Message Template</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody >
        
         <?php 

                          $sql="SELECT * FROM message_template WHERE user_type=$auth_usr_type  ";
                          $result=mysqli_query($con,$sql);

                          while ($rows=mysqli_fetch_assoc($result)) {

                           ?>

                           <tr>
        <td><?php echo $rows['id']; ?></td>
        <td>
            <?php 
            echo $rows['template_name']; 
             

            ?>
                
            </td>
        <td >
            <?php
             $textFile= $rows['text'];
            echo  substr($textFile, 0, 50)."......";

            ?>
                
        </td>
       <td style="text-align:right">
        <a   href="message_template_edit.php?id=<?php echo $rows['id']; ?>" class="btn-sm btn btn-info"><i class="fas fa-edit"></i></a>

        <a   href="message_template_delete.php?id=<?php echo $rows['id']; ?>"class="btn-sm btn btn-danger"onclick="return confirm('Are you sure');"><i class="fas fa-trash"></i>
        </a>

        </td>
        </tr>
                       <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>


      <script type="text/javascript">
          $(document).ready(function(){
            $(".deleteBtn").click(function(){
                var id=$(this).data('id');
                alert(id);
            });
            $("#add_template").click(function(){
                 var templateName=$("#templateName").val();
                 var message=$("#textMessage").val();
                 var user_type=$("#user_type").val();
                 if (message.length==0) {
                    toastr.error("Please Type Your Message");
                 }else if(templateName.length==0){
                     toastr.error("Template Name Require");
                 }
                 else{
                   //var formData= $("#form-category").serialize();
                   var messageDataInsert="0";
                   $.ajax({
                    type:'POST',
                    data:{message:message,messageDataInsert:messageDataInsert,user_type:user_type,templateName:templateName},
                    url:'include/message.php',
                    cache:false,
                    success:function(response){
                        if (response==1) {
                            toastr.success("Add Successfully");
                            $("#addModal").modal('hide');
                         setTimeout(()=>{location.reload();},1000);
                        }else{
                           toastr.warning("Please Try Again"); 
                        }
                        
                    }
                   });
                 }
            });
          });
      </script>

    </body>
</html>
<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";


?>


<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Monthly Recharge</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                     <div class="col-md-12 grid-margin">
                        <div class="d-flex justify-content-between flex-wrap">
                           <div class="d-flex align-items-end flex-wrap">
                              <div class="mr-md-3 mr-xl-5">
                                 <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Monthly Recharge</p>
                                 </div>
                              </div>
                              <br>
                           </div>
                           <div class="d-flex justify-content-between align-items-end flex-wrap">
                              
                           </div>
                        </div>
                     </div>
                  </div>
            <div class="row">
                     <div class="col-md-12 stretch-card">
                        <div class="card">
                           <div class="card-body">
                              <span class="card-title"></span>
                              <div class="col-md-6 float-md-right grid-margin-sm-0">
                                 <div class="form-group">
                                    
                                       
                                 </div>
                              </div>
                              <div class="table-responsive">
                              <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
    <thead>
        <tr>
            <th>Customer Name</th>
            <th>Recharged Date</th>
            <th>Months</th>
            <th>Paid Until</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
        <?php 
        // Get the month parameter from the URL
        $month = $_GET['month']; // Format: YYYY-MM
        
        // Prepare the SQL query
        $sql = "SELECT * FROM customer_rechrg WHERE DATE_FORMAT(datetm, '%Y-%m') = '$month'";
        $result = mysqli_query($con, $sql);

        // Loop through the results
        while ($rows = mysqli_fetch_assoc($result)) {
            $getCstmrId = $rows["customer_id"];
            $customerName = '';

            // Fetch customer name from the customers table
            $customerQuery = "SELECT fullname FROM customers WHERE id='$getCstmrId'";
            $customerResult = mysqli_query($con, $customerQuery);
            if ($customerRow = mysqli_fetch_assoc($customerResult)) {
                $customerName = $customerRow['fullname'];
            }
        ?>
        <tr>
            <td>
                <a href="profile.php?clid=<?php echo $getCstmrId; ?>">
                    <?php echo $customerName; ?>
                </a>
            </td>
            <td>
                <?php 
                $recharge_date_time = $rows['datetm'];
                $dateTm = new DateTime($recharge_date_time);
                echo $dateTm->format("H:i A, d-M-Y");
                ?> 
            </td>
            <td><?php echo $rows["months"]; ?></td>
            <td><?php echo $rows["rchrg_until"]; ?></td>
            <td><?php echo $rows["sales_price"]; ?></td>
        </tr>
        <?php } ?>
    </tbody>
</table>

                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>
        
        
        <!-- Peity chart-->
        <script src="assets/libs/peity/jquery.peity.min.js"></script>
        
        <!--C3 Chart-->
        <script src="assets/libs/d3/d3.min.js"></script>
        <script src="assets/libs/c3/c3.min.js"></script> 
        <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
        
        <script src="assets/js/pages/dashboard.init.js"></script>
        
        <script src="assets/js/app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script type="text/javascript" src="assets/js/js-fluid-meter.js"></script>
    </body>
</html>
<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';
require 'routeros/routeros_api.class.php';
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Nas';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">NAS</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button type="button" data-bs-toggle="modal" data-bs-target="#addModal"
                                        class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New NAS</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-striped table-bordered  nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>NAS Details</th>
                                                    <th>Online Users</th>
                                                    <th>Location</th>
                                                    <th>IP</th>
                                                    <th>Secret</th>
                                                    <th>Api User</th>
                                                    <th>Description</th>
                                                    <th>Server</th>
                                                    <th>&nbsp;</th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php 
                            $sql="SELECT * FROM nas";
                            $result=mysqli_query($con,$sql);

                            while ($rows=mysqli_fetch_assoc($result)) {
                                $id = $rows['id'];
                                $nasname = $rows['nasname'];
                                $api_usr = $rows['api_user'];
                                $api_pswd = $rows['api_password'];
                                $api_server = $rows['api_ip'];
                                $api_port = $rows['ports'];
                                $location = $rows['location'];
                            ?>


                                                <tr>
                                                    <td>
                                                        <?php echo $rows['shortname'] . '<br>';
                                                        
                                                        ////////////////////////////////////
                                                        $API = new RouterosAPI();
                                                        
                                                        //$API->debug = true;
                                                        //$port = 8727;
                                                        if ($API->connect($api_server, $api_usr, $api_pswd, $api_port)) {
                                                            //$API->write('/interface/getall');
                                                            $API->write('/system/resource/print');
                                                        
                                                            $READ = $API->read(true);
                                                        
                                                            //$ARRAY = $API->parseResponse($READ);
                                                        
                                                            echo 'Uptime: ' . $READ['0']['uptime'] . '<br>';
                                                            echo 'Version: ' . $READ['0']['version'] . '<br>';
                                                            echo 'Hardware: ' . $READ['0']['board-name'] . '<br>';
                                                            echo 'CPU: ' . $READ['0']['cpu'] . ', ';
                                                            echo 'Core: ' . $READ['0']['cpu-count'] . ' Core, ';
                                                            echo 'Speed: ' . $READ['0']['cpu-frequency'] / 1000 . ' GHz';
                                                        
                                                            // Online users
                                                            $NAS_Online = $ARRAY = $API->comm('/ppp/active/print', ['count-only' => '']);
                                                        
                                                            //print_r($ARRAY);
                                                        
                                                            $API->disconnect();
                                                        }
                                                        /////////////////////////////////
                                                        ?>
                                                    </td>
                                                    <td><?php echo $NAS_Online; ?>
                                                    <td><?php echo $location; ?>
                                                    <td><?php echo $host = $rows['nasname']; ?>
                                                        <br />
                                                        <div id="pingchk"></div>




                                                    </td>
                                                    <td><?php echo $rows['secret']; ?></td>
                                                    <td><?php echo $rows['api_user']; ?></td>
                                                    <td><?php echo $rows['description']; ?></td>
                                                    <td><?php echo $rows['api_ip']; ?></td>
                                                    <td>
                                                    <button type="button" name="edit_button" class="btn-sm btn btn-info" data-id="<?php echo $id; ?>"><i class="fas fa-edit"></i></button>
                                                        <!-- <a href="include/nas_delete.php?clid=<?php echo $rows['id']; ?>" class="btn-sm btn btn-danger" onclick=" return confirm('Are You Sure');">Delete
                                    </a> -->
                                                    </td>
                                                </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Add Modal -->
    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New NAS
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/nas_server.php?add_data=true" method="POST" enctype="multipart/form-data">

                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>NAS Name</label>
                                            <input name="nas_name" type="text" class="form-control "
                                                placeholder="Enter Nas Name" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Short Name</label>
                                            <input name="short_name" type="text" class="form-control "
                                                placeholder="Enter Your IP" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Type</label>
                                            <input name="type" type="text"class="form-control "
                                                placeholder="Enter Type" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Port</label>
                                            <input name="port" type="text"class="form-control "
                                                placeholder="Enter Port" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 ">
                                        <div class="form-group mb-2">
                                            <label>Secret</label>
                                            <input name="secret" type="text"class="form-control "
                                                placeholder="Enter API Secret" />
                                        </div>
                                    </div>
                                    <div class="col-md-6 ">
                                        <div class="form-group mb-2">
                                            <label>API User</label>
                                            <input name="api_user" type="text"class="form-control "
                                                placeholder="Enter API User" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>API Password</label>
                                            <input name="api_pass" type="password" class="form-control"
                                                placeholder="Enter API Password" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Api IP</label>
                                            <input name="api_ip" type="text" class="form-control"
                                                placeholder="Enter Api IP" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Server</label>
                                            <input name="server" type="text" class="form-control"
                                                placeholder="Enter Server" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Location</label>
                                            <input name="location" type="text" class="form-control"
                                                placeholder="Enter Location" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Community</label>
                                            <input name="community" type="text" class="form-control"
                                                placeholder="Enter Community" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Description</label>
                                            <textarea name="description" type="text" class="form-control"
                                                placeholder="Enter Description"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New NAS
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/nas_server.php?update_data=true" method="POST" enctype="multipart/form-data">

                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>NAS Name</label>
                                            <input type="text" name="id" class="d-none">
                                            <input name="nas_name" type="text" class="form-control "
                                                placeholder="Enter Nas Name" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Short Name</label>
                                            <input name="short_name" type="text" class="form-control "
                                                placeholder="Enter Your IP" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Type</label>
                                            <input name="type" type="text"class="form-control "
                                                placeholder="Enter Type" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Port</label>
                                            <input name="port" type="text"class="form-control "
                                                placeholder="Enter Port" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 ">
                                        <div class="form-group mb-2">
                                            <label>Secret</label>
                                            <input name="secret" type="text"class="form-control "
                                                placeholder="Enter API Secret" />
                                        </div>
                                    </div>
                                    <div class="col-md-6 ">
                                        <div class="form-group mb-2">
                                            <label>API User</label>
                                            <input name="api_user" type="text"class="form-control "
                                                placeholder="Enter API User" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>API Password</label>
                                            <input name="api_pass" type="password" class="form-control"
                                                placeholder="Enter API Password" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Api IP</label>
                                            <input name="api_ip" type="text" class="form-control"
                                                placeholder="Enter Api IP" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Server</label>
                                            <input name="server" type="text" class="form-control"
                                                placeholder="Enter Server" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Location</label>
                                            <input name="location" type="text" class="form-control"
                                                placeholder="Enter Location" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Community</label>
                                            <input name="community" type="text" class="form-control"
                                                placeholder="Enter Community" />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label>Description</label>
                                            <textarea name="description" type="text" class="form-control"
                                                placeholder="Enter Description"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>

<script type="text/javascript">
     /**  Add **/
     $('#addModal form').submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $('#addModal').modal('hide');
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                    },


                    error: function(xhr, status, error) {
                        /** Handle  errors **/
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        }
                    }
                });
            });
            $(document).on('click',"button[name='edit_button']",function(){
                var id=$(this).data('id');
                $.ajax({
                    url: "include/nas_server.php?get_nas_data=true", 
                    type: "GET",
                    data: { id: id }, 
                    dataType:'json',
                    success: function(response) {
                        if (response.success) {
                        $('#editModal').modal('show');
                        $('#editModal input[name="id"]').val(response.data.id);
                        $('#editModal input[name="nas_name"]').val(response.data.nasname);
                        $('#editModal input[name="short_name"]').val(response.data.shortname);
                        $('#editModal input[name="type"]').val(response.data.type);
                        $('#editModal input[name="port"]').val(response.data.ports);
                        $('#editModal input[name="secret"]').val(response.data.secret);
                        $('#editModal input[name="api_user"]').val(response.data.api_user);
                        $('#editModal input[name="api_pass"]').val(response.data.api_password);
                        $('#editModal input[name="api_ip"]').val(response.data.api_ip);
                        $('#editModal input[name="server"]').val(response.data.server);
                        $('#editModal input[name="location"]').val(response.data.location);
                        $('#editModal input[name="community"]').val(response.data.community);
                        $('#editModal textarea[name="description"]').val(response.data.description);
                        } else {
                            toastr.error("Error fetching data for edit: " + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        toastr.error('Failed to fetch department details');
                    }
                });
            });
            /** Update The data from the database table **/
            $('#editModal form').submit(function(e){
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();

                /*Get the submit button*/
                var submitBtn = form.find('button[type="submit"]');

                /*Save the original button text*/
                var originalBtnText = submitBtn.html();

                /*Change button text to loading state*/
                    

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                    type:'POST',
                    'url':url,
                    data: formData,
                    dataType:'json',
                    beforeSend: function () {
                        form.find(':input').prop('disabled', true);
                    },
                    success: function (response) {
                        if (response.success) {
                            toastr.success(response.message);
                            $('#editModal').modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 500);

                        }
                        if(response.success==false){
                            toastr.error(response.message);
                        }
                    },

                    error: function (xhr, status, error) {
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        } else {
                            toastr.error("An error occurred. Please try again.");
                        }
                    },
                    complete:function(){
                        form.find(':input').prop('disabled', false);
                    }
                });
            });
</script>


</body>

</html>
<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customers</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                   
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="customers_tables" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <!-- <th>Check All <input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"></th> -->
                                                    <th>Area</th>
                                                    <th>Name</th>
                                                    
                                                    <th>User Name</th>
                                                    <th>Status</th>
                                                    <th>Password</th>
                                                    <th>User End Pass</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
    <?php
	
	$usroffline = $con->query("SELECT * FROM area_list");
	while ($rowoff = $usroffline->fetch_assoc()) {

        $areaid = $rowoff["id"];
        $areaname = $rowoff["name"];
		
		?>
		<tr>
			<!-- <th>Check All <input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"></th> -->
			<td><b><?php echo $areaname; ?></b></td>
			<th>Name</th>
			
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		
<?php
	
	
    $result = $con->query("SELECT id,fullname,username,mobile,expiredate FROM customers WHERE status='1' AND username NOT IN(SELECT username FROM radacct WHERE acctstoptime IS NULL AND acctterminatecause='')");
    print_r($result->num_rows);exit;  


    while ($rows = mysqli_fetch_assoc($result)) {

		$custfullname = $rows["fullname"];
        $custUsername = $rows["username"];
        //$pwd = $rows["password"];

                ?>
                <tr>
                    <td></td>
                    <td>
                        <a target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>">
                            <?php 
							$chkc=0;
                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$custUsername'");
                            $chkc = $onlineusr->num_rows;
							//$rowlst = $onlineusr->fetch_assoc();
                            if ($chkc == 1) {
                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                            } else {
                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';
                            }
                            echo ' ' . $rows["fullname"]; 
                            ?>
                        </a>
                    </td>
                    <td><?php echo $custUsername; ?></td>
                    <td><?php echo $rows["mobile"]; ?></td>
                    <td><?php echo $rows["expiredate"]; ?></td>
                    <td><?php //echo $pwdtry; ?></td>
                    <td>
                      
                        <a class="btn btn-success" target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i></a>
                    </td>
                </tr>
                <?php
        }   
    }
    ?>
</tbody>


                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $("#customers_table").DataTable();

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });


        $(document).on('click','.missmtchID', function(){

            var pwdmissname = $(this).attr("data-id");
            var pwdtry = $(this).attr("data-idp");
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pwdmissname: pwdmissname,
                    pwdtry: pwdtry
                    
                },
                success: function(response) {
                    $("#"+pwdmissname).hide(300);
                }
            });



            });

        
      
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customers</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                   
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <!-- <th>Check All <input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"></th> -->
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    
                                                    <th>User Name</th>
                                                    <th>Status</th>
                                                    <th>Password</th>
                                                    <th>User End Pass</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
    <?php
    $result = $con->query("SELECT * FROM customers");

    while ($rows = mysqli_fetch_assoc($result)) {

        $custUsername = $rows["username"];
        $pwd = $rows["password"];

        $pwdtry = "";
        $cstpwd = $con->query("SELECT * FROM radpostauth WHERE username='$custUsername' LIMIT 1");
        if ($cstpwd->num_rows > 0) {
            while ($pwdRow = $cstpwd->fetch_array()) {
                $pwdtry = $pwdRow['pass'];
            }
            if ($pwdtry != $pwd) {
                $pwdstatus = '
                <span id="' . $custUsername . '" class="badge bg-danger">Not Matched</span>
                <button type="button" class="btn-sm btn-info missmtchID" data-id="' . $custUsername . '" data-idp="' . $pwdtry . '">
                    <i class="fas fa-sync"></i>
                </button>';
                ?>
                <tr>
                    <td><?php echo $rows['id']; ?></td>
                    <td>
                        <a target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>">
                            <?php 
                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$custUsername'");
                            $chkc = $onlineusr->num_rows;
                            if ($chkc == 1) {
                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                            } else {
                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';
                            }
                            echo ' ' . $rows["fullname"]; 
                            ?>
                        </a>
                    </td>
                    <td><?php echo $custUsername; ?></td>
                    <td><?php echo $pwdstatus; ?></td>
                    <td><?php echo $pwd; ?></td>
                    <td><?php echo $pwdtry; ?></td>
                    <td>
                        <a class="btn btn-info" target="_blank" href="profile_edit.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                        <a class="btn btn-success" target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i></a>
                    </td>
                </tr>
                <?php
            }
        }
    }
    ?>
</tbody>


                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $("#customers_table").DataTable();

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });


        $(document).on('click','.missmtchID', function(){

            var pwdmissname = $(this).attr("data-id");
            var pwdtry = $(this).attr("data-idp");
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pwdmissname: pwdmissname,
                    pwdtry: pwdtry
                    
                },
                success: function(response) {
                    $("#"+pwdmissname).hide(300);
                }
            });



            });

        
      
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">

</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Add New Package</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor"> Add Package</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;Add Package</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="addModal">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add Package</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <form id="form-package">
                                                    <div class="form-group mb-2">
                                                        <label>Select Pool</label>
                                                        <select  class="form-select" name="pool_id" id="pool_id">
                                                            <option value="">Select pool</option>
                                                            <?php
                                                            $pool = $con->query("SELECT * FROM pool");


                                                            while ($rows = $pool->fetch_array()) {
                                                                $lstid = $rows["id"];
                                                                $poolname = $rows["name"] . " (IP " . $rows["ip_block"] . ")";



                                                                echo '<option value=' . $lstid . '>' . $poolname . '</option>';
                                                            }


                                                            ?>
                                                        </select>
                                                    </div>
                                                    <div class="form-group mb-2">
                                                        <label>Package</label>
                                                        <input class="form-control" type="text" name="package" id="package" placeholder="Type Your Package" required />
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Price</label>
                                                        <input class="form-control" type="text" name="price" id="price" placeholder="Type Your Price" required />
                                                    </div>
                                                    <div class="form-group d-none">
                                                        <label>user type</label>
                                                        <input class="form-control" type="text" name="user_type" id="user_type" value="<?php echo $auth_usr_type; ?>" required />
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancle</button>
                                    <button type="submit" id="add_package" class="btn btn-primary">Add Package</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">


                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Package List</th>
                                                    <th>Package Price</th>
                                                    <th>Total Customer</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php

                                                $qUery = "SELECT * FROM radgroupcheck";
                                                $result = mysqli_query($con, $qUery);
                                                while ($rowss = mysqli_fetch_assoc($result)) {

                                                ?>
                                                    <tr>
                                                        <td><?php echo $pkgID = $rowss['id']; ?></td>
                                                        <td><?php echo $rowss['groupname'] ?></td>
                                                        <td><?php echo $rowss['price'] ?></td>
                                                        <td><?php

                                                            // Total customer using package
                                                            $pckgusr = $con->query("SELECT * FROM customers WHERE package='$pkgID'");
                                                            echo $pckgusr->num_rows;



                                                            ?></td>
                                                        <td style="text-align:right;">
                                                            <a class="btn-sm btn btn-success " href="package_customer.php?id=<?php echo $rowss['id']; ?>"><i class="fas fa-eye"></i></a>

                                                            <a class="btn-sm btn btn-info " href="package_edit.php?id=<?php echo $rowss['id']; ?>"><i class="fas fa-edit"></i></a>

                                                            <a onclick="return confirm('Are you sure');" href="package_delete.php?id=<?php echo $rowss['id']; ?>" class="btn-sm btn btn-danger "><i class="fas fa-trash"></i></a>

                                                        </td>
                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 d-none" id="DeleteId"></h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#package_table").DataTable();

            $("#add_package").click(function() {
                var package = $("#package").val();
                var pool_id = $("#pool_id").val();

                if (pool_id.length == '') {
                    toastr.error("Pool Name is require");
                }else if(package.length == 0){
                    toastr.error("Name is require");
                } else {
                    var formData = $("#form-package").serialize();
                    $.ajax({
                        type: "GET",
                        data: formData,
                        url: "include/package_server.php?add",
                        cache: false,
                        success: function(response) {
                            toastr.success(response);
                            $("#addModal").modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        }
                    });
                }


            });
        });

        function deleteData(deleteId) {
            //delete Confirm button
            $("#DeleteConfirm").click(function() {
                //var deleteId=$("#DeleteId").html();
                $.ajax({
                    type: "GET",
                    url: "include/add_package.php?delete",
                    data: {
                        id: deleteId
                    },
                    cache: false,
                    success: function(response) {
                        if (response = 1) {
                            location.reload(true);
                            toastr.success("Delete Successfully");

                        } else {
                            toastr.error(" try again");
                        }
                        $("#deleteModal").modal('hide');

                    }
                });

            });
        }
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customers</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer</button>
                                </div>

                                <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addCustomerModal" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New customer</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="">
                                                <form id="customer_form">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Full Name</label>
                                                                        <input id="customer_fullname" type="text" class="form-control " placeholder="Enter Your Fullname" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Username <span id="usernameCheck"></span></label>
                                                                        <input id="customer_username" type="text" class="form-control " name="username" placeholder="Enter Your Username" oninput="checkUsername();" />

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Password</label>
                                                                        <input id="customer_password" type="password" class="form-control " name="password" placeholder="Enter Your Password" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Mobile no.</label>
                                                                        <input id="customer_mobile" type="text" class="form-control " name="mobile" placeholder="Enter Your Mobile Number" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Expired Date</label>
                                                                        <select id="customer_expire_date" class="form-select">
                                                                            <option value="<?php echo date("d"); ?>"><?php echo date("d"); ?></option>
                                                                            <?php
                                                                            if ($exp_cstmr = $con->query("SELECT * FROM customer_expires")) {
                                                                                while ($rowsssss = $exp_cstmr->fetch_array()) {


                                                                                    $exp_date = $rowsssss["days"];

                                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                                }
                                                                            }

                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Address</label>
                                                                        <input id="customer_address" type="text" class="form-control" name="address" placeholder="Enter Your Addres" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>POP/Branch</label>
                                                                        <select id="customer_pop" class="form-select">
                                                                            <option value="">Select Pop/Branch</option>
                                                                            <?php
                                                                            if ($pop = $con->query("SELECT * FROM add_pop ")) {
                                                                                while ($rows = $pop->fetch_array()) {


                                                                                    $id = $rows["id"];
                                                                                    $name = $rows["pop"];

                                                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                                                }
                                                                            }
                                                                            ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 ">
                                                                    <div class="form-group mb-2">
                                                                        <label>Area/Location</label>
                                                                        <select id="customer_area" class="form-select" name="area">
                                                                            <option>Select Area</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">

                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Nid Card Number</label>
                                                                        <input id="customer_nid" type="text" class="form-control" name="nid" placeholder="Enter Your Nid Number" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package</label>
                                                                        <select id="customer_package" class="form-select">


                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Connection Charge</label>
                                                                        <input id="customer_con_charge" type="text" class="form-control" name="con_charge" placeholder="Enter Connection Charge" value="500" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group mb-2">
                                                                        <label>Package Price</label>
                                                                        <input disabled id="customer_price" type="text" class="form-control" value="00" />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Remarks</label>
                                                                        <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"></textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label>Status</label>
                                                                        <select id="customer_status" class="form-select">
                                                                            <option value="">Select Status</option>
                                                                            <option value="0">Disable</option>
                                                                            <option value="1">Active</option>
                                                                            <option value="2">Expire</option>
                                                                            <option value="3">Request</option>
                                                                        </select>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-success" id="customer_add">Add Customer</button>
                                            </div>
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <!-- <th>Check All <input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"></th> -->
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Package</th>
                                                    <th>Expired Date</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>POP/Branch</th>
                                                    <th>Area/Location</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
                                                <?php
                                                $getPackageId=$_GET['id'];
                                                $sql = "SELECT * FROM customers WHERE  package=$getPackageId";
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {

                                                ?>

                                                    <tr>
                                                        <td><?php echo $rows['id']; ?></td>
                                                        <td><a href="profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
                                                        <td>
                                                            <?php

                                                            echo  $rows["package_name"];
                                                            // if ($allData = $con->query("SELECT * FROM radgroupcheck WHERE id='$packageId'")) {
                                                            //     while ($packageName = $allData->fetch_array()) {
                                                            //         echo  $packageName['groupname'];
                                                            //     }
                                                            // }

                                                            ?>

                                                        </td>
                                                        <td>
                                                            <?php

                                                            $expireDate = $rows["expiredate"];
                                                            $todayDate = date("Y-m-d");
                                                            if ($expireDate <= $todayDate) {
                                                                echo "<span class='badge bg-danger'>Expired</span>";
                                                            } else {
                                                                echo $expireDate;
                                                            }
                                                            ?>
                                                        </td>
                                                        <td><?php echo $rows["username"]; ?></td>
                                                        <td><?php echo $rows["mobile"]; ?></td>
                                                        <td>
                                                            <?php
                                                            $popID = $rows["pop"];
                                                            $allPOP = $con->query("SELECT * FROM add_pop WHERE id=$popID ");
                                                            while ($popRow = $allPOP->fetch_array()) {
                                                                echo $popRow['pop'];
                                                            }

                                                            ?>
                                                        </td>
                                                        <td>
                                                            <?php $id = $rows["area"];
                                                            $allArea = $con->query("SELECT * FROM area_list WHERE id='$id' ");
                                                            while ($popRow = $allArea->fetch_array()) {
                                                                echo $popRow['name'];
                                                            }

                                                            ?>

                                                        </td>

                                                        <td>
                                                            <a class="btn btn-info" href="profile_edit.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                                                            <a class="btn btn-success" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
                                                            </a>

                                                            <a href="customer_delete.php?clid=<?php echo $rows['id']; ?>" class="btn btn-danger deleteBtn" onclick=" return confirm('Are You Sure');" data-id=<?php echo $rows['id']; ?>><i class="fas fa-trash"></i>
                                                            </a>

                                                        </td>
                                                    </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $("#customers_table").DataTable();

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });




        $("#customer_add").click(function() {
            var fullname = $("#customer_fullname").val();
            var package = $("#customer_package").val();
            var username = $("#customer_username").val();
            var password = $("#customer_password").val();
            var mobile = $("#customer_mobile").val();
            var address = $("#customer_address").val();
            var expire_date = $("#customer_expire_date").val();
            var area = $("#customer_area").val();
            var pop = $("#customer_pop").val();
            var nid = $("#customer_nid").val();
            var con_charge = $("#customer_con_charge").val();
            var price = $("#customer_price").val();
            var remarks = $("#customer_remarks").val();
            var status = $("#customer_status").val();
            var user_type = <?php echo $auth_usr_type; ?>;

            customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status)

        });

        function customerAdd(user_type, fullname, package, username, password, mobile, address, expire_date, area, pop, con_charge, price, remarks, nid, status) {
            if (fullname.length == 0) {
                toastr.error("Customer name is require");
            } else if (package.length == 0) {
                toastr.error("Customer Package is require");
            } else if (username.length == 0) {
                toastr.error("Username is require");
            } else if (password.length == 0) {
                toastr.error("Password is require");
            } else if (mobile.length == 0) {
                toastr.error("Mobile number is require");
            } else if (expire_date.length == 0) {
                toastr.error("Expire Date is require");
            } else if (pop.length == 0) {
                toastr.error("POP/Branch is require");
            } else if (area.length == 0) {
                toastr.error("Area is require");
            } else if (con_charge.length == 0) {
                toastr.error("Connection Charge is require");
            } else if (price.length == 0) {
                toastr.error("price is require");
            } else if (status.length == 0) {
                toastr.error("Status is require");
            } else {
                $("#customer_add").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                var addCustomerData = 0;
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php',
                    data: {
                        addCustomerData: addCustomerData,
                        fullname: fullname,
                        package: package,
                        username: username,
                        password: password,
                        mobile: mobile,
                        address: address,
                        expire_date: expire_date,
                        area: area,
                        pop: pop,
                        con_charge: con_charge,
                        price: price,
                        remarks: remarks,
                        nid: nid,
                        status: status,
                        user_type: user_type,
                    },
                    success: function(responseData) {
                        if (responseData == 1) {
                            toastr.success("Added Successfully");
                            $("#addCustomerModal").modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            toastr.error(responseData);
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>

<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM `radgroupcheck` WHERE id=$id ");
	if ($result==true) {
		header("location:package_add.php");
	}else{

	}
}


 ?>

 <?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $packageId=$_GET['id'];
    if ($package_list=$con->query("SELECT * FROM radgroupcheck WHERE id='$packageId'")) {
        while($rows=$package_list->fetch_array()){
            $id=$rows["id"];
      $package_name=$rows["groupname"];
        }
    }
}


?>




<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Package Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                <div id="alertMsg" class="alert alert-success p-2 mt-3" style="width: 400px; display:none;">
                 <i class="mdi mdi-check-circle"></i>
                 <strong class="mx-2">Success!</strong> Update Data 
                </div>
           </div> 
            <div class="row mt-5 py-3 mr-3 ml-3">

                    <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center">Update Package</h4><br>
                        <form id="package_form">
                            <label><b style="color: green;">Package List*</b></label>
                            <input class="d-none" type="text" value="<?php echo $id; ?>" name="id">
                            <input id="form" name="package" class="form-control form-control-sm" type="text" value="<?php echo $package_name; ?>"><br>
                            <button id="package_button" class="btn btn-success mr-1">Update</button>
                            <a href="package_add.php" id="up_delete_button" class="btn btn-danger mr-1">Cancel</a>
                        </form>
                    </div>

                </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script src="js/toastr/toastr.min.js"></script>
    <script src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
     <script type="text/javascript">
    $(document).ready(function(){
        $("#package_button").click(function(e){
            e.preventDefault();
            var formData=$("#package_form").serialize();
            $.ajax({
            type:"GET",
            url:"include/add_package.php?update",
            data:formData,
            cache:false,
            success:function(){
                 Swal.fire(
                      'Success!',
                      'Data Update Success!',
                      'success'
                        )
                }
           });
        });
    });
</script>
    </body>
</html>
<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">
   
    <!-- Begin page -->
    <div id="layout-wrapper">
      <?php $page_title="Customer Package"; include 'Header.php';?>
        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customer/Package</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;New Package</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content col-md-6">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-lan mdi-18px"></span> &nbsp;Package</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div>
                                    <!--Customer form start-->
                                    <form id="pool-frm">
                                        <div>
                                            <div class="card">
                                                <div class="card-body">
                                                    <form class="form-sample" id="package_form">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group ">
                                                                    <label>Package Name</label>
                                                                    <input id="package_name" type="text" class="form-control " placeholder="1-MBPS / 2-MBPS" name="package_name" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group">
                                                                    <label>Pool</label>
                                                                    <select id="form" class="form-control" name="pool_name">
                                                                        <option>Select pool</option>
                                                                        <?php
                                                                        $pool = $con->query("SELECT * FROM pool");


                                                                        while ($rows = $pool->fetch_array()) {
                                                                            $lstid = $rows["id"];
                                                                            $poolname = $rows["name"] . " (IP " . $rows["ip_block"] . ")";



                                                                            echo '<option value=' . $lstid . '>' . $poolname . '</option>';
                                                                        }


                                                                        ?>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <!--Customer form end-->
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary" id="packg_add">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                    </div>
                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>Package</th>
                                                    <th>Pool</th>
                                                    <th>Start IP</th>
                                                    <th>End IP</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                if ($package = $con->query("SELECT * FROM radgroupcheck")) {


                                                    while ($rows = $package->fetch_array()) {
                                                        $lstid = $rows["id"];
                                                        $groupname = $rows["groupname"];

                                                        $pool = $con->query("SELECT * FROM pool WHERE name='$groupname'");
                                                        while ($rowp = $pool->fetch_array()) {
                                                            $pname = $rowp["name"];
                                                            $pstrtip = $rowp["start_ip"];
                                                            $pendip = $rowp["end_ip"];
                                                        }
                                                        echo '
                                          <tr>
                                          <td>' . $rows["groupname"] . '</td>
                                          <td>' . $pname . '</td>
                                          <td>' . $pstrtip . '</td>
                                          <td>' . $pendip . '</td>
                                          <td style="text-align:right;">
                                          <a class="btn btn-info" href=""><i class="fas fa-edit"></i></a>
                                          
                                          <a class="btn btn-success" href=""><i class="mdi mdi-eye"></i>
                                          </a>
                                          
                                          </td>
                                          </tr>
                                          ';
                                                    }
                                                    // Free result set
                                                    //$result -> free_result();
                                                }

                                                ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
        $(document).ready(function(e) {
            $("#package_table").DataTable();

            // var nas = "0";
            // $.ajax({
            //     type: "GET",
            //     url: "include/package.php?list",
            //     data: nas,
            //     cache: false,
            //     success: function(packagelist) {
            //         $("#packg-list").html(packagelist);
            //     }
            // });


            //add package

            $("#packg_add").click(function() {

                var pacgdt = $("#package_form").serialize();
                $.ajax({
                    type: "GET",
                    url: "include/package.php?add",
                    data: pacgdt,
                    cache: false,
                    success: function(packagelist) {
                        $("#packg-list").load("include/package.php?list");
                    }
                });


            });





        });
    </script>



</body>

</html>

<?php
if(isset($_GET["ping"]))
{
    $host = $_GET["ping"];
    exec("ping -c 1 " . $host, $output, $result);

        if ($result == 0)
        {
        echo "Ping okay!";
        }
        else
        {
        echo "Ping failed!";
        }



}
        
                          
  ?>

  <?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM `pool` WHERE id=$id ");
	if ($result==true) {
		header("location:pool.php");
	}else{

	}
}


 ?>

 <?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $poolId=$_GET['id'];
    if ($pool=$con->query("SELECT * FROM pool WHERE id='$poolId'")) {
        while($rows=$pool->fetch_array()){
            $id=$rows["id"];
            $name=$rows["name"];
            $startIp=$rows["start_ip"];
            $endIp=$rows["end_ip"];
        }
    }
}


?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
             <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Pool Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">
        
                <div class="page-content">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="container">
                                <div class="col-md-4 m-auto" id="formArea">

                        <h4 class="text-center"><i class="mdi mdi-human-handsup"></i> Update Pool</h4><br>
                        <form id="updatePool">
                                    <input class="d-none" type="text" name="id" value="<?php echo $id; ?>">
                                    <div class="form-group ">
                                        <label><b style="color: green;">Pool Name</b></label>
                                        <input type="text" name="pool-name"
                                            class="form-control"
                                            value="<?php echo $name; ?>" />
                                     </div>
                                     <div class="form-group">
                                        <label><b style="color: green;">Start IP</b></label>
                                        <input type="text" name="start-ip"
                                            class="form-control"
                                            value="<?php echo $startIp; ?>" />
                                     </div>
                                    <div class="form-group">
                                        <label><b style="color: green;">End IP</b></label>
                                        <input type="text" name="end-ip"
                                            class="form-control"
                                            value="<?php echo $endIp; ?>" />
                                    </div><br>

                                    <button id="up_pool_button" type="submit" class="btn btn-success ">Update</button>

                                    <a href="pool.php" type="submit" class="btn btn-danger ">Cancle</a>
                        </form>
                    </div>
                            </div>
                        </div>
                    </div> <!-- container-fluid -->
                </div>
                <!-- End Page-content -->
        
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-6">
                                <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                            </div>
                            <div class="col-sm-6">
                                <div class="text-sm-end d-none d-sm-block">
                                    Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>

            </div>
            <!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>
        
        
        <!-- Peity chart-->
        <script src="assets/libs/peity/jquery.peity.min.js"></script>
        
        <!--C3 Chart-->
        <script src="assets/libs/d3/d3.min.js"></script>
        <script src="assets/libs/c3/c3.min.js"></script> 
        <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
        
        <script src="assets/js/pages/dashboard.init.js"></script>
        
        <script src="assets/js/app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script type="text/javascript">
    $(document).ready(function(){
        $("#up_pool_button").click(function(e){
            e.preventDefault();
            var formData=$("#updatePool").serialize();
            alert("Are Your Sure!");
            $.ajax({
            type:"GET",
            url:"include/pool.php?update",
            data:formData,
            cache:false,
            success:function(){
                Swal.fire(
  'Success!',
  'Data Update Success!',
  'success'
)
                }
           });
        });
    });
</script>
    </body>
</html>
<?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- DataTables -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Responsive datatable examples -->
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
        <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Pool</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Pool</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                              IP Pool</button>
                          </div>
                            </div>
                        </div>
                    </div>






                    <!-- Modal -->
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true" id="addModal">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content col-md-10">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span
                                            class="mdi mdi-lan mdi-18px"></span> &nbsp;IP Pool</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>

                                <div>

            <!--Customer form start-->
            <form id="pool-frm">
                <div>
                    <div class="card">
                        <div class="card-body">

                            <form class="form-sample">

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group ">
                                            <label>Pool Name</label>
                                            <input type="text" name="pool-name"
                                                class="form-control"
                                                placeholder="1-MBPS / 2-MBPS" />

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>IP Block</label>
                                            <input type="text" name="start-ip"
                                                class="form-control"
                                                placeholder="172.16.1.1" />

                                        </div>
                                    </div>

                                    

                                </div>





                            </form>
                        </div>
                    </div>
                </div>

            </form>
            <!--Customer form end-->
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="pool-save">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>








                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">





                                    </div>


                            <div class="table-responsive">
                                <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>NO.</th>
                                            <th>Name</th>
                                            <th>IP Block</th>
                                            
                                            <th class="text-right"></th>
                                        </tr>
                                    </thead>
                                    <tbody >
                                        <?php 

                                       $sql="SELECT * FROM pool";
                                      $result= mysqli_query($con,$sql);
                                      while ($rows=mysqli_fetch_assoc($result)) {
                                        ?> 
                                       <tr>
     <td><?php echo $rows["id"]; ?></td>
     <td><?php echo $rows["name"]; ?></td>
     <td><?php echo $rows["ip_block"]; ?></td>
     
     <td style="text-align:right">
        <a class="btn btn-primary " href="pool_edit.php?id=<?php echo $rows["id"]; ?>"><i class="fas fa-edit"></i></a>

        <a onclick="return confirm('Are you sure');" href="pool_delete.php?id=<?php echo $rows["id"]; ?> "  class="btn btn-danger "><i class="fas fa-trash"></i></a>

        </td>
     </tr> 
                                    <?php } ?>
                                    </tbody>
                                </table>
                            </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<div id="deleteModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box">
                    <i class="fa fa-trash"></i>
                </div>
                <h4 class="modal-title w-100">Are you sure?</h4>
                <h4 class="modal-title w-100 d-none" id="DeleteId"></h4>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
            </div>
            <div class="modal-body">
                <p>Do you really want to delete these records? This process cannot be undone.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
            </div>
        </div>
    </div>
</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>

       <script type="text/javascript">
    $(document).ready(function() {
        $("#pool_table").DataTable();
        $("#pool-list").load("include/pool.php?list");

        $(".deleteId").click(function(){
            var id=$(this).data('id');
            //alert(id);
            $("#deleteModal").modal('show');
            $("#DeleteId").html(id);
            deleteData(id)
        });
        //add package

        $("#pool-save").click(function() {

            var pooldt = $("#pool-frm").serialize();
            $.ajax({
                type: "GET",
                url: "include/pool.php?add",
                data: pooldt,
                cache: false,
                success: function(response) {
                      if(response=1){
                            toastr.success("Pool Create Successfully");
                        location.reload();
                      }else{
                        toastr.error("Please try again");
                      }
                      $("#addModal").modal('hide');
                    $("#pool-list").load("include/pool.php?list");
                }
            });
        });
    });
    function deleteData(deleteId){
        //delete Confirm button
        $("#DeleteConfirm").click(function(){
            //var deleteId=$("#DeleteId").html();
                    $.ajax({
                    type: "GET",
                    url: "include/pool.php?delete",
                    data: {id:deleteId},
                    cache: false,
                    success: function(response) {
                          if(response=1){
                            toastr.success("Pool Delete Successfully");
                          }else{
                            toastr.error("Please try again");
                          }
                          $("#deleteModal").modal('hide');
                        $("#pool-list").load("include/pool.php?list");
                    }
                });
            
        });
    }
    </script>


    </body>
</html>

<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';
include 'include/pop_security.php';

?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title="Area"; include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Area</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg"
                                        style="margin-bottom: 12px;">&nbsp;&nbsp;New
                                        Area</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel"
                        aria-hidden="true" id="addModal">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add Area</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <form id="form-area">
                                                    <div class="form-group mb-1">
                                                        <label>POP</label>
                                                        <select class="form-select" name="pop_id">
                                                            <option>Select</option>
                                                            <?php
                                                            if ($pop = $con->query("SELECT * FROM add_pop WHERE user_type='1'  ")) {
                                                                while ($rows = $pop->fetch_array()) {
                                                                    $id = $rows['id'];
                                                                    $name = $rows['pop'];
                                                            
                                                                    echo '<option value=' . $id . '>' . $name . '</option>';
                                                                }
                                                            }
                                                            
                                                            ?>


                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Area</label>
                                                        <input class="form-control" type="text" name="area"
                                                            placeholder="Type Your Area" id="area" />
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Billing Cycle Date</label>
                                                        <select class="form-select" type="text" id="billing_date" name="billing_date">
                                                            <?php 
                                                            
                                                            for($i=1; $i<30; $i++){
                                                                echo '<option value="'.$i.'">'.$i.'</option>';
                                                            }
                                                            
                                                            ?>
                                                        </select>
                                                    </div>
                                                    <div class="form-group d-none">
                                                        <label>User Type</label>
                                                        <input class="form-control" type="text" name="user_type"
                                                            value="<?php echo $auth_usr_type; ?>" id="user_type" />
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger"data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" id="add_area" class="btn btn-primary">Add Area</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">


                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="areaDataTable" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Area</th>
                                                    <th>Total Customers</th>
                                                    <th>Online</th>
                                                    <th>Expired</th>
                                                    <th>POP/Branch Name</th>
                                                    <th>Billing Cycle</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="areaList">
                                            <?php 

if (!empty($_GET['pop_id'])) {
    $pop_id = (int)$_GET['pop_id'];
} else if (!empty($auth_usr_POP_id)) {
    $pop_id = (int)$auth_usr_POP_id;
} else {
    $pop_id = null; 
}

if ($pop_id !== null) {
    $sql_con = "SELECT * FROM area_list WHERE pop_id = $pop_id";
} else {
    $sql_con = "SELECT * FROM area_list"; 
}

$result = mysqli_query($con, $sql_con);

while ($rows2 = mysqli_fetch_assoc($result)) {
    $areaID = $rows2['id'];
    ?>

    <tr>
        <td><?php echo $areaID; ?></td>
        <td><?php echo htmlspecialchars($rows2['name']); ?></td>
        <td>
            <?php
            $totalcust = $con->query("SELECT COUNT(*) as total FROM customers WHERE area = '$areaID'");
            $area_cust = $totalcust->fetch_assoc()['total'];
            echo $area_cust;
            ?>
        </td>
        <td>
            <?php
             $sql = "SELECT radacct.username FROM radacct
             INNER JOIN customers
             ON customers.username=radacct.username
             
             WHERE customers.area='$areaID' AND radacct.acctstoptime IS NULL";
             $countpoponlnusr = mysqli_query($con, $sql);

             echo $countpoponlnusr->num_rows;
            ?>
        </td>

        <td>
            <?php
            $totalexcust = $con->query("SELECT COUNT(*) as expired FROM customers WHERE area = '$areaID' AND expiredate < NOW()");
            $area_excust = $totalexcust->fetch_assoc()['expired'];
            echo '<a href="customer_expire.php?area_id=' . $areaID . '"><span class="badge bg-danger">' . $area_excust . '</span></a>';
            ?>
        </td>

        <td>
            <?php
            $popID = $rows2['pop_id'];
            $get = $con->query("SELECT pop FROM add_pop WHERE id = $popID");
            if ($rows3 = $get->fetch_assoc()) {
                echo htmlspecialchars($rows3['pop']);
            }
            ?>
        </td>
        <td>
            <?php 
            $final_data= $rows2['billing_date'] ?? 0;
            if($final_data > 0){
                echo '<span class="badge bg-success">'.$final_data.'</span></span>';
            }else{
                echo '<span class="badge bg-danger">'.$final_data.'</span></span>';
            }
            ?>
        </td>

        <td style="text-align:right;">
            <a class="btn btn-info" href="area_edit.php?id=<?php echo $areaID; ?>">
                <i class="fas fa-edit"></i>
            </a>
            <a class="btn btn-success" href="view_area.php?id=<?php echo $areaID; ?>">
                <i class="fas fa-eye"></i>
            </a>
        </td>
    </tr>

<?php } ?>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->




    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 d-none" id="DeleteId"></h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $("#areaDataTable").DataTable();
        $("#add_area").click(function() {
            var area = $("#area").val();
            var billing_date = $("#billing_date").val();
            if (area.length == 0) {
                toastr.error("Area name is require");
            }else if(billing_date.length==0){
                toastr.error("Billing Cycle Date is require");
            } 
            else {
                var formData = $("#form-area").serialize();
                $.ajax({
                    type: "GET",
                    data: formData,
                    url: "include/add_area.php?add",
                    cache: false,
                    success: function(data) {
                        toastr.success(data);
                        $("#addModal").modal('hide');
                        $("#areaDataTable").DataTable();
                        setTimeout(() => {
                            location.reload();
                        }, 1000);
                    }
                });
            }


        });
    </script>

</body>

</html>
<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
error_reporting(E_ALL);

if (isset($_GET['inactive'])) {
    if ($_GET['inactive'] == 'true') {
        $popID = $_GET['pop'];

        $custmrs = $con->query("SELECT * FROM customers WHERE pop=$popID");
        while ($rowsct = mysqli_fetch_assoc($custmrs)) {
            $custmr_usrname = $rowsct['username'];

            // Deleting users from Radius user list
            $con->query("DELETE FROM radcheck WHERE username = '$custmr_usrname'");
            $con->query("DELETE FROM radreply WHERE username = '$custmr_usrname'");
            $con->query("UPDATE customers SET status='0' WHERE username='$custmr_usrname'");
            $con->query("UPDATE add_pop SET status='0' WHERE id='$popID'");
        }

        header('Location: ' . $_SERVER['PHP_SELF']);
        die();
    } elseif ($_GET['inactive'] == 'false') {
        $popID = $_GET['pop'];

        $custmrs = $con->query("SELECT * FROM customers WHERE pop=$popID");
        while ($rowsct = mysqli_fetch_assoc($custmrs)) {
            $custmr_usrname = $rowsct['username'];
            $custmr_password = $rowsct['password'];
            $custmr_package = $rowsct['package_name'];

            // Deleting users from Radius user list
            $con->query("INSERT INTO radcheck(username,attribute,op,value) VALUES('$custmr_usrname','Cleartext-Password',':=','$custmr_password')");
            $con->query("INSERT INTO radreply (username,attribute,op,value) VALUES('$custmr_usrname','MikroTik-Group',':=','$custmr_package')");
            $con->query("UPDATE customers SET status='1' WHERE username='$custmr_usrname'");
            $con->query("UPDATE add_pop SET status='1' WHERE id='$popID'");
        }

        header('Location: ' . $_SERVER['PHP_SELF']);
        die();
    }
}

?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
    <!-- <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->

    <style>
        
      
    
    </style>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php
        $page_title = 'POP/Branch';
        
        include 'Header.php';
        
        ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">POP/Branch</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        data-bs-toggle="modal" data-bs-target="#addModal"
                                        style="margin-bottom: 12px;">&nbsp;&nbsp;New
                                        POP/Branch</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade " tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true"
                        id="addModal">
                        <div class="modal-dialog" role="document">
                            <form action="include/popBranch.php?add_pop=true" method="POST"
                                enctype="multipart/form-data">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Add POP/Branch</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12 d-flex">
                                                    <div class="col-md-6" style="margin-right:9px">
                                                        <div class="form-group mb-3">
                                                            <label>POP/Branch</label>
                                                            <input class="form-control" type="text" name="pop"
                                                                id="pop" placeholder="Type Your POP/Branch" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group mb-3">
                                                            <label>Incharge Fullname</label>
                                                            <input class="form-control" type="text" name="fullname"
                                                                id="fullname" placeholder="Type Your fullname" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 d-flex">
                                                    <div class="col-md-6" style="margin-right:9px">
                                                        <div class="form-group mb-3">
                                                            <label>Incharge Username</label>
                                                            <input class="form-control" type="text" name="username"
                                                                id="username" placeholder="Enter username" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group mb-3">
                                                            <label>Incharge Password</label>
                                                            <input class="form-control" type="password" name="password"
                                                                id="password" placeholder="Enter Your Password" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 d-flex">
                                                    <div class="col-md-6" style="margin-right:9px">
                                                        <div class="form-group mb-3">
                                                            <label>Opening Balance</label>
                                                            <input class="form-control" type="text"
                                                                name="opening_bal" id="opening_bal"
                                                                placeholder="Enter Balance" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6" style="margin-right:5px">
                                                        <div class="form-group mb-3">
                                                            <label>Mobile Number</label>
                                                            <input class="form-control" type="text"
                                                                name="mobile_num1"
                                                                placeholder="Enter Your Mobile Number"
                                                                id="mobile_num1" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 d-flex">
                                                    <div class="col-md-6" style="margin-right:9px">
                                                        <div class="form-group mb-3">
                                                            <label>Mobile Number 2</label>
                                                            <input class="form-control" type="text"
                                                                name="mobile_num2" id="mobile_num2"
                                                                placeholder="Enter Mobile No" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group mb-3">
                                                            <label>Email Address</label>
                                                            <input class="form-control" type="email"
                                                                name="email_address" placeholder="Enter Email Address"
                                                                id="email_address" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 ">
                                                    <div class="form-group mb-3">
                                                        <label>Note</label>
                                                        <textarea id="note" placeholder="Enter Your Text" class="form-control" rows="4" cols="50"></textarea>

                                                    </div>
                                                    <input class="d-none" type="text" id="user_type"
                                                        name="user_type" value="<?php echo $auth_usr_type; ?>">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="reset" class="btn btn-danger">Reset</button>
                                        <button type="submit" class="btn btn-primary">Add POP/Branch</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>POP/Branch</th>
                                                    <th></th>
                                                    <th>Total Users</th>
                                                    <th>Online Users</th>
                                                    <th>Expired Users</th>
                                                    <th>Total Due</th>
                                                    <th>Available Balance</th>
                                                    <th>Action</th>
                                                    <th>Active</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
        $result =$con->query("SELECT * FROM add_pop WHERE user_type='$auth_usr_type'");
        while ($rows = mysqli_fetch_assoc($result)) {
            $popId = $rows['id']; 
            $customer_changes = [];
            
            for ($i = 5; $i >= 0; $i--) {
                $month_year = date('Y-m', strtotime("-$i month"));
                 $result_customers = $con->query("SELECT * FROM customers WHERE pop='$popId' AND createdate LIKE '$month_year%'");
                $countconn = mysqli_num_rows($result_customers);

                $customer_changes[] = $countconn;
            }
            if (count($customer_changes) < 6) {
                $customer_changes = array_pad($customer_changes, 6, 0);
            }
            $chart_data = implode(',', $customer_changes);
        ?>

                                                <tr>
                                                    <td><?php echo $popId; ?></td>
                                                    <td>
                                                        <a href="view_pop.php?id=<?php echo $popId; ?>"
                                                            class="text-dark text-truncate" style="max-width: 150px;">
                                                            <?php echo substr($rows['pop'], 0, 15); ?>
                                                        </a>
                                                    </td>
                                                    <td>
    <canvas id="chart-<?php echo $popId; ?>" width="300 !important" height="100 !important"></canvas>
    <script>
        let ctx<?php echo $popId; ?> = document.getElementById("chart-<?php echo $popId; ?>").getContext("2d");

        new Chart(ctx<?php echo $popId; ?>, {
            type: "bar", 
            data: {
                labels: ["6 Month", "5 Month", "4 Month", "3 Month", "2 Month", "1 Month"],
                datasets: [{
                    label: "New Customers",
                    data: [<?php echo implode(',', $customer_changes); ?>], 
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4CAF50", "#FF9800", "#9C27B0"],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: { display: false } 
                },
                responsive: true,
              
                scales: {
                    x: { display: false }, 
                    y: { display: false }
                }
            }
        });
    </script>
</td>




                                                    <td>
                                                        <?php
                                                        $pop_usr = $con->query("SELECT * FROM customers WHERE pop='$popId'");
                                                        echo $pop_usr->num_rows;
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT radacct.username FROM radacct
                                                                                INNER JOIN customers ON customers.username=radacct.username
                                                                                WHERE customers.pop='$popId' AND radacct.acctstoptime IS NULL";
                                                        $countpoponlnusr = mysqli_query($con, $sql);
                                                        echo $countpoponlnusr->num_rows;
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE pop='$popId' AND NOW() > expiredate";
                                                        $countxprd = mysqli_query($con, $sql);
                                                        $totalexprs = $countxprd->num_rows;
                                                        echo $totalexprs == 0 ? $totalexprs : "<span class='badge bg-danger'>$totalexprs</span>";
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $pop_payment = $con->query("SELECT SUM(amount) AS balance FROM pop_transaction WHERE pop_id=$popId");
                                                        $totalAmount = $pop_payment->fetch_array()['balance'];
                                                        
                                                        $paidAmount = $con->query("SELECT SUM(paid_amount) AS amount FROM pop_transaction WHERE pop_id=$popId")->fetch_array()['amount'];
                                                        echo round($totalAmount - $paidAmount);
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $allTransactionAmount = $con->query("SELECT SUM(amount) AS balance FROM pop_transaction WHERE pop_id=$popId")->fetch_array()['balance'];
                                                        $allCustomerAmount = $con->query("SELECT SUM(purchase_price) AS recharge_amount FROM customer_rechrg WHERE pop_id=$popId")->fetch_array()['recharge_amount'];
                                                        echo round($allTransactionAmount - $allCustomerAmount);
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <span>
                                                            <?php
                                                            $pop_status = $rows['status'];
                                                            if ($pop_status == '0') {
                                                                echo '<a href="?inactive=false&pop=' . $popId . '">Active</a>';
                                                            } elseif ($pop_status == '1') {
                                                                echo '<a href="?inactive=true&pop=' . $popId . '">Inactive</a>';
                                                            }
                                                            ?>
                                                        </span>
                                                    </td>
                                                    <td style="text-align:right">
                                                        <input disabled="disabled" class="form-check form-switch"
                                                            type="checkbox" onchange="popAction()"
                                                            id="<?php echo $popId; ?>" value="id=<?php echo $popId; ?>"
                                                            switch="bool" <?php echo $checkd; ?>>
                                                        <label class="form-label" for="<?php echo $popId; ?>"
                                                            data-on-label="Yes" data-off-label="No"></label>
                                                    </td>
                                                    <td style="text-align:right">
                                                        <a class="btn-sm btn btn-success"
                                                            href="view_pop.php?id=<?php echo $rows['id']; ?>"><i
                                                                class="mdi mdi-eye"></i></a>
                                                        <a class="btn-sm btn btn-info"
                                                            href="pop_edit.php?id=<?php echo $rows['id']; ?>"><i
                                                                class="fas fa-edit"></i></a>
                                                    </td>
                                                </tr>

                                                <?php } ?>

                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php
            include 'Footer.php';
            
            ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <?php include 'script.php'; ?>
    <!-- JavaScript -->

    <!-- Peity chart-->

    <!-- <script src="assets/libs/peity/jquery.peity.min.js"></script>
    <script src="assets/js/pages/chartjs.init.js"></script>
    <script src="assets/js/pages/peity.init.js"></script> -->
    
    <script type="text/javascript">
        $(document).ready(function() {
           /** Bar chart**/
            $(".peity-bar").peity("bar");
            
            $('.tooltip-data').each(function() {
        var tooltipContent = $(this).data('title').split(',').join('<br>');
        $(this).attr('title', tooltipContent);
    });
            /**  Add POP/Branch**/
            $('#addModal form').submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $('#addModal').modal('hide');
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else if (response.success == false) {
                            toastr.error(response.message);
                        } else {
                            toastr.error(response.message);
                        }
                    },


                    error: function(xhr, status, error) {
                        /** Handle  errors **/
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        }
                    }
                });
            });
            // var ctx = document.getElementById('bar').getContext('2d');
            // var chart = new Chart(ctx, {
            //     type: 'bar',
            //     data: {
            //         labels: ['6 Months', '5 Months', '4 Months', '3 Months', '2 Months', '1 Month'],
            //         datasets: [{
            //             label: '',
            //             data: [11, 19, 13, 15, 12, 14],
            //             backgroundColor: 'rgba(75, 192, 192, 0.2)', 
            //             borderWidth: 2,
            //             fill: false
            //         }]
            //     },
            //     options: {
            //         responsive: true,
            //         scales: {
            //             y: {
            //                 beginAtZero: true
            //             }
            //         }
            //     }
            // });
        });
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $popId=$_GET['id'];
    if ($POP=$con->query("SELECT * FROM add_pop WHERE id='$popId'")) {
        while($rows=$POP->fetch_array()){
            $id=$rows["id"];
            $popName=$rows["pop"];
            $fullname=$rows["fullname"];
            $username=$rows["username"];
            $password=$rows["password"];
            $opening_bal=$rows["opening_bal"];
            $mobile_num1=$rows["mobile_num1"];
            $mobile_num2=$rows["mobile_num2"];
            $email_address=$rows["email_address"];
            $note=$rows["note"];
        }
    }
}


?>



<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php'; ?>
    </head>

    <body data-sidebar="dark">


       

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <?php $page_title="Update POP/Branch";  include 'Header.php'; ?>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
        <div class="row">
    <div class="col-md-8 m-auto">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Update POP/Branch</h5>
            </div>
            <div class="card-body">
                <form action="#" id="updatePop">
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="pop">POP/Branch Name</label>
                                <input type="text" class="form-control" id="pop" name="pop" value="<?php echo $popName; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="fullname">Full Name</label>
                                <input type="text" class="form-control" id="fullname" name="fullname" value="<?php echo $fullname; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="username">Username</label>
                                <input type="text" class="form-control" id="username" name="username" value="<?php echo $username; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="password">Password</label>
                                <input type="text" class="form-control" id="password" name="password" value="<?php echo $password; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="opening_bal">Opening Balance</label>
                                <input type="text" class="form-control" id="opening_bal" name="opening_bal" value="<?php echo $opening_bal; ?>">
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="mobile_num1">Mobile Number 1</label>
                                <input type="text" class="form-control" id="mobile_num1" name="mobile_num1" value="<?php echo $mobile_num1; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="mobile_num2">Mobile Number 2</label>
                                <input type="text" class="form-control" id="mobile_num2" name="mobile_num2" value="<?php echo $mobile_num2; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="email_address">Email Address</label>
                                <input type="text" class="form-control" id="email_address" name="email_address" value="<?php echo $email_address; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <label for="note">Note</label>
                                <input type="text" class="form-control" id="note" name="note" value="<?php echo $note; ?>">
                            </div>
                            <div class="form-group mb-3">
                                <input type="hidden" name="id" value="<?php echo $id; ?>">
                                <button type="submit" class="btn btn-success" id="up_pop_button" style="margin-top: 20px;">Update POP/Branch</button>
                                <button onclick="history.back();" type="button" class="btn btn-danger" style="margin-top: 20px;">Back</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

        </div> <!-- container -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php'; ?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

      

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <?php include 'script.php';?>
      <script type="text/javascript">
       $(document).ready(function () {
                $("#up_pop_button").click(function (e) {
                e.preventDefault();
                var formData = $("#updatePop").serialize();

                $.ajax({
                    type: "POST",
                    url: "include/add_pop.php?update", 
                    data: formData,
                    cache: false,
                    dataType: 'json',
                    beforeSend: function () {
                        $("#up_pop_button").prop("disabled", true).text("Updating...");
                    },
                    success: function (response) {
                        $("#up_pop_button").prop("disabled", false).text("Update POP/Branch");

                        if (response.status) {
                            toastr.success(response.message);
                        } else {
                            toastr.error(response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error: ' + error);
                        $("#up_pop_button").prop("disabled", false).text("Update POP/Branch");
                        toastr.error("An error occurred while updating the data.");
                    }
                });
            });
        });

    </script>
    </body>
</html>

<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM `products` WHERE id=$id ");
	if ($result==true) {
		header("location:product.php");
	}else{

	}
}


 ?>
 <?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

if (isset($_GET['id'])) {
    $userId = $_GET['id'];

    if ($product = $con->query("SELECT * FROM products WHERE id='$userId'")) {
        while ($rows = $product->fetch_array()) {
            $id = $rows["id"];
            $pd_name = $rows["name"];
            $category = $rows["category"];
            $brand = $rows["brand"];
            $p_ac = $rows["purchase_ac"];
            $sales_ac = $rows["sales_ac"];
            $unitId = $rows["unit_id"];
            $p_price = $rows["purchase_price"];
            $s_price = $rows["sale_price"];
            $store = $rows["store"];
            $note = $rows["note"];
            $qty = $rows['qty'];
        }
    }
}

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">
        
          <?php $page_title="Product Update"; include 'Header.php';?>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12 grid-margin">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                            <div class="mr-md-3 mr-xl-5">


                                <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Product/Update</p>
                                </div>


                            </div>
                            <br>


                        </div>
                    </div>
                </div>
            </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                            <form action="include/product_server.php?update_product" id="productUpdateForm" enctype="multipart/form-data" method="post">
                            <input type="hidden" name="product_id" id="product_id" value="<?php echo $id; ?>">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <!-- Product Name -->
                                            <div class="form-group mb-4">
                                                <label for="product_name">Product Name</label>
                                                <input type="text" class="form-control" name="product_name" id="product_name" value="<?php echo $pd_name; ?>" placeholder="Enter Product Name" required>
                                            </div>
                                        </div>
                                        <div class="col">
                                           <!-- Brand -->
                                            <div class="form-group mb-4">
                                                <label for="brand_id">Brand</label>
                                                <select id="brand_id" class="form-select" name="brand" required>
                                                    <option value="">---Select---</option>
                                                    <?php 
                                                        if ($brands = $con->query("SELECT * FROM product_brand")) {
                                                            while($row = $brands->fetch_array()){
                                                                $selected = ($row['id'] == $brand) ? 'selected' : '';

                                                                echo '<option value="'.$row['id'].'" '.$selected.'>'.$row['name'].'</option>';
                                                            }
                                                        }
                                                    ?>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group mb-4">
                                                <label for="">Category</label>
                                                <select id="category" class="form-select" name="category" required>
                                                <option value="">---Select---</option>
                                                <?php 
                                                    if ($categories = $con->query("SELECT * FROM product_cat")) {
                                                        while($row = $categories->fetch_array()){
                                                            $selected = ($row['id'] == $category) ? 'selected' : '';
                                                            echo '<option value="'.$row['id'].'" '.$selected.'>'.$row['name'].'</option>';
                                                        }
                                                    }
                                                ?>
                                                        

                                                    </select>
                                            </div>
                                        </div>
                                    </div>

                                

                                <div class="row">

                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label>Purchase A/C</label>
                                            <select id="purchase_ac" type="text" class="form-control"name="purchase_ac" required>
            <?php
                if ($ledgr = $con->query("SELECT * FROM ledger WHERE `mstr_ledger_id`=2")) {
                    echo '<option value="">Select</option>';
                    while ($rowsitm = $ledgr->fetch_array()) {
                        $ldgritmsID = $rowsitm["id"];
                        $ledger_name = $rowsitm["ledger_name"];
                        echo '<optgroup label="' . $ledger_name . '">';
                        if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                            while ($rowssb = $ledgrsubitm->fetch_array()) {
                                $selected = ($rowssb['id'] == $p_ac) ? 'selected' : '';
                                echo '<option value="' . $rowssb['id'] . '" '.$selected.'>' . $rowssb['item_name'] . '</option>';
                            }
                        }
                        echo '</optgroup>';
                    }
                }
            ?>
                                            </select>
                                        </div>
                                    </div>            
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label>Sales Account</label>
                                            <select type="text" id="sales_ac" class="form-control" name="sales_ac" required>
                <?php
                    if ($ledgr = $con->query("SELECT * FROM ledger WHERE `mstr_ledger_id`=1")) {
                        echo '<option value="">Select</option>';
                        while ($rowsitm = $ledgr->fetch_array()) {
                            $ldgritmsID = $rowsitm["id"];
                            $ledger_name = $rowsitm["ledger_name"];
                            echo '<optgroup label="' . $ledger_name . '">';
                            if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                while ($rowssb = $ledgrsubitm->fetch_array()) {
                                    $selected = ($rowssb['id'] == $sales_ac) ? 'selected' : '';
                                    echo '<option value="' . $rowssb['id'] . '" '.$selected.'>' . $rowssb['item_name'] . '</option>';
                                }
                            }
                            echo '</optgroup>';
                        }
                    }
                ?>
                                            </select>
                                        </div>
                                    </div>            
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label>Unit</label>
                                            <select type="text" id="unit_id" class="form-select" name="unit_id" style="width: 100%;" required>
                                            <?php
                                                if ($all_data = $con->query("SELECT id,unit_name FROM units")) {
                                                    echo '<option value="">Select</option>';

                                                    while ($rowsitm = $all_data->fetch_array()) {
                                                        $unit_id = $rowsitm["id"];
                                                        $unit_name = $rowsitm["unit_name"];
                                                        $selected = ($rowsitm['id'] == $unitId) ? 'selected' : '';
                                                        echo '<option ' . $selected . ' value="' . $unit_id . '">' . $unit_name . '</option>';

                                                    }
                                                }
                                                ?>
                                            </select>
                                        </div>
                                    </div>            
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Purchase Price</label>
                                            <input type="number" class="form-control" id="p_price" name="p_price" value="<?php echo $p_price; ?>" placeholder="Enter Purchase Price" required/>
                                        </div>
                                    </div>            
                                    
                                </div>


                                


                                <div class="row">
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Sale's Price</label>
                                            <input type="number" class="form-control" id="s_price" name="s_price" value="<?php echo $s_price; ?>" placeholder="Enter Sale's Price" required/>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Store</label>
                                            <select id="store" class="form-select" name="store">
                                                <option value="">---Select---</option>
                                                <?php 
                                                    if ($stores = $con->query("SELECT * FROM store")) {
                                                        while($row = $stores->fetch_array()){
                                                            $selected = ($row['id'] == $store) ? 'selected' : '';
                                                            echo '<option value="'.$row['id'].'" '.$selected.'>'.$row['name'].'</option>';
                                                        }
                                                    }
                                                ?>
                                                        

                                                    </select>       
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Remarks</label>
                                            <input type="text" class="form-control" id="note"  name="note" placeholder="Enter Your Note" value="<?php echo $note; ?>"/>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group mb-4">
                                            <label for="">Quantity</label>
                                            <input type="text" class="form-control" id="qty"  name="qty" placeholder="Enter Quantity" value="<?php echo $qty; ?>"/>
                                        </div>
                                    </div>
                                </div>



                                </div>
                                <div class="card-footer">
                                    <button type="button" onclick="history.back();" class="btn btn-danger">Back</button>
                                    <button type="submit" class=" btn btn-success">Update Now</button>
                                </div>
                                </form>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php';?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

       

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
   <?php include 'script.php';?>
    <script type="text/javascript">
       $("#brand_id").select2();
       $("#category").select2();
       $("#sales_ac").select2();
       $("#purchase_ac").select2();
       $("#unit_id").select2();
       
    /** Store The data from the database table **/
        $(document).ready(function(){
            $('#productUpdateForm').on('submit', function(e){
                e.preventDefault();

                var formData = new FormData(this);

                $.ajax({
                    url: $(this).attr('action'),
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        var result = JSON.parse(response);
                        if (result.success) {
                            toastr.success(result.message);
                        } else {
                            toastr.error(result.message);
                        }
                    },
                    error: function() {
                        toastr.error("Error occurred during the request.");
                    }
                });
            });
        });
 
    </script>

    </body>
</html>

<?php
include 'include/db_connect.php';
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/pop_security.php';
if (isset($_GET['id'])) {
    $productId = $_GET['id'];
    if ($product = $con->query("SELECT * FROM products WHERE id='$productId'")) {
        while ($rows = $product->fetch_array()) {
            $id = $rows['id'];
            $pd_name = $rows['name'];
            $desc = $rows['description'];
            $category = $rows['category'];
            $brand = $rows['brand'];
            $p_ac = $rows['purchase_ac'];
            $sales_ac = $rows['sales_ac'];
            $p_price = $rows['purchase_price'];
            $s_price = $rows['sale_price'];
            $store = $rows['store'];
        }
    }
}
?>
<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?= include 'style.php' ?>

</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Product Profile';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row gutters-sm">
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <img class="img-fluid"
                                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTSkdGbj-QrUuNqhXP7DtY3-t8yD6H1Tk4uFg&s">
                            </div>
                            <div class="card mt-3">
                                <div class="card-title text-center mt-1">
                                    <h5>About This Product</h5>
                                </div>
                                <div class="card-body">
                                    <p>this is the nast timethis is the nast timethis is the nast timethis is the nast
                                        timethis is the nast timethis is the nast timethis is the nast time</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Product Name:</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php echo $pd_name; ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Category</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php
                                            
                                            if ($categories = $con->query("SELECT * FROM product_cat WHERE id= '$category' ")) {
                                                while ($row = $categories->fetch_array()) {
                                                    echo $row['name'];
                                                }
                                            }
                                            
                                            ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Brand</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php
                                            if ($brands = $con->query("SELECT * FROM product_brand WHERE id= '$brand' ")) {
                                                while ($row = $brands->fetch_array()) {
                                                    echo $row['name'];
                                                }
                                            }
                                            ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Purchase Account No:</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php
                                            if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE id='$p_ac'")) {
                                                while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                    echo $rowssb['item_name'];
                                                }
                                            }
                                            ?>
                                        </div>
                                    </div>
                                    <hr>

                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Sales Account:</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php
                                            if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE id='$sales_ac'")) {
                                                while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                    echo $rowssb['item_name'];
                                                }
                                            }
                                            ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Purchase Price:</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php echo $p_price; ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Sale's Price:</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php echo $s_price; ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <h6 class="mb-0">Store</h6>
                                        </div>
                                        <div class="col-sm-9 text-secondary">
                                            <?php
                                            if ($allstore = $con->query("SELECT `name` FROM store WHERE id='$store'")) {
                                                while ($rowssb = $allstore->fetch_array()) {
                                                    echo $rowssb['name'];
                                                }
                                            }
                                            
                                            ?>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="card">
                                            <div class="card-body">
                                            <!-- Nav tabs -->
                                             <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                                                <li class="nav-item">
                                                   <button class="nav-link active" data-bs-toggle="tab" href="#purchase_history" role="tab">
                                                   <span class="d-none d-md-block">Purchase History</span><span class="d-block d-md-none">Purchase History</span>
                                                   </button>
                                                </li>
                                                <li class="nav-item">
                                                   <button class="nav-link" data-bs-toggle="tab" href="#sales_history" role="tab">
                                                   <span class="d-none d-md-block">Sales History
                                                   </span><span class="d-block d-md-none">Sales History</span>
                                                   </button>
                                                </li>
                                             </ul>
                                             <!-- Tab panes -->
                                             <div class="tab-content">
                                                <div class="tab-pane p-3 tab-pane p-3 active" id="purchase_history" role="tabpanel">
                                                    <div class="table table-responsive">
                                                    <table id="purchase_history_table" class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                        <thead>
                                                            <tr>
                                                                <th>Invoice id</th>
                                                                <th>Supplier Name</th>
                                                                <th>Quantity</th>
                                                                <th>Invoice Date</th>
                                                                <th>Create Date</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        <?php
        $sales_invoices = $con->query("SELECT * FROM purchase_details WHERE product_id='$productId' AND status='1'");
        while ($row = $sales_invoices->fetch_assoc()) {
            $purchase_invoice_id = $row['invoice_id'];
            $product_quantity = $row['qty'];

            $query = "SELECT * FROM purchase WHERE id=$purchase_invoice_id";
            $result = mysqli_query($con, $query);

            if (mysqli_num_rows($result) > 0) {
                while ($rows = mysqli_fetch_assoc($result)) {
                    echo "<tr>";
                    echo "<td>" . $rows['id'] . "</td>";

                    echo "<td>";
                    $client_id = $rows['client_id'];
                    $allCustomerData = $con->query("SELECT * FROM suppliers WHERE id=$client_id");
                    while ($client_loop = $allCustomerData->fetch_array()) {
                        echo '<a href="supplier_profile.php?clid=' . $client_id . '">' . $client_loop['fullname'] . '</a>';
                    }
                    echo "</td>";

                    echo "<td>" . $product_quantity . "</td>";

                    /*Display Invoice Date*/ 
                    echo "<td>";
                    $date = $rows['date'];
                    $formatted_date = date("d F Y", strtotime($date));
                    echo $formatted_date;
                    echo "</td>";

                    /* Display Create Date*/
                    echo "<td>" . (!empty($rows['created_at']) ? date("d F Y", strtotime($rows['created_at'])) : $rows['created_at']) . "</td>";

                    /*Display Action buttons*/ 
                    echo "<td>";
                    echo '<a class="btn-sm btn btn-success" style="margin-right: 5px;" href="invoice/purchase_inv_view.php?clid=' . $rows['id'] . '"><i class="fas fa-eye"></i></a>';
                    echo "</td>";

                    echo "</tr>";
                }
            }
        }
        ?>
                                                        </tbody>
                                                    </table>
                                                    </div>
                                                </div>
                                                <div class="tab-pane p-3" id="sales_history" role="tabpanel">
                                                    <div class="table table-responsive">
                                                    <table id="sales_history_table" class="table table-bordered dt-responsive nowrap"
       style="border-collapse: collapse; border-spacing: 0; width: 100%;">
    <thead>
        <tr>
            <th>Invoice id</th>
            <th>Customer Name</th>
            <th>Quantity</th>
            <th>Invoice Date</th>
            <th>Create Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <?php
        $sales_invoices = $con->query("SELECT * FROM sales_details WHERE product_id='$productId' AND status='1'");
        while ($row = $sales_invoices->fetch_assoc()) {
            $sales_invoice_id = $row['invoice_id'];
            $product_quantity = $row['qty'];

            $query = "SELECT * FROM sales WHERE id=$sales_invoice_id";
            $result = mysqli_query($con, $query);

            if (mysqli_num_rows($result) > 0) {
                while ($rows = mysqli_fetch_assoc($result)) {
                    echo "<tr>";
                    echo "<td>" . $rows['id'] . "</td>";

                    /* Display Customer Name*/
                    echo "<td>";
                    $client_id = $rows['client_id'];
                    $allCustomerData = $con->query("SELECT * FROM clients WHERE id=$client_id");
                    while ($client_loop = $allCustomerData->fetch_array()) {
                        echo '<a href="client_profile.php?clid=' . $client_id . '">' . $client_loop['fullname'] . '</a>';
                    }
                    echo "</td>";

                    /* Display Product Quantity in this invoice*/
                    echo "<td>" . $product_quantity . "</td>";

                    /*Display Invoice Date*/ 
                    echo "<td>";
                    $date = $rows['date'];
                    $formatted_date = date("d F Y", strtotime($date));
                    echo $formatted_date;
                    echo "</td>";

                    /*Display Create Date*/ 
                    echo "<td>" . (!empty($rows['created_at']) ? date("d F Y", strtotime($rows['created_at'])) : $rows['created_at']) . "</td>";

                    /* Display Action buttons*/
                    echo "<td>";
                    echo '<a class="btn-sm btn btn-success" style="margin-right: 5px;" href="invoice/sales_inv_view.php?clid=' . $rows['id'] . '"><i class="fas fa-eye"></i></a>';
                    echo "</td>";

                    echo "</tr>";
                }
            }
        }
        ?>
    </tbody>
</table>

                                                    </div>
                                                </div>
                                             </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>




                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php'; ?>

    </div>
    <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $("#purchase_history_table").DataTable();
        $("#sales_history_table").DataTable();

        $(document).ready(function() {
            $("#update_button").click(function(e) {
                e.preventDefault();
                var formData = $("#update_product").serialize();
                $.ajax({
                    type: "GET",
                    url: "include/product.php?update",
                    data: formData,
                    cache: false,
                    success: function() {
                        $("#alertMsg").show();
                        setTimeout(function() {
                            $("#alertMsg").hide();
                        }, 5000);
                    }
                });
            });
        });
    </script>

</body>

</html>
<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/users_right.php");
include("include/pop_security.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">


       

        <!-- Begin page -->
        <div id="layout-wrapper">
        
           <?php $page_title="Products"; include 'Header.php';?>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
               <div class="col-md-12 grid-margin">
                  <div class="d-flex justify-content-between flex-wrap">
                     <div class="d-flex align-items-end flex-wrap">
                        <div class="mr-md-3 mr-xl-5">
                           <div class="d-flex">
                              <i class="mdi mdi-home text-muted hover-cursor"></i>
                              <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                              </p>
                              <p class="text-primary mb-0 hover-cursor">Products</p>
                           </div>
                        </div>
                        <br>
                     </div>
                     <div class="d-flex justify-content-between align-items-end flex-wrap">
                         <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"data-bs-toggle="modal" data-bs-target="#addproductModal" style="margin-bottom: 12px;">&nbsp;&nbsp;&nbsp;New Product</button> 
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
                     <div class="col-md-12 stretch-card">
                        <div class="card">
                           <div class="card-body">
                              <div class="col-md-6 float-md-right grid-margin-sm-0">
                                 <div class="form-group">
                                    
                                 </div>
                              </div>
                              <div class="table-responsive">
                                 <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                       <tr>
                                          <th>ID</th>
                                          <th>Product Name</th>
                                          <th>Purchase Price</th>
                                          <th>Sale Price</th>
                                          <th>unit</th>
                                          <th>Store</th>
                                          <th>Quantity</th>
                                          <th></th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       
                                        <?php
                                        
                                        $sql = "SELECT  p.id, 
                                        p.name, 
                                        p.purchase_price, 
                                        p.sale_price, 
                                        u.unit_name,
                                        s.name AS store_name, 
                                        IFNULL(purchase_qty.total_purchase_qty, 0) - IFNULL(sale_qty.total_sale_qty, 0) AS current_qty
                                    FROM 
                                        products p
                                    LEFT JOIN 
                                        units u ON p.unit_id = u.id
                                    LEFT JOIN 
                                        store s ON p.store = s.id
                                    LEFT JOIN 
                                        (SELECT product_id, SUM(qty) AS total_purchase_qty 
                                         FROM purchase_details 
                                         WHERE status = 1  --     
                                         GROUP BY product_id) AS purchase_qty 
                                        ON p.id = purchase_qty.product_id
                                    LEFT JOIN 
                                        (SELECT product_id, SUM(qty) AS total_sale_qty 
                                         FROM sales_details 
                                         WHERE status = 1  --     
                                         GROUP BY product_id) AS sale_qty 
                                        ON p.id = sale_qty.product_id";
                            
                            $result = mysqli_query($con, $sql);
                            
                            while ($rows = mysqli_fetch_assoc($result)) {
                            ?>
                            
                                <tr>
                                    <td><?php echo $rows['id']; ?></td>
                                    <td><a href="product_profile.php?id=<?php echo $rows['id']; ?>"><?php echo $rows['name']; ?></a></td>
                                    <td><?php echo $rows['purchase_price']; ?></td>
                                    <td><?php echo $rows['sale_price']; ?></td>
                                    <td><?php echo $rows['unit_name']; ?></td>
                                    <td><?php echo $rows['store_name']; ?></td>
                                    <td>
                                        <?php if ($rows['current_qty'] == 0) { ?>
                                            <span class="badge bg-danger">0</span>
                                        <?php } else { ?>
                                            <?php echo $rows['current_qty']; ?>
                                        <?php } ?>
                                    </td>
                                    <td style="text-align:right">
                                        <a class="btn-sm btn btn-info" href="product_profile_edit.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                                        <a class="btn-sm btn btn-success" href="product_profile.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i></a>
                                        <a onclick=" return confirm('Are You Sure');" class="btn-sm btn btn-danger" href="product_delete.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i></a>
                                    </td>
                                </tr>
                            
                            <?php 
                            } 
                            
                                        
                                        ?> 

                         
                                    </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
         </div>
      </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php';?>

</div>
<!-- end main content-->
        
        </div>
        <?php include 'modal/product_modal.php'; ?>
        <!-- END layout-wrapper -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>

        <!-- JAVASCRIPT -->
        <?php include 'script.php';?>
        <script src="modal/product_modal.js"></script>
        
    </body>
</html>
<?php
include 'include/db_connect.php';
include 'include/security_token.php';
include 'include/users_right.php';
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
if (isset($_GET['clid'])) {
    $clid = $_GET['clid'];
    if ($cstmr = $con->query("SELECT * FROM customers WHERE id='$clid'")) {
        while ($rows = $cstmr->fetch_array()) {
            $lstid = $rows['id'];
            $fullname = $rows['fullname'];
            $package = $rows['package'];
            $username = $rows['username'];
            $password = $rows['password'];
            $mobile = $rows['mobile'];
            $area = $rows['area'];
            $area_house_id = $rows['area_house_id'];
            $pop_id = $rows['pop'];
            $address = $rows['address'];
            $nid = $rows['nid'];
            $remarks = $rows['remarks'];
            $con_charge = $rows['con_charge'];
            //$pop = $rows['pop'];
            $price = $rows['price'];
            $customer_status = $rows['status'];
            $expiredate = $rows['expiredate'];
            $liablities = $rows['liablities'];
            $con_type = $rows['con_type'];
        }
    }
}

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <?php include 'style.php'; ?>
    <style>
        #details-section {
            max-width: 600px;
            margin: 0 auto;
            background: #f8f9fa;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #details-section .card-body {
            position: relative;
        }

        #customer-details p {
            font-size: 14px;
            color: #333;
            border-bottom: 2px dotted #ccc;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        #customer-details p span {
            font-weight: bold;
            color: #007bff;
        }

        .wizard>.content {
            padding: 12px !important;
        }

        .content.clearfix {
            border: 2px dotted #a6a6a9 !important;
            margin-top: 12px !important;
            margin-bottom: 15px !important;
        }
    </style>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Update Customer';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-10 col-xl-10">
                            <div class="card shadow-sm">
                                <!-- <div class="card-header bg-info text-white text-center">
                                    <h4>Update Customer</h4>
                                </div> -->
                                <div class="card-body">
                                    <form id="form-horizontal" class="form-horizontal form-wizard-wrapper">
                                        <h3>Basic Information</h3>
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="" class="col-lg-3 col-form-label">Full
                                                            Name</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_id" type="text" class="d-none"
                                                                value="<?php echo $lstid; ?>" />
                                                            <input id="customer_fullname" type="text"
                                                                class="form-control " placeholder="Enter Your Fullname"
                                                                value="<?php echo $fullname; ?>" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtLastNameBilling"
                                                            class="col-lg-3 col-form-label">Mobile No.</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_mobile" type="text"
                                                                class="form-control " name="mobile"
                                                                placeholder="Enter Your Mobile Number"
                                                                value="<?php echo $mobile; ?>" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCompanyBilling"
                                                            class="col-lg-3 col-form-label">Address.</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_address" type="text"
                                                                class="form-control" name="address"
                                                                placeholder="Enter Your Addres"
                                                                value="<?php echo $address; ?>" />

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtEmailAddressBilling"
                                                            class="col-lg-3 col-form-label">Nid Card Number</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_nid" type="text" class="form-control"
                                                                name="nid" placeholder="Enter Your Nid Number"
                                                                value="<?php echo $nid; ?>" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <h3>POP/Area</h3>
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtFirstNameShipping"
                                                            class="col-lg-3 col-form-label">POP/Branch</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_pop" class="form-select"
                                                                style="width: 100%;">
                                                                <option value="">Select Pop/Branch
                                                                </option>
                                                                <?php
                                                                if ($get_all_pop = $con->query('SELECT * FROM add_pop')) {
                                                                    while ($pop_rows = $get_all_pop->fetch_assoc()) {
                                                                        $_pop_id = $pop_rows['id'];
                                                                        $pop_name = $pop_rows['pop'];
                                                                        $pop_selected = $_pop_id == $pop_id ? 'selected' : '';
                                                                        echo '<option value="' . $_pop_id . '" ' . $pop_selected . '>' . $pop_name . '</option>';
                                                                    }
                                                                }
                                                                ?>
                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtLastNameShipping"
                                                            class="col-lg-3 col-form-label">Area/Location</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_area" class="form-select"
                                                                name="area" style="width: 100%;">
                                                                <option>Select Area</option>
                                                                <?php
                                                                if ($get_all_area = $con->query("SELECT * FROM area_list WHERE pop_id=$pop_id")) {
                                                                    while ($area_rows = $get_all_area->fetch_assoc()) {
                                                                        $area_id = $area_rows['id'];
                                                                        $area_name = $area_rows['name'];
                                                                        $area_selected = $area_id == $area ? 'selected' : '';
                                                                        echo '<option value="' . $area_id . '" ' . $area_selected . '>' . $area_name . '</option>';
                                                                    }
                                                                }
                                                                ?>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCompanyShipping"
                                                            class="col-lg-3 col-form-label">House No.</label>
                                                        <div class="col-lg-9">
                                                            <div class="d-flex">
                                                                <select id="customer_houseno" class="form-select"
                                                                    name="customer_houseno" style="width: 100%;">
                                                                    <option value="0">---Select---</option>
                                                                    <?php
                                                                    
                                                                    if ($get_all_house = $con->query("SELECT * FROM area_house WHERE pop_id=$pop_id")) {
                                                                        while ($rows = $get_all_house->fetch_assoc()) {
                                                                            $_area_house_id = $rows['id'];
                                                                            $area_house_name = $rows['house_no'];
                                                                            $selected_area_house = $_area_house_id == $area_house_id ? 'selected' : '';
                                                                            echo '<option value="' . $_area_house_id . '" ' . $selected_area_house . '>' . $area_house_name . '</option>';
                                                                        }
                                                                    }
                                                                    
                                                                    ?>
                                                                </select>
                                                                <button type="button"
                                                                    class="btn btn-primary add-house-btn"
                                                                    data-bs-toggle="modal"
                                                                    data-bs-target="#addHouseModal">
                                                                    <span>+</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <h3>Subscription</h3>
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtNameCard"
                                                            class="col-lg-3 col-form-label">Username <span
                                                                id="usernameCheck"></span></label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_username" type="text"
                                                                class="form-control " name="username"
                                                                placeholder="Enter Your Username"
                                                                value="<?php echo $username; ?>" />

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="ddlCreditCardType"
                                                            class="col-lg-3 col-form-label">Password</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_password" type="password"
                                                                class="form-control " name="password"
                                                                placeholder="Enter Your Password"
                                                                value="<?php echo $password; ?>" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCreditCardNumber"
                                                            class="col-lg-3 col-form-label">Package</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_package" class="form-select"
                                                                style="width: 100%;">
                                                                <?php
                                                                
                                                                if ($result = $con->query("SELECT * FROM branch_package WHERE pop_id=$pop_id")) {
                                                                    while ($rows = $result->fetch_assoc()) {
                                                                        $id = htmlspecialchars($rows['pkg_id']);
                                                                        $package_name = htmlspecialchars($rows['package_name']);
                                                                        $selected = $id == $package ? 'selected' : '';
                                                                        echo '<option value="' . $id . '" ' . $selected . '>' . $package_name . '</option>';
                                                                    }
                                                                }
                                                                
                                                                ?>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCardVerificationNumber"
                                                            class="col-lg-3 col-form-label">Package Price</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_price" type="text"
                                                                class="form-control" value="<?php echo $price ?? 00; ?>" />

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtExpirationDate"
                                                            class="col-lg-3 col-form-label">Connection Charge</label>
                                                        <div class="col-lg-9">
                                                            <input id="customer_con_charge" type="text"
                                                                class="form-control" name="con_charge"
                                                                placeholder="Enter Connection Charge"
                                                                value="<?php echo $con_charge ?? 500; ?>" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtExpirationDate"
                                                            class="col-lg-3 col-form-label">Expired Date</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_expire_date" class="form-select"
                                                                style="width: 100%;">
                                                                <?php
                                                                if ($get_all_area_billing_days = $con->query("SELECT `billing_date` FROM area_list WHERE id=$area")) {
                                                                    $billing_date_found = false;
                                                                
                                                                    while ($rows = $get_all_area_billing_days->fetch_assoc()) {
                                                                        $billing_date = $rows['billing_date'] ?? null;
                                                                
                                                                        if (!empty($billing_date) && $billing_date > 0) {
                                                                            echo '<option value="' . $billing_date . '">' . $billing_date . '</option>';
                                                                            $billing_date_found = true;
                                                                        }
                                                                    }
                                                                
                                                                    if (!$billing_date_found) {
                                                                        if ($exp_cstmr = $con->query('SELECT `days` FROM customer_expires')) {
                                                                            $expire_dates = [];
                                                                            while ($rowsssss = $exp_cstmr->fetch_assoc()) {
                                                                                $exp_date = $rowsssss['days'];
                                                                                if (!in_array($exp_date, $expire_dates)) {
                                                                                    echo '<option value="' . $exp_date . '">' . $exp_date . '</option>';
                                                                                    $expire_dates[] = $exp_date;
                                                                                }
                                                                            }
                                                                
                                                                            if (empty($expire_dates)) {
                                                                                $default_date = date('d');
                                                                                echo '<option value="' . $default_date . '">' . $default_date . '</option>';
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                ?>

                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <h3>Additional</h3>
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtNameCard"
                                                            class="col-lg-3 col-form-label">Remarks</label>
                                                        <div class="col-lg-9">
                                                            <textarea id="customer_remarks" type="text" class="form-control" placeholder="Enter Remarks"
                                                                value="  <?php echo htmlspecialchars($remarks); ?>"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="ddlCreditCardType"
                                                            class="col-lg-3 col-form-label">Status</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_status" class="form-select"
                                                                style="width: 100%;">
                                                                <option value="">Select Status</option>
                                                                <option value="0" <?php echo $customer_status == 0 ? 'selected' : ''; ?>>Disable
                                                                </option>
                                                                <option value="1" <?php echo $customer_status == 1 ? 'selected' : ''; ?>>Active
                                                                </option>
                                                                <option value="2" <?php echo $customer_status == 2 ? 'selected' : ''; ?>>Expire
                                                                </option>
                                                                <option value="3" <?php echo $customer_status == 3 ? 'selected' : ''; ?>>Request
                                                                </option>
                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCreditCardNumber"
                                                            class="col-lg-3 col-form-label">Liablities</label>
                                                        <div class="col-lg-9">
                                                            <select id="customer_liablities" class="form-select"
                                                                style="width: 100%;">
                                                                <option value="">---Select---</option>
                                                                <option value="0" <?php echo $liablities == 0 ? 'selected' : ''; ?>>No</option>
                                                                <option value="1" <?php echo $liablities == 1 ? 'selected' : ''; ?>>Yes
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="row mb-3">
                                                        <label for="txtCreditCardNumber" class="col-lg-3 col-form-label">Connection Type</label>
                                                        <div class="col-lg-9">
                                                        <select id="customer_connection_type" class="form-select" style="width: 100%;">
                                                                <option value="">---Select---</option>
                                                                <option value="UTP" <?= ($con_type == 'UTP') ? 'selected' : '' ?>>UTP</option>
                                                                <option value="ONU" <?= ($con_type == 'ONU') ? 'selected' : '' ?>>ONU</option>
                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </form>
                                </div>
                                <div class="card-footer mt-2">
                                    <button type="button" class="btn btn-danger"
                                        onclick="window.history.back();">Back</button>
                                    <button type="button" class="btn btn-success" id="customer_update_btn">Update
                                        Customer</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Add House Modal  -->
    <div class="modal fade" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true"
        id="addHouseModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Area</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <form id="form-area">
                                    <div class="form-group mb-1">
                                        <label>Area</label>
                                        <select class="form-select" name="area_id" id="area_id"
                                            style="width: 100%;">
                                            <option value="">Select</option>
                                            <?php
                                            if ($pop = $con->query('SELECT * FROM area_list')) {
                                                while ($rows = $pop->fetch_array()) {
                                                    $id = $rows['id'];
                                                    $name = $rows['name'];
                                                    echo '<option value="' . $id . '">' . $name . '</option>';
                                                }
                                            }
                                            ?>
                                        </select>
                                    </div>
                                    <div class="form-group mb-1">
                                        <label>House/Building No.</label>
                                        <input class="form-control" type="text" name="house_no" id="house_no"
                                            placeholder="Type  House-Building No." />

                                    </div>
                                    <div class="form-group mb-1">
                                        <label>Note</label>
                                        <input class="form-control" type="text" name="note" id="note"
                                            placeholder="Type Your Note" />
                                    </div>
                                    <div class="d-none">
                                        <input type="hidden" id="lat" name="lat">
                                        <input type="hidden" id="lng" name="lng">
                                    </div>
                                    <div class="form-group mb-1">
                                        <label>Map Location</label>
                                        <div id="show_map" style="width: 100%; height: 300px;"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="add_area" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <?php include 'script.php'; ?>
    <script src="js/customer.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('select').select2();
        });



        $("#customer_update_btn").click(function() {
            var customer_id = $("#customer_id").val();
            var fullname = $("#customer_fullname").val();
            var package = $("#customer_package").val();
            var username = $("#customer_username").val();
            var password = $("#customer_password").val();
            var mobile = $("#customer_mobile").val();
            var address = $("#customer_address").val();
            var expire_date = $("#customer_expire_date").val();
            var area = $("#customer_area").val();
            var pop = $("#customer_pop").val();
            var nid = $("#customer_nid").val();
            var con_charge = $("#customer_con_charge").val();
            var price = $("#customer_price").val();
            var remarks = $("#customer_remarks").val();
            var status = $("#customer_status").val();
            var liablities = $("#customer_liablities").val();
            var customer_houseno = $("#customer_houseno").val();
            var customer_connection_type = $("#customer_connection_type").val();
            var user_type = 1;

            if (fullname.length == 0) {
                toastr.error("Customer name is require");
            } else if (package.length == 0) {
                toastr.error("Customer Package is require");
            } else if (username.length == 0) {
                toastr.error("Username is require");
            } else if (password.length == 0) {
                toastr.error("Password is require");
            } else if (mobile.length == 0) {
                toastr.error("Mobile number is require");
            } else if (expire_date.length == 0) {
                toastr.error("Expire Date is require");
            } else if (pop.length == 0) {
                toastr.error("POP/Branch is require");
            } else if (area.length == 0) {
                toastr.error("Area is require");
            } else if (con_charge.length == 0) {
                toastr.error("Connection Charge is require");
            } else if (price.length == 0) {
                toastr.error("price is require");
            } else if (status.length == 0) {
                toastr.error("Status is require");
            } else if (liablities.length == 0) {
                toastr.error("Liablities is require");
            } else if (nid.length == 0) {
                toastr.error("Nid is require");
            } else if (address.length == 0) {
                toastr.error("Address is require");
            }else if(customer_connection_type.length=='0'){
                toastr.error("Connection Type is Require");
                return false; 
            }
            $("#customer_update_btn").html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
            $("#customer_update_btn").prop("disabled", true);
            $.ajax({
                type: 'POST',
                url: 'include/customers_server.php?update_customer=true',
                dataType: "json",
                data: {
                    customer_id: customer_id,
                    fullname: fullname,
                    package: package,
                    username: username,
                    password: password,
                    mobile: mobile,
                    address: address,
                    expire_date: expire_date,
                    area: area,
                    customer_houseno: customer_houseno,
                    pop: pop,
                    con_charge: con_charge,
                    price: price,
                    remarks: remarks,
                    liablities: liablities,
                    nid: nid,
                    status: status,
                    user_type: user_type,
                    customer_connection_type:customer_connection_type,
                },
                success: function(response) {
                    if (response.success == true) {
                        toastr.success(response.message);
                    }
                    if (response.success == false) {
                        toastr.error(response.message);
                    }
                    $("#customer_update_btn").html('Update Customer');
                    $("#customer_update_btn").prop("disabled", false);
                }
            });

        });
    </script>

</body>

</html>

<?php
date_default_timezone_set("Asia/Dhaka");
include "include/security_token.php";
include "include/users_right.php";
include "include/db_connect.php";
require('routeros/routeros_api.class.php');
// ini_set('display_errors', 1);
// ini_set('display_startup_errors', 1);

$nasipaddress ="Not connected!";
$RouterPortID ="Not Found!";
$DeviceMAC ="Not Found!";
$framedipaddress ="Not connected!";
$offlineHours ="Never connected!";
		
		
		
error_reporting(E_ALL);
if (isset($_GET['clid'])) {

    $clid = $_GET['clid'];
    if ($cstmr = $con->query("SELECT * FROM customers WHERE id='$clid'")) {

        while ($rows = $cstmr->fetch_array()) {
            $lstid = $rows["id"];
            $fullname = $rows["fullname"];
            $package = $rows["package"];
            $packagename = $rows["package_name"];
            $username = $rows["username"];
            $password = $rows["password"];
            $mobile = $rows["mobile"];
            $pop = $rows["pop"];
            $area = $rows["area"];
            $area_house_id = $rows["area_house_id"];
            $address = $rows["address"];
            $expiredDate = $rows["expiredate"];
            $createdate = $rows["createdate"];
            $profile_pic = $rows["profile_pic"];
            $nid = $rows["nid"];
            $price = $rows["price"];
            $remarks = $rows["remarks"];
            $liablities = $rows["liablities"];
        }

			$onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$username'");
			$onlineusr->num_rows;
		
			// NAS Info
			$rowacct = $onlineusr->fetch_assoc();
			$nasipaddress = $rowacct["nasipaddress"] ?? '';

			$CNRT = $con->query("SELECT * FROM nas WHERE nasname='$nasipaddress' LIMIT 1");
			while ($nas_rows = $CNRT->fetch_array()) 
			{
				$NASname = $nas_rows["shortname"];
				$nasname = $nas_rows['nasname'];
				$api_usr = $nas_rows['api_user'];
				$api_pswd = $nas_rows['api_password'];
				$api_server = $nas_rows['api_ip'];
				$api_port = $nas_rows['ports'];
			}

        // Disable Enable
        if (isset($_GET["disable"])) {
            if ($_GET["disable"] == 'true') {
                $con->query("UPDATE customers SET status='0' WHERE id='$clid'");
                $con->query("DELETE FROM radcheck WHERE username='$username'");
				$con->query("DELETE FROM radreply WHERE username='$username'");
				
				     // Disconnect from RT
					 $API = new RouterosAPI();
					 //$API->debug = true;
				
				if ($API->connect($api_server, $api_usr, $api_pswd, $api_port)) {
					 $API->write('/ppp/active/print', false);
					 $API->write('?name='.$username, false);
					 $API->write('=.proplist=.id');
					 $ARRAYS = $API->read();
					 $API->write('/ppp/active/remove', false);
					 $API->write('=.id=' . $ARRAYS[0]['.id']);
					 $READ = $API->read();
					 $API->disconnect();
					 //header("location:?clid=$clid");
				} 
				
                header("location:?clid=$clid");
            } else if ($_GET["disable"] == 'false') {
                $con->query("UPDATE customers SET status='1' WHERE id='$clid'");
                $con->query("INSERT INTO radcheck(username,value,attribute,op) VALUES('$username','$password','Cleartext-Password',':=')");
				$con->query("INSERT INTO radreply(username,attribute,op,value) VALUES('$username','MikroTik-Group',':=','$packagename')");
                header("location:?clid=$clid");
            }
        }
    }
	
			
					
	if (isset($_GET["reconnect"])) {
            
								
				// Reconnect PPP User
				
					$API = new RouterosAPI();
					//$API->debug = true;
				
				if ($API->connect($api_server, $api_usr, $api_pswd, $api_port)) {
					 //$API->write('/interface/pppoe-server/remove <pppoe-ml_ataur>',true);
					 $API->write('/ppp/active/print', false);
					 $API->write('?name='.$username, false);
					 $API->write('=.proplist=.id');
					 $ARRAYS = $API->read();
					 $API->write('/ppp/active/remove', false);
					 $API->write('=.id=' . $ARRAYS[0]['.id']);
					 $READ = $API->read();
					 $API->disconnect();
					 header("location:?clid=$clid");
			} 
	
	}
	
	
}

?>
<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>FAST-ISP-BILLING-SYSTEM</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <?php include 'style.php';?>
   </head>
   <body data-sidebar="dark">
      <!-- Begin page -->
      <div id="layout-wrapper">
         <?php
            $page_title = "Profile";
            include 'Header.php';
         ?>
         <!-- ========== Left Sidebar Start ========== -->
         <div class="vertical-menu">
            <div data-simplebar class="h-100">
               <!--- Sidemenu -->
               <?php include 'Sidebar_menu.php'; ?>
               <!-- Sidebar -->
            </div>
         </div>
         <!-- Left Sidebar End -->
         <!-- ============================================================== -->
         <!-- Start right Content here -->
         <!-- ============================================================== -->
         <div class="main-content">
            <div class="page-content">
               <div class="container-fluid">
                  <div class="row">
                     <div class="">
                        <div class="row">
                           <div class="col-md-6"></div>
                           <div class="col-md-6">
                              <div class="d-flex py-2" style="float:right;">
                                 <abbr title="Note">
                                 <button type="button" class="btn-sm btn btn-info" data-bs-target="#customerRmarksChangeModal" data-bs-toggle="modal">
                                   <i class="fas fa-save"></i>
                                </button>
                                 </abbr>
                                 &nbsp;
                                 <abbr title="Download QR ">
                                 <button type="button" class="btn-sm btn btn-success" 
                                    onclick="qr_function(<?php echo $clid; ?>, '<?php echo $fullname; ?>', '<?php echo $mobile; ?>')">
                                    <i class="mdi mdi-qrcode"></i>
                                </button>
                                 </abbr>

                                 &nbsp;
                                 <abbr title="Password Change">
                                 <button type="button" data-bs-target="#customerPasswordChangeModal" data-bs-toggle="modal" class="btn-sm btn btn-info">
                                 <i class="mdi mdi-key"></i>
                                 </button></abbr>
                                 &nbsp;
                                 <abbr title="Complain">
                                 <button type="button" data-bs-target="#ticketModal" data-bs-toggle="modal" class="btn-sm btn btn-warning ">
                                 <i class="mdi mdi-alert-outline"></i>
                                 </button></abbr>
                                 &nbsp;
                                 <abbr title="Recharge">
                                 <button type="button" id="rechargeBtn" class="btn-sm btn btn-primary ">
                                 <i class="mdi mdi mdi-battery-charging-90"></i>
                                 </button></abbr>
                                 &nbsp;
                                 <abbr title="Temp. Recharge">
                                 <button type="button" data-bs-target="#temp_recharge_Modal" data-bs-toggle="modal" class="btn-sm btn btn-secondary">
                                 <i class="mdi mdi mdi-battery-charging-20"></i>
                                 </button></abbr>
                                 &nbsp;
                                 <abbr title="Payment received">
                                 <button type="button" data-bs-target="#addPaymentModal" data-bs-toggle="modal" class="btn-sm btn btn-info ">
                                 <i class="mdi mdi mdi-cash-multiple"></i>
                                 </button></abbr>
                                 &nbsp;
                                 <?php
										if ($usrstatus = $con->query("SELECT * FROM radcheck WHERE username='$username' LIMIT 1")) {

											$radusrname = $usrstatus->num_rows;
										}
										if ($radusrname == 1) {

											echo '<abbr title="Disable"><a href="?clid=' . $clid . '&disable=true"><button type="button"
																			class="btn-sm btn btn-danger">
																			<i class="fas fa-user-slash"></i>
																			</button></a></abbr>';
										} else {

											echo '<abbr title="Enable"> <a href="?clid=' . $clid . '&disable=false"><button type="button"
																				class="btn-sm btn btn-success">
																				<i class="fas fa-user-slash"></i>
																				</button></a></abbr>';
										}
									?>
                                 &nbsp;
                                 <abbr title="Reconnect">
								 <a href="?clid=<?php echo $clid; ?>&reconnect">
                                 <button type="button" id="reconnect" class="btn-sm btn btn-pink">
                                 <i class="mdi mdi-sync"></i>
                                 </button>
								 </a>
                                 </abbr>
                                 &nbsp;
                                 <abbr title="Edit Customer">
                                 <a href="profile_edit.php?clid=<?php echo $clid; ?>">
                                 <button type="button" class="btn-sm btn btn-info">
                                 <i class="mdi mdi-account-edit"></i>
                                 </button></a>
                                 </abbr>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="row">
                     <div class="container">
                        <div class="main-body">
                           <div class="row gutters-sm">
                              <div class="col-md-4 mb-3">
                                 <div class="">
                                 <div class="card  p-3 mb-4 bg-white rounded text-center">
    <div class="card-body">
        <div class="d-flex flex-column align-items-center profile">
            <!-- Profile Image -->
            <img src="profileImages/avatar.png" class="rounded-circle border border-3 border-primary shadow-sm" width="120" height="120" />
            
            <!-- Profile Details -->
            <div class="mt-3">
                <h4 class="text-primary fw-bold"><?php echo $fullname; ?></h4>
                <p class="text-muted mb-1"> 
                    <span class="badge bg-secondary"># <?php echo $clid; ?></span>
                </p>
                <p class="text-dark fw-semibold">
                    <i class="fas fa-phone-alt text-success"></i> <?php echo $mobile; ?>
                </p>

                <!-- User Since -->
                <small class="text-muted">
                    <i class="far fa-calendar-alt"></i> 
                    <?php
                        $createdate = new DateTime($createdate);
                        echo $createdate->format('d M, Y');
                    ?>
                </small>

                <!-- Remarks Section -->
                <?php if (!empty($remarks)) : ?>
                    <div class="mt-2 p-2 bg-light border rounded">
                        <i class="fas fa-comment-dots text-info"></i> 
                        <?php echo $remarks; ?>
                    </div>
                <?php endif; ?>

                <!-- Action Buttons -->
                <div class="mt-3">
                    <a href="profile_edit.php?clid=<?php echo $clid;?>" class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i> Edit Profile
                    </a>
                 
                </div>
            </div>
        </div>
    </div>
</div>

                                 </div>
                                 <div class="card  border-0 rounded-4">
                                    <div class="card-body p-4">
                                       <div class="col-12 bg-white p-0">
                                             <?php 
                                                $info = [
                                                   ["mdi mdi-marker-check", "Fullname", $fullname],
                                                   ["mdi mdi-account-circle", "Username", $username],
                                                   ["fas fa-box", "Package", $packagename],
                                                   ["fas fa-dollar-sign", "Bill Amount", "<span class='fw-bold text-success'>$price</span>"],
                                                   ["fas fa-location-arrow", "Area", $con->query("SELECT name FROM area_list WHERE id='$area'")->fetch_array()['name']],
                                                   ["fas fa-home", "Address", $address],
                                                   ["fas fa-map-marker-alt", "Area Location", isset($area_house_id) && $area_house_id > 0 ? $con->query("SELECT house_no FROM area_house WHERE id=$area_house_id")->fetch_array()['house_no'] : 'N/A'],
                                                   ["fas fa-file-contract", "Liabilities", $liablities == 1 ? '<span class="badge bg-success">Yes</span>' : '<span class="badge bg-danger">No</span>'],
                                                   ["mdi mdi-phone", "Mobile", $mobile],
                                                   ["mdi mdi-crosshairs-gps", "POP/Branch", '<a href="view_pop.php?id='.$pop.'" class="text-decoration-none text-dark fw-bold">'.$con->query("SELECT pop FROM add_pop WHERE id='$pop'")->fetch_array()['pop'].'</a>'],
                                                   ["fas fa-id-card", "Nid No", $nid],
                                                   ["fas fa-comment-alt", "Remarks", $remarks]
                                                ];
                                             ?>

                                             <?php foreach ($info as $item): ?>
                                             <div class="d-flex justify-content-between align-items-center py-3 px-3 border-bottom border-dotted">
                                                <p class="mb-0 text-muted"><i class="<?= $item[0]; ?> me-2 text-primary fs-5"></i> <span class="fw-bold"><?= $item[1]; ?>:</span></p>
                                                <span class="fw-semibold text-dark"><?= $item[2]; ?></span>
                                             </div>
                                             <?php endforeach; ?>
                                       </div>
                                    </div>
                                 </div>



                              </div>
                              <div class="col-md-8">
                                 <div class="row d-flex">
                                    <div class="col-md-12 mb-4">
                                       <div class="card  shadow py-2" style="border-left:3px solid green;">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col">
                                                   <?php
if ($onlineusr->num_rows == 1) {
    echo '<span class="badge bg-success">Online</span>';
} else {
    echo '<span class="badge bg-danger">Offline</span>';
}

if ($DeviceMC = $con->query("SELECT nasipaddress, nasportid, callingstationid, framedipaddress FROM radacct WHERE username='$username' ORDER BY radacctid DESC LIMIT 1")) {
    while ($mac_rows = $DeviceMC->fetch_array()) {
        $nasipaddress = $mac_rows["nasipaddress"];
		$RouterPortID = $mac_rows["nasportid"];
		$DeviceMAC = $mac_rows["callingstationid"];
        $framedipaddress = $mac_rows["framedipaddress"];
    }
	
	// Router name
	if($nasipaddress !="")
	{
		$NASFND = $con->query("SELECT shortname FROM nas WHERE nasname='$nasipaddress' LIMIT 1");
		while ($nas_rows = $NASFND->fetch_array()) 
		{
			$NASname = $nas_rows["shortname"];
		}

	}
	else
	{
		$NASname = "Not Found!";
	}
	/**/
	echo '</br>';
    echo '<b>Router:</b> '.$NASname.' ~ '.$nasipaddress;
	echo '</br>';
    echo '<b>Interface:</b> '.$RouterPortID;
    echo '</br>';
	echo '<b>MAC:</b> '.$DeviceMAC;
    echo '</br>';
    echo '<b>Remote IP:</b> '.$framedipaddress;
    echo '</br>';
	
	////////////// Mikrotik package detected
		$cstpckg = $con->query("SELECT value FROM radreply WHERE username='$username' LIMIT 1");
		if ($cstpckg->num_rows == 1) {
			//echo '<br><b><span style="color:red;">Grace Time</span></b><br>';
			$cpkg_rows = $cstpckg->fetch_array();
			echo '<b>Detected pkg. </b>' . $cpkg_rows["value"].'</br>';

		}

    if (strlen($DeviceMAC) > 6) {

        $MACaddr = substr($DeviceMAC, 0, 8);
        // Retrive MAC Data from database
        if ($MC_vend = $con->query("SELECT vendor FROM mac_vendor WHERE mac='$MACaddr' LIMIT 1")) {
            while ($vend_rows = $MC_vend->fetch_array()) {
                $MAC_vendor = $vend_rows["vendor"];
                echo "<b>$MAC_vendor</b>";
            }
        }
    }
}

?>
                                                </div>
                                                <div class="col">
                                                   
                                                      <?php
if ($onlineusr->num_rows == 1) {
    echo '<b><abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr> Online </b> <br/>';
    if ($lastuptime = $con->query("SELECT TIMEDIFF(NOW(), acctstarttime) AS time FROM radacct WHERE username='$username' AND acctstoptime IS NULL ORDER BY radacctid DESC LIMIT 1")) {
        $upt_rows = $lastuptime->fetch_array();
        $onlineHrs = $upt_rows["time"];

        echo '<span class="far fa-clock"></span> <strong><span style="color:green;"> ' . $onlineHrs . "</span></strong> Hrs <br/>";
        {

            if ($ontimes = $con->query("SELECT acctstarttime, acctinputoctets/1000/1000/1000 AS GB_IN, acctoutputoctets/1000/1000/1000 AS GB_OUT FROM radacct WHERE username='$username' ORDER BY radacctid DESC LIMIT 1")) {
                $on_rowss = $ontimes->fetch_array();
                $Download = $on_rowss["GB_OUT"];
                $Download = number_format($Download, 3);
                $Upload = $on_rowss["GB_IN"];
                $Upload = number_format($Upload, 3);

                //echo date("Y-m-d h:i:sa", strtotime($on_rowss["acctstarttime"]));
                echo '<span class="fas fa-arrow-alt-circle-down" style="color:red;"> ' . $Download . ' GB</span><br/><span class="fas fa-arrow-alt-circle-up" style="color:purple;"> ' . $Upload . ' GB</span><br/>';
                echo '<span class="fas fa-link text-green"></span><strong><span style="color:blue;"> ' . date("h:i:s A", strtotime($on_rowss["acctstarttime"])) . "</span></strong>";

            }
            /* */

        }

    }

} else {
    echo '<b><img src="images/icon/offline.png" height="10" width="10"/> Offline </b> <br/>';
    if ($offtime = $con->query("SELECT TIMEDIFF(NOW(),acctstoptime) AS time FROM radacct WHERE username='$username' ORDER BY radacctid DESC LIMIT 1")) {
        $off_rows = $offtime->fetch_assoc();
		$offlineHours = $off_rows["time"] ?? '';
		
        echo '<span class="far fa-clock"></span> <strong><span style="color:red;"> ' . $offlineHours . "</span></strong> Hrs <br/>";
        {

            if ($offtimes = $con->query("SELECT acctstoptime FROM radacct WHERE username='$username' ORDER BY radacctid DESC LIMIT 1")) {
                $off_rowss = $offtimes->fetch_array();
                //echo date("Y-m-d h:i:sa", strtotime($off_rowss["acctstoptime"]));
                echo '<span class="fas fa-unlink text-green"></span><strong><span style="color:grey;"><abbr title=' . date("Y-M-d h:i:s A", strtotime($off_rowss["acctstoptime"])) . ' >  ' . date("h:i:s A", strtotime($off_rowss["acctstoptime"])) . "</abbr></span></strong>";
            }else{
                                 echo '<span class="fas fa-unlink text-green"></span><strong><span style="color:grey;">Never connected</span></strong>';
            }

        }

    }

}

?>
                                                  
                                                </div>
                                                <div class="col">
												<b>Expired Date</b><br>
<?php
if ($usrstatus = $con->query("SELECT * FROM radcheck WHERE username='$username' LIMIT 1")) {

    $radusrname = $usrstatus->num_rows;
}

if ($radusrname == 1) {
   if (!empty($expiredDate) && preg_match('/^\d{4}-\d{2}-\d{2}$/', $expiredDate)) {
       $expiredDate = new DateTime($expiredDate);
       $expiredDate = $expiredDate->format('d-M-Y');
       echo "<span style='color:green;'><b>Active</b></span>";	
	   echo "<br>" . $expiredDate;
	   
   } else {
       echo "<span style='color:orange;'><b>Invalid Date</b></span>";
   }
} else {
   echo '<a href="?clid=' . $clid . '&disable=false"><span style="color:red;"><b>Disabled</b></span></a>';
}



echo '<br>';
$gracetime = $con->query("SELECT DATEDIFF(grace_expired, NOW()) AS time FROM customers WHERE grace_expired>=NOW() AND username='$username'");
if ($gracetime->num_rows == 1) {
    echo '<br><b><span style="color:red;">Grace Time</span></b><br>';
    $grc_rows = $gracetime->fetch_array();
    echo '<b>' . $grc_rows["time"] . '</b> Days';

}

?>
                                                   <b>Monthly Uses</b>
												   </br>
                                                  
                                                      <?php
$currentMonth = date("m");
if ($lastused = $con->query("SELECT SUM(acctinputoctets)/1000/1000/1000 AS GB_IN, SUM(acctoutputoctets)/1000/1000/1000 AS GB_OUT FROM
                                                         radacct WHERE username='$username' AND  MONTH(acctstarttime)='$currentMonth'")) {
    $r_usd_rows = $lastused->fetch_array();
    $Download = $r_usd_rows["GB_OUT"];
    $Download = number_format($Download, 3);
    $Upload = $r_usd_rows["GB_IN"];
    $Upload = number_format($Upload, 3);

    echo '<span class=" fas fa-arrow-alt-circle-down" style="color:red;"> ' . $Download . ' GB</span><br/><span class=" fas fa-arrow-alt-circle-up" style="color:purple;"> ' . $Upload . ' GB</span><br/>';

}
?>
                                                   
                                                
                                                   
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                                 
                                 <div class="row">
                                    <!-- Earnings (Monthly) Card Example -->
                                    <div class="col-xl-3 col-md-6 mb-4">
                                       <div class="card shadow py-2" style="border-left:3px solid #2A0FF1;">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                   <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Recharged</div>
                                                   <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                      <?php
                                                         if ($rchdamt = $con->query("SELECT SUM(purchase_price) AS Amount FROM customer_rechrg WHERE customer_id='$clid' AND type !='4'")) {
                                                            while ($r_rchd_rows = $rchdamt->fetch_array()) {
                                                               $totalrchd = $r_rchd_rows["Amount"];
                                                            }
                                                            echo $totalrchd;
                                                         }
                                                      ?>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <!-- Earnings (Monthly) Card Example -->
                                    <div class="col-xl-3 col-md-6 mb-4">
                                       <div class="card shadow  py-2" style="border-left:3px solid #27F10F;">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                   <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Paid</div>
                                                   <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                   <?php

$totalpaid = 0.00;
$discount_amount = 0.00;

if ($dueamt = $con->query("SELECT SUM(purchase_price) AS Amount FROM customer_rechrg WHERE customer_id='$clid' AND type != '0'")) {
    if ($r_due_rows = $dueamt->fetch_array()) {
        $totalpaid = $r_due_rows["Amount"] ?? 0.00; 
    }
}

if ($discount_query = $con->query("SELECT SUM(discount) AS discount_amount FROM customer_rechrg WHERE customer_id='$clid'")) {
    if ($discount_row = $discount_query->fetch_array()) {
        $discount_amount = $discount_row["discount_amount"] ?? 0.00;
    }
}

// Calculate and output the net value
echo $totalpaid - $discount_amount ?? 0.00;
?>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <!-- Pending Requests Card Example -->
                                    <div class="col-xl-3 col-md-6 mb-4">
                                       <div class="card shadow  py-2" style="border-left:3px solid red; color:red">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                   <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Total Due</div>
                                                   <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                      <?php echo $totalDue = $totalrchd - $totalpaid; ?>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <!-- Pending Requests Card Example -->
                                    <div class="col-xl-3 col-md-6 mb-4">
                                       <div class="card shadow  py-2" style="border-left:3px solid blue;">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                   <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Due paid</div>
                                                   <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                      <?php
if ($duepmt = $con->query("SELECT SUM(purchase_price) AS Amount FROM customer_rechrg WHERE customer_id='$clid' AND type='4'")) {
    while ($pmt_rows = $duepmt->fetch_array()) {
        $totalpmtpaid = $pmt_rows["Amount"] ?? 0;
    }
    echo $totalpmtpaid;
}
?>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <!-- Pending Requests Card Example -->
                                    <div class="col-xl-3 col-md-6 mb-4">
                                       <div class="card shadow  py-2" style="border-left:3px solid red;">
                                          <div class="card-body">
                                             <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                   <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Discount</div>
                                                   <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                      <?php
if ($duepmt = $con->query("SELECT SUM(discount) AS discount_amount FROM customer_rechrg WHERE customer_id='$clid'")) {
    while ($discount_amount_rows = $duepmt->fetch_array()) {
        $_discount_amount = $discount_amount_rows["discount_amount"] ?? 0;
    }
    echo $_discount_amount;
}
?>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="row">
                                    <canvas id="bandwidthChart"></canvas>
                                    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                                    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                                    <script>
        $(document).ready(function() {
            let ctx = document.getElementById('bandwidthChart').getContext('2d');
            let bandwidthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Download Speed (Mbps)',
                        borderColor: 'blue',
                        borderWidth: 2,
                        pointRadius: 2,
                        data: [],
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Upload Speed (Mbps)',
                        borderColor: 'red',
                        borderWidth: 2,
                        pointRadius: 2,
                        data: [],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    animation: {
                        duration: 200,
                        easing: 'linear'
                    },
                    scales: {
                        x: { title: { display: true, text: 'Time' } },
                        y: { title: { display: true, text: 'Speed (Mbps)' }, min: 0, max: 100 }
                    }
                }
            });

            function fetch_dumy_data() {
                let time = new Date().toLocaleTimeString();
                let downloadSpeed = (Math.random() * 50 + 10).toFixed(2);
                let uploadSpeed = (Math.random() * 20 + 5).toFixed(2); 
                
                if (bandwidthChart.data.labels.length > 20) {
                    bandwidthChart.data.labels.shift();
                    bandwidthChart.data.datasets[0].data.shift();
                    bandwidthChart.data.datasets[1].data.shift();
                }
                
                bandwidthChart.data.labels.push(time);
                bandwidthChart.data.datasets[0].data.push(downloadSpeed);
                bandwidthChart.data.datasets[1].data.push(uploadSpeed);
                bandwidthChart.update();
            }
            // function __fetch_data() {
            //     $.ajax({
            //         url: "include/customers_server.php?fetch_bandwith_data=true&username=<?php echo $username; ?>",
            //         method: "GET",
            //         dataType: "json",
            //         success: function(response) {
            //             if (!response.error) {
            //                 if (bandwidthChart.data.labels.length > 20) {
            //                     bandwidthChart.data.labels.shift();
            //                     bandwidthChart.data.datasets[0].data.shift();
            //                     bandwidthChart.data.datasets[1].data.shift();
            //                 }

            //                 bandwidthChart.data.labels.push(response.time);
            //                 bandwidthChart.data.datasets[0].data.push(response.download);
            //                 bandwidthChart.data.datasets[1].data.push(response.upload);
            //                 bandwidthChart.update();
            //             }
            //         }
            //     });
            // }
            //__fetch_data();
           setInterval(fetch_dumy_data, 500);
        });
    </script>
                                 </div>
                                 <div class="container">
                                    <div class="row">
                                       <div class="card">
                                          <div class="card-body">
                                             <!-- Nav tabs -->
                                             <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                                             <li class="nav-item">
                                                   <a class="nav-link active" data-bs-toggle="tab" href="#tickets" role="tab">
                                                   <span class="d-none d-md-block">Tickets
                                                   </span><span class="d-block d-md-none"><i class="mdi mdi-home-variant h5"></i></span>
                                                   </a>
                                                </li>
                                                <li class="nav-item">
                                                   <a class="nav-link" data-bs-toggle="tab" href="#cstmr_recharge" role="tab">
                                                   <span class="d-none d-md-block">Customers Recharge</span><span class="d-block d-md-none"><i class="mdi mdi-account h5"></i></span>
                                                   </a>
                                                </li>
                                                <li class="nav-item">
                                                   <a class="nav-link " data-bs-toggle="tab" href="#usr_usage" role="tab">
                                                   <span class="d-none d-md-block">User Usage</span><span class="d-block d-md-none"><i class="mdi mdi-email h5"></i></span>
                                                   </a>
                                                </li>
                                                <li class="nav-item">
                                                   <a class="nav-link" data-bs-toggle="tab" href="#usr_activity" role="tab">
                                                   <span class="d-none d-md-block">User Activity</span><span class="d-block d-md-none"><i class="mdi mdi-email h5"></i></span>
                                                   </a>
                                                </li>
                                                
                                             </ul>
                                             <!-- Tab panes -->
                                             <div class="tab-content">
                                                <div class="tab-pane  p-3" id="usr_usage" role="tabpanel">
                                                   <div class="card">
                                                      <div class="card-body">
                                                         <div class="table-responsive">
                                                            <table class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                               <thead>
                                                                  <tr>
                                                                     <th>Usage</th>
                                                                     <th>Duration</th>
                                                                     <th>Time</th>
                                                                     <th>Act.</th>
                                                                  </tr>
                                                               </thead>
                                                               <tbody>
                                                                  <?php
if ($csusage = $con->query("SELECT acctinputoctets/1000/1000/1000 AS GB_IN, acctoutputoctets/1000/1000/1000 AS GB_OUT, TIMEDIFF(acctstoptime,acctstarttime) AS time, acctstoptime, acctterminatecause FROM
                                                                     radacct WHERE username='$username' AND acctstoptime IS NOT NULL ORDER BY acctstoptime DESC, radacctid ASC LIMIT 5")) {
    while ($r_ussg_rows = $csusage->fetch_array()) {

        $usgDownload = $r_ussg_rows["GB_OUT"];
        $usgDownload = number_format($usgDownload, 3);
        $usgUpload = $r_ussg_rows["GB_IN"];
        $usgUpload = number_format($usgUpload, 3);
        $Usagetime = $r_ussg_rows["time"];
        $Usagestoptime = $r_ussg_rows["acctstoptime"];
        $Usagestoptime = date("h:i:s A ~ d-M-Y", strtotime($Usagestoptime));
        $Usageacctterminatecause = $r_ussg_rows["acctterminatecause"];

        //echo '<span class="fas fa-caret-down" style="color:red;"> '.$Download.' GB</span><br/><span class="fas fa-caret-up" style="color:purple;"> '.$Upload.' GB</span><br/>';

        echo '
                                                                             <tr>
                                                                             <td><span class="fas fa-caret-down"></span> ' . $usgDownload . ' GB<br/><span class="fas fa-caret-up" ></span> ' . $usgUpload . ' GB</td>
                                                                                 <td>' . $Usagetime . '</td>
                                                                                 <td>' . $Usagestoptime . '</td>
                                                                                 <td>' . $Usageacctterminatecause . '</td>
                                                                             </tr>
                                                                             ';
    }
}

?>
                                                               </tbody>
                                                            </table>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="tab-pane p-3" id="usr_activity" role="tabpanel">
                                                   <div class="card">
                                                      <div class="card-body">
                                                         <div class="table-responsive">
                                                            <table class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                               <thead>
                                                                  <tr>
                                                                     <th>Auth Date</th>
                                                                     <th>Username</th>
                                                                     <th>Pass</th>
                                                                     <th>Reply</th>
                                                                  </tr>
                                                               </thead>
                                                               <tbody>
                                                                  <?php
if ($usrs_activity = $con->query("SELECT * FROM radpostauth WHERE username='$username' ORDER BY authdate DESC LIMIT 5")) {
    while ($rowsppp = $usrs_activity->fetch_array()) {
        $usr_act_name = $rowsppp["username"];
        $usr_act_pass = $rowsppp["pass"];
        $usr_act_reply = $rowsppp["reply"];
        $usr_act_auth = $rowsppp["authdate"];
        $usr_act_auth = date("h:i:s A ~ d-M-Y", strtotime($usr_act_auth));

        if ($usr_act_reply == "Access-Accept") {
            $userReplay = "<span class='badge bg-success'>Password Matched</span>";
        } else if ($usr_act_reply == "Access-Reject") {
            $userReplay = "<span class='badge bg-danger'>Password Missmatched</span>";
        }

        echo '
                                                                             <tr>
                                                                             <td>' . $usr_act_auth . '</td>
                                                                                 <td>' . $usr_act_name . '</td>
                                                                                 <td>' . $usr_act_pass . '</td>
                                                                                 <td>' . $userReplay . '</td>
                                                                             </tr>
                                                                             ';
    }
}
?>
                                                               </tbody>
                                                            </table>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="tab-pane active p-3" id="tickets" role="tabpanel">
                                                   <div class="card">
                                                      <div class="card-body">
                                                         <div class="table-responsive">
                                                            <table id="tickets_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                               <thead>
                                                                  <tr>
                                                                     <th>Complain Type</th>
                                                                     <th>Ticket Type</th>
                                                                     <th>Form Date</th>
                                                                  </tr>
                                                               </thead>
                                                               <tbody id="ticket-list">
                                                                  <?php
$sql = "SELECT * FROM ticket WHERE customer_id=$lstid  ";
$result = mysqli_query($con, $sql);

while ($rows = mysqli_fetch_assoc($result)) {

    ?>
                                                                  <tr>
                                                                     <td>
                                                                        <?php
$complain_typeId = $rows["complain_type"];
    $ticketsId = $rows["id"];
    if ($allCom = $con->query("SELECT * FROM ticket_topic WHERE id='$complain_typeId' ")) {
        while ($rowss = $allCom->fetch_array()) {
            $topicName = $rowss['topic_name'];
            echo '<a href="tickets_profile.php?id=' . $ticketsId . '">' . $topicName . '</a>';
        }
    }
    ?>
                                                                     </td>
                                                                     <td>
                                                                        <?php
$ticketType = $rows['ticket_type'];
    if ($ticketType == "Active") {
        echo "<span class='badge bg-success'>Active</span>";
    } else if ($ticketType == "Open") {
        echo "<span class='badge bg-info'>Open</span>";
    } else if ($ticketType == "New") {
        echo "<span class='badge bg-danger'>New</span>";
    } else if ($ticketType == "Complete") {
        echo "<span class='badge bg-success'>Complete</span>";
    }

    ?>
                                                                     </td>
                                                                     <td>
                                                                        <?php 
                                                                        echo  date("d F Y", strtotime($rows["startdate"]));
                                                                        ?>
                                                                     </td>
                                                                  </tr>
                                                                  <?php
}?>
                                                               </tbody>
                                                            </table>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="tab-pane p-3" id="cstmr_recharge" role="tabpanel">
                                                   <div class="card">
                                                      <div class="card-body">
                                                         <div class="table-responsive">
                                                            <table id="recharge_data_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                               <thead>
                                                                  <tr>
                                                                     <th>Date</th>
                                                                     <th>Months</th>
                                                                     <th>Type</th>
                                                                     <th>Reference</th>
                                                                     <th>Paid until</th>
                                                                     <th>Amount</th>
                                                                     <th></th>
                                                                  </tr>
                                                               </thead>
                                                               <tbody>
                                                                  <?php
if ($recharge_customer = $con->query("SELECT * FROM customer_rechrg WHERE customer_id='$lstid' ORDER BY id DESC ")) {
    while ($r_cus_rows = $recharge_customer->fetch_array()) {
        $r_id = $r_cus_rows["id"];
        //$r_cus_name = $r_cus_rows["customer_name"];
        $r_cus_month = $r_cus_rows["months"];
        $r_cus_ref = $r_cus_rows["ref"];
        $r_cus_amount = $r_cus_rows["purchase_price"];

        $r_unti = $r_cus_rows["rchrg_until"];
        $r_unti = new DateTime($r_unti);
        $r_unti = $r_unti->format('d-m-Y');

        $r_datetm = $r_cus_rows["datetm"];
        $r_datetm = new DateTime($r_datetm);
        //$r_datetm = $r_datetm->format('H:i A, d-M-Y');
        $r_datetm = $r_datetm->format('d-m-Y');

        $trnstype = $r_cus_rows['type'];
        if ($trnstype == "1") {
            $trnstype = "<span class='badge bg-success'>Cash</span>";
        } else if ($trnstype == "2") {
            $trnstype = "<span class='badge bg-info'>Bkash</span>";
        } else if ($trnstype == "3") {
            $trnstype = "<span class='badge bg-success'>Nagad</span>";
        } else if ($trnstype == "4") {
            $trnstype = "<span class='badge bg-primary'>Due Paid</span>";
        } else if ($trnstype == "0") {
            $trnstype = "<span class='badge bg-danger'>Crdit</span>";
        }

        echo '
                                                                                     <tr>
                                                                                     <td>' . $r_datetm . '</td>
                                                                                         <td>' . $r_cus_month . '</td>
                                                                                         <td>' . $trnstype . '</td>
                                                                                         <td>' . $r_cus_ref . '</td>
                                                                                         <td>' . $r_unti . '</td>
                                                                                         <td>' . $r_cus_amount . '</td>
                                                                                         <td><button type="button" id="recharge_undo" data-id="' . $r_id . '" class="btn-sm btn btn-danger"><i class="mdi mdi-undo"></i></button></td>
                                                                                     </tr>
                                                                                     ';
    }
}
?>
                                                               </tbody>
                                                            </table>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <!-- Modal for customer Remarsk update -->
            <div class="modal fade" id="customerRmarksChangeModal" tabindex="-1" role="dialog" aria-labelledby="Profile_pic_upload_Label" aria-hidden="true">
               <div class="modal-dialog" role="document">
                  <div class="modal-content">
                     <div class="modal-header">
                        <h5 class="modal-title" id="Profile_pic_upload_Label">Update Customer Remarks</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form>
                           <div class="from-group d-none">
                              <label>Customer id:</label>
                              <input class="" type="text" id="update_customer_id" value="<?php echo $lstid; ?>">
                           </div>
                           <div class="from-group mb-2">
                              <label>Customer Remarks</label>
                              <textarea type="text" id="update_customer_remarks" class="form-control " placeholder="Enter Customer Remarks"><?php echo $remarks; ?></textarea>
                           </div>
                        </form>
                     </div>
                     <div class="modal-footer">
                        <button type="button" id="customer_remarks_update_btn" class="btn btn-primary">Update Now</button>
                     </div>
                  </div>
               </div>
            </div>

            <!-- Modal for customer username and password update -->
            <div class="modal fade" id="customerPasswordChangeModal" tabindex="-1" role="dialog" aria-labelledby="Profile_pic_upload_Label" aria-hidden="true">
               <div class="modal-dialog" role="document">
                  <div class="modal-content">
                     <div class="modal-header">
                        <h5 class="modal-title" id="Profile_pic_upload_Label">Update Customer Info</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form>
                           <div class="from-group d-none">
                              <label>Customer id:</label>
                              <input class="" type="text" id="update_customer_id" value="<?php echo $lstid; ?>">
                           </div>
                           <div class="from-group mb-2">
                              <label>Customer Username:</label>
                              <input type="text" id="update_customer_username" class="form-control " placeholder="Enter Customer Username" value="<?php echo $username; ?>">
                           </div>
                           <div class="from-group mb-2">
                              <label>Customer Password:</label>
                              <input type="text" id="update_customer_password" class="form-control " placeholder="Enter Customer Password" value="<?php echo $password; ?>">
                           </div>
                        </form>
                     </div>
                     <div class="modal-footer">
                        <button type="button" id="customer_update_btn" class="btn btn-primary">Update Now</button>
                     </div>
                  </div>
               </div>
            </div>
            <!-- Modal for Ticket -->
            <?php require 'modal/tickets_modal.php';?>
            <!-- Modal for Recharge -->
            <div class="modal fade" id="rechargeModal" tabindex="-1" role="dialog" aria-labelledby="ComplainModalCenterTitle" aria-hidden="true" >
               <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                     <div class="modal-header">
                        <h5 class="modal-title" id="ComplainModalLongTitle">
                           Recharge [<span style="color:red;" id="currentBal">Due Balance: <?php echo $totalDue; ?> </span>]
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form id="recharge-form" method="POST">
                           <div class="form-group d-none">
                              <label for="">id</label>
                              <input id="customer_id" type="text" value="<?php echo $clid; ?>" class="form-control form-control-sm">
                              <input id="pop_id" type="text" value="<?php echo $pop; ?>" class="form-control form-control-sm">
                           </div>
                           <div id="holders">
                              <div class="form-group mb-1">
                                 <label>Month</label>
                                 <select id="month" class="form-select" name='month'>
                                    <option value="">Select</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                 </select>
                              </div>
                              <div class="form-group mb-1">
                                 <label for="">Package</label>
                                 <input id="package" disabled="Disable" name="package" class="form-control " value="<?php echo $packagename; ?>" />
                              </div>
                              <div class="form-group mb-1 ">
                                 <label>Package Price:</label>
                                 <input id="amount" disabled="Disable" type="text" class="form-control form-control-sm" value="<?php echo $price; ?>">
                              </div>
                           </div>
                           <div class="form-group mb-1 ">
                              <label>Payable Amount:</label>
                              <input id="MainAmount"  type="text" class="form-control form-control-sm" />
                           </div>
                           <div class="form-group mb-1 ">
                              <label>Ref No.:</label>
                              <input id="RefNo" type="text" class="form-control form-control-sm" />
                           </div>
                           <div class="form-group mb-1">
                              <label>Transaction Type:</label>
                              <select id="tra_type" name="tra_type" class="form-select">
                                 <option>---Select---</option>
                                 <option value="1">Cash</option>
                                 <option value="0">On Credit</option>
                                 <option value="2">Bkash</option>
                                 <option value="3">Nagad</option>
                              </select>
                           </div>
                        </form>
                     </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button id="recharge-button" type="button" class="btn btn-success">Recharge Now</button>
                     </div>
                  </div>
               </div>
            </div>
            <!-----------------temp Customer Recharge------------------->
            <div class="modal fade" id="temp_recharge_Modal" tabindex="-1" role="dialog" aria-labelledby="ComplainModalCenterTitle" aria-hidden="true" >
               <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                     <div class="modal-header">
                        <h5 class="modal-title" id="ComplainModalLongTitle">
                           Recharge [<span style="color:red;" id="currentBal">Due Balance: <?php echo $totalDue; ?> </span>]
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form id="recharge-form" method="POST">
                           <div class="form-group d-none">
                              <label for="">id</label>
                              <input id="customer_id" type="text" value="<?php echo $clid; ?>" class="form-control form-control-sm">
                              <input id="pop_id" type="text" value="<?php echo $pop; ?>" class="form-control form-control-sm">
                           </div>
                           <div class="form-group mb-1">
                              <label>Days</label>
                              <select id="days" class="form-select">
                                 <option value="">Select</option>
                                 <option value="01">1</option>
                                 <option value="02">2</option>
                                 <option value="03">3</option>
                                 <option value="4">4</option>
                                 <option value="5">5</option>
                                 <option value="6">6</option>
                                 <option value="7">7</option>
                                 <option value="8">8</option>
                                 <option value="9">9</option>
                                 <option value="10">10</option>
                                 <option value="11">11</option>
                                 <option value="12">12</option>
                              </select>
                           </div>
                           <div class="form-group mb-1 ">
                              <label>Ref No.:</label>
                              <input id="RefNo" type="text" class="form-control form-control-sm" />
                           </div>
                           <div class="form-group mb-1">
                              <label>Transaction Type:</label>
                              <select id="tra_type" name="tra_type" class="form-select">
                              <option>---Select---</option>
                                 <option value="0">On Credit</option>
                              </select>
                           </div>
                        </form>
                     </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button id="temp_recharge" type="button" class="btn btn-success"><i class="mdi mdi-cash"></i> Add Recharge</button>
                     </div>
                  </div>
               </div>
            </div>
            <!--------------------Add Payment received Modal---------------------------->
            <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="addPaymentModal">
               <div class="modal-dialog" role="document">
                  <form id="FormData">
                     <div class="modal-content">
                        <div class="modal-header">
                           <h5 class="modal-title" id="exampleModalLabel">Add Payment Received</h5>
                           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="card">
                           <div class="card-body">
                              <input class="d-none" type="text" id="due_recharge_pop_id" value="<?php echo $pop; ?>">
                              <input id="due_customer_id" type="text" value="<?php echo $clid; ?>" class="form-control d-none">
                              <div class="form-group mb-2">
                                 <label>Amount:</label>
                                 <input type="text" id="addRechargeAmount" placeholder="Enter Your Amount" class="form-control">
                              </div>
                              <div class="form-group mb-2">
                                 <label>Transaction Type:</label>
                                 <select id="addRechargeTra_type" class="form-select">
                                    <option>---Select---</option>
                                    <option value="1">Cash</option>
                                    <option value="2">Bkash</option>
                                    <option value="3">Nagad</option>
                                    <option value="4">Bank</option>
                                 </select>
                              </div>
                              <div class="form-group mb-2">
                                 <label>Remarks</label>
                                 <textarea id="addRechargeRemarks" class="form-control" placeholder="Enter Remarks"></textarea>
                              </div>
                              <div class="form-group d-none">
                                 <label>Recharge By:</label>
                                 <input type="text" id="recharge_by" class="form-control" value="<?php echo $_SESSION['uid']; ?>" />
                              </div>
                           </div>
                        </div>
                        <div class="modal-footer">
                           <button type="button" data-bs-dismiss="modal" aria-label="Close" class="btn btn-danger">Cancle</button>
                           <button type="button" id="addPaymentBtn" class="btn btn-primary"><i class="mdi mdi-cash"></i> Add Payment</button>
                        </div>
                     </div>
                  </form>
               </div>
            </div>
             <!-------------------- QR CODE  Modal---------------------------->
             <div class="modal fade" id="qrCodeModal" tabindex="-1" aria-labelledby="qrCodeModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="qrCodeModalLabel">QR Code</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="modal-body text-center">
                              <div id="qrCodeContainer"></div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-success" id="downloadButton">Download QR Code</button>
                              <button type="button" class="btn btn-info" id="print_qr_code_btn">Print QR Code</button>
                              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                           </div>
                        </div>
                  </div>
               </div>
            <?php include 'Footer.php';?>
         </div>
         <!-- end main content-->
      </div>
      <!-- END layout-wrapper -->
      <!-- Right bar overlay-->
      <div class="rightbar-overlay"></div>
      <?php include 'script.php';?>
      <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
       <!-- Include Tickets js File -->
    <script src="js/tickets.js"></script>
        <script type="text/javascript">
         $('#tickets_table').dataTable();
         $('#recharge_data_table').dataTable();
         $('#user_activity_data_table').dataTable();
         showModal();
        function qr_function(customer_id, customer_name, phone_number) {
            const qrData = `https://sr-wifi.net?clid=${customer_id}`;

            $('#qrCodeContainer').html('');

            QRCode.toDataURL(qrData, { width: 200 }, function (err, url) {
                if (err) {
                    console.error(err);
                    return;
                }

                $('#qrCodeContainer').html(`<img src="${url}" alt="QR Code" class="img-fluid">`);

                $('#downloadButton').off('click').on('click', function () {
                    const downloadLink = document.createElement('a');
                    downloadLink.href = url;
                    downloadLink.download = 'QRCode.png';
                    downloadLink.click();
                });

                $("#print_qr_code_btn").off('click').on('click', function () {
                    const printContent = `
                        <html>
                        <head>
                            <title>Print QR Code</title>
                            <style>
                                @media print {
                                    body {
                                        width: 60mm; /* Perfect for small thermal printers */
										height: 50mm;
                                        font-size: 14px;
                                        margin: 0;
                                        padding: 0;
                                        text-align: center;
                                        font-family: Arial, sans-serif;
                                    }
                                    .content-wrapper {
                                        display: flex;
                                        margin-top:20px;
                                        align-items: center;
                                        padding: 5px;
                                    }
                                    .qr-section {
                                        width: 60%;
										
										padding-left: 10px;
                                        text-align: center;
                                    }
                                    .info-section {
                                        width: 100%;
                                        text-align: left;
                                        padding-left: 20px;
                                    }
                                    .info-section p {
                                        margin: 2px 0;
                                        font-size: 12px;
                                    }
                                    img {
                                        display: block;
                                        margin: 0 auto;
                                        max-width: 100%;
                                    }
                                    .footer {
                                        text-align: center;
										font-size: 14px;
                                        margin-top: 5px;
                                        font-size: 10px;
                                        border-top: 1px dashed #000;
                                        padding-top: 2px;
										
                                    }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="content-wrapper">
							
                                <div class="qr-section">
                                    <img src="${url}" alt="QR Code">
                                </div>
								<p><strong>Please Scan...</strong> 
								<br/>
								<br/>
								For Self Payment & Management.</p>
                            </div>
							
							<div class="info-section">
								<p><strong>ID: #</strong> ${customer_id}</p>
								<p><strong>Name:</strong> ${customer_name}</p>
							</div>
                            <div class="footer">
                                <strong>Support: 01821 600 600</strong>
                            </div>
                        </body>
                        </html>`;

                    const printWindow = window.open('', '__blank', 'width=800,height=800');
                    printWindow.document.open();
                    printWindow.document.write(printContent);
                    printWindow.document.close();

                    printWindow.onload = function () {
                        printWindow.print();
                        printWindow.close();
                    };
                });

                $('#qrCodeModal').modal('show');
            });
        }


         function showModal() {
             $("#rechargeBtn").click(function() {
                 $("#rechargeModal").modal('show');
                 $("#month").on('change', function() {
                     var month = $("#month").val();
                     var amount = $("#amount").val();
                     totalAmount = (month * amount);
                     $("#MainAmount").val(totalAmount);
                 });
             });
         }
         //addRecharge();


        $("#recharge-button").click(function() {
                 var customer_id = $("#customer_id").val();
                 var month = $("#month").val();
                 var package = $("#package").val();
                 var mainAmount = $("#MainAmount").val();
                 var RefNo = $("#RefNo").val();
                 var tra_type = $("#tra_type").val();
                 var pop_id = $("#pop_id").val();
                var RechargData =
                    "customer_id=" + customer_id+
                    "&month=" + month+
                    "&package=" + package+
                    "&amount=" + mainAmount+
                    "&RefNo=" + RefNo+
                    "&tra_type=" + tra_type+
                    "&pop_id=" + pop_id+
                    "&add_recharge_data=0";
                if (month.length == 0 && $("#tra_type").val() != 4) {
                    toastr.error("Select Month");
                }else if(mainAmount.length == 0){
                    toastr.error("Payable Amount Required");
                } 
                else if (tra_type === '' || tra_type === null || tra_type === '---Select---') {
                    toastr.error("Select Transaction Type");
                } else {
                    $("#recharge-button").disabled;
                    $.ajax({
                        type: 'POST',
                        url: 'include/customer_recharge_server.php',
                        data: RechargData,
                        success: function(response) {
                        // alert(response);
                            if (response == 1) {
                                toastr.success("Recharge Successful");
                                $("#rechargeModal").modal('hide');
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else if(response == 2) {
                                toastr.error("Please Recharge This POP Account");
                            }else{
                                toastr.error(response);
                            }

                        }
                    });
                }

         });

         //add due payment processing
         $(document).on('click', '#addPaymentBtn', function() {
             var pop_id = $("#due_recharge_pop_id").val();
             var recharge_amount = $("#addRechargeAmount").val();
             var due_customer_id = $("#due_customer_id").val();
             var transaction_type = $("#addRechargeTra_type").val();
             var remarks = $("#addRechargeRemarks").val();



             if (recharge_amount.length == 0) {
                 toastr.error("Please Enter Amount");
             } else {
                 $.ajax({
                     type: 'POST',
                     url: 'include/customer_recharge_server.php',
                     data: {
                         customer_id: due_customer_id,
                         amount: recharge_amount,
                         remarks: remarks,
                         transaction_type: 4,
                         pop_id: pop_id,
                         addCustomerDuePayment: 0
                     },
                     success: function(response) {
                         if (response == 1) {

                             toastr.success("Payment Success");
                             $("#addPaymentModal").modal('hide');
                             setTimeout(() => {
                                 location.reload();
                             }, 1000);
                         } else {
                             toastr.error(response);
                         }
                     }
                 });
             }
         });


         $(document).on('click', '#temp_recharge', function() {
             var pop_id = $("#due_recharge_pop_id").val();
             var due_customer_id = $("#due_customer_id").val();
             var days = $("#days").val();

             var RefNo = $("#RefNo").val();
             var tra_type = $("#tra_type").val();


             if (days.length == 0) {
                 toastr.error("Please Select Your Days");
             } else {
                 $.ajax({
                     type: 'POST',
                     url: 'include/customer_recharge_server.php',
                     data: {
                         customer_id: due_customer_id,
                         pop_id: pop_id,
                         days: days,
                         RefNo: RefNo,
                         transaction_type: tra_type,
                         customer_temp_recharge: 0
                     },
                     success: function(response) {

                         if (response == 1) {
                             toastr.success("Recharge Success");
                             $("#temp_recharge_Modal").modal('hide');
                             setTimeout(() => {
                                 location.reload();
                             }, 1000);
                         } else {
                             toastr.error(response);
                         }

                     }
                 });
             }
         });
         //customer username and password update script
         $("#customer_update_btn").click(function() {
             var customerId = $("#update_customer_id").val();
             var customerUsername = $("#update_customer_username").val();
             var customerPassword = $("#update_customer_password").val();

             if (customerUsername.length == 0) {
                 toastr.error("Please Enter Your Username");
             } else if (customerUsername.length == 0) {
                 toastr.error("Please Enter Your Password");
             } else {
                 $.ajax({
                     url: "include/customers_server.php",
                     method: "POST",
                     data: {
                         customer_id: customerId,
                         customer_username: customerUsername,
                         customer_password: customerPassword,
                         updateCustomerData: 0
                     },
                     success: function(response) {
                         if (response == 1) {
                             toastr.success("Update Success");
                             $("#customerPasswordChangeModal").modal('hide');
                             setTimeout(() => {
                                 location.reload();
                             }, 1000);
                         } else {
                             toastr.error(response);
                         }
                     },
                     error: function(error) {
                         console.log(error);
                     }
                 });
             }

         });
         //customer Remarks update script
         $("#customer_remarks_update_btn").click(function() {
            var customerId = $("#update_customer_id").val();
            var customerRemarks = $("#update_customer_remarks").val();
               $.ajax({
                  url: "include/customers_server.php",
                  method: "POST",
                  data: {
                        customer_id: customerId,
                        customer_remarks: customerRemarks,
                        update_customer_remarks_data: true,
                  },
                  dataType:'json',
                  success: function(response) {
                        if (response.success) {
                           toastr.success(response.message);
                           $("#customerRmarksChangeModal").modal('hide');
                           setTimeout(() => {
                              location.reload();
                           }, 1000);
                        }else if(response.success==false){
                           toastr.error(response.message);
                        }
                  },
                  error: function(error) {
                        console.log(error);
                  }
               });

         });

         //customer username and password update script
         $("#reconnect").click(function() {
             //var customerId = $("#update_customer_id").val();
             //var customerFramedIP = <?php echo $framedipaddress; ?>;

             alert("customerFramedIP");



         });







         $(document).on('click', '#recharge_undo', function() {

         var rechargeID = $(this).attr("data-id");

         var confrm = confirm("Are you sure undo recharge ?"+rechargeID);


         if(confrm)
         {

         $.ajax({
             type: 'POST',
             url: 'include/customer_recharge_server.php',
             data: {
                 rechargeID: rechargeID,
                 undo_customer_recharge: 0
             },
             success: function(response) {

                 if (response == 1)
                 {
                     toastr.success("Recharge Undone!");
                     setTimeout(() => {
                                 location.reload();
                             }, 1000);
                 }
                 else
                 {
                     toastr.error(response);
                 }

             }
         });

         }

         });


         /*** Add ticket Modal Script****/
         ticket_modal();
         loadCustomers(<?php echo $lstid; ?>);
         ticket_assign(<?php echo $lstid; ?>);
         ticket_complain_type();
      </script>
   </body>
</html>

<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    if ($sales = $con->query("SELECT * FROM purchase WHERE id=".$_GET['id'] ."")) {
        while ($rows = $sales->fetch_array()) {
            $id = $rows['id'];
            $usr_id = $rows['usr_id'];
            $client_id = $rows['client_id'];
            $invoice_date = $rows['date'];
            $sub_total = $rows['sub_total'];
            $discount = $rows['discount'];
            $grand_total = $rows['grand_total'];
            $total_due = $rows['total_due'];
            $total_paid = $rows['total_paid'];
            $note = $rows['note'];
            $status = $rows['status'];
        }
    }
}
?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
   
</head>

<body data-sidebar="dark">
    
    <!-- Begin page -->
    <div id="layout-wrapper">
        <?= $page_title="Edit Purchase Invoice"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <form id="form-data" action="include/purchase_server.php?update_invoice=1&invoice_id=<?php echo $id; ?>" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header">
                                    <div class="row mb-3">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="refer_no" class="form-label">Refer No:</label>
                                                    <input class="form-control" type="text" placeholder="Type Your Refer No" id="refer_no" name="refer_no" >
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group mt-2">
                                                    <label>Suppliers Name</label>
                                                    <div class="input-group">
                                                        <select type="text" id="supplier_name" name="client_id" class="form-select select2">
                                                            <option>---Select---</option>
                                                        </select>
                                                        <button type="button" class="btn btn-primary add-supplier-btn" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
                                                        <span>+</span>
                                                    </button>
                                                    </div>
                                                   
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="note" class="form-label">Note:</label>
                                                    <input class="form-control" type="text" placeholder="Notes" id="note" name="note"  value="<?php echo $note; ?>">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="currentDate" class="form-label">Invoice Date</label>
                                                    <input class="form-control" type="date" id="currentDate" value="<?php echo date('Y-m-d', strtotime($invoice_date)); ?>" name="date">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                       
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="product_item" class="form-label">Product</label>
                                                    <div class="input-group">
                                                        <select type="text" id="product_name"  class="form-control">
                                                            <option>---Select---</option>
                                                        </select>
                                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addproductModal">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <div class="form-group">
                                                    <label for="qty" class="form-label">Quantity</label>
                                                    <input type="number" id="qty" class="form-control" min="1" value="1">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="price" class="form-label">Price</label>
                                                    <input type="text" class="form-control price" id="price" value="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="total_price" class="form-label">Total Price</label>
                                                    <input id="total_price" type="text" class="form-control total_price" value="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="details" class="form-label">Notes</label>
                                                    <input id="details" type="text" class="form-control" placeholder="Notes">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mt-1 ">
                                                <button type="button" id="submitButton" class="btn btn-primary mt-4">Add Now</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-bordered">
                                <thead class="bg bg-info text-white">
                                    <th>Product List</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                    <th></th>
                                </thead>
                                <tbody id="tableRow">
                                <?php
                                    $sql = "SELECT * FROM `purchase_details` WHERE invoice_id=$id";
                                    $result = mysqli_query($con, $sql);

                                    while ($rows = mysqli_fetch_assoc($result)) {

                                    ?>

                                <tr>
                                    <td>
                                        <?php
                                            $product_id = $rows["product_id"];
                                            if ($allPD = $con->query("SELECT * FROM products WHERE id='$product_id' ")) {
                                                while ($rowss = $allPD->fetch_array()) {
                                                    echo ' <input type="hidden" name="table_product_id[]" value="'.$rowss['id'].'">'; 
                                                    echo $rowss['name']; 
                                                }
                                            }
                                        ?>
                                    

                                    </td>
                                    <td>
                                        <input  type="hidden" min="1" name="table_qty[]" value="<?php echo $rows['qty']; ?>" class="form-control table_qty"><?php echo $rows['qty']; ?>
                                    </td>
                                    <td>
                                        <input  type="hidden" name="table_price[]" class="form-control table_price" value="<?php echo $rows['value']; ?>"><?php echo $rows['value']; ?>
                                    </td>
                                    <td>
                                        <input  type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="<?php echo $rows['total']; ?>"><?php echo $rows['total']; ?></td>
                                
                                        <td>
                                            <button class="btn btn-danger btn-sm removeRow">

                                                <i class="fas fa-times"></i>
                                            
                                            </button>
                                        </td>
                                
                                    </tr>
                                <?php } ?>

                                </tbody>
                                </table>
                                <div class="form-group text-end">
                                <button type="button"  data-bs-target="#invoiceModal" data-bs-toggle="modal" class="btn btn-success"><i class="fe fe-dollar"></i> Process Invoice</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- container-fluid -->
               
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php';?>
        </div>
        <!-- end main content-->
    </div>
    <?php include 'modal/product_modal.php'; ?>
    <?php include 'modal/supplier_modal.php'; ?>
    <div class="modal fade bs-example-modal-lg" id="invoiceModal" tabindex="-1" role="dialog"
               aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog " role="document">
                  <div class="modal-content col-md-12">
                     <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span
                           class="mdi mdi-account-check mdi-18px"></span> &nbsp;Invoice Summery</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form id="paymentForm">
                           
                           <div class="form-group mb-2">
                              <label>Total Amount </label>
                              <input readonly class="form-control table_total_amount" name="table_total_amount" type="text" value="<?php echo $sub_total; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label>Paid Amount </label>
                              <input  type="text" class="form-control table_paid_amount" name="table_paid_amount" value="<?php echo $total_paid; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label> Discount Amount </label>
                              <input  type="text" class="form-control table_discount_amount" name="table_discount_amount" value="<?php echo $discount; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label> Due Amount </label>
                              <input type="text" readonly class="form-control table_due_amount" name="table_due_amount" value="<?php echo $total_due; ?>">
                           </div>
                           <div class="form-group mb-2">
                                <label>Select Accounts</label>
                                <select type="text" class="form-control" id="sub_ledger_id" name="sub_ledger_id"
                                    style="width: 100%;">
                                    <?php
                                    if ($ledgr = $con->query('SELECT * FROM ledger')) {
                                        echo '<option value="">Select</option>';
                                    
                                        while ($rowsitm = $ledgr->fetch_array()) {
                                            $ldgritmsID = $rowsitm['id'];
                                            $ledger_name = $rowsitm['ledger_name'];
                                    
                                            echo '<optgroup label="' . $ledger_name . '">';
                                    
                                            // Sub Ledger items list
                                            if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                                while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                    $sub_ldgrid = $rowssb['id'];
                                                    $ldgr_items = $rowssb['item_name'];
                                    
                                                    echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                                }
                                            }
                                    
                                            echo '</optgroup>';
                                        }
                                    }
                                    ?>
                                </select>
                            </div>
                           <div class="form-group mb-2">
                              <label>Type</label>
                              <select type="text" class="form-select table_status" name="table_status">
                                <option value="">---Select---</option>
                                <option value="0" <?php echo ($status == 0) ? 'selected' : ''; ?>>Draft</option>
                                <option value="1" <?php echo ($status == 1) ? 'selected' : ''; ?>>Completed</option>
                                <option value="2" <?php echo ($status == 2) ? 'selected' : ''; ?>>Print Invoice</option>
                            </select>
                           </div>
                           <div class="form-check">
                                <input class="form-check-input" type="checkbox"  name="table_assets">
                                <label class="form-check-label" for="flexCheckChecked">
                                    Assets
                                </label>
                            </div>
                           <div class="modal-footer ">
                              <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                              <button type="button" id="save_invoice_btn" class="btn btn-success">Save Invoice</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->

    <?php include 'script.php'; ?>
    <script src="modal/product_modal.js"></script>
    <script src="modal/supplier_modal.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#supplier_name").select2(); 
            $("#product_name").select2(); 

          var selectedProductId = null;
            getProductData();
            function getProductData() {

                $.ajax({
                    url: "include/purchase_server.php?getProductData",
                    method: 'GET',
                    success: function(response) {
                        $('#product_name').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
            getSupplierData()

            function getSupplierData() {
                var client_id=<?php echo $client_id; ?>;
                $.ajax({
                    url: "include/purchase_server.php?getSupplierData",
                    method: 'GET',
                    success: function(response) {
                        $('#supplier_name').html(response);
                        $('#supplier_name').val(client_id);
                    
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
            $("#product_name").change(function() {
                var itemId = $(this).val();
                $.ajax({
                    url: "include/purchase_server.php?getSingleProductData",
                    method: 'GET',
                    data: {
                        id: itemId
                    },
                    success: function(response) {
                        var data = JSON.parse(response);
                        selectedProductId = data.id;
                        var price = data.sale_price;

                        $('#price').val(price);
                        updateTotalPrice();

                    },
                    error: function(xhr, status, error) {
                        /*handle the error response*/ 
                        console.log(error);
                    }
                });
            });
            $('#qty').on('input', function() {
                updateTotalPrice();
            });
            $('#price').on('input', function() {
                updateTotalPrice();
            });

            function updateTotalPrice() {
                var qty = $('#qty').val();
                var price = $('#price').val();
                var total = qty * price;
                $('#total_price').val(total);
               
            }

            $(document).on('click','#submitButton',function(e){
                e.preventDefault(); 
                var productName = $('#product_name option:selected').text();
                var quantity = $('#qty').val();
                var price = $('#price').val();
                var totalPrice = $('#total_price').val();

                if(!selectedProductId || !quantity || !price || !totalPrice) {
                    toastr.error('Please fill in all fields');
                    return;
                }
                $('#submitButton').html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`).prop('disabled', true);
                $.ajax({
                    url: 'include/product_server.php?check_product_qty=true', 
                    method: 'POST',
                    data: { product_id: selectedProductId, qty: quantity },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var row = `<tr>
                                <td><input type="hidden" name="table_product_id[]" value="`+ selectedProductId +`">${productName}</td>
                                <td><input type="hidden" min="1" name="table_qty[]" value="${quantity}" class="form-control table_qty">${quantity}</td>
                                <td><input type="hidden" name="table_price[]" class="form-control table_price" value="${price}">${price}</td>
                                <td><input type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="${totalPrice}">${totalPrice}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm removeRow">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>`;
                            $("#tableRow").append(row);
                            

                            calculateTotalAmount(); 

                            /*Clear The Fild*/
                            $('#product_name').val('');
                            $('#qty').val('1');
                            $('#price').val('');
                            $('#total_price').val('');
                            selectedProductId = null;
                        } else if(response.success==false) {
                            /*IF The Stock Is Not Available*/
                            toastr.error(response.message);
                        }
                       
                    },
                    error: function() {
                      //  toastr.error('Error checking product stock.');

                    },
                    complete:function(){
                        $('#submitButton').html('Submit').prop('disabled', false);
                    }
                });
            });
            $(document).on('click', '.removeRow', function() {
                $(this).closest('tr').remove();
                calculateTotalAmount(); 
            });
            /* Calculate total amount function*/
            function calculateTotalAmount() {
                var totalAmount = 0;
                $('#tableRow tr').each(function() {
                    var total_price = $(this).find('input[name="table_total_price[]"]').val();
                    totalAmount += parseFloat(total_price);
                });
                $('input[name="table_total_amount"]').val(totalAmount);

                // Calculate Due Amount
                var paidAmount = parseFloat($('input[name="table_paid_amount"]').val()) || 0;
                var discountAmount = parseFloat($('input[name="table_discount_amount"]').val()) || 0;
                var dueAmount = totalAmount - paidAmount - discountAmount;
                $('input[name="table_due_amount"]').val(dueAmount);
            }
            /*Update Due Amount when Paid Amount or Discount changes*/ 
            $(document).on('input', 'input[name="table_paid_amount"], input[name="table_discount_amount"]', function() {
                calculateTotalAmount();
            });

            $('#save_invoice_btn').on('click', function() {
                var mainFormData = $('#form-data').serializeArray();
                var modalFormData = $('#paymentForm').serializeArray(); 
                var allFormData = $.merge(mainFormData, modalFormData);
                var isValid = true;
                /*Validate each form data field*/
                $.each(allFormData, function(index, field) {
                    if (field.name === 'client_id' && field.value === '') {
                        toastr.error("Suppliers must be selected!");
                        isValid = false;
                        return false;
                    } else if (field.name === 'table_paid_amount' && field.value === '') {
                        toastr.error("Paid Amount is required");
                        isValid = false;
                        return false;
                    } else if (field.name === 'date' && field.value === '') {
                        toastr.error("Date is required!");
                        isValid = false;
                        return false;
                    } else if (field.name === 'table_status' && field.value === '') {
                        toastr.error("Type is required!");
                        isValid = false;
                        return false;
                    }else if(field.name === 'sub_ledger_id' && field.value === ''){
                        toastr.error("Select Accounts is required!");
                        isValid = false;
                        return false;
                    }
                });

                if (!isValid) {
                    return false;
                }
                $(this).prop('disable',true).html('Saving...'); 
                $.ajax({
                    type:'POST',
                    url:$("#form-data").attr('action'),
                    data:$.param(allFormData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message);
                            /*Close the invoice modal*/ 
                            $('#invoiceModal').modal('hide'); 
                            setTimeout(() => {
                                location.reload(); 
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    },
                    error:function(xhr,status,error){
                        toastr.error("Error:"+error); 
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    }
                }); 
            });
         

        });

        $('#invoiceModal').on('shown.bs.modal', function () {
            if (!$('#sub_ledger_id').hasClass("select2-hidden-accessible")) {
                $('#sub_ledger_id').select2({
                    dropdownParent: $('#invoiceModal')
                });
            }
            
        });

    </script>


</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
error_reporting(E_ALL);
ini_set('display_errors', 1);
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Purchase Invoice List'; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <a href="purchase.php" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" style="margin-bottom: 12px;">&nbsp;&nbsp;New Invoice </a>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                            <div class="card-header">
                                    <div class="row d-flex">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="start_date">Start Date:</label>
                                                <input type="date" id="start_date" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="end_date">End Date:</label>
                                                <input type="date" id="end_date" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mt-1">
                                                <button id="filter_invoice_btn" class="btn btn-primary mt-3">Search Now</button>
                                              
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="invoice-table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>Invoice id</th>
                                                    <th>Supplier Name</th>
                                                    <th>Sub Total</th>
                                                    <th>Discount</th>
                                                    <th>Total Due</th>
                                                    <th>Grand Total</th>
                                                    <th>Status</th>
                                                    <th>Invoice Date</th>
                                                    <th>Create Date</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="invoice-list">
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
     
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script type="text/javascript">
        $(document).ready(function(){
            //var table = $('#invoice-table').DataTable();
             /* Fetch initial data*/
             __fetch_invoice_data();

            /* Filter button click event*/
            $('#filter_invoice_btn').click(function() {
                var startDate = $('#start_date').val();
                var endDate = $('#end_date').val();

                if (startDate.length=='') {
                    toastr.error("Please Select Date"); 
                }
                else if (endDate.length=='') {
                    toastr.error("Please Select Date"); 
                }else{
                    $("#filter_invoice_btn").html('<span class="spinner-border spinner-border-sm" aria-hidden="true"></span> Loading...');
                    $("#filter_invoice_btn").prop('disabled', true);
                    __fetch_invoice_data(startDate,endDate);
                }
               
            });
            function __fetch_invoice_data(startDate,endDate) {

                $.ajax({
                    url: 'include/purchase_server.php',
                    type: 'GET',
                    data: {
                        start_date: startDate,
                        end_date: endDate,
                        fetch_invoice:true,
                    },
                    success: function(response) {
                        $('#invoice-list').html(response);
                        $("#invoice-table").DataTable();
                        $('#filter_invoice_btn').html('Search');
                        $('#filter_invoice_btn').prop('disabled', false);
                    }
                });
            }

            /*Delete Script*/
            $(document).on('click',"button[name='delete_button']",function(){
                var id=$(this).data('id');
                if (confirm("Are you sure you want to delete this item?")) {
                   
                    $.ajax({
                        type: 'POST', 
                        url: 'include/purchase_server.php',
                        data: { delete_invoice: true, invoice_id: id }, 
                        dataType:'json',
                        success: function(response) {
                            if (response.success) {
                                toastr.success("Deleted successfully!");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error(xhr.responseText);
                            toastr.error("Error deleting item! " + error);
                        }
                    });
                }
            });
            
        });



      
    </script>
</body>

</html>

<?php
include 'include/db_connect.php';
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/pop_security.php';
?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">
    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title = 'Purchase';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <form id="form-data" action="include/purchase_server.php?add_invoice" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header">
                                        <div class="row ">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="refer_no" class="form-label">Refer No:</label>
                                                    <input class="form-control" type="text"
                                                        placeholder="Type Your Refer No" id="refer_no" name="refer_no">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group mt-2">
                                                    <label>Suppliers Name</label>

                                                    <div class="input-group">
                                                        <select type="text" id="supplier_name" name="client_id"
                                                            class="form-select select2" required>
                                                            <option>---Select---</option>
                                                        </select>
                                                        <button type="button" class="btn btn-primary add-supplier-btn"
                                                            data-bs-toggle="modal" data-bs-target="#addSupplierModal">
                                                            <span>+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="note" class="form-label">Note:</label>
                                                    <input class="form-control" type="text" placeholder="Notes"
                                                        id="note" name="note">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="currentDate" class="form-label">Invoice Date</label>
                                                    <input class="form-control" type="date" id="currentDate"
                                                        name="date">
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="product_item" class="form-label">Product</label>
                                                    <div class="input-group">
                                                        <select id="product_name" class="form-select select2"
                                                            aria-label="Product Name">
                                                            <option value="">---Select---</option>
                                                        </select>
                                                        <button type="button" class="btn btn-primary add-product-btn"
                                                            data-bs-toggle="modal" data-bs-target="#addproductModal">
                                                            <span>+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <div class="form-group">
                                                    <label for="qty" class="form-label">Quantity</label>
                                                    <input type="number" id="qty" class="form-control"
                                                        min="1" value="1">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="price" class="form-label">Price</label>
                                                    <input type="text" class="form-control price" id="price"
                                                        placeholder="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="total_price" class="form-label">Total Price</label>
                                                    <input id="total_price" type="text"
                                                        class="form-control total_price" placeholder="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="details" class="form-label">Notes</label>
                                                    <input id="details" type="text" class="form-control"
                                                        placeholder="Notes">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mt-1">
                                                    <button type="button" id="submitButton"
                                                        class="btn btn-primary mt-4">Add Now</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-bordered">
                                    <thead class="bg bg-info text-white">
                                        <th>Product List</th>
                                        <th>Qty</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                        <th></th>
                                    </thead>
                                    <tbody id="tableRow">
                                    </tbody>

                                </table>
                                <div class="form-group text-end">
                                    <button type="button" name="finished_btn" class="btn btn-success"><i
                                            class="fe fe-dollar"></i> Process</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- container-fluid -->

            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <?php include 'modal/product_modal.php'; ?>
    <?php include 'modal/supplier_modal.php'; ?>
    <div class="modal fade bs-example-modal-lg" id="invoiceModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                            class="mdi mdi-account-check mdi-18px"></span> &nbsp;Invoice Summery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="form-group mb-2">
                            <label>Total Amount </label>
                            <input readonly class="form-control table_total_amount" name="table_total_amount"
                                type="text" required>
                        </div>
                        <div class="form-group mb-2">
                            <label>Paid Amount </label>
                            <input type="text" class="form-control table_paid_amount" name="table_paid_amount"
                                value="00" required>
                        </div>
                        <div class="form-group mb-2">
                            <label> Discount Amount </label>
                            <input type="text" class="form-control table_discount_amount"
                                name="table_discount_amount" value="00">
                        </div>
                        <div class="form-group mb-2">
                            <label> Due Amount </label>
                            <input type="text" readonly class="form-control table_due_amount"
                                name="table_due_amount" value="00">
                        </div>
                        <div class="form-group mb-2">
                            <label>Select Accounts</label>
                            <select type="text" class="form-control" id="sub_ledger_id" name="sub_ledger_id"
                                 style="width: 100%;">
                                <?php
                                if ($ledgr = $con->query('SELECT * FROM ledger')) {
                                    echo '<option value="">Select</option>';
                                
                                    while ($rowsitm = $ledgr->fetch_array()) {
                                        $ldgritmsID = $rowsitm['id'];
                                        $ledger_name = $rowsitm['ledger_name'];
                                
                                        echo '<optgroup label="' . $ledger_name . '">';
                                
                                        // Sub Ledger items list
                                        if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                            while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                $sub_ldgrid = $rowssb['id'];
                                                $ldgr_items = $rowssb['item_name'];
                                
                                                echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                            }
                                        }
                                
                                        echo '</optgroup>';
                                    }
                                }
                                ?>
                            </select>
                        </div>
                        <div class="form-group mb-2">
                            <label>Type</label>
                            <select type="text" class="form-select table_status" name="table_status">
                                <option value="">---Select---</option>
                                <option value="0">Draf</option>
                                <option value="1">Completed</option>
                                <option value="2">Print Invoice</option>
                            </select>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="table_assets">
                            <label class="form-check-label" for="flexCheckChecked">
                                Assets
                            </label>
                        </div>
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="button" id="save_invoice_btn" class="btn btn-success">Save
                                Invoice</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- END layout-wrapper -->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>

    <script src="modal/product_modal.js"></script>
    <script src="modal/supplier_modal.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $("#supplier_name").select2();
            $("#product_name").select2();
           

            var selectedProductId = null;
            getProductData();

            function getProductData() {

                $.ajax({
                    url: "include/purchase_server.php?getProductData",
                    method: 'GET',
                    success: function(response) {
                        $('#product_name').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
            getSupplierData()

            function getSupplierData() {

                $.ajax({
                    url: "include/purchase_server.php?getSupplierData",
                    method: 'GET',
                    success: function(response) {
                        $('#supplier_name').html(response);

                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
            $("#product_name").change(function() {
                var itemId = $(this).val();
                $.ajax({
                    url: "include/purchase_server.php?getSingleProductData",
                    method: 'GET',
                    data: {
                        id: itemId
                    },
                    success: function(response) {
                        var data = JSON.parse(response);
                        selectedProductId = data.id;
                        var price = data.purchase_price;

                        $('#price').val(price);
                        updateTotalPrice();

                    },
                    error: function(xhr, status, error) {
                        /*handle the error response*/
                        console.log(error);
                    }
                });
            });
            $('#qty').on('input', function() {
                updateTotalPrice();
            });
            $('#price').on('input', function() {
                updateTotalPrice();
            });

            function updateTotalPrice() {
                var qty = $('#qty').val();
                var price = $('#price').val();
                var total = qty * price;
                $('#total_price').val(Math.round(parseFloat(total), 2));

            }

            $(document).on('click', '#submitButton', function(e) {
                e.preventDefault();

                var productName = $('#product_name option:selected').text();
                var quantity = $('#qty').val();
                var price = $('#price').val();
                var totalPrice = $('#total_price').val();

                if (!selectedProductId || !quantity || !price || !totalPrice) {
                    toastr.error('Please fill in all fields');
                    return;
                }
                var row = `<tr>
                    <td><input type="hidden" name="table_product_id[]"value="` + selectedProductId + `">${productName}</td>

                    <td><input type="hidden" min="1" name="table_qty[]" value="${quantity}" class="form-control table_qty">${quantity}</td>

                    <td><input  type="hidden" name="table_price[]" class="form-control table_price" value="${price}">${price}</td>

                    <td><input  type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="${totalPrice}">${totalPrice}</td>

                   <td>
                   <button class="btn btn-danger btn-sm removeRow">

                    <i class="fas fa-times"></i>
                   
                   </button>
                   </td>

                   
                    
                  </tr>`;

                $("#tableRow").append(row);
                calculateTotalAmount();
                $('#product_name').val('');
                $('#qty').val('1');
                $('#price').val('');
                $('#total_price').val('');
                selectedProductId = null;
            });
            $(document).on('click', '.removeRow', function() {
                $(this).closest('tr').remove();
                calculateTotalAmount();
            });
            /* Calculate total amount function*/
            function calculateTotalAmount() {
                var totalAmount = 0;
                $('#tableRow tr').each(function() {
                    var total_price = $(this).find('input[name="table_total_price[]"]').val();
                    totalAmount += parseFloat(total_price);
                });
                $('input[name="table_total_amount"]').val(totalAmount);

                // Calculate Due Amount
                var paidAmount = parseFloat($('input[name="table_paid_amount"]').val()) || 0;
                var discountAmount = parseFloat($('input[name="table_discount_amount"]').val()) || 0;
                var dueAmount = totalAmount - paidAmount - discountAmount;
                $('input[name="table_due_amount"]').val(dueAmount);
            }
            /*Update Due Amount when Paid Amount or Discount changes*/
            $(document).on('input', 'input[name="table_paid_amount"], input[name="table_discount_amount"]',
                function() {
                    calculateTotalAmount();
                });
            $('#save_invoice_btn').on('click', function() {
                var mainFormData = $('#form-data').serializeArray();
                var modalFormData = $('#paymentForm').serializeArray();
                var allFormData = $.merge(mainFormData, modalFormData);
                var isValid = true;
                /*Validate each form data field*/
                $.each(allFormData, function(index, field) {
                    if (field.name === 'client_id' && field.value === '') {
                        toastr.error("Suppliers must be selected!");
                        isValid = false;
                        return false;
                    } else if (field.name === 'table_paid_amount' && field.value === '') {
                        toastr.error("Paid Amount is required");
                        isValid = false;
                        return false;
                    } else if (field.name === 'date' && field.value === '') {
                        toastr.error("Date is required!");
                        isValid = false;
                        return false;
                    } else if (field.name === 'table_status' && field.value === '') {
                        toastr.error("Type is required!");
                        isValid = false;
                        return false;
                    }else if(field.name === 'sub_ledger_id' && field.value === ''){
                        toastr.error("Select Accounts is required!");
                        isValid = false;
                        return false;
                    }
                });

                if (!isValid) {
                    return false;
                }

                $(this).prop('disable', true).html('Saving...');
                $.ajax({
                    type: 'POST',
                    url: $("#form-data").attr('action'),
                    data: $.param(allFormData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message);
                            /*Close the invoice modal*/
                            $('#invoiceModal').modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    },
                    error: function(xhr, status, error) {
                        toastr.error("Error:" + error);
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    }
                });
            });

        });
        $(document).on('click', 'button[name="finished_btn"]', function() {
            $('#invoiceModal').modal('show');
        });

        $('#invoiceModal').on('shown.bs.modal', function () {
            if (!$('#sub_ledger_id').hasClass("select2-hidden-accessible")) {
                $('#sub_ledger_id').select2({
                    dropdownParent: $('#invoiceModal')
                });
            }
            
        });
    </script>



</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Customers</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                   
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive ">
                                        <table id="customers_table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <!-- <th>Check All <input type="checkbox" id="checkedAll" name="checkedAll" value="Bike"></th> -->
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    
                                                    <th>User Name</th>
                                                    <th>Status</th>
                                                    <th>Password</th>
                                                    <th>User End Pass</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="customer-list">
    <?php
    $result = $con->query("SELECT * FROM customers");

    while ($rows = mysqli_fetch_assoc($result)) {

        $custUsername = $rows["username"];
        $pwd = $rows["password"];

        $pwdtry = "";
        $cstpwd = $con->query("SELECT * FROM radpostauth WHERE username='$custUsername' LIMIT 1");
        if ($cstpwd->num_rows > 0) {
            while ($pwdRow = $cstpwd->fetch_array()) {
                $pwdtry = $pwdRow['pass'];
            }
            if ($pwdtry != $pwd) {
                $pwdstatus = '
                <span id="' . $custUsername . '" class="badge bg-danger">Not Matched</span>
                <button type="button" class="btn-sm btn-info missmtchID" data-id="' . $custUsername . '" data-idp="' . $pwdtry . '">
                    <i class="fas fa-sync"></i>
                </button>';
                ?>
                <tr>
                    <td><?php echo $rows['id']; ?></td>
                    <td>
                        <a target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>">
                            <?php 
                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$custUsername'");
                            $chkc = $onlineusr->num_rows;
                            if ($chkc == 1) {
                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                            } else {
                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';
                            }
                            echo ' ' . $rows["fullname"]; 
                            ?>
                        </a>
                    </td>
                    <td><?php echo $custUsername; ?></td>
                    <td><?php echo $pwdstatus; ?></td>
                    <td><?php echo $pwd; ?></td>
                    <td><?php echo $pwdtry; ?></td>
                    <td>
                        <a class="btn btn-info" target="_blank" href="profile_edit.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>
                        <a class="btn btn-success" target="_blank" href="profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i></a>
                    </td>
                </tr>
                <?php
            }
        }
    }
    ?>
</tbody>


                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        $("#customers_table").DataTable();

        $(document).on('keyup', '#customer_username', function() {
            var customer_username = $("#customer_username").val();
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_username: customer_username
                },
                success: function(response) {
                    $("#usernameCheck").html(response);
                }
            });
        });
        
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    current_pop_name: pop_id
                },
                success: function(response) {
                     $("#customer_area").html(response);
                }
            });
        });
        $(document).on('change', '#customer_pop', function() {
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pop_name: pop_id,
                    getCustomerPackage:0
                },
                success: function(response) {
                     $("#customer_package").html(response);
                }
            });
        });
        $(document).on('change', '#customer_package', function() {
            var packageId = $("#customer_package").val();
            var pop_id = $("#customer_pop").val();
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    package_id: packageId,
                    pop_id: pop_id,
                    getPackagePrice:0
                },
                success: function(response) {
                     $("#customer_price").val(response);
                }
            });
        });


        $(document).on('click','.missmtchID', function(){

            var pwdmissname = $(this).attr("data-id");
            var pwdtry = $(this).attr("data-idp");
           // alert(pop_id);
            $.ajax({
                type: 'POST',
                url: "include/customers_server.php",
                data: {
                    pwdmissname: pwdmissname,
                    pwdtry: pwdtry
                    
                },
                success: function(response) {
                    $("#"+pwdmissname).hide(300);
                }
            });



            });

        
      
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title"> Recharge Filter</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="profileImages/avatar.png" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                    <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row" id="searchRow">
                <div class="col-md-4 col-sm m-auto">
                    <div class="card">
                        <div class="card-header">Recharge Filter</div>
                        <div class="card-body">
                            <div class="form-gruop mb-2">
                                <label>From Date</label>
                                <input type="text" name="" id="popid"  class="form-control d-none" value="<?php echo $auth_usr_POP_id;?>">
                                <input type="date" name="" id="fromDate"  class="form-control">
                            </div>
                            <div class="form-gruop mb-2">
                                <label>To Date</label>
                                <input type="date" name="" id="toDate" placeholder="Enter Student Id" class="form-control">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-success"style="width: 100%;" type="button" id="searchBtn"><i class="fas fa-filter"></i>&nbsp;&nbsp;Filter Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row d-none" id="FilterTable">
                <div class="col-md-12 col-sm-12 m-auto">
                    <div class="card" id="mainCard">
                        <div class="card-body">
                           <table id="rechargeDataTable" class="table table-bordered dt-responsive nowrap " style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                               <thead>
                                   <tr>
                                      <th> Customer Name </th>
                                      <th> Recharged date </th>
                                      <th> Months</th>
                                     
                                      <th> Paid until </th>
                                      <th> Amount </th>
                                   </tr>
                                </thead>
                                <tbody id="rechargeTable"></tbody>
                           </table> 
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
       <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script src="js/toastr/toastr.min.js"></script>
        <script src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>

        <script src="assets/js/app.js"></script>

        <script type="text/javascript">
              function downloadCSV(csv, filename) {
                var csvFile;
                var downloadLink;

                csvFile = new Blob([csv], {type: "text/csv"});

                downloadLink = document.createElement("a");

                downloadLink.download = filename;

                downloadLink.href = window.URL.createObjectURL(csvFile);

                downloadLink.click();
            }

            function exportTableToCSV(filename) {
                var csv = [];
                var rows = document.querySelectorAll("#rechargeDataTable tr");

                for (var i = 0; i < rows.length; i++) {
                    var row = [], cols = rows[i].querySelectorAll("td, th");

                    for (var j = 0; j < cols.length; j++) 
                        row.push(cols[j].innerText);

                    csv.push(row.join(","));        
                }
                downloadCSV(csv.join("\n"), filename);
            }

            function exportTableToPDF(filename) {
                var { jsPDF } = window.jspdf;
                var doc = new jsPDF();

                doc.autoTable({ html: '#rechargeDataTable' });

                doc.save(filename);
            }
        $(document).ready(function(){
            $("#searchBtn").on('click',function(){
                var fromDate=$("#fromDate").val();
                var toDate=$("#toDate").val();
                var popid=$("#popid").val();
                if (fromDate.length==0) {
                    toastr.error("From Date is require");
                }else if(toDate.length==0){
                    toastr.error("To Date is require");
                }else{
                    var rechargeFilter="0";
                    $.ajax({
                        url: 'include/rechargeFilter.php',
                        type: 'POST',
                        data: {rechargeFilter: rechargeFilter, fromDate: fromDate, toDate: toDate, popid: popid},
                        success: function(response) {
                            $("#rechargeTable").html(response);
                            $("#FilterTable").removeClass('d-none');
                            $("#searchRow").addClass('d-none');

                            $("<button class='btn-sm btn btn-danger' style='margin-top: 10px; margin-right: 10px;'>Export to CSV</button>").insertAfter("#rechargeDataTable").on('click', function() {
                                exportTableToCSV('recharge_data.csv');
                            });
                            $("<button class='btn-sm btn btn-success' style='margin-top: 10px; margin-left: 10px;'>Export to PDF</button>").insertAfter("#rechargeDataTable").on('click', function() {
                                exportTableToPDF('recharge_data.pdf'); 
                            });

                        }
                    }); 
                }
                
            });
        });
        </script>
    </body>
</html>

<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_SESSION['uid'])) {
    $ledgr_id = $_SESSION["uid"];
}

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    
</head>

<body data-sidebar="dark">
    <!-- Begin page -->
    <div id="layout-wrapper">
       <?php $page_title="Reports"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">From Date</label>
                                            <input type="date" class="form-control" id="fromDate">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">To Date</label>
                                            <input type="date" class="form-control" id="endDate" value="<?php echo date('Y-m-d');?>">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group mb-2">
                                            <label for="">Master Ledger</label>
                                            <select class="form-select" id="masterLedger">
                                                <option value="">Select</option>
                                                <option value="1">Income</option>
                                                <option value="2">Expense</option>
                                                <option value="3">Asset</option>
                                                <option value="4">Liabilities</option>
                                                <option value="5">Income Vs Expense</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" id="searchBtn" class="btn btn-primary mt-3">Search Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                   
                                    <div class="table-responsive" id="tableArea">
                                    <!-- <table class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Ledger</th>
                                                <th>Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>
                                                    <b>Main Ledger 1</b><br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub Ledger Item 1 - <span style="float:right">1000</span><br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub Ledger Item 2 - <span style="float:right">2000</span><br>
                                                </td>
                                                <td>3000</td>
                                            </tr>
                                            <tr>
                                                <td>2</td>
                                                <td>
                                                    <b>Main Ledger 2</b><br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub Ledger Item 1 - <span style="float:right">1500</span><br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub Ledger Item 2 - <span style="float:right">2500</span><br>
                                                </td>
                                                <td>4000</td>
                                            </tr>
                                            <tr>
                                                <td colspan="2" style="text-align: right;"><b>Total:</b></td>
                                                <td>7000</td>
                                            </tr>
                                        </tbody>
                                    </table> -->

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Add Sub Ledger</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">

                                        <div class="form-group mb-2" style="width:100%">
                                            <label for="">Ledger Name</label>
                                            <select name="ledger_id" id="sub_ledger_id" class="form-select">
                                                <?php
                                                if ($ledgr = $con->query("SELECT * FROM ledger")) {

                                                    while ($rowsitm = $ledgr->fetch_array()) {
                                                        $ldgritmsID = $rowsitm["id"];
                                                        $ledger_name = $rowsitm["ledger_name"];
                                                        echo '<option value="' . $ldgritmsID . '">' . $ledger_name . '</option>';
                                                    }
                                                }


                                                ?>
                                            </select>
                                        </div>
                                        <div class="form-group mb-2">
                                            <label for="">Sub Ledger Name</label>
                                            <input id="item_name" type="text" class="form-control" placeholder="Enter Item Name">
                                        </div>
                                        <div class="form-group mb-2">
                                            <label for="">Description</label>
                                            <input id="subLedgerDescription" type="text" class="form-control" name="description" placeholder="description">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button id="addSubLedgerBtn" type="submit" class="btn btn-primary">Add Sub Ledger</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->

    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $(document).on('click', '#searchBtn', function() {
                var masterLedger = $('#masterLedger').val();
                var fromDate = $('#fromDate').val();
                var endDate = $('#endDate').val();

                if (fromDate.length == 0) {
                    toastr.error("From Date is Require");
                } else if (endDate.length == 0) {
                    toastr.error("To Date is Require");
                } else if (masterLedger.length == 0) {
                    toastr.error("Please Select Ledger");
                } else {
                    $("#searchBtn").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
                    
                    $.ajax({
                        type: 'POST',
                        data: {
                            masterLedger: masterLedger,
                            fromDate: fromDate,
                            endDate: endDate,
                            getReport: 0,
                        },
                        url: "include/transactions_server.php",
                        success: function(response) {
                            $("#searchBtn").html('Search Now');
                            $('#tableArea').html(response);
                        },
                        error: function(xhr, status, error) {
                            // handle the error response
                            console.log(error);
                        }
                    });
                }

            });
        });

        function printTable() {
            var divToPrint = document.getElementsByClassName('report_table');
            var newWin = window.open('', '_blank');
            newWin.document.write('<html><head><title>Customer</title>');
            newWin.document.write('<style>');
            newWin.document.write('table { width: 100%; border-collapse: collapse; }');
            newWin.document.write('table, th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('a { text-decoration: none; color: black; }');
            newWin.document.write('</style></head><body>');
            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');
            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }
    </script>


</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");

?>

<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- DataTables -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Responsive datatable examples -->
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
        <link rel="stylesheet" type="text/css" href="css/deleteModal.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Router Setting</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
               <div class="col-md-12 grid-margin">
                  <div class="d-flex justify-content-between flex-wrap">
                     <div class="d-flex align-items-end flex-wrap">
                        <div class="mr-md-3 mr-xl-5">
                           <div class="d-flex">
                              <i class="mdi mdi-home text-muted hover-cursor"></i>
                              <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                              </p>
                              <p class="text-primary mb-0 hover-cursor">Router Setting</p>
                           </div>
                        </div>
                        <br>
                     </div>
                     <div class="d-flex justify-content-between align-items-end flex-wrap">
                        <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New Router</button>
                     </div>

                     <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel" id="addModal" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Router</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="">
                               <form id="customer_form">
                                  <div class="card">
                                      <div class="card-body">
                                         <div class="row">
                                              <div class="col-md-6">
                                                 <div class="form-group mb-2">
                                                        <label>Name</label>
                                                        <input id="name" type="text"
                                                         class="form-control "
                                                         placeholder="Enter Your Name" />
                                                  </div> 
                                              </div>
                                              <div class="col-md-6">
                                                 <div class="form-group mb-2">
                                                        <label>IP</label>
                                                        <input id="ip" type="text"
                                                         class="form-control "
                                                         placeholder="Enter Your IP" />
                                                  </div> 
                                              </div>
                                          </div>
                                          <div class="row">
                                              <div class="col-md-6">
                                                   <div class="form-group mb-2">
                                                        <label>Radius Secret</label>
                                                        <input id="secret" type="text"class="form-control "
                                                         placeholder="Enter Radius Secret" />
                                                  </div>
                                              </div>
                                              <div class="col-md-6">
                                                 <div class="form-group mb-2">
                                                        <label>Radius Inc. Port</label>
                                                        <input id="port" type="text"class="form-control "
                                                         placeholder="Enter Radius Secret" />
                                                  </div>
                                              </div>
                                          </div>
                                          <div class="row">
                                              <div class="col-md-6 ">
                                                 <div class="form-group mb-2">
                                                  <label>API User</label>
                                                      <input id="api_user" type="text"class="form-control "
                                                         placeholder="Enter API User" />
                                                  </div> 
                                              </div>
                                              <div class="col-md-6 ">
                                                  <div class="form-group mb-2">
                                                       <label>API Password</label>
                                                      <input id="api_pass" type="text"class="form-control "
                                                         placeholder="Enter API Password" />
                                                  </div> 
                                              </div>
                                          </div>
                                          <div class="row">
                                              <div class="col-md-6">
                                                 <div class="form-group mb-2">
                                                   <label>Port</label>
                                                    <input id="port" type="text" class="form-control"
                                                     placeholder="Enter Your Port" />
                                                  </div> 
                                              </div>
                                              <div class="col-md-6">
                                                 <div class="form-group mb-2">
                                                  <label>Email</label>
                                                  <input id="email" type="email"
                                                     class="form-control"
                                                     placeholder="Enter Your Email" />
                                                  </div> 
                                              </div>
                                          </div>  
                                      </div>
                                  </div> 
                               </form> 
                            </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                              <button type="button" class="btn btn-success" id="customer_add">Add Now</button>
                           </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
         <div class="col-md-12 stretch-card">
            <div class="card">
               <div class="card-body">
                  <div class="col-md-6 float-md-right grid-margin-sm-0">
                     <div class="form-group">
                        
                     </div>
                  </div>
                  <div class="table-responsive ">
                    <table id="customers_table" class="table table-striped table-bordered  nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                        <thead>
                           <tr>
                                <th>Type</th>
                                <th>IP</th>
                                <th> IP-2</th>
                                <th> Name</th>
                                <th> Incoming</th>
                                <th>API Login/Port</th>
                                <th>Status</th>
                                <th>&nbsp;</th>
                           </tr>
                        </thead>
                        <tbody id="customer-list">
                           
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
         </div>
      </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->
        
        <div id="deleteModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box">
                    <i class="fa fa-trash"></i>
                </div>
                <h4 class="modal-title w-100">Are you sure?</h4>
                <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
            </div>
            <div class="modal-body">
                <p>Do you really want to delete these records? This process cannot be undone.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
            </div>
        </div>
    </div>
</div>
        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
         <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
    </body>
</html>


<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    <style>
    @media print {
        .removeRow, .hide-on-print {
            display: none !important;
        }
    }
</style>
</head>

<body data-sidebar="dark">
    <div id="loader" style="display:none ;">
        <img class="mx-auto d-block img-fluid" height="100px" width="200px" src="https://media.tenor.com/I6kN-6X7nhAAAAAi/loading-buffering.gif" alt="Loading..."> 
    </div>
    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title="Sale";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <form id="form-data" action="include/sale_server.php?add_invoice" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header">
                                    <div class="row mb-3">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="refer_no" class="form-label">Refer No:</label>
                                                    <input class="form-control" type="text" placeholder="Type Your Refer No" id="refer_no" name="refer_no">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group mt-2">
                                                    <label>Client Name</label>
                                                    <div class="input-group">
                                                    <select type="text" id="client_name" name="client_id" class="form-select">
                                                        <option value="">---Select---</option>
                                                            <?php 

                                                            if($allClient=$con->query("select * from clients")){
                                                                while($rows=$allClient->fetch_array()){
                                                                    $id=$rows['id']; 
                                                                    $fullname=$rows['fullname']; 
                                                                echo '<option value='.$id.'>'.$fullname.'</option>'; 
                                                                }
                                                            }
                                                            
                                                            ?>
                                                    </select>
                                                        <button type="button" class="btn btn-primary add-client-btn" data-bs-toggle="modal" data-bs-target="#addClientModal"><span>+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="note" class="form-label">Note:</label>
                                                    <input class="form-control" type="text" placeholder="Notes" id="note" name="note">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="currentDate" class="form-label">Invoice Date</label>
                                                    <input class="form-control" type="date" id="currentDate" name="date">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                       
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="product_item" class="form-label">Product</label>
                                                    <div class="input-group">
                                                        <select id="product_name" class="form-select select2" aria-label="Product Name">
                                                            <option value="">---Select---</option>
                                                        </select>
                                                        <button type="button" class="btn btn-primary add-product-btn" data-bs-toggle="modal" data-bs-target="#addproductModal">
                                                            <span>+</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <div class="form-group">
                                                    <label for="qty" class="form-label">Quantity</label>
                                                    <input type="number" id="qty" class="form-control" min="1" value="1">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="price" class="form-label">Price</label>
                                                    <input type="text" class="form-control price" id="price" placeholder="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="total_price" class="form-label">Total Price</label>
                                                    <input id="total_price" type="text" class="form-control total_price" placeholder="00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="details" class="form-label">Notes</label>
                                                    <input id="details" type="text" class="form-control" placeholder="Notes">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mt-1">
                                                <button type="button" id="submitButton" class="btn btn-primary mt-4">Add Now</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-bordered" id="invoiceTable">
                                <thead class="bg bg-info text-white">
                                    <th>Product List</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                    <th></th>
                                </thead>
                                <tbody id="tableRow"></tbody>
                                
                                </table>
                                <div class="form-group text-end">
                                    <button type="button" name="finished_btn" class="btn btn-success"><i class="fe fe-dollar"></i>Process</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- container-fluid -->
               
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <?php include 'modal/product_modal.php'; ?>
     <!-- Add Client Modal-->
    <?php include 'modal/client_modal.php'; ?>
   
     <!-- Add Inovice Modal-->
    <div class="modal fade bs-example-modal-lg" id="invoiceModal" tabindex="-1" role="dialog"
               aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog " role="document">
                  <div class="modal-content col-md-12">
                     <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span
                           class="mdi mdi-account-check mdi-18px"></span> &nbsp;Invoice Summery</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form id="paymentForm">
                           
                           <div class="form-group mb-2">
                              <label>Total Amount </label>
                              <input readonly class="form-control table_total_amount" name="table_total_amount" type="text">
                           </div>
                           <div class="form-group mb-2">
                              <label>Paid Amount </label>
                              <input  type="text" class="form-control table_paid_amount" name="table_paid_amount" value="0">
                           </div>
                           <div class="form-group mb-2">
                              <label> Discount Amount </label>
                              <input  type="text" class="form-control table_discount_amount" name="table_discount_amount" value="00">
                           </div>
                           <div class="form-group mb-2">
                              <label> Due Amount </label>
                              <input type="text" readonly class="form-control table_due_amount" name="table_due_amount" value="0">
                           </div>
                           <div class="form-group mb-2">
                            <label>Select Accounts</label>
                            <select type="text" class="form-control" id="sub_ledger_id" name="sub_ledger_id"
                                 style="width: 100%;">
                                <?php
                                if ($ledgr = $con->query('SELECT * FROM ledger WHERE mstr_ledger_id=1')) {
                                    echo '<option value="">Select</option>';
                                
                                    while ($rowsitm = $ledgr->fetch_array()) {
                                        $ldgritmsID = $rowsitm['id'];
                                        $ledger_name = $rowsitm['ledger_name'];
                                
                                        echo '<optgroup label="' . $ledger_name . '">';
                                
                                        // Sub Ledger items list
                                        if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                            while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                $sub_ldgrid = $rowssb['id'];
                                                $ldgr_items = $rowssb['item_name'];
                                
                                                echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                            }
                                        }
                                
                                        echo '</optgroup>';
                                    }
                                }
                                ?>
                            </select>
                        </div>
                           <div class="form-group mb-2">
                              <label>Type</label>
                              <select type="text" class="form-select table_status" name="table_status">
                                <option value="">---Select---</option>
                                <option value="0">Draf</option>
                                <option value="1">Completed</option>
                                <option value="2">Print Invoice</option>
                            </select>
                           </div>
                           <div class="modal-footer ">
                              <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                              <button type="button" id="save_invoice_btn" class="btn btn-success">Save Invoice</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
    <!-- END layout-wrapper -->
   
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <?php include 'script.php';?>
    <script src="modal/client_modal.js"></script>
    <script type="text/javascript" src="modal/product_modal.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            
        $("#client_name").select2(); 
        $("#product_name").select2(); 
          var selectedProductId = null;
            getProductData();
            function getProductData() {

                $.ajax({
                    url: "include/purchase_server.php?getProductData",
                    method: 'GET',
                    success: function(response) {
                        $('#product_name').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
           
            $("#product_name").change(function() {
                var itemId = $(this).val();
                $.ajax({
                    url: "include/purchase_server.php?getSingleProductData",
                    method: 'GET',
                    data: {
                        id: itemId
                    },
                    success: function(response) {
                        var data = JSON.parse(response);
                        selectedProductId = data.id;
                        var price = data.sale_price;

                        $('#price').val(price);
                        updateTotalPrice();

                    },
                    error: function(xhr, status, error) {
                        /*handle the error response*/ 
                        console.log(error);
                    }
                });
            });
            $('#qty').on('input', function() {
                updateTotalPrice();
            });
            $('#price').on('input', function() {
                updateTotalPrice();
            });

            function updateTotalPrice() {
                var qty = $('#qty').val();
                var price = $('#price').val();
                var total = qty * price;
                $('#total_price').val(total);
               
            }

            $(document).on('click','#submitButton',function(e){
                e.preventDefault(); 
                var productName = $('#product_name option:selected').text();
                var quantity = $('#qty').val();
                var price = $('#price').val();
                var totalPrice = $('#total_price').val();

                if(!selectedProductId || !quantity || !price || !totalPrice) {
                    toastr.error('Please fill in all fields');
                    return;
                }
                /*Check if the product is already added to the table*/ 
                var isProductAdded = false;
                $('#tableRow tr').each(function() {
                    var tableProductId = $(this).find('input[name="table_product_id[]"]').val();
                    if (tableProductId == selectedProductId) {
                        isProductAdded = true;
                        return false; 
                    }
                });

                if (isProductAdded) {
                    toastr.error('Product is already added. <br> Please update the quantity instead.');
                    return;
                }
                $('#submitButton').html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`).prop('disabled', true);
                $.ajax({
                    url: 'include/product_server.php?check_product_qty=true', 
                    method: 'POST',
                    data: { product_id: selectedProductId, qty: quantity },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var row = `<tr>
                                <td><input type="hidden" name="table_product_id[]" value="`+ selectedProductId +`">${productName}</td>
                                <td><input type="hidden" min="1" name="table_qty[]" value="${quantity}" class="form-control table_qty">${quantity}</td>
                                <td><input type="hidden" name="table_price[]" class="form-control table_price" value="${price}">${price}</td>
                                <td><input type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="${totalPrice}">${totalPrice}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm removeRow">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>`;
                            $("#tableRow").append(row);
                            

                            calculateTotalAmount(); 

                            /*Clear The Fild*/
                            $('#product_name').val('');
                            $('#qty').val('1');
                            $('#price').val('');
                            $('#total_price').val('');
                            selectedProductId = null;
                        } else if(response.success==false) {
                            /*IF The Stock Is Not Available*/
                            toastr.error(response.message);
                        }
                       
                    },
                    error: function() {
                      //  toastr.error('Error checking product stock.');

                    },
                    complete:function(){
                        $('#submitButton').html('Submit').prop('disabled', false);
                    }
                });
            });
            
            $(document).on('click', '.removeRow', function() {
                $(this).closest('tr').remove();
                calculateTotalAmount(); 
            });
            /* Calculate total amount function*/
            function calculateTotalAmount() {
                var totalAmount = 0;
                $('#tableRow tr').each(function() {
                    var total_price = $(this).find('input[name="table_total_price[]"]').val();
                    totalAmount += parseFloat(total_price);
                });
                $('input[name="table_total_amount"]').val(totalAmount);

                // Calculate Due Amount
                var paidAmount = parseFloat($('input[name="table_paid_amount"]').val()) || 0;
                var discountAmount = parseFloat($('input[name="table_discount_amount"]').val()) || 0;
                var dueAmount = totalAmount - paidAmount - discountAmount;
                $('input[name="table_due_amount"]').val(dueAmount);
            }
            /*Update Due Amount when Paid Amount or Discount changes*/ 
            $(document).on('input', 'input[name="table_paid_amount"], input[name="table_discount_amount"]', function() {
                calculateTotalAmount();
            });

            $('#save_invoice_btn').on('click', function() {
                var mainFormData = $('#form-data').serializeArray();
                var modalFormData = $('#paymentForm').serializeArray(); 
                var allFormData = $.merge(mainFormData, modalFormData);
                var isValid = true;
                /*Validate each form data field*/ 
                $.each(allFormData, function(index, field) {
                    if (field.name==='client_id' && field.value === '') {
                        toastr.error("Client must be selected!");
                        isValid = false; 
                        return false; 
                    }
                    else if (field.name === 'table_paid_amount' && field.value === '') {
                        toastr.error("Paid Amount is required");
                        isValid = false; 
                        return false; 
                    }
                    else if (field.name === 'date' && field.value === '') {
                        toastr.error("Date is required!");
                        isValid = false; 
                        return false;
                    }
                    else if (field.name === 'table_status' && field.value === '') {
                        toastr.error("Type is required!");
                        isValid = false; 
                        return false;
                    }else if(field.name === 'sub_ledger_id' && field.value === ''){
                        toastr.error("Select Accounts is required!");
                        isValid = false;
                        return false;
                    }
                });

                if (!isValid) {
                    return false;
                }
                $(this).prop('disable',true).html('Saving...'); 
                $.ajax({
                    type:'POST',
                    url:$("#form-data").attr('action'),
                    data:$.param(allFormData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message);
                            /*Close the invoice modal*/ 
                            $('#invoiceModal').modal('hide'); 
                            setTimeout(() => {
                                location.reload(); 
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    },
                    error:function(xhr,status,error){
                        toastr.error("Error:"+error); 
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    }
                }); 
            });

        });

        $(document).on('click','button[name="finished_btn"]',function(){
            $('#invoiceModal').modal('show');
            // $.ajax({
            //     url: "include/transactions_server.php?getLedger",
            //     method: 'GET',
            //     success: function(response) {
            //         $('select[name="sub_ledger"]').html(response);
            //         $('select[name="sub_ledger"]').select2({
            //             dropdownParent: $('#invoiceModal')
            //         });
            //     },
            //     error: function(xhr, status, error) {
            //         console.log(error);
            //     }
            // });
        });

        $('#invoiceModal').on('shown.bs.modal', function () {
            if (!$('#sub_ledger_id').hasClass("select2-hidden-accessible")) {
                $('#sub_ledger_id').select2({
                    dropdownParent: $('#invoiceModal')
                });
            }
            
        });
    

       

    </script>


</body>

</html>

<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["clid"])) {
    if ($sales = $con->query("SELECT * FROM sales WHERE id=".$_GET['clid'] ."")) {
        while ($rows = $sales->fetch_array()) {
            $id = $rows['id'];
            $usr_id = $rows['usr_id'];
            $client_id = $rows['client_id'];
            $invoice_date = $rows['date'];
            $sub_total = $rows['sub_total'];
            $discount = $rows['discount'];
            $grand_total = $rows['grand_total'];
            $total_due = $rows['total_due'];
            $total_paid = $rows['total_paid'];
            $note = $rows['note'];
            $status = $rows['status'];
        }
    }
}

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
   
</head>

<body data-sidebar="dark">
    
    <!-- Begin page -->
    <div id="layout-wrapper">
       <?php $page_title="Edit Sales Invoice"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <form id="form-data" action="include/sale_server.php?update_invoice=1&invoice_id=<?php echo $id; ?>" method="post">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header">
                                    <div class="row ">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="refer_no" class="form-label">Refer No:</label>
                                                    <input class="form-control" type="text" placeholder="Type Your Refer No" id="refer_no" name="refer_no">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group mt-2">
                                                    <label>Client Name</label>
                                                    <div class="input-group">
                                                    <select type="text" id="client_name" name="client_id" class="form-select select2">
                                                        <option>---Select---</option>
                                                        <?php 
                                                        
                                                        if($allClient=$con->query("select * from clients")){
                                                            while($rows=$allClient->fetch_array()){
                                                                $id=$rows['id']; 
                                                                $fullname=$rows['fullname']; 
                                                                if ($client_id==$id) {
                                                                    echo '<option value='.$id.' selected>'.$fullname.'</option>'; 
                                                                }else{
                                                                    echo '<option value='.$id.'>'.$fullname.'</option>'; 
                                                                }
                                                           
                                                            }
                                                        }

                                                        ?>
                                                    </select>
                                                    <button  type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="note" class="form-label">Note:</label>
                                                    <input class="form-control" type="text" placeholder="Notes" id="note" name="note" value="<?php echo $note; ?>">
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="currentDate" class="form-label">Date</label>
                                                    <input class="form-control" type="date" id="currentDate" value="<?php echo date('Y-m-d', strtotime($invoice_date)); ?>" name="date">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                       
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="product_item" class="form-label">Product</label>
                                                    <div class="input-group">
                                                        <select type="text" id="product_name"  class="form-control">
                                                            <option>---Select---</option>
                                                        </select>
                                                        <button  type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addproductModal">+</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <div class="form-group">
                                                    <label for="qty" class="form-label">Quantity</label>
                                                    <input type="number" id="qty" class="form-control" min="1" value="1">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="price" class="form-label">Price</label>
                                                    <input type="text" class="form-control price" id="price" value="0">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="total_price" class="form-label">Total Price</label>
                                                    <input id="total_price" type="text" class="form-control total_price" value="0">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="details" class="form-label">Notes</label>
                                                    <input id="details" type="text" class="form-control" placeholder="Notes">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mt-1">
                                                <button type="button" id="submitButton" class="btn btn-primary mt-4">Add Now</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-bordered">
                                <thead class="bg bg-info text-white">
                                    <th>Product List</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                    <th></th>
                                </thead>
                                <tbody id="tableRow">
                                <?php
                                $invoice_id=$_GET['clid'];
                                $sql = "SELECT * FROM `sales_details` WHERE invoice_id=$invoice_id";
                                $result = mysqli_query($con, $sql);

                                while ($rows = mysqli_fetch_assoc($result)) {

                                ?>

                            <tr>
                                <td>
                                    <?php
                                        $product_id = $rows["product_id"];
                                        if ($allPD = $con->query("SELECT * FROM products WHERE id='$product_id' ")) {
                                            while ($rowss = $allPD->fetch_array()) {
                                                echo ' <input type="hidden" name="table_product_id[]" value="'.$rowss['id'].'">'; 
                                                echo $rowss['name']; 
                                            }
                                        }
                                    ?>
                                

                                </td>
                                <td>
                                    <input  type="hidden" min="1" name="table_qty[]" value="<?php echo $rows['qty']; ?>" class="form-control table_qty"><?php echo $rows['qty']; ?>
                                </td>
                                <td>
                                    <input  type="hidden" name="table_price[]" class="form-control table_price" value="<?php echo $rows['value']; ?>"><?php echo $rows['value']; ?>
                                </td>
                                <td>
                                    <input  type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="<?php echo $rows['total']; ?>"><?php echo $rows['total']; ?></td>
                            
                                    <td>
                                        <button class="btn btn-danger btn-sm removeRow">

                                            <i class="fas fa-times"></i>
                                        
                                        </button>
                                    </td>
                            
                                </tr>
                            <?php } ?>


                               
                                </tbody>
                                </table>
                                <div class="form-group text-end">
                                    <button type="button"  data-bs-target="#invoiceModal" data-bs-toggle="modal" class="btn btn-success"><i class="fe fe-dollar"></i> Process</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- container-fluid -->
               
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php';?>
        </div>
        <!-- end main content-->
    </div>
    <?php include 'modal/product_modal.php'; ?>
    <?php include 'modal/client_modal.php'; ?>
    <div class="modal fade bs-example-modal-lg" id="invoiceModal" tabindex="-1" role="dialog"
               aria-labelledby="exampleModalLabel" aria-hidden="true">
               <div class="modal-dialog " role="document">
                  <div class="modal-content col-md-12">
                     <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"><span
                           class="mdi mdi-account-check mdi-18px"></span> &nbsp;Invoice Summery</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                     </div>
                     <div class="modal-body">
                        <form id="paymentForm">
                           
                           <div class="form-group mb-2">
                              <label>Total Amount </label>
                              <input readonly class="form-control table_total_amount" name="table_total_amount" type="text" value="<?php echo $sub_total; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label>Paid Amount </label>
                              <input  type="text" class="form-control table_paid_amount" name="table_paid_amount" value="<?php echo $total_paid; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label> Discount Amount </label>
                              <input  type="text" class="form-control table_discount_amount" name="table_discount_amount" value="<?php echo $discount; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label> Due Amount </label>
                              <input type="text" readonly class="form-control table_due_amount" name="table_due_amount" value="<?php echo $total_due; ?>">
                           </div>
                           <div class="form-group mb-2">
                              <label>Type</label>
                              <select type="text" class="form-select table_status" name="table_status">
                                <option value="">---Select---</option>
                                <option value="0" <?php echo ($status == 0) ? 'selected' : ''; ?>>Draft</option>
                                <option value="1" <?php echo ($status == 1) ? 'selected' : ''; ?>>Completed</option>
                                <option value="2" <?php echo ($status == 2) ? 'selected' : ''; ?>>Print Invoice</option>
                            </select>
                           </div>
                           <div class="modal-footer ">
                              <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                              <button type="button" id="save_invoice_btn" class="btn btn-success">Save Invoice</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->

   <?php include 'script.php';?>
    <script src="modal/product_modal.js"></script>
    <script src="modal/client_modal.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#client_name").select2(); 
            $("#product_name").select2();

          var selectedProductId = null;
            getProductData();
            function getProductData() {

                $.ajax({
                    url: "include/purchase_server.php?getProductData",
                    method: 'GET',
                    success: function(response) {
                        $('#product_name').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }
            
            $("#product_name").change(function() {
                var itemId = $(this).val();
                $.ajax({
                    url: "include/purchase_server.php?getSingleProductData",
                    method: 'GET',
                    data: {
                        id: itemId
                    },
                    success: function(response) {
                        var data = JSON.parse(response);
                        selectedProductId = data.id;
                        var price = data.sale_price;

                        $('#price').val(price);
                        updateTotalPrice();

                    },
                    error: function(xhr, status, error) {
                        /*handle the error response*/ 
                        console.log(error);
                    }
                });
            });
            $('#qty').on('input', function() {
                updateTotalPrice();
            });
            $('#price').on('input', function() {
                updateTotalPrice();
            });

            function updateTotalPrice() {
                var qty = $('#qty').val();
                var price = $('#price').val();
                var total = qty * price;
                $('#total_price').val(total);
               
            }

            $(document).on('click','#submitButton',function(e){
                e.preventDefault(); 

                var productName = $('#product_name option:selected').text();
                var quantity = $('#qty').val();
                var price = $('#price').val();
                var totalPrice = $('#total_price').val();

                if(!selectedProductId || !quantity || !price || !totalPrice) {
                    toastr.error('Please fill in all fields');
                    return;
                }
                /*Check if the product is already added to the table*/ 
                var isProductAdded = false;
                $('#tableRow tr').each(function() {
                    var tableProductId = $(this).find('input[name="table_product_id[]"]').val();
                    if (tableProductId == selectedProductId) {
                        isProductAdded = true;
                        return false; 
                    }
                });

                if (isProductAdded) {
                    toastr.error('Product is already added. <br> Please update the quantity instead.');
                    return;
                }
                $('#submitButton').html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`).prop('disabled', true);
                $.ajax({
                    url: 'include/product_server.php?check_product_qty=true', 
                    method: 'POST',
                    data: { product_id: selectedProductId, qty: quantity },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success==true) {
                            var row = `<tr>
                                <td><input type="hidden" name="table_product_id[]" value="`+ selectedProductId +`">${productName}</td>
                                <td><input type="hidden" min="1" name="table_qty[]" value="${quantity}" class="form-control table_qty">${quantity}</td>
                                <td><input type="hidden" name="table_price[]" class="form-control table_price" value="${price}">${price}</td>
                                <td><input type="hidden" id="table_total_price" name="table_total_price[]" class="form-control" value="${totalPrice}">${totalPrice}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm removeRow">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>`;
                            $("#tableRow").append(row);
                            

                            calculateTotalAmount(); 

                            /*Clear The Fild*/
                            $('#product_name').val('');
                            $('#qty').val('1');
                            $('#price').val('');
                            $('#total_price').val('');
                            selectedProductId = null;
                        } else if(response.success==false) {
                            /*IF The Stock Is Not Available*/
                            toastr.error(response.message);
                        }
                       
                    },
                    error: function() {
                      //  toastr.error('Error checking product stock.');

                    },
                    complete:function(){
                        $('#submitButton').html('Submit').prop('disabled', false);
                    }
                });
            });
            $(document).on('click', '.removeRow', function() {
                $(this).closest('tr').remove();
                calculateTotalAmount(); 
            });
            /* Calculate total amount function*/
            function calculateTotalAmount() {
                var totalAmount = 0;
                $('#tableRow tr').each(function() {
                    var total_price = $(this).find('input[name="table_total_price[]"]').val();
                    totalAmount += parseFloat(total_price);
                });
                $('input[name="table_total_amount"]').val(totalAmount);

                // Calculate Due Amount
                var paidAmount = parseFloat($('input[name="table_paid_amount"]').val()) || 0;
                var discountAmount = parseFloat($('input[name="table_discount_amount"]').val()) || 0;
                var dueAmount = totalAmount - paidAmount - discountAmount;
                $('input[name="table_due_amount"]').val(dueAmount);
            }
            /*Update Due Amount when Paid Amount or Discount changes*/ 
            $(document).on('input', 'input[name="table_paid_amount"], input[name="table_discount_amount"]', function() {
                calculateTotalAmount();
            });
            $('#save_invoice_btn').on('click', function() {
                var mainFormData = $('#form-data').serializeArray();
                var modalFormData = $('#paymentForm').serializeArray(); 
                var allFormData = $.merge(mainFormData, modalFormData);
                $(this).prop('disable',true).html('Saving...'); 
                $.ajax({
                    type:'POST',
                    url:$("#form-data").attr('action'),
                    data:$.param(allFormData),
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message);
                            /*Close the invoice modal*/ 
                            $('#invoiceModal').modal('hide'); 
                            setTimeout(() => {
                                location.reload(); 
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    },
                    error:function(xhr,status,error){
                        toastr.error("Error:"+error); 
                        $('#save_invoice_btn').prop('disabled', false).html('Save Invoice');
                    }
                }); 
            });


          

        });

       

    </script>


</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include "style.php";?>
</head>

<body data-sidebar="dark">



    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Sales Invoice"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                          
                                           
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <a href="sale.php" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" style="margin-bottom: 12px;">&nbsp;&nbsp;New Invoice </a>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-header">
                                    <div class="row d-flex">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="start_date">Start Date:</label>
                                                <input type="date" id="start_date" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="end_date">End Date:</label>
                                                <input type="date" id="end_date" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mt-1">
                                                <button id="filter_invoice_btn" class="btn btn-primary mt-3">Search Now</button>
                                              
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="invoice-table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>Invoice id</th>
                                                    <th>Customer Name</th>
                                                    <th>Sub Total</th>
                                                    <th>Paid Amount</th>
                                                    <th>Discount</th>
                                                    <th>Due Balance</th>
                                                    <th>Grand Total</th>
                                                    <th>Status</th>
                                                    <th>Invoice Date</th>
                                                    <th>Create Date</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="invoice-list">
                                             

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
        $(document).ready(function(){
            //var table = $('#invoice-table').DataTable();
             /* Fetch initial data*/
             __fetch_invoice_data();

            /* Filter button click event*/
            $('#filter_invoice_btn').click(function() {
                var startDate = $('#start_date').val();
                var endDate = $('#end_date').val();

                if (startDate.length=='') {
                    toastr.error("Please Select Date"); 
                }
                else if (endDate.length=='') {
                    toastr.error("Please Select Date"); 
                }else{
                    __fetch_invoice_data(startDate,endDate);
                }
               
            });
            function __fetch_invoice_data(startDate,endDate) {

               
               
                $("#filter_invoice_btn").html('<span class="spinner-border spinner-border-sm" aria-hidden="true"></span> Loading...');
                $("#filter_invoice_btn").prop('disabled', true);

                $.ajax({
                    url: 'include/sale_server.php',
                    type: 'GET',
                    data: {
                        start_date: startDate,
                        end_date: endDate,
                        fetch_invoice:true,
                    },
                    success: function(response) {
                        $('#invoice-list').html(response);
                        $("#invoice-table").DataTable();
                        $('#filter_invoice_btn').html('Search');
                        $('#filter_invoice_btn').prop('disabled', false);
                    }
                });
            }
            /*Delete Script*/
            $(document).on('click',"button[name='delete_button']",function(){
                var id=$(this).data('id');
                if (confirm("Are you sure you want to delete this item?")) {
                   
                    $.ajax({
                        type: 'POST', 
                        url: 'include/sale_server.php',
                        data: { delete_invoice: true, invoice_id: id }, 
                        dataType:'json',
                        success: function(response) {
                            if (response.success) {
                                toastr.success("Deleted successfully!");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error(xhr.responseText);
                            toastr.error("Error deleting item! " + error);
                        }
                    });
                }
            });
            
        });
    </script>
    
</body>

</html>

<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Custom Style -->
   <style type="text/css">
       :root {
    --body-bg: rgb(204, 204, 204);
    --white: #ffffff;
    --darkWhite: #ccc;
    --black: #000000;
    --dark: #615c60;
    --themeColor: #22b8d1;
    --pageShadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
}

/* Font Include */
@import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&display=swap');

body {
    background-color: var(--body-bg);
}

.page {
    background: var(--white);
    display: block;
    margin: 0 auto;
    position: relative;
    box-shadow: var(--pageShadow);
}

.page[size="A4"] {
    width: 21cm;
    height: 29.7cm;
    overflow: hidden;
}

.bb {
    border-bottom: 3px solid var(--darkWhite);
}

/* Top Section */
.top-content {
    padding-bottom: 15px;
}

.logo img {
    height: 60px;
}

.top-left p {
    margin: 0;
}

.top-left .graphic-path {
    height: 40px;
    position: relative;
}

.top-left .graphic-path::before {
    content: "";
    height: 20px;
    background-color: var(--dark);
    position: absolute;
    left: 15px;
    right: 0;
    top: -15px;
    z-index: 2;
}

.top-left .graphic-path::after {
    content: "";
    height: 22px;
    width: 17px;
    background: var(--black);
    position: absolute;
    top: -13px;
    left: 6px;
    transform: rotate(45deg);
}

.top-left .graphic-path p {
    color: var(--white);
    height: 40px;
    left: 0;
    right: -100px;
    text-transform: uppercase;
    background-color: var(--themeColor);
    font: 26px;
    z-index: 3;
    position: absolute;
    padding-left: 10px;
}

/* User Store Section */
.store-user {
    padding-bottom: 25px;
}

.store-user p {
    margin: 0;
    font-weight: 600;
}

.store-user .address {
    font-weight: 400;
}

.store-user h2 {
    color: var(--themeColor);
    font-family: 'Rajdhani', sans-serif;
}

.extra-info p span {
    font-weight: 400;
}

/* Product Section */
thead {
    color: var(--white);
    background: var(--themeColor);
}

.table td,
.table th {
    text-align: center;
    vertical-align: middle;
}

tr th:first-child,
tr td:first-child {
    text-align: left;
}

.media img {
    height: 60px;
    width: 60px;
}

.media p {
    font-weight: 400;
    margin: 0;
}

.media p.title {
    font-weight: 600;
}

/* Balance Info Section */
.balance-info .table td,
.balance-info .table th {
    padding: 0;
    border: 0;
}

.balance-info tr td:first-child {
    font-weight: 600;
}

tfoot {
    border-top: 2px solid var(--darkWhite);
}

tfoot td {
    font-weight: 600;
}

/* Cart BG */
.cart-bg {
    height: 250px;
    bottom: 32px;
    left: -40px;
    opacity: 0.3;
    position: absolute;
}

/* Footer Section */
footer {
    text-align: center;
    position: absolute;
    bottom: 30px;
    left: 75px;
}

footer hr {
    margin-bottom: -22px;
    border-top: 3px solid var(--darkWhite);
}

footer a {
    color: var(--themeColor);
}

footer p {
    padding: 6px;
    border: 3px solid var(--darkWhite);
    background-color: var(--white);
    display: inline-block;
}

   </style>

    <title>Invoice..!</title>
</head>

<body>
    <div class="my-5 page" size="A4">
        <div class="p-5">
            <section class="top-content bb d-flex justify-content-between">
                <div class="logo">
                    <img src="http://103.146.16.154/assets/images/it-fast.png" alt="" class="img-fluid">
                </div>
                <div class="top-left">
                    <div class="graphic-path">
                        <p>Invoice</p>
                    </div>
                    <div class="position-relative">
                        <p>Invoice No. <span>XXXX</span></p>
                    </div>
                </div>
            </section>

            <section class="store-user mt-5">
                <div class="col-10">
                    <div class="row bb pb-3">
                        <div class="col-7">
                            <p>Supplier,</p>
                            <h2>Your Store Name</h2>
                            <p class="address"> 777 Brockton Avenue, <br> Abington MA 2351, <br>Vestavia Hills AL </p>
                            <div class="txn mt-2">TXN: XXXXXXX</div>
                        </div>
                        <div class="col-5">
                            <p>Client,</p>
                            <h2>Rakib Mahmud</h2>
                            <p class="address"> 777 Brockton Avenue, <br> Abington MA 2351, <br>Vestavia Hills AL </p>
                            <div class="txn mt-2">TXN: XXXXXXX</div>
                        </div>
                    </div>
                    <div class="row extra-info pt-3">
                        <div class="col-7">
                            <p>Payment Method: <span>bKash</span></p>
                            <p>Order Number: <span>#868</span></p>
                        </div>
                        <div class="col-5">
                            <p>Deliver Date: <span>10-04.2021</span></p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="product-area mt-4">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <td>Item Description</td>
                            <td>Price</td>
                            <td>Quantity</td>
                            <td>Total</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="media">
                                    <img class="mr-3 img-fluid" src="mobile.jpg" alt="Product 01">
                                    <div class="media-body">
                                        <p class="mt-0 title">Media heading</p>
                                        Cras sit amet nibh libero, in gravida nulla.
                                    </div>
                                </div>
                            </td>
                            <td>200$</td>
                            <td>1</td>
                            <td>200$</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="media">
                                    <img class="mr-3 img-fluid" src="mobile-2.jpg" alt="Product 01">
                                    <div class="media-body">
                                        <p class="mt-0 title">Media heading</p>
                                        Cras sit amet nibh libero, in gravida nulla.
                                    </div>
                                </div>
                            </td>
                            <td>300$</td>
                            <td>2</td>
                            <td>600$</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="balance-info">
                <div class="row">
                    <div class="col-8">
                        <p class="m-0 font-weight-bold"> Note: </p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. In delectus, adipisci vero est dolore praesentium.</p>
                    </div>
                    <div class="col-4">
                        <table class="table border-0 table-hover">
                            <tr>
                                <td>Sub Total:</td>
                                <td>800$</td>
                            </tr>
                            <tr>
                                <td>Tax:</td>
                                <td>15$</td>
                            </tr>
                            <tr>
                                <td>Deliver:</td>
                                <td>10$</td>
                            </tr>
                            <tfoot>
                                <tr>
                                    <td>Total:</td>
                                    <td>825$</td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- Signature -->
                        <div class="col-12">
                            <img src="signature.png" class="img-fluid" alt="">
                            <p class="text-center m-0"> Director Signature </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Cart BG -->
            <img src="cart.jpg" class="img-fluid cart-bg" alt="">

           
        </div>
    </div>










</body></html>

<!-- JAVASCRIPT -->
<script src="assets/libs/jquery/jquery.min.js"></script>
<script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/libs/metismenu/metisMenu.min.js"></script>
<script src="assets/libs/simplebar/simplebar.min.js"></script> 
<script src="assets/libs/node-waves/waves.min.js"></script> 
<script src="assets/libs/select2/js/select2.min.js"></script>
<script src="assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>

<!-- Required datatable js -->
<script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>

<!-- Buttons examples -->
<script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="assets/libs/jszip/jszip.min.js"></script>
<script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
<script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
<script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script> 

<!-- Responsive examples -->
<script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

<!-- Toastr -->
<script src="js/toastr/toastr.min.js"></script>
<script src="js/toastr/toastr.init.js"></script>

<!-- Datatable init js -->
<script src="assets/js/pages/datatables.init.js"></script>

<!-- App Js -->
<script src="assets/js/app.js"></script>

<!-- Peity chart -->
<script src="assets/libs/peity/jquery.peity.min.js"></script> 

<!-- C3 Chart -->
<script src="assets/libs/d3/d3.min.js"></script>
<script src="assets/libs/c3/c3.min.js"></script> 

<!-- jQuery Knob -->
 <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>

<!-- Dashboard init -->
<script src="assets/js/pages/dashboard.init.js"></script>

<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<!-- Fluid Meter -->
 <script src="assets/js/js-fluid-meter.js"></script>
<!-- Form Advanced Init -->
 <!-- <script src="assets/js/pages/form-advanced.init.js"></script>  -->

<!-- Plugin Js for Charts -->
<script src="assets/libs/chartist/chartist.min.js"></script>
<script src="assets/libs/chartist-plugin-tooltips/chartist-plugin-tooltip.min.js"></script>

 <!-- form wizard -->
 <script src="assets/libs/jquery-steps/build/jquery.steps.min.js"></script>

<!-- form wizard init -->
<script src="assets/js/pages/form-wizard.init.js"></script>


<script type="text/javascript">
$(document).ready(function() {
    async function loadCustomerOptions() {
        try {
            let response = await $.ajax({
                url: 'include/customers_server.php?get_all_customer_with_online_status=true',
                type: 'GET',
                dataType: 'json'
            });
            if (response.success === true) {
                var customerOptions = '<option value="">--- Select Customer ---</option>'; 

                $.each(response.data, function (key, customer) {
                    let statusIcon = customer.status === 'online'
                    ? '<span style="color: green;"></span>'
                    : '<span style="color: red;"></span>';

                    customerOptions += '<option value="' + customer.id + '">' +
                        statusIcon + ' [' + customer.id + '] - ' + customer.username + 
                        ' || ' + customer.fullname + ', (' + customer.mobile + ')</option>';
                });

                $('select[name="menu_select_box"]').html(customerOptions);
                $('select[name="menu_select_box"]').select2({
                    placeholder: '---Select Customer---',
                        escapeMarkup: function (markup) {
                        return markup; 
                    }
                });
            }

        } catch (error) {
            console.error('Error fetching customer options:', error);
        }
    }

    if ($('select[name="menu_select_box"]').length > 0) {
        loadCustomerOptions(); 
    }

    $('select[name="menu_select_box"]').on('change', function() {
        var customerId = $(this).val(); 
        if(customerId) {
            window.location.href = 'profile.php?clid=' + customerId;
        }
    });

});
</script> 




<?php
session_start();
$_SESSION["uid"];
$_SESSION["username"];
$_SESSION["fullname"];
$_SESSION["tcoken"];

if(empty($_SESSION["username"]))
{
	
	header('location: login.php');
}
?>

<?php
date_default_timezone_set('Asia/Dhaka');
include 'include/db_connect.php';




if (isset($_GET['clid'])) {
    $clid = $_GET['clid'];
    if ($cstmr = $con->query("SELECT * FROM customers WHERE id='$clid'")) {
        while ($rows = $cstmr->fetch_array()) {
            $lstid = $rows['id'];
            $fullname = $rows['fullname'];
            $package = $rows['package'];
            $packagename = $rows['package_name'];
            $username = $rows['username'];
            $password = $rows['password'];
            $mobile = $rows['mobile'];
            $pop = $rows['pop'];
            $area = $rows['area'];
            $address = $rows['address'];
            $expiredDate = $rows['expiredate'];
            $createdate = $rows['createdate'];
            $profile_pic = $rows['profile_pic'];
            $nid = $rows['nid'];
            $price = $rows['price'];
            $remarks = $rows['remarks'];
            $liablities = $rows['liablities'];
        }
    }
}


$protocol = ((!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] != 'off') || $_SERVER['SERVER_PORT'] == 443) ? "https://" : "http://";  
$CurPageURL = $protocol . $_SERVER['HTTP_HOST'].'/self.php?clid='.$_GET['clid'].''; 

if (isset($_GET['clid']) && isset($_GET['paymentID']) && $_GET['status'] == 'success') {
    $customer_id = $_GET['clid'];
    include 'include/Service/Bkash_payment_service.php';
    include 'include/Config.php';
    $bk = new BkashPaymentService($config);
    $idToken = $bk->getGrantToken();

    if (!empty($idToken)) {
        $paymentID = $_GET['paymentID'];

        /* Execute the payment*/
        $response = $bk->executePayment($idToken, $paymentID);

        /* Check response*/
        if (!empty($response['transactionStatus']) && $response['transactionStatus'] === 'Completed') {
            $pop_id = $con->query("SELECT `pop` FROM customers WHERE id=$customer_id")->fetch_assoc()['pop'];
            $get_customer_package = $con->query("SELECT `package` FROM customers WHERE id=$customer_id")->fetch_assoc()['package'];
            $package = $con->query("SELECT `package_name` FROM customers WHERE id=$customer_id")->fetch_assoc()['package_name'];
            $username = $con->query("SELECT `username` FROM customers WHERE id=$customer_id")->fetch_assoc()['username'];
            $password = $con->query("SELECT `password` FROM customers WHERE id=$customer_id")->fetch_assoc()['password'];
            $customer_amount = $con->query("SELECT `price` FROM customers WHERE id=$customer_id")->fetch_assoc()['price'];
            $sale_price = $con->query("SELECT s_price FROM branch_package WHERE pkg_id=$get_customer_package AND pop_id=$pop_id")->fetch_assoc()['s_price'];
            $expiredDate = $con->query("SELECT `expiredate` FROM customers WHERE id=$customer_id")->fetch_assoc()['expiredate'];
            $chrg_mnths = 1;
            $recharge_by = $_SESSION['uid'] ?? 0;
            /*Calculate new expiry date*/
            if (!empty($expiredDate) && isset($expiredDate) && !empty($chrg_mnths) && isset($chrg_mnths)) {
                $today = date('Y-m-d');
                if ($expiredDate > $today) {
                    $exp_date = date('Y-m-d', strtotime("+$chrg_mnths month", strtotime($expiredDate)));
                } else {
                    $exp_date = date('Y-m-d', strtotime("+$chrg_mnths month", strtotime($today)));
                }

                /*Insert Recharge Data*/
                $con->query("INSERT INTO customer_rechrg(customer_id, pop_id, months, sales_price, purchase_price,discount, ref, rchrg_until, type, rchg_by, datetm) VALUES('$customer_id', '$pop_id', '$chrg_mnths', '$sale_price', '$customer_amount','0.00', 'Bkash Payment', '$exp_date', '2', '$recharge_by', NOW())");
                $con->query("INSERT INTO radcheck(username,attribute,op,value) VALUES('$username','Cleartext-Password',':=','$password')");
                $con->query("INSERT INTO radreply(username,attribute,op,value) VALUES('$username','MikroTik-Group',':=','$package')");

                /*Update Customer New Balance AND Expire Date */
                $_customer_total_paid_amount = 0;
                $_customer_total_due_amount = 0;
                $_customer_total_recharge_amount = 0;
                /**** Get Customer total paid amount *************/
                if ($customer_total_paid_amount = $con->query("SELECT SUM(`purchase_price`) as customer_total_paid_amount FROM customer_rechrg WHERE customer_id='$customer_id' AND type!='0'")) {
                    while ($rows = $customer_total_paid_amount->fetch_assoc()) {
                        $_customer_total_paid_amount = $rows['customer_total_paid_amount'];
                    }
                }

                /**** Get Customer total Due amount *************/
                if ($customer_total_due_amount = $con->query("SELECT SUM(`purchase_price`) as customer_total_due_amount FROM customer_rechrg WHERE customer_id='$customer_id' AND type='0'")) {
                    while ($rows = $customer_total_due_amount->fetch_assoc()) {
                        $_customer_total_due_amount = $rows['customer_total_due_amount'];
                    }
                }

                /**** Get Customer total Recharge amount *************/
                if ($customer_total_recharge_amount = $con->query("SELECT SUM(`purchase_price`) as customer_total_recharge_amount FROM customer_rechrg WHERE customer_id='$customer_id' AND type !='4'")) {
                    while ($rows = $customer_total_recharge_amount->fetch_assoc()) {
                        $_customer_total_recharge_amount = $rows['customer_total_recharge_amount'];
                    }
                }

                /**** Get Customer Defference Balance *************/
                if (!empty($_customer_total_paid_amount) && isset($_customer_total_paid_amount) && !empty($_customer_total_recharge_amount) && isset($_customer_total_recharge_amount)) {
                    $_balance_amount = $_customer_total_recharge_amount - $_customer_total_paid_amount;

                    $con->query("UPDATE customers SET expiredate='$exp_date', status='1', rchg_amount='$_customer_total_recharge_amount', paid_amount='$_customer_total_paid_amount', balance_amount='$_balance_amount' WHERE id='$customer_id'");
                }
            }
            header("Location: $CurPageURL");
            exit; 
        }
    }
}

?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payment Process</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/fontawesome-free/css/all.min.css">
    <!-- icheck bootstrap -->
    <link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="https://adminlte.io/themes/v3/dist/css/adminlte.min.css?v=3.2.0">
    <style>
        .login-box .card,
        .register-box .card {

            border: 2px #bfbfbf dotted !important;
        }
    </style>
</head>

<body class="hold-transition register-page">
    <div class="register-box">
        <!-- <div class="register-logo">
   <img  width="90px" src="http://103.146.16.154/profileImages/avatar.png">
  </div> -->

        <div class="card">
            <div class="card-body register-card-body">
                <div class="register-logo">
                    <img width="90px" src="http://103.146.16.154/profileImages/avatar.png">
                </div>
                <p class="login-box-msg">Welcome To SR Communication</p>

                <form action="" method="post">
                    <div class="input-group mb-3">
                        <input readonly type="text" class="form-control" placeholder="Full name"
                            value="<?php echo $fullname ?? ''; ?>">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-user"></span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <input readonly type="text" class="form-control" placeholder="Package"
                            value="<?php echo $packagename ?? ''; ?>">
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-lock"></span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <?php
                        $todayDate = date('Y-m-d');
                        if ($expiredDate <= $todayDate) {
                            echo '<br>';
                            echo ' <input readonly type="text" class="form-control" value="Expired" style="color:red">';
                        } else {
                            $expiredDate = new DateTime($expiredDate);
                            $formattedDate = $expiredDate->format('d-M-Y');
                            echo ' <input readonly type="text" class="form-control" value="Expire Will be ' . $formattedDate . '">';
                        }
                        ?>

                        <div class="input-group-append">
                            <div class="input-group-text">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="social-auth-links text-center">


                    <a type="button" id="bkash_payment_btn" class="btn btn-block btn-danger">
                        <img src="images/Bkash-Logo.jpg" alt="Bkash" style="width: 20px; margin-right: 8px;">
                        Pay With Bkash
                    </a>
                </div>
            </div>
            <!-- /.form-box -->
        </div><!-- /.card -->
    </div>
    <!-- /.register-box -->

    <!-- jQuery -->
    <script src="https://adminlte.io/themes/v3/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="https://adminlte.io/themes/v3/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="https://adminlte.io/themes/v3/dist/js/adminlte.min.js?v=3.2.0"></script>
    <script type="text/javascript">
        $("#bkash_payment_btn").on('click', function() {
            console.log(window.location.href);
            var pop_id = <?php echo $pop; ?>;
            var customer_id = <?php echo $clid; ?>;
            window.location.href =
                `http://<?php echo $_SERVER['HTTP_HOST']; ?>/include/customer_recharge_server.php?customer_recharge_with_payment_getway=true&pop_id=${pop_id}&landing_page=1&customer_id=${customer_id}`;
        });
    </script>
</body>

</html>


 <?php 
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
    <head>
    
          <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php'; ?>
    </head>

    <body data-sidebar="dark">


      

        <!-- Begin page -->
        <div id="layout-wrapper">
        
          <?php $page_title="Send Message";  include 'Header.php';?>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>

                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
          <div class="row">
              <div class="col-md-6 m-auto">
                  <form action="include/message_server.php?send_message=true" method="POST" id="send_message">
                        <div class="card shadow-lg ">
                        
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm">
                                        <div class="form-group mb-2">
                                            <label>POP</label>
                                            <select  name="pop" id="pop" class="form-control " style="height:55px;">
                                                <option>Select</option>
                                                <?php 

                                                if ($allPOPuSR=$con->query("SELECT * FROM add_pop WHERE user_type=1")) {
                                                    while ($rows=$allPOPuSR->fetch_array()) {
                                                        echo '<option value='.$rows['id'].'>'.$rows['pop'].'</option>';
                                                    }
                                                }

                                                 ?>                                               

                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm">
                                        <div class="form-group mb-2">
                                            <label>Area</label>
                                            <select  name="area" id="area" class="form-control" style="height:55px;">
                                                <option>---Select---</option> 
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm">
                                        <div class="form-group mb-2">
                                            <label>Customer Account</label>
                                            <select  name="cstmr_ac" id="cstmr_ac" class="form-control " style="height:55px;">
                                            <option>Select</option>                                           

                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm">
                                        <div class="form-group mb-2">
                                            <label>Customer Phone No.</label>
                                            <input id="phone" type="text" name="phone" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm">
                                        <div class="form-group mb-2">
                                            <label>Message Template</label>
                                            <select class="form-select" id="currentMessageTemp" onchange="currentMsgTemp()">
                                                <option>Select</option>
                                                <?php 
                                                  if ($allCstmr=$con->query("SELECT * FROM message_template WHERE user_type=1")) {
                                                    while ($rows=$allCstmr->fetch_array()) {
                                                        echo '<option value='.$rows['id'].'>'.$rows['template_name'].'</option>';
                                                    }
                                                }

                                                 ?>
                                            </select>
                                        </div>
                                    </div>
                                </div><div class="row">
                                    <div class="col-sm">
                                        <div class="form-group">
                                            <label>Message</label>
                                            <textarea id="message" name="message" rows="5" placeholder="Enter Your Message" class="form-control"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-sm">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary">Send Message</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
              </div>
          </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php'; ?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

       

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <?php include 'script.php'; ?>
      <script type="text/javascript">
          $(document).ready(function(){
                 $('#cstmr_ac').select2();
                 $('#Select3').select2();
                 $('#pop').select2();
                 $('#area').select2();
           });
           $(document).on('change','#pop',function(){
                var popID = $(this).val();
                if(popID){
                $.ajax({
                    type: 'POST',
                    url: 'include/add_pop.php', 
                    data: {pop_id: popID},
                    success: function(response){
                        $('#area').html(response);
                    }
                });
                }else{
                    $('#area').html('<option>---Select---</option>');
                }
            });
           $(document).on('change','#area',function(){
                var areaID = $(this).val();
                if(areaID){
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php', 
                    data: {area_id: areaID},
                    success: function(response){
                        $('#cstmr_ac').html(response);
                    }
                });
                }else{
                    $('#cstmr_ac').html('<option>---Select---</option>');
                }
            });
           $(document).on('change','#cstmr_ac',function(){
                var customerID = $(this).val();
                if(customerID){
                $.ajax({
                    type: 'POST',
                    url: 'include/customers_server.php', 
                    data: {get_customer_phone_number: customerID},
                    success: function(response){
                        $("#phone").val(response);
                    }
                });
                }else{
                    $("#phone").val('Phone Number');
                }
            });
           function currentMsgTemp(){
            var name=$("#currentMessageTemp").val();
            var currentMsgTemp="0";
                $.ajax({
                    type:'POST',
                    data:{name:name,currentMsgTemp:currentMsgTemp},
                    url:'include/message.php',
                    success:function(response){
                        console.log(response);
                        $("#message").val(response);
                    }
                });
           }

           $('#send_message').submit(function(e) {
            e.preventDefault();

            /* Get the submit button */
            var submitBtn = $(this).find('button[type="submit"]');
            var originalBtnText = submitBtn.html();

            submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>');
            submitBtn.prop('disabled', true);

            var form = $(this);
            var url = form.attr('action');
            /*Change to FormData to handle file uploads*/
            var formData = new FormData(this);

            /* Use Ajax to send the request */
            $.ajax({
                type: 'POST',
                url: url,
                data: formData,
                contentType: false,
                processData: false,
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                       toastr.success(response.message);

                    }else if (!response.success && response.errors) {
                        $.each(response.errors, function(field, message) {
                            toastr.error(message);
                        });
                    }
                },
                error: function(xhr, status, error) {
                    /* Handle errors */
                },
                complete: function() {
                    /* Reset button text and enable the button */
                    submitBtn.html(originalBtnText);
                    submitBtn.prop('disabled', false);
                }
            });
        });
           
      </script>

    </body>
</html>


<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Shift";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Shift</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New Shift</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Shift Name</th>
                                                    <th>Start Time</th>
                                                    <th>End Time</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- <div class="card-footer" style="text-align: right;">
                                    <button class="btn btn-primary" id="send_message_btn" >Send Message</button>
                                    <button class="btn btn-success" id="export_to_excel" >Export To Excel</button>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
     <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Shift</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?add_shift=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Shift Name</label>
                            <input name="shift_name" placeholder="Enter Shift Name" class="form-control" type="text" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>Start TIme</label>
                            <input name="start_time" class="form-control" type="time" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>End TIme</label>
                            <input name="end_time" class="form-control" type="time" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Shift</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/hrm_server.php?update_shift=true" method="POST" enctype="multipart/form-data" >          
                        <div class="form-group mb-2">
                            <label>Shift Name</label>
                            <input type="text" class="d-none" name="id">
                            <input name="shift_name" placeholder="Enter Shift Name" class="form-control" type="text" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>Start TIme</label>
                            <input name="start_time" class="form-control" type="time" >
                        </div>           
                        <div class="form-group mb-2">
                            <label>End TIme</label>
                            <input name="end_time" class="form-control" type="time" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/hrm_server.php?show_shift_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Department Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Department Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var shift_id = $(this).data("id");
        $.ajax({
            url: "include/hrm_server.php?get_shift=true", 
            type: "GET",
            data: { id: shift_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal input[name="shift_name"]').val(response.data.shift_name);
                $('#editModal input[name="start_time"]').val(response.data.start_time);
                $('#editModal input[name="end_time"]').val(response.data.end_time);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/hrm_server.php', 
                data: { shift_delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    </script>
</body>

</html>

<?php
include 'include/db_connect.php';
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/pop_security.php';
$data = [];

// Validate input parameters
if (isset($_GET['id']) && isset($_GET['fromDate']) && isset($_GET['endDate'])) {
    $ledger_id = $_GET['id'];
    $fromDate = $_GET['fromDate'];
    $endDate = $_GET['endDate'];

    // Prepare SQL query to prevent SQL Injection
    $stmt = $con->prepare('SELECT * FROM ledger_transactions WHERE ledger_id = ? AND date BETWEEN ? AND ?');
    $stmt->bind_param('iss', $ledger_id, $fromDate, $endDate);
    $stmt->execute();

    $result = $stmt->get_result();

    while ($row = $result->fetch_assoc()) {
        $data[] = $row;
    }

    $stmt->close();
}

// Output the data in a readable format
// echo "<pre>";
// print_r($data);
// echo "</pre>";

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">
    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title = 'Ledger Reports';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">

                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="card ledger-card">
                                <div class="card-header bg-primary text-white text-center">
                                    <h4><?php
                                    
                                    $ledger_id = $data[0]['ledger_id'];
                                    $stmt = $con->prepare('SELECT * FROM ledger WHERE id = ?');
                                    $stmt->bind_param('i', $ledger_id);
                                    $stmt->execute();
                                    $result = $stmt->get_result();
                                    $row = $result->fetch_assoc();
                                    echo $row['ledger_name'] ?? 'N/A';
                                    ?></h4>
                                    <p class="mb-0">From: <strong><?php echo  date('d M Y', strtotime($_GET['fromDate'])) ?></strong> | To:
                                        <strong><?php echo  date('d M Y', strtotime($_GET['endDate'])) ?></strong>
                                    </p>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <button type="button" onclick="printTable()" class="btn btn-success">
                                            <i class="fas fa-print"></i>
                                        </button>
                                    </div>
                                    <div class="table-responsive mt-3">
                                        <table class="table table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th class="text-center">Accounts Titles And Explanations</th>
                                                    <th class="text-end">Quantity</th>
                                                    <th class="text-end">Value</th>
                                                    <th class="text-end">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                $total_amount = 0;
                                                $i = 1;
                                                foreach ($data as $row) {
                                                    $sub_ledger_id = $row['sub_ledger_id'];
                                                    $stmt = $con->prepare('SELECT * FROM legder_sub WHERE id = ?');
                                                    $stmt->bind_param('i', $sub_ledger_id);
                                                    $stmt->execute();
                                                    $result = $stmt->get_result();
                                                    $rowsss = $result->fetch_assoc();
                                                    $sub_ledger_name = $rowsss['item_name']?? 'N/A';
                                                    $total_amount += $row['total'] ?? 0;
                                                    echo '<tr>
                                                            <td class="text-center">' . $i . '</td>
                                                            <td>
                                                                <span class="fw-bold text-dark fs-6">' . $sub_ledger_name . '</span><br>
                                                                <small class="text-muted fst-italic">' . $row['note'] . '</small>
                                                            </td>
                                                            <td class="text-center">' . $row['qty'] . '</td>
                                                            <td class="text-end"> ' . round($row['value'], 2) . '</td>
                                                            <td class="text-end"> ' . round($row['total'], 2) . '</td>
                                                        </tr>';
                                                    $i++;
                                                }
                                                ?>

                                                <tr>
                                                    <td colspan="4" class="text-end total-row"><b>Total:</b></td>
                                                    <td class="total-row text-end"><b>   <?php echo round($total_amount); ?></b></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->

    <?php include 'script.php'; ?>
    <script type="text/javascript">
        function printTable() {
            var divToPrint = document.querySelector('.ledger-card');
            var newWin = window.open('', '_blank');

            newWin.document.write('<html><head><title>Ledger Report</title>');
            newWin.document.write('<style>');
            newWin.document.write('body { font-family: Arial, sans-serif; margin: 20px; }');
            newWin.document.write('.ledger-card { width: 100%; padding: 20px; border: 1px solid black; }');
            newWin.document.write('table { width: 100%; border-collapse: collapse; margin-top: 20px; }');
            newWin.document.write('th, td { border: 1px solid black; padding: 10px; text-align: left; }');
            newWin.document.write('th { background-color: #f2f2f2; }');
            newWin.document.write('</style></head><body>');

            newWin.document.write(divToPrint.outerHTML);
            newWin.document.write('</body></html>');

            newWin.document.close();
            newWin.focus();
            newWin.print();
            newWin.close();
        }
    </script>


</body>

</html>


 <div id="sidebar-menu">
                        <!-- Left Menu Start -->
                        <ul class="metismenu list-unstyled" id="side-menu">


                            <li>
                                <a href="index.php" class="waves-effect">
                                    <i class="mdi mdi-view-dashboard"></i>
                                    <span> Dashboard </span>
                                </a>
                            </li>
                            <li >
                                
                                <?php if (!(isset($page_title) && $page_title === 'Tickets') && isset($_SESSION['details']['role']) && ($_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role'] == 'Staff' || $_SESSION['details']['role'] == 'Supports')): ?>
                                    <select name="menu_select_box" id="menu_select_box" class="form-select"></select>
                                <?php endif; ?>

                            </li> 
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Staff' || $_SESSION['details']['role']=='Supports'): ?>  
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class="mdi mdi-account-check"></i>
                                    <span>Customer </span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="customers_new.php">Customer List</a></li>
                                    <li>
                                        <a href="con_request.php">Connection Request 
                                            <?php 
                                                if ($allCstmr=$con->query("SELECT * FROM customer_request WHERE status=0")) {
                                                    if ($allCstmr->num_rows > 0) {
                                                        echo '<span class="badge rounded-pill bg-danger float-end">'.$allCstmr->num_rows.'<span>';
                                                    }else{

                                                    }
                                                }



                                                 ?>
                                        </a>
                                    </li>
                                    <!-- <li><a href="customer_dues.php">Customer Unpaid</a></li> -->
                                    <li><a href="customer_recharge.php">Customer Recharge</a></li>
                                    <li><a href="credit_recharge_list.php">Credit Recharge List</a></li>
                                    <li><a href="package_add.php">Customer Packages</a></li>
                                    <li><a href="pwdmissmatch.php">Password missmatch</a></li>
                                    <li><a href="customer_import.php">Import</a></li>
                                    <!-- <li><a href="area.php">Area</a></li> -->
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Supports'): ?>  
                           
                                <li>
                                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                                        <i class="mdi mdi-antenna"></i>
                                        <span>Pop/Area Mgt</span>
                                    </a>
                                    <ul class="sub-menu" aria-expanded="false">
                                        <li><a href="pop_branch.php">Pop Branch</a></li>
                                        <li><a href="pop_area.php">Pop Area</a></li>
                                        <li><a href="area_house_no.php">House/Holding/Building</a></li>
                                    </ul>
                                </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Supports'): ?>     
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class="mdi mdi-account-plus-outline"></i>
                                    <span>Customers Packages</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="pool.php">IP Pool</a></li>
                                    <li><a href="package.php">Packages</a></li>
                                    <li><a href="expired.php">Expired Date</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Staff' || $_SESSION['details']['role']=='Supports'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span>Tickets</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="allTickets.php"> List All Tickets </a></li>
                                    <li><a href="ticketsTopic.php"> Ticket Topics  </a></li>
									<li><a href="working_group.php"> Working Group  </a></li>
                                    <li><a href="works.php"> Works  </a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Accounts'): ?> 
                           <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class="mdi mdi-book"></i>
                                    <span>Accounts</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="ledger.php">Leger</a></li>
                                    <li><a href="transactions.php">Transactions</a></li>
                                    <li><a href="reports.php">Reports</a></li>
                                    <li><a href="balance_sheet.php">Balance Sheet</a></li>
                                    <li><a href="#">Settings</a></li>
                                    <li><a href="cash_bank.php"> Cash/Bank List </a></li>
                                    <li><a href="voucher.php">Voucher Entry</a></li>
                                    <li><a href="bill_entry.php"> Bill Entry</a></li>
                                    <li><a href="daybook.php">Daybook </a></li>
                                    <li><a href="bank_maping.php">Bank Mapping  </a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='HR & Admin'): ?> 
                           <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class="mdi mdi-book"></i>
                                    <span>HR Management</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="department.php">Department</a></li>
                                    <li><a href="shift.php">Shift</a></li>
                                    <li><a href="leave.php">Leave</a></li>
                                    <li><a href="attendance.php">Attendance</a></li>
                                    <li><a href="employee.php">Employee</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Accounts'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class=" far fa-save"></i>
                                    <span>Inventory</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="product.php">Products</a></li>
                                    <li><a href="category.php">Category</a></li>
                                    <li><a href="brand.php">Brand</a></li>
                                    <li><a href="units.php">Units</a></li>
                                    <li><a href="store.php">Store</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Accounts'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                <i class="fas fa-shopping-cart"></i>
                                    <span>Sale's</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="sale.php">Sale</a></li>
                                    <li><a href="sales_invoice.php">Sale's Invoice</a></li>
                                    <li><a href="client.php">Client </a></li>
                                    <li><a href="client_tickets.php">Client Tickets</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>

                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Accounts'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                <i class="fas fa-shopping-bag"></i>
                                    <span>Purchase</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="purchase.php">Purchase</a></li>
                                    <li><a href="purchase_invoice.php">Purchase Invoice</a></li>
                                    <li><a href="supplier.php">Supplier</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>

                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin' || $_SESSION['details']['role']=='Accounts'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                <i class="fas fa-university"></i> 
                                    <span>Bank</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="bank_list.php">Bank List</a></li>
                                    <li><a href="bank_transaction.php">Bank Transaction</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>


                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class= "fa fa-file"></i>
                                    <span>Reports</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="customers_payment.php">Customer Payment</a></li>
                                    <!-- <li><a href="recharge_filter.php">Recharge Filter</a></li> -->
                                    <li><a href="bill_collection.php">Bill Collection</a></li>
                                    <li><a href="cash_collection.php">Cash Collection</a></li>
                                    <li><a href="billing_report.php">Billing Report</a></li>
                                     <!-- <li><a href="bkash_search.php">bKash Search</a></li> -->
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class= "far fa-envelope"></i>
                                    <span>SMS</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="message_template.php">Message Templates</a></li>
                                    <li><a href="send_message.php">Send SMS </a></li>
                                    <li><a href="sms_schedule.php">Schedule</a></li>
                                    <li><a href="sms_settings.php">Settings</a></li>
                                    <li><a href="sms_report.php">Report</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class= "fas fa-user-friends"></i>
                                    <span>Users</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="users.php">User List</a></li>
                                    <li><a href="users_log.php">Users Log</a></li>
                                </ul>
                            </li>
                            <?php endif; ?>
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin'): ?> 
                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <i class= "mdi mdi-power-settings menu-icon"></i>
                                    <span>Settings</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="nas.php">NAS</a></li>
                                      <li><a href="router_setting.php">Router Settings</a></li>
                                    <li><a href="password_change.php">Password Change</a></li>
                                </ul>
                            </li>
                            <?php endif; ?> 
                            <?php if (isset($_SESSION['details']['role']) && $_SESSION['details']['role'] == 'Super Admin'): ?> 
                               <li>
                                    <a href="company.php" class="waves-effect">
                                        <i class="mdi mdi-domain"></i>
                                        <span> Company </span>
                                    </a>
                                </li>


                            <?php endif; ?>
                        </ul>
                    </div>

                    <?php
include("include/security_token.php");
include("include/users_right.php");
$areaData = [];
$areaResult = $con->query("SELECT * FROM area_list");

if ($areaResult) {
    while ($row = $areaResult->fetch_assoc()) {
        $areaData[$row['pop_id']][] = [
            'id' => $row['id'],
            'name' => $row['name']
        ];
    }
}
echo  '<script>var areas = ' . json_encode($areaData) . ';</script>';
?>
<!doctype html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">



    <!-- Begin page -->
        <div id="layout-wrapper">

        <?php
        $page_title="Schedule";
        include 'Header.php'; 
        ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Sms Schedule</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
									<button type="button" class="btn btn-primary mt-2 mb-2 mt-xl-0 mdi mdi-account-plus mdi-18px"  data-bs-toggle="modal" data-bs-target="#addModal">&nbsp;&nbsp;Add New</button>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="datatable1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>No.</th> 
                                                    <th>POP/Branch Name</th> 
                                                    <th> Area Name</th> 
                                                    <th>Message</th> 
                                                    <th>Schedule Date</th> 
                                                    <th>Created</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php';?>

        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header  bg-success">
                    <h5 class="modal-title text-white " id="exampleModalLabel">Schedule Add&nbsp;&nbsp;<i class="mdi mdi-account-plus"></i></h5>
                </div>
                <form action="include/message_server.php?add_message_shchedule_data=true" method="POST" id="add_message_schedule_modal_form">
                    <div class="modal-body">
                       
                        <div class="from-group mb-2">
                            <label for=""> POP/Branch </label>
                            <select id="pop_id" name="pop_id" class="form-select" style="width: 100%;">
                                <option value="all">All POP/Branch</option>
                                <?php
                                $result = $con->query("SELECT * FROM add_pop");
                              
                                if ($result) {
                                    while ($row = $result->fetch_array()) {
                                        echo "<option value='".$row['id']."'>".$row['pop']."</option>";
                                    }
                                } else {
                                    echo "<option value=''>No data available</option>";
                                }
                                ?>
                            </select>


                        </div>
                        <div class="from-group mb-2">
                            <label for=""> POP/Area </label>
                            <select id="area_id" name="area_id" class="form-select" style="width: 100%;" >
                                <option value="all">All POP/Area</option>
                            </select>

                        </div>

                        <div class="from-group mb-2">
                            <label for="">Message Template</label>
                            <select id="template_id" name="template_id" class="form-select" style="width: 100%;" >
                                <option >---Select---</option>
                                <?php
                                if ($result=$con->query("SELECT * FROM message_template")) {
                                    while ($row = $result->fetch_array()) {
                                        echo "<option value='" . $row['id'] . "'>" . $row['template_name'] . "</option>";
                                    }
                                }
                                ?>
                            </select>

                        </div>
                        <div class="from-group mb-2">
                            <label for="">Message Template</label>
                            <textarea id="message" name="message" class="form-control" placeholder="Enter Your Message"></textarea>

                        </div>
                        <div class="from-group mb-2">
                            <label for=""> Send Date </label>
                            <input  name="send_date" type="date" class="form-control"></input>

                        </div>
                        <div class="from-group mb-2">
                            <label for="">Note</label>
                            <input id="notes" type="text" name="notes" class="form-control" placeholder="Enter Your Note">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header  bg-success">
                    <h5 class="modal-title text-white " id="exampleModalLabel">Schedule Update&nbsp;&nbsp;<i class="mdi mdi-account-plus"></i></h5>
                </div>
                <form action="include/message_server.php?update_message_shchedule_data=true" method="POST" id="update_message_schedule_modal_form">
                    <div class="modal-body">
                       
                        <div class="from-group mb-2">
                            <label for=""> POP/Branch </label>
                            <input type="text" name="id" class="d-none">
                            <select id="pop_id" name="pop_id" class="form-select" style="width: 100%;">
                                <option value="all">All POP/Branch</option>
                                <?php
                                $result = $con->query("SELECT * FROM add_pop");
                              
                                if ($result) {
                                    while ($row = $result->fetch_array()) {
                                        echo "<option value='".$row['id']."'>".$row['pop']."</option>";
                                    }
                                } else {
                                    echo "<option value=''>No data available</option>";
                                }
                                ?>
                            </select>


                        </div>
                        <div class="from-group mb-2">
                            <label for=""> POP/Area </label>
                            <select id="area_id" name="area_id" class="form-select" style="width: 100%;" >
                                <option value="all">All POP/Area</option>
                                <?php
                                if ($result=$con->query("SELECT * FROM area_list")) {
                                    while ($row = $result->fetch_array()) {
                                        echo "<option value='" . $row['id'] . "'>" . $row['name'] . "</option>";
                                    }
                                }
                                ?>
                            </select>

                        </div>

                        <div class="from-group mb-2">
                            <label for="">Message Template</label>
                            <select id="template_id" name="template_id" class="form-select" style="width: 100%;" >
                                <option >---Select---</option>
                                <?php
                                if ($result=$con->query("SELECT * FROM message_template")) {
                                    while ($row = $result->fetch_array()) {
                                        echo "<option value='" . $row['id'] . "'>" . $row['template_name'] . "</option>";
                                    }
                                }
                                ?>
                            </select>

                        </div>
                        <div class="from-group mb-2">
                            <label for="">Message Template</label>
                            <textarea id="message" name="message" class="form-control" placeholder="Enter Your Message"></textarea>

                        </div>
                        <div class="from-group mb-2">
                            <label for=""> Send Date </label>
                            <input  name="send_date" type="date" class="form-control"></input>

                        </div>
                        <div class="from-group mb-2">
                            <label for="">Note</label>
                            <input id="notes" type="text" name="notes" class="form-control" placeholder="Enter Your Note">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <form action="include/message_server.php?delete_message_schedule_data=true" method="post" enctype="multipart/form-data">
                <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fas fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <input type="hidden" name="id" value="">
                    <a class="close" data-bs-dismiss="modal" aria-hidden="true"><i class="mdi mdi-close"></i></a>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>

    <?php include 'script.php'; ?>
    <script type="text/javascript">
        var table;
        $(document).ready(function(){
            table=$('#datatable1').DataTable( {
               "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/message_server.php?get_message_schedule_data=1",
                    type		: 'GET',
                },
                "order": [[0, 'desc']], 
                "buttons": [
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy"></i> Copy',
                    titleAttr: 'Copy',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'excel',
                    text: '<i class="fas fa-file-excel"></i> Excel',
                    titleAttr: 'Excel',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'csv',
                    text: '<i class="fas fa-file-csv"></i> CSV',
                    titleAttr: 'CSV',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'pdf',
                    exportOptions: { columns: ':visible' },
                    orientation: 'landscape',
                    pageSize: "LEGAL",
                    text: '<i class="fas fa-file-pdf"></i> PDF',
                    titleAttr: 'PDF'
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print"></i> Print',
                    titleAttr: 'Print',
                    exportOptions: { columns: ':visible' }
                },
                {
                    extend: 'colvis',
                    text: '<i class="fas fa-list"></i> Column Visibility',
                    titleAttr: 'Column Visibility'
                }
            ],
            });
            table.buttons().container().appendTo($('#export_buttonscc'));	
        });
        /* Area filter change event*/
        $(document).on('change', '.area_filter', function(){
            var area_filter_result = $('.area_filter').val() || '';
            table.columns(7).search(area_filter_result).draw();
        });   
    $(document).on('shown.bs.modal', '#addModal', function () { 
        // Check if select2 is already initialized for pop_id
        if (!$('#pop_id').hasClass("select2-hidden-accessible")) {
            $("#pop_id").select2({
                dropdownParent: $('#addModal')
            });
        }

        // Check if select2 is already initialized for area_id
        if (!$('#area_id').hasClass("select2-hidden-accessible")) {
            $("#area_id").select2({
                dropdownParent: $('#addModal')
            });
        }

        // Check if select2 is already initialized for template_id
        if (!$('#template_id').hasClass("select2-hidden-accessible")) {
            $("#template_id").select2({
                dropdownParent: $('#addModal')
            });
        }
    });
    

    $(document).on('change', 'select[name="pop_id"]', function() {
        var selectedPopId = $(this).val();

        /*Filter area by pop_id*/ 
        var filteredAreas = areas[selectedPopId] || [];
        var areaOptions = '<option value="all">All POP/Area</option>';
        filteredAreas.forEach(function(area) {
            areaOptions += '<option value="' + area.id + '">' + area.name + '</option>';
        });

        // Update the Area dropdown
        $('select[name="area_id"]').html(areaOptions);
    });
    $(document).on('change', 'select[name="template_id"]', function(){
        template_id = $(this).val();
        var currentMsgTemp="0";
        if(template_id){
            $.ajax({
                type: 'POST',
                url:'include/message.php',
                data: {name: template_id, currentMsgTemp: currentMsgTemp},
                success: function(response){
                    $('textarea[name="message"]').val(response);
                }
            });
        }
    });
    $('#add_message_schedule_modal_form').submit(function(e) {
        e.preventDefault();

        /* Get the submit button */
        var submitBtn = $(this).find('button[type="submit"]');
        var originalBtnText = submitBtn.html();

        submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>');
        submitBtn.prop('disabled', true);

        var form = $(this);
        var url = form.attr('action');
        /*Change to FormData to handle file uploads*/
        var formData = new FormData(this);

        /* Use Ajax to send the request */
        $.ajax({
            type: 'POST',
            url: url,
            data: formData,
            contentType: false,
            processData: false,
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $("#addModal").fadeOut(500, function() {
                    $(this).modal('hide');
                    toastr.success(response.message);
                    $('#datatable1').DataTable().ajax.reload();
                });

                } else if (!response.success && response.errors) {
                    $.each(response.errors, function(field, message) {
                        toastr.error(message);
                    });
                }
            },
            error: function(xhr, status, error) {
                /* Handle errors */
            },
            complete: function() {
                /* Reset button text and enable the button */
                submitBtn.html(originalBtnText);
                submitBtn.prop('disabled', false);
            }
        });
    });

    /** Handle edit button click**/
    $('#datatable1 tbody').on('click', '.edit-btn', function () {
      var id = $(this).data('id');
      var url = "include/message_server.php?edit_data=true&id=" + id;
      $.ajax({
          type: 'GET',
          url: url,
          dataType:'json',
          success: function (response) {
              if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);


                $('#editModal select[name="pop_id"]').select2();
                $('#editModal select[name="pop_id"]').val(response.data.pop_id);
               

                $('#editModal select[name="area_id"]').select2();
                $('#editModal select[name="area_id"]').val(response.data.area_id);
                
                $('#editModal textarea[name="message"]').val(response.data.message_text); 
                $('#editModal input[name="send_date"]').val(response.data.send_date);
                $('#editModal input[name="notes"]').val(response.data.note);
              } else {
                toastr.error("Error fetching data for edit!");
              }
          },
          error: function (xhr, status, error) {
            console.error(xhr.responseText);
            toastr.error("Error fetching data for edit!");
          }
      });
    });
    
     /** Handle Delete button click**/
    $('#datatable1 tbody').on('click', '.delete-btn', function () {
        var id = $(this).data('id');
        $('#deleteModal').modal('show');
        var value_input = $("input[name*='id']").val(id);
    });
    /** Handle form submission for delete **/
    $('#deleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#deleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
        type:'POST',
        'url':url,
        data: formData,
        dataType:'json',
        success: function (response) {
            $('#deleteModal').modal('hide');
            if (response.success) {
            toastr.success(response.message);
            $('#datatable1').DataTable().ajax.reload( null , false);
            }
        },

        error: function (xhr, status, error) {
            /** Handle  errors **/
            toastr.error(xhr.responseText);
        },
        complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
    });
    $('#update_message_schedule_modal_form').submit(function(e) {
        e.preventDefault();

        /* Get the submit button */
        var submitBtn = $(this).find('button[type="submit"]');
        var originalBtnText = submitBtn.html();

        submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>');
        submitBtn.prop('disabled', true);

        var form = $(this);
        var url = form.attr('action');
        /*Change to FormData to handle file uploads*/
        var formData = new FormData(this);

        /* Use Ajax to send the request */
        $.ajax({
            type: 'POST',
            url: url,
            data: formData,
            contentType: false,
            processData: false,
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $("#editModal").fadeOut(500, function() {
                    $(this).modal('hide');
                    toastr.success(response.message);
                    $('#datatable1').DataTable().ajax.reload();
                });

                } else if (!response.success && response.errors) {
                    $.each(response.errors, function(field, message) {
                        toastr.error(message);
                    });
                }
            },
            error: function(xhr, status, error) {
                /* Handle errors */
            },
            complete: function() {
                /* Reset button text and enable the button */
                submitBtn.html(originalBtnText);
                submitBtn.prop('disabled', false);
            }
        });
    });
    </script>
</body>

</html>

<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <!-- <link rel="shortcut icon" href="assets/images/favicon.ico"> -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    	<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Store</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Store</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target="#addModal" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                              Store</button>
                          </div>
                            </div>
                        </div>
                    </div>






                          <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Store</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/store_backend.php" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="add_store_data" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Name</label>
										<input name="name" placeholder="Enter Name" class="form-control" type="text" >
									</div>
                                    <div class="form-group mb-2">
                                        <label for="">Phone Number</label>
                                        <input class="form-control" type="text" name="phone_number" id="phone_number" placeholder="Type Phone Number"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Address</label>
                                        <input class="form-control" type="text" name="address" id="address" placeholder="Type Your Address"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Note</label>
                                        <input class="form-control" type="text" name="note" id="note" placeholder="Type Your Note"/>
                                    </div>
									              
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>


				 <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Store</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/store_backend.php" method="POST" enctype="multipart/form-data">
                                    <div class="form-group mb-2 d-none">
                                        <input name="update_store_data" class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2 d-none">
                                        <label>ID</label>
                                        <input name="id"  class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Name</label>
                                        <input name="name" placeholder="Enter Name" class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Phone Number</label>
                                        <input class="form-control" type="text" name="phone_number" id="phone_number" placeholder="Type Phone Number"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Address</label>
                                        <input class="form-control" type="text" name="address" id="address" placeholder="Type Your Address"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Note</label>
                                        <input class="form-control" type="text" name="note" id="note" placeholder="Type Your Note"/>
                                    </div>                
                                    <div class="modal-footer ">
                                        <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                                        <button type="submit" class="btn btn-success">Save Changes</button>
                                    </div>
                                </form>
							</div>
                        </div>
                     </div>
                  </div>






                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                    <th>ID</th>
                                                    <th>Store Name</th>
                                                    <th>Phone Number</th>
                                                    <th>Address</th>
                                                    <th>Note</th>
                                                    <th></th>
                                               </tr>
                                            </thead>
                                            <tbody>
                                                <?php 

                                                if ($userlist=$con->query("SELECT* FROM store")) {

        while ($rows=$userlist->fetch_array()) {

            $userId=$rows["id"];
            $name=$rows["name"];
            $phone_number=$rows["phone_number"];
            $address=$rows["address"];
            $note=$rows["note"];
             echo '
     <tr>
     <td>'.$userId.'</td>
     <td>'.$name.'</td>
	 <td>'.$phone_number.'</td>
     <td>'.$address.'</td>
     <td>'.$note.'</td>
    <td style=" text-align:right;">
        <button type="button" class="btn btn-info edit-btn" data-id="'.$userId.'"><i class="fas fa-edit"></i></button>
        <button type="button" class="btn btn-danger delete-btn" data-id="'.$userId.'" ><i class=" fas fa-trash"></i>
        </button>
        </td>
     </tr>'; 
        }
    }

                                                 ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script> 

    <script src="assets/js/app.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#users_table").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/store_backend.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

       /** Store The data from the database table **/
	  $('#addModal form').submit(function(e){
		e.preventDefault();

		var form = $(this);
		var url = form.attr('action');
		var formData = form.serialize();
		/** Use Ajax to send the delete request **/
		$.ajax({
		  type:'POST',
		  'url':url,
		  data: formData,
		 success: function (response) {
			/*Parse the JSON response*/ 
			const jsonResponse = JSON.parse(response);

			/* Check if the request was successful*/
			if (jsonResponse.success) {
				/*Hide the modal*/ 
				$('#addModal').modal('hide'); 
				 /*Reset the form*/ 
				$('#addModal form')[0].reset();
				/* Show success message*/
				toastr.success(jsonResponse.message); 

				/*Reload the page after a short delay*/ 
				setTimeout(() => {
					location.reload();
				}, 500);
			} else {
				/*Show error message if success is false*/ 
				toastr.error(jsonResponse.message); // Show error message
			}
		},


		  error: function (xhr, status, error) {
			 /** Handle  errors **/
			if (xhr.status === 422) {
				var errors = xhr.responseJSON.errors;
				$.each(errors, function(key, value) {
					toastr.error(value[0]); 
				});
			}
		  }
		});
	  });
    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/store_backend.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="name"]').val(jsonResponse.data.name);
                    $('#editModal input[name="phone_number"]').val(jsonResponse.data.phone_number);
                    $('#editModal input[name="address"]').val(jsonResponse.data.address);
                    $('#editModal input[name="note"]').val(jsonResponse.data.note);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
                const jsonResponse = JSON.parse(response);
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>

<!-- DataTables -->
<link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
<link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
<link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

<!-- Bootstrap Touchspin -->
<link href="assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet" type="text/css">

<!-- Select2 -->
<link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">

<!-- Bootstrap Datepicker -->
<link href="assets/libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css">

<!-- Spectrum Colorpicker -->
<link href="assets/libs/spectrum-colorpicker2/spectrum.min.css" rel="stylesheet" type="text/css">

<!-- Bootstrap Css -->
<link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">

<!-- Icons Css -->
<link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">

<!-- App Css -->
<link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

<!-- Toastr Css -->
<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">

<!-- Delete Modal Css -->
<link rel="stylesheet" type="text/css" href="css/deleteModal.css">

<!-- Chartist Chart -->
<link href="assets/libs/chartist/chartist.min.css" rel="stylesheet" type="text/css">

<!-- C3 Chart Css -->
<link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>


<?php 



include "include/db_connect.php";

if(isset($_POST["loginConfirmBtn"]))
{
$password = $_POST["password"];

 $username = $_POST["username"];
 $usr = $con -> query("SELECT * FROM customers WHERE username='$username' AND password='$password' LIMIT 1");
 $usrext = $usr->num_rows;
 
 if($usrext==1)
 {
      while($rows= $usr->fetch_array())
  {
      $uid = $rows["id"];
      $fullname = $rows["fullname"];
  }
session_start();
$_SESSION["subscribe_id"] = $uid;    
$_SESSION["subscribe_fullname"] = $fullname;    
header("location: subscribe_profile.php");
     
 }else{
    $wrong_info="Username or Password Wrong!";
 }
    
}












 ?>






<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Customer Login Page</title>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css?family=Ubuntu&display=swap');

:root{
    --font-ubuntu: 'Ubuntu', monospace;
    --color-border: #e5e5e5;
}

.font-ubuntu{
    font: normal 500 16px var(--font-ubuntu);
}

#register, #login-form {
    padding: 5% 0;
    background: url("assets/images/background.png") no-repeat;
    background-size: cover;
}

#login-form{
    padding: 10% 0;
}

#register .upload-profile-image{
    position: relative;
    width: 10%;
    margin-left: auto;
    margin-right: auto;
    transition: filter .8s ease;
}

#register .upload-profile-image:hover{
    filter: drop-shadow(1px 1px 22px #7584bb);
}

#upload-profile{
    position: absolute;
    top: 0;
    z-index: 10;
    width: 200px;
    margin-top: 0px;
    opacity: 0;
}

#upload-profile::-webkit-file-upload-button{
    visibility: hidden;
}

#upload-profile::before{
    content: ' ';
    display: inline-block;
    width: 200px;
    height: 200px;
    cursor: pointer;
    border-radius: 50%;
}

#register .upload-profile-image .camera-icon{
    position: absolute;
    top: 70px;
    width: 60px !important;
    filter: invert(30%) !important;
}

#register .upload-profile-image:hover .camera-icon{
    filter: invert(100%) !important;
}

#reg-form input[type='text'],
#reg-form input[type='email'],
#reg-form input[type='password'],
#log-form input[type='text'],
#log-form input[type='email'],
#log-form input[type='password']{
    border: none;
    border-radius: unset;
    border-bottom: 1px solid var(--color-border);
    font-family: var(--font-ubuntu);
}

#reg-form input[type='text'],
#reg-form input[type='email'],
#reg-form input[type='password'],
#log-form input[type='text'],
#log-form input[type='email'],
#log-form input[type='password']{
    outline: none;
    box-shadow: none;
}

</style>
<link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
</head>
<body>
<section id="login-form">
    <div class="row m-0">
        <div class="col-lg-4 offset-lg-2">
            <div class="text-center pb-5">
                <h1 class="login-title text-dark">Login</h1>
                <p class="p-1 m-0 font-ubuntu text-black-50">Login and enjoy additional features</p>
                <span class="font-ubuntu text-black-50">Create a new <a href="register.php">account</a></span>
            </div>
            <!-- <div class="upload-profile-image d-flex justify-content-center pb-5">
                <div class="text-center">
                    <img src="" style="width: 200px; height: 200px" class="img rounded-circle" alt="profile">
                </div>
            </div> -->
            <div class="d-flex justify-content-center">
                <form method="post" id="log-form">

                    <div class="form-row my-4">
                        <div class="col">
                            <input type="text" required name="username" id="username" class="form-control" placeholder="Username*">
                        </div>
                    </div>

                    <div class="form-row my-4">
                        <div class="col">
                            <input type="password" required name="password" id="password" class="form-control" placeholder="password*">
                        </div>
                    </div>
                    <div>
                        <?php if (isset($wrong_info)) {
                            echo '<p style="color:red;">'.$wrong_info.'</p>';
                        } ?>
                    </div>
                    <div class="submit-btn text-center my-5">
                        <button type="submit" class="btn btn-warning rounded-pill text-dark px-5" name="loginConfirmBtn">Login</button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</section>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Customer Profile Page</title>
	<style>
		body{
    background: #eaeaea;
    margin-top:20px;
}
.profile-info-list {
    padding: 0;
    margin: 0;
    list-style-type: none;
}
.friend-list,
.img-grid-list {
    margin: -1px;
    list-style-type: none;
}
.profile-info-list > li.title {
    font-size: 0.625rem;
    font-weight: 700;
    color: #8a8a8f;
    padding: 0 0 0.3125rem;
}
.profile-info-list > li + li.title {
    padding-top: 1.5625rem;
}
.profile-info-list > li {
    padding: 0.625rem 0;
}
.profile-info-list > li .field {
    font-weight: 700;
}
.profile-info-list > li .value {
    color: #666;
}
.profile-info-list > li.img-list a {
    display: inline-block;
}
.profile-info-list > li.img-list a img {
    max-width: 2.25rem;
    -webkit-border-radius: 2.5rem;
    -moz-border-radius: 2.5rem;
    border-radius: 2.5rem;
}
.coming-soon-cover img,
.email-detail-attachment .email-attachment .document-file img,
.email-sender-img img,
.friend-list .friend-img img,
.profile-header-img img {
    max-width: 100%;
}
.table.table-profile th {
    border: none;
    color: #000;
    padding-bottom: 0.3125rem;
    padding-top: 0;
}
.table.table-profile td {
    border-color: #c8c7cc;
}
.table.table-profile tbody + thead > tr > th {
    padding-top: 1.5625rem;
}
.table.table-profile .field {
    color: #666;
    font-weight: 600;
    width: 25%;
    text-align: right;
}
.table.table-profile .value {
    font-weight: 500;
}
.profile-header {
    position: relative;
    overflow: hidden;
}
.profile-header .profile-header-cover {
    background: url(https://bootdey.com/img/Content/bg1.jpg) center no-repeat;
    background-size: 100% auto;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
}
.profile-header .profile-header-cover:before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0.25) 0, rgba(0, 0, 0, 0.85) 100%);
}
.profile-header .profile-header-content,
.profile-header .profile-header-tab,
.profile-header-img,
body .fc-icon {
    position: relative;
}
.profile-header .profile-header-tab {
    background: #fff;
    list-style-type: none;
    margin: -1.25rem 0 0;
    padding: 0 0 0 8.75rem;
    border-bottom: 1px solid #c8c7cc;
    white-space: nowrap;
}
.profile-header .profile-header-tab > li {
    display: inline-block;
    margin: 0;
}
.profile-header .profile-header-tab > li > a {
    display: block;
    color: #000;
    line-height: 1.25rem;
    padding: 0.625rem 1.25rem;
    text-decoration: none;
    font-weight: 700;
    font-size: 0.75rem;
    border: none;
}
.profile-header .profile-header-tab > li.active > a,
.profile-header .profile-header-tab > li > a.active {
    color: #007aff;
}
.profile-header .profile-header-content:after,
.profile-header .profile-header-content:before {
    content: "";
    display: table;
    clear: both;
}
.profile-header .profile-header-content {
    color: #fff;
    padding: 1.25rem;
}
body .fc th a,
body .fc-ltr .fc-basic-view .fc-day-top .fc-day-number,
body .fc-widget-header a {
    color: #000;
}
.profile-header-img {
    float: left;
    width: 7.5rem;
    height: 7.5rem;
    overflow: hidden;
    z-index: 10;
    margin: 0 1.25rem -1.25rem 0;
    padding: 0.1875rem;
    -webkit-border-radius: 0.25rem;
    -moz-border-radius: 0.25rem;
    border-radius: 0.25rem;
    background: #fff;
}
.profile-header-info h4 {
    font-weight: 500;
    margin-bottom: 0.3125rem;
}
.profile-container {
    padding: 1.5625rem;
}
@media (max-width: 967px) {
    .profile-header-img {
        width: 5.625rem;
        height: 5.625rem;
        margin: 0;
    }
    .profile-header-info {
        margin-left: 6.5625rem;
        padding-bottom: 0.9375rem;
    }
    .profile-header .profile-header-tab {
        padding-left: 0;
    }
}
@media (max-width: 767px) {
    .profile-header .profile-header-cover {
        background-position: top;
    }
    .profile-header-img {
        width: 3.75rem;
        height: 3.75rem;
        margin: 0;
    }
    .profile-header-info {
        margin-left: 4.6875rem;
        padding-bottom: 0.9375rem;
    }
    .profile-header-info h4 {
        margin: 0 0 0.3125rem;
    }
    .profile-header .profile-header-tab {
        white-space: nowrap;
        overflow: scroll;
        padding: 0;
    }
    .profile-container {
        padding: 0.9375rem 0.9375rem 3.6875rem;
    }
    .friend-list > li {
        float: none;
        width: auto;
    }
}
.profile-info-list {
    padding: 0;
    margin: 0;
    list-style-type: none;
}
.friend-list,
.img-grid-list {
    margin: -1px;
    list-style-type: none;
}
.profile-info-list > li.title {
    font-size: 0.625rem;
    font-weight: 700;
    color: #8a8a8f;
    padding: 0 0 0.3125rem;
}
.profile-info-list > li + li.title {
    padding-top: 1.5625rem;
}
.profile-info-list > li {
    padding: 0.625rem 0;
}
.profile-info-list > li .field {
    font-weight: 700;
}
.profile-info-list > li .value {
    color: #666;
}
.profile-info-list > li.img-list a {
    display: inline-block;
}
.profile-info-list > li.img-list a img {
    max-width: 2.25rem;
    -webkit-border-radius: 2.5rem;
    -moz-border-radius: 2.5rem;
    border-radius: 2.5rem;
}
.coming-soon-cover img,
.email-detail-attachment .email-attachment .document-file img,
.email-sender-img img,
.friend-list .friend-img img,
.profile-header-img img {
    max-width: 100%;
}
.table.table-profile th {
    border: none;
    color: #000;
    padding-bottom: 0.3125rem;
    padding-top: 0;
}
.table.table-profile td {
    border-color: #c8c7cc;
}
.table.table-profile tbody + thead > tr > th {
    padding-top: 1.5625rem;
}
.table.table-profile .field {
    color: #666;
    font-weight: 600;
    width: 25%;
    text-align: right;
}
.table.table-profile .value {
    font-weight: 500;
}
.row.row-space-2 {
    margin: 0 -1px;
}
.m-b-2 {
    margin-bottom: 2px!important;
}
.embed-responsive {
    position: relative;
    display: block;
    width: 100%;
    padding: 0;
    overflow: hidden;
}
.row.row-space-2>[class*=col-] {
    padding: 0 1px;
}
	</style>
	<link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
</head>
<body>

<div class="container">
    <div id="content" class="content p-0">
        <div class="profile-header">
            <div class="profile-header-cover"></div>
    
            <div class="profile-header-content">
                <div class="profile-header-img">
                    <img src="https://bootdey.com/img/Content/avatar/avatar6.png" alt="" />
                </div>
    
                <div class="profile-header-info">
                    <h4 class="m-t-sm">Rakib Mahmud</h4>
                    <p class="m-b-sm">devOps Engineer </p>
                    <a href="#" class="btn btn-xs btn-info mb-4">Edit Profile</a>
                    <a href="subscribe_logout.php" class="btn btn-xs btn-danger mb-4">logout</a>
                </div>
            </div>
    
                  <ul class="profile-header-tab nav nav-tabs">
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-with-timeline-posts" target="__blank" class="nav-link_">POSTS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-about" target="__blank" class="nav-link_">ABOUT</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-photos" target="__blank" class="nav-link_">PHOTOS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-videos" target="__blank" class="nav-link_">VIDEOS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-friend-list" target="__blank" class="nav-link_ active show">FRIENDS</a></li>
                  </ul>
        </div>
    
        <div class="profile-container">
            <div class="row row-space-20">
                <div class="col-md-8">
                    <div class="tab-content p-0">
                        <div class="tab-pane active show" id="profile-videos">
                            <div class="m-b-10"><b>Videos (15)</b></div>
    
                            <div class="row ">
                                <div class="col-sm">
                                    <div class="embed-responsive embed-responsive-16by9 m-b-2">
                                        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/3Kf-FlECN7M?showinfo=0"></iframe>
                                    </div>
                                </div>
    
                                <div class="col-sm">
                                    <div class="embed-responsive embed-responsive-16by9 m-b-2">
                                        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/izsjRpcgfmk?showinfo=0"></iframe>
                                    </div>
                                    <div class="embed-responsive embed-responsive-16by9 m-b-2">
                                        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/j876xgnTVUg?showinfo=0"></iframe>
                                    </div>
                                </div>
                            </div>
    
                        </div>
                    </div>
                </div>
    
                <div class="col-md-4 hidden-xs hidden-sm">
                    <ul class="profile-info-list">
                        <li class="title">PERSONAL INFORMATION</li>
                        <li>
                            <div class="field">Occupation:</div>
                            <div class="value">UXUI / Frontend Developer</div>
                        </li>
                        <li>
                            <div class="field">Skills:</div>
                            <div class="value">C++, PHP, HTML5, CSS, jQuery, MYSQL, Ionic, Laravel, Phonegap, Bootstrap, Angular JS, Angular JS, Asp.net</div>
                        </li>
                        <li>
                            <div class="field">Birth of Date:</div>
                            <div class="value">1989/11/04</div>
                        </li>
                        <li>
                            <div class="field">Country:</div>
                            <div class="value">San Francisco</div>
                        </li>
                        <li>
                            <div class="field">Address:</div>
                            <div class="value">
                                <address class="m-b-0">
                                    Twitter, Inc.<br />
                                    1355 Market Street, Suite 900<br />
                                    San Francisco, CA 94103
                                </address>
                            </div>
                        </li>
                        <li>
                            <div class="field">Phone No.:</div>
                            <div class="value">
                                (123) 456-7890
                            </div>
                        </li>
                        <li class="title">FRIEND LIST (9)</li>
                        <li class="img-list">
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar4.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar5.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar6.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar8.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" /></a>
                            <a href="#" class="m-b-5"><img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="" /></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>




</body>
</html>

<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';
// ini_set('display_errors', '1');
// ini_set('display_startup_errors', '1');
// error_reporting(E_ALL);

if (isset($_GET['clid'])) {
    $clid = $_GET['clid'];
    if ($cstmr = $con->query("SELECT * FROM suppliers WHERE id=$clid")) {
        while ($rows = $cstmr->fetch_array()) {
            $lstid = $rows['id'];
            $fullname = $rows['fullname'];
            $company = $rows['company'];
            $mobile = $rows['mobile'];
            $email = $rows['email'];
            $address = $rows['address'];
        }
    }
}

?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <div id="layout-wrapper">
        <?php $page_title = "Supplier's Profile";
        include 'Header.php'; ?>
        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-flex justify-content-end align-items-center gap-2 py-2">
                                <abbr title="Create Invoice">
                                    <a href="purchase.php" class="btn btn-sm btn-primary ">
                                        <i class="fas fa-money-bill-wave me-1"></i> Create Invoice
                                    </a>
                                </abbr>

                                <abbr title="Supplier Payment">
                                    <button type="button" data-bs-toggle="modal" data-bs-target="#paymentModal"
                                        class="btn btn-sm btn-success">
                                        <i class="fas fa-hand-holding-usd me-1"></i> Due Payment
                                    </button>
                                </abbr>

                                <abbr title="Edit Supplier">
                                    <button type="button" data-id="<?php echo $clid; ?>"
                                        class="btn btn-sm btn-info edit-btn">
                                        <i class="mdi mdi-account-edit me-1"></i> Edit
                                    </button>
                                </abbr>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="container">
                            <div class="main-body">
                                <div class="row gutters-sm">
                                    <div class="col-md-4 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="d-flex flex-column align-items-center text-center profile">
                                                    <img src="profileImages/avatar.png" alt='Profile Picture'
                                                        class="rounded-circle" width="150" />
                                                    <div class="imgUpIcon">
                                                        <button id="uploadBtn" type="button">
                                                            <i class="mdi mdi-camera"></i>
                                                        </button>
                                                    </div>
                                                    <div class="mt-3">
                                                        <h5>
                                                            <?php echo $fullname; ?>
                                                        </h5>
                                                        <p class="text-secondary mb-1"># <?php echo $clid; ?>
                                                            <br>
                                                            <?php echo $mobile; ?>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="col-12 bg-white p-0 px-2 pb-3 mb-3">
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="mdi mdi-marker-check"></i> Fullname:</p>
                                                        <a href="#"><?php echo $fullname; ?></a>
                                                    </div>
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="mdi mdi-phone"></i> Mobile:</p>
                                                        <a href="#"><?php echo $mobile; ?></a>
                                                    </div>
                                                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                                                        <p><i class="fas fa-id-card"> </i> Address: </p>
                                                        <a href="#"><?php echo $address; ?></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="row">
                                            <!-- Earnings (Monthly) Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow py-2" style="border-left:3px solid #2A0FF1;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                                    Total Purchase's</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    
                                                                    $total_amount = $con->query("SELECT SUM(grand_total) AS amount FROM purchase WHERE client_id='$clid' ")->fetch_array()['amount'] ?? 0;
                                                                    echo floatval($total_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Earnings (Monthly) Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow  py-2" style="border-left:3px solid #27F10F;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                                    Total Paid</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    
                                                                    $total_paid_amount = $con->query("SELECT SUM(amount) AS total_paid FROM inventory_transaction WHERE client_id='$clid' AND transaction_type  !='0' AND inventory_type='Supplier'")->fetch_array()['total_paid'] ?? 0;
                                                                    echo floatval($total_paid_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Pending Requests Card Example -->
                                            <div class="col-xl-4 col-md-6 mb-4">
                                                <div class="card shadow  py-2" style="border-left:3px solid red;">
                                                    <div class="card-body">
                                                        <div class="row no-gutters align-items-center">
                                                            <div class="col mr-2">
                                                                <div
                                                                    class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                    Total Due</div>
                                                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                                    <?php
                                                                    echo floatval($total_amount - $total_paid_amount);
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="container">
                                            <div class="row">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <!-- Nav tabs -->
                                                        <ul class="nav nav-tabs nav-tabs-custom nav-justified"
                                                            role="tablist">
                                                            <li class="nav-item">
                                                                <a class="nav-link active" data-bs-toggle="tab"
                                                                    href="#transaction" role="tab">
                                                                    <span class="d-none d-md-block">Transaction
                                                                    </span><span class="d-block d-md-none"><i
                                                                            class="mdi mdi-home-variant h5"></i></span>
                                                                </a>
                                                            </li>
                                                            <li class="nav-item">
                                                                <a class="nav-link" data-bs-toggle="tab"
                                                                    href="#invoice" role="tab">
                                                                    <span class="d-none d-md-block">Invoice</span><span
                                                                        class="d-block d-md-none"><i
                                                                            class="mdi mdi-account h5"></i></span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                        <!-- Tab panes -->
                                                        <div class="tab-content">
                                                            <div class="tab-pane active p-3" id="transaction"
                                                                role="tabpanel">
                                                                <div class="card">
                                                                    <div class="card-body">
                                                                        <div class="row">
                                                                            <div class="table-responsive">
                                                                                <table id="transaction_datatable"
                                                                                    class="table table-bordered dt-responsive nowrap"
                                                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>ID</th>
                                                                                            <th>Amount</th>
                                                                                            <th>Note</th>
                                                                                            <th>Transaction Type</th>
                                                                                            <th>Transaction Date</th>
                                                                                            <th>Posting Date</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php
                                                                                          $totalCount=1;
                                                                                          $result =$con->query("SELECT * FROM inventory_transaction WHERE inventory_type='Supplier' AND  client_id=$lstid");
                                                                                          
                                                                                          while ($rows = mysqli_fetch_assoc($result)) {
                                                                                          
                                                                                          ?>
                                                                                        <tr>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo $totalCount++;
                                                                                                ?>
                                                                                            </td>
                                                                                            <td><?php echo $rows['amount']; ?>
                                                                                            </td>
                                                                                            <td><?php echo $rows['note']; ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                if ($rows['transaction_type'] == '1') {
                                                                                                    echo "<span class='badge bg-success'>Cash</span>";
                                                                                                } elseif ($rows['transaction_type'] == '2') {
                                                                                                    echo "<span class='badge bg-info'>Bkash</span>";
                                                                                                } elseif ($rows['transaction_type'] == '3') {
                                                                                                    echo "<span class='badge bg-success'>Nagad</span>";
                                                                                                } elseif ($rows['transaction_type'] == '4') {
                                                                                                    echo "<span class='badge bg-primary'>Due Paid</span>";
                                                                                                } elseif ($rows['transaction_type'] == '0') {
                                                                                                    echo "<span class='badge bg-danger'>Crdit</span>";
                                                                                                } elseif ($rows['transaction_type'] == '5') {
                                                                                                    echo "<span class='badge bg-info'>Bank</span>";
                                                                                                }
                                                                                                ?>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo date('d F Y', strtotime($rows['transaction_date']));
                                                                                                ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                echo date('d F Y', strtotime($rows['create_date']));
                                                                                                
                                                                                                ?>
                                                                                            </td>
                                                                                        </tr>
                                                                                        <?php } ?>
                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="tab-pane  p-3" id="invoice"
                                                                role="tabpanel">
                                                                <div class="card">
                                                                    <div class="card-body">
                                                                        <div class="row">
                                                                            <div class="table table-responsive">
                                                                                <table id="invoice_datatable"
                                                                                    class="table table-bordered dt-responsive nowrap"
                                                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>Invoice id</th>
                                                                                            <th>Customer Name</th>
                                                                                            <th>Sub Total</th>
                                                                                            <th>Paid Amount</th>
                                                                                            <th>Due Balance</th>
                                                                                            <th>Grand Total</th>
                                                                                            <th>Create Date</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php
                                                                                       $sql = "SELECT * FROM purchase WHERE client_id=?";
                                                                                       $stmt = $con->prepare($sql);
                                                                                       $stmt->bind_param("i", $lstid);  
                                                                                       $stmt->execute();
                                                                                       $result = $stmt->get_result();

                                                                                       while ($rows = $result->fetch_assoc()) {
                                                                                       ?>
                                                                                        <tr>
                                                                                            <td><?php echo htmlspecialchars($rows['id']); ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                $supplier_id = $rows['client_id'];
                                                                                                $allCustomerData = $con->prepare('SELECT fullname FROM suppliers WHERE id=?');
                                                                                                $allCustomerData->bind_param('i', $supplier_id);
                                                                                                $allCustomerData->execute();
                                                                                                $client_result = $allCustomerData->get_result();
                                                                                                
                                                                                                if ($client_row = $client_result->fetch_assoc()) {
                                                                                                    echo '<a href="supplier_profile.php?clid=' . htmlspecialchars($supplier_id) . '">' . htmlspecialchars($client_row['fullname']) . '</a>';
                                                                                                }
                                                                                                ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['sub_total']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['total_paid']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['total_due']); ?>
                                                                                            </td>
                                                                                            <td><?php echo htmlspecialchars($rows['grand_total']); ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <?php
                                                                                                $date = $rows['date'];
                                                                                                $formatted_date = date('d F Y', strtotime($date));
                                                                                                echo htmlspecialchars($formatted_date);
                                                                                                ?>
                                                                                            </td>
                                                                                            <td>
                                                                                                <a class="btn-sm btn btn-primary"
                                                                                                    href="purchase_invoice_edit.php?clid=<?php echo htmlspecialchars($rows['id']); ?>"><i
                                                                                                        class="fas fa-edit"></i></a>
                                                                                                <a class="btn-sm btn btn-success"
                                                                                                    href="invoice/purchase_inv_view.php?clid=<?php echo htmlspecialchars($rows['id']); ?>"><i
                                                                                                        class="fas fa-eye"></i></a>
                                                                                                <a class="btn-sm btn btn-danger"
                                                                                                    onclick="return confirm('Are You Sure');"
                                                                                                    href="purchase_inv_delete.php?clid=<?php echo htmlspecialchars($rows['id']); ?>"><i
                                                                                                        class="fas fa-trash"></i></a>


                                                                                            </td>
                                                                                        </tr>
                                                                                        <?php  }  ?>

                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <!-- Modal for addPayment -->
            <div class="modal fade bs-example-modal-lg" id="paymentModal" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog " role="document">
                    <div class="modal-content col-md-12">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><span
                                    class="mdi mdi-account-check mdi-18px"></span> &nbsp;Due Payment</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="include/purchase_server.php?add_due_payment=true" method="POST"
                                enctype="multipart/form-data">
                                <input type="hidden" name="client_id" id="client_id" value="<?php echo $clid; ?>">

                                <div class="form-group mb-2">
                                    <label>Due Amount</label>
                                    <input readonly name="due_amount" placeholder="Enter Due Amount"
                                        class="form-control" type="text" value="<?php
                                        echo round($total_amount - $total_paid_amount, 2);
                                        ?>" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Paid Amount</label>
                                    <input name="paid_amount" placeholder="Enter Paid Amount" class="form-control"
                                        type="text" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Select Accounts</label>
                                    <select type="text" class="form-control" id="sub_ledger_id"
                                        name="sub_ledger_id" style="width: 100%;">
                                        <?php
                                        if ($ledgr = $con->query('SELECT * FROM ledger')) {
                                            echo '<option value="">Select</option>';
                                        
                                            while ($rowsitm = $ledgr->fetch_array()) {
                                                $ldgritmsID = $rowsitm['id'];
                                                $ledger_name = $rowsitm['ledger_name'];
                                        
                                                echo '<optgroup label="' . $ledger_name . '">';
                                        
                                                // Sub Ledger items list
                                                if ($ledgrsubitm = $con->query("SELECT * FROM legder_sub WHERE ledger_id='$ldgritmsID'")) {
                                                    while ($rowssb = $ledgrsubitm->fetch_array()) {
                                                        $sub_ldgrid = $rowssb['id'];
                                                        $ldgr_items = $rowssb['item_name'];
                                        
                                                        echo '<option value="' . $sub_ldgrid . '">' . $ldgr_items . '</option>';
                                                    }
                                                }
                                        
                                                echo '</optgroup>';
                                            }
                                        }
                                        ?>
                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Type</label>
                                    <select name="transaction_type" id="transaction_type" class="form-select"
                                        type="text" required>
                                        <option value="">---Select---</option>
                                        <option value="1">Cash</option>
                                        <option value="2">Bkash</option>
                                        <option value="3">Nagad</option>
                                        <option value="4">Due Payment</option>
                                        <option value="5">Bank</option>
                                    </select>
                                </div>
                                <div class="form-group mb-2 d-none" id="bank_area">
                                    <label>Bank Name</label>
                                    <select class="form-select" id="bank_id" name="bank_id" style="width: 100%;">
                                        <option value="">Select</option>
                                        <?php
                                        if ($get_all_bank = $con->query('SELECT * FROM banks')) {
                                            while ($rows = $get_all_bank->fetch_array()) {
                                                echo '<option value="' . $rows['id'] . '">' . $rows['bank_name'] . '</option>';
                                            }
                                        }
                                        
                                        ?>

                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Date</label>
                                    <input name="transaction_date" class="form-control" type="date" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Transaction Notes</label>
                                    <input name="transaction_note" class="form-control" type="text"
                                        placeholder="Enter Transaction Notes" required>
                                </div>
                                <div class="modal-footer ">
                                    <button data-bs-dismiss="modal" type="button"
                                        class="btn btn-danger">Cancel</button>
                                    <button type="submit" class="btn btn-success">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>



            <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog " role="document">
                    <div class="modal-content col-md-12">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><span
                                    class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Supplier</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="include/supplier_backend.php?update_supplier_data=true" method="POST"
                                enctype="multipart/form-data">
                                <div class="form-group mb-2 d-none">
                                    <input name="id" class="form-control" type="text">
                                </div>
                                <div class="form-group mb-2">
                                    <label>Fullname</label>
                                    <input name="fullname" placeholder="Enter Fullname" class="form-control"
                                        type="text">
                                </div>
                                <div class="form-group mb-2">
                                    <label>Company</label>
                                    <input name="company" placeholder="Enter Company" class="form-control"
                                        type="text">
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Phone Number</label>
                                    <input class="form-control" type="text" name="phone_number" id="phone_number"
                                        placeholder="Type Phone Number" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Email</label>
                                    <input class="form-control" type="email" name="email" id="email"
                                        placeholder="Type Your Email" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Address</label>
                                    <input class="form-control" type="text" name="address" id="address"
                                        placeholder="Type Your Address" />
                                </div>
                                <div class="form-group mb-2">
                                    <label for="">Status</label>
                                    <select class="form-select" type="text" name="status">
                                        <option value="">---Select---</option>
                                        <option value="1">Active</option>
                                        <option value="0">Expire</option>
                                    </select>
                                </div>

                                <div class="modal-footer ">
                                    <button data-bs-dismiss="modal" type="button"
                                        class="btn btn-danger">Cancel</button>
                                    <button type="submit" class="btn btn-success">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <?php include 'Footer.php'; ?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    <!-- Right Sidebar -->
    <!-- /Right-bar -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#transaction_datatable").DataTable();
            $("#invoice_datatable").DataTable();
            $('select[name="invoice_id"]').on('change', function() {
                var invoiceId = $(this).val();

                if (invoiceId) {
                    $.ajax({
                        url: 'include/purchase_server.php',
                        type: 'GET',
                        data: {
                            get_invoice_data: true,
                            invoice_id: invoiceId
                        },
                        dataType: 'json',
                        success: function(response) {
                            if (response.status === 'success') {
                                $('input[name="total_due"]').val(response.total_due);
                            } else {
                                toastr.error(response.message);
                                $('input[name="total_due"]').val('');
                            }
                        }
                    });
                } else {
                    $('input[name="total_due"]').val('');
                }
            });

            /** Handle edit button click**/
            $(document).on('click', '.edit-btn', function() {

                var id = $(this).data('id');
                var url = "include/supplier_backend.php?edit_data=true&id=" + id;
                $.ajax({
                    type: 'GET',
                    url: url,
                    success: function(response) {
                        const jsonResponse = JSON.parse(response);
                        if (jsonResponse.success) {
                            $('#editModal').modal('show');
                            $('#editModal input[name="id"]').val(jsonResponse.data.id);
                            $('#editModal input[name="fullname"]').val(jsonResponse.data
                                .fullname);
                            $('#editModal input[name="company"]').val(jsonResponse.data
                                .company);
                            $('#editModal input[name="phone_number"]').val(jsonResponse.data
                                .mobile);
                            $('#editModal input[name="email"]').val(jsonResponse.data.email);
                            $('#editModal input[name="address"]').val(jsonResponse.data
                                .address);
                            $('#editModal select[name="status"]').val(jsonResponse.data.status);
                        } else {
                            toastr.error("Error fetching data for edit: " + jsonResponse
                                .message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error("Error fetching data for edit!");
                    }
                });
            });


            /** Update The data from the database table **/
            $('#editModal form').submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();

                /*Get the submit button*/
                var submitBtn = form.find('button[type="submit"]');

                /*Save the original button text*/
                var originalBtnText = submitBtn.html();

                /*Change button text to loading state*/


                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    beforeSend: function() {
                        form.find(':input').prop('disabled', true);
                    },
                    success: function(response) {
                        const jsonResponse = JSON.parse(response);
                        if (jsonResponse.success) {
                            toastr.success(jsonResponse.message);
                            $('#editModal').modal('hide');
                            $('#editModal form')[0].reset();
                            /*Reload the page after a short delay*/
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        }
                    },

                    error: function(xhr, status, error) {
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        } else {
                            toastr.error("An error occurred. Please try again.");
                        }
                    },
                });
            });

            /**********************Paid Due Amount Script****************************/

            $('#paymentModal').on('shown.bs.modal', function() {
                if (!$('#sub_ledger_id').hasClass("select2-hidden-accessible")) {
                    $('#sub_ledger_id').select2({
                        dropdownParent: $('#paymentModal')
                    });
                }
                if (!$('#transaction_type').hasClass("select2-hidden-accessible")) {
                    $('#transaction_type').select2({
                        dropdownParent: $('#paymentModal')
                    });
                }
                if (!$('#bank_id').hasClass("select2-hidden-accessible")) {
                    $('#bank_id').select2({
                        dropdownParent: $('#paymentModal')
                    });
                }
            });

            /*Show Bank Name in Payment Modal*/
            $(document).on('change','#transaction_type',function(){
                var transaction_type=$(this).val();
                if ($(this).val() == '5') {
                    $('#bank_area').removeClass('d-none'); 
                } else {
                    $('#bank_area').addClass('d-none'); 
                    $('#bank_id').val(''); 
                }
            });
          
            

            $('#paymentModal form').submit(function(e) {
                e.preventDefault();
                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $("#paymentModal").modal('hide');
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                    },


                    error: function(xhr, status, error) {
                        /** Handle  errors **/
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        }
                    }
                });
            });


        });
    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <?php include 'style.php';?>
    </head>

    <body data-sidebar="dark">

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <?php $page_title="Supplier";  include 'Header.php';?>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                <div class="col-md-12 grid-margin">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div class="d-flex align-items-end flex-wrap">
                            <div class="mr-md-3 mr-xl-5">


                                <div class="d-flex">
                                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                    </p>
                                    <p class="text-primary mb-0 hover-cursor">Supplier</p>
                                </div>


                            </div>
                            <br>


                        </div>
                        <div class="d-flex justify-content-between align-items-end flex-wrap">
                            <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                            data-bs-toggle="modal" data-bs-target="#addSupplierModal" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                        Supplier</button>
                    </div>
                    </div>
                </div>
            </div>






            <?php include 'modal/supplier_modal.php'; ?>


				 <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Supplier</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
                           <form action="include/supplier_backend.php?update_supplier_data=true" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="id" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Fullname</label>
										<input name="fullname" placeholder="Enter Fullname" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Company</label>
										<input name="company" placeholder="Enter Company" class="form-control" type="text" >
									</div>
                                    <div class="form-group mb-2">
                                        <label for="">Phone Number</label>
                                        <input class="form-control" type="text" name="phone_number" id="phone_number" placeholder="Type Phone Number"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Email</label>
                                        <input class="form-control" type="email" name="email" id="email" placeholder="Type Your Email"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Address</label>
                                        <input class="form-control" type="text" name="address" id="address" placeholder="Type Your Address"/>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label for="">Status</label>
                                        <select class="form-control" type="text" name="status" >
                                            <option value="">---Select---</option>
                                            <option value="1">Active</option>
                                            <option value="0">Expire</option>
                                        </select>
                                    </div>
									              
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>






                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Full Name</th>
                                                    <th>Company</th>
                                                    <th>Mobile</th>
                                                    <th>Email</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            <?php

$sql = "SELECT * FROM suppliers";
$result = mysqli_query($con, $sql);

while ($rows = mysqli_fetch_assoc($result)) {

?>

    <tr>
        <td><?php echo $rows['id']; ?></td>
        <td><a href="supplier_profile.php?clid=<?php echo $rows['id']; ?>"><?php echo $rows["fullname"]; ?></a></td>
        <td><?php echo $rows["company"]; ?></td>
        <td><?php echo $rows["mobile"]; ?></td>
        <td><?php echo $rows['email']; ?></td>
        <td style="text-align:right">
            <button type="button" class="btn btn-info edit-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></button>

            <a class="btn btn-success" href="supplier_profile.php?clid=<?php echo $rows['id']; ?>"><i class="fas fa-eye"></i>
            </a>
            <button class="btn btn-danger delete-btn" data-id="<?php echo $rows['id']; ?>"><i class="fas fa-trash"></i>
            </button>

        </td>
    </tr>
<?php } ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <?php include 'Footer.php'; ?>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>
    <script src="modal/supplier_modal.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#users_table").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/supplier_backend.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/supplier_backend.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="fullname"]').val(jsonResponse.data.fullname);
                    $('#editModal input[name="company"]').val(jsonResponse.data.company);
                    $('#editModal input[name="phone_number"]').val(jsonResponse.data.mobile);
                    $('#editModal input[name="email"]').val(jsonResponse.data.email);
                    $('#editModal input[name="address"]').val(jsonResponse.data.address);
                    $('#editModal select[name="status"]').val(jsonResponse.data.status);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
                const jsonResponse = JSON.parse(response);
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>


<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/pop_security.php';
include 'include/users_right.php';
?>

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
    <script src="./assets/libs/jquery/jquery.min.js"></script>

</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Customers test';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-primary mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Customers</p>
                                            <?php if($_GET['new_customer_month']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;New Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['expire_customer_month']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp; Monthly Expired Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['online']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Online Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['offline']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Offline Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['active']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Active Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['expired']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Expired Customers</p>
                                            <?php endif; ?>
                                            <?php if($_GET['disabled']):?>
                                                <p class="text-primary mb-0 hover-cursor">/&nbsp;Disabled Customers</p>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addCustomerModal"
                                        class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New customer
                                    </button>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                           <?php require 'Component/customer_table.php';?>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

   
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <?php include 'script.php'; ?>



    
</body>

</html>


<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	echo $id=$_GET['id'];

	$result=$con->query("DELETE FROM `ticket` WHERE id='$id'");
	if ($result==true) {
		header("location:allTickets.php");
	}else{

	}
}


 ?>

 <?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	  $id=$_GET['id'];

	$result=$con->query("DELETE FROM  ticket_topic WHERE id=$id ");
	if ($result==true) {
		header("location:ticketsTopic.php");
	}else{

	}
}


 ?>

 <?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
if (isset($_GET["id"])) {
    $expiredId=$_GET['id'];
    if ($messae_template=$con->query("SELECT * FROM ticket_topic WHERE id='$expiredId'")) {
        while($rows=$messae_template->fetch_array()){
            $id=$rows["id"];
            $topic_name=$rows["topic_name"];
        }
    }
}


?>



<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css"> 
        <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Expire date Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4 m-auto" id="formArea">
                            <h4 class="text-center">Update Ticket Topic</h4><br>
                        <form id="expired_form">
                            <div class="form-group mb-2">
                                <input type="text" id="updateId" value="<?php echo $id;?>" class="d-none">
                            </div>
                            <div class="form-group mb-2">
                                <label>Topic Name</label>
                                <input id="ticketTopicName" class="form-control" value="<?php echo $topic_name; ?>" /> 
                            </div>
                            <button type="button" id="updateBtn" class="btn btn-success mr-1">Update</button>
                            <a href="ticketsTopic.php" class="btn btn-danger mr-1">Cancle</a>
                        </form>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
      <script type="text/javascript">
    $(document).ready(function(){
        $("#updateBtn").click(function(){
            var updateId=$("#updateId").val();
            var ticketTopicName=$("#ticketTopicName").val();
            if (ticketTopicName.length==0) {
                toastr.error("Topic Name is require");
            }else{
                var updateTicketTopic="0";
                $.ajax({
                    type:"POST",
                    url:"include/tickets_server.php",
                    data:{id:updateId,name:ticketTopicName,updateTicketTopic:updateTicketTopic},
                    success:function(response){
                        if (response==1) {
                            toastr.success("Update Successfully");
                            setTimeout(() => {
                                    window.history.back();
                                }, 1000);
                        }else{
                            toastr.error(response);
                        }
                    }
                });  
            }
            
        });
    });
</script>

    </body>
</html>
<?php
include("include/security_token.php");
include "include/db_connect.php";
include("include/users_right.php");
if (isset($_GET["id"])) {
    $ticketsId = $_GET['id'];
    if ($tickets = $con->query("SELECT * FROM ticket WHERE id='$ticketsId'  ")) {
        while ($rows = $tickets->fetch_array()) {
            $id = $rows['id'];
            $ticket_type = $rows['ticket_type'];
            $asignto = $rows['asignto'];
            $ticketfor = $rows['ticketfor'];
            $complain_type = $rows['complain_type'];
            $pop = $rows['pop'];
            $startdate = $rows['startdate'];
            $enddate = $rows['enddate'];
            $note = $rows['notes'];
        }
    }
}


?>


<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <!-- C3 Chart css -->
    <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Ticket Update</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['fullname'])) {
                                    echo $_SESSION['fullname'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="profileImages/avatar.png" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>



        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    
                    <div class="row">
                        <form id="update_tickets">
                            <div>
                                <div class="card">
                                    <div class="card-body">

                                        <form class="form-sample">

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group d-none">
                                                        <label>ID</label>
                                                        <input type="text" id="id" class="form-control" name="id" value="<?php echo $id; ?>" />
                                                    </div>
                                                    <div class="form-group mb-2">
                                                        <label for="">Ticket Type</label>
                                                        <select  disabled="true" name="ticket_type" id="ticket_type" class="form-select">
                                                            <option value='<?php echo $ticket_type; ?>'><?php echo $ticket_type; ?></option>
                                                            <option value="Active">Active</option>
                                                            <option value="New">New</option>
                                                            <option value="Open">Open</option>
                                                            <option value="Complete">Complete</option>
                                                        </select>

                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">Assigned To</label>
                                                        <select name="assigned" id="assigned" class="form-select">
                                                   <?php 

                                                        
                                                    if ($group = $con->query("SELECT * FROM working_group")) {
                                                        while ($rows = $group->fetch_array()) {
                                                            $userId = $rows["id"];
                                                            $group_name = $rows["group_name"];
                                                            
                                                            // Check if this userId is the assigned one
                                                            $selected = ($userId == $asignto) ? 'selected' : '';
                                                            
                                                            echo '<option value="'.$userId.'" '.$selected.'>'.$group_name.'</option>';  
                                                        }
                                                    }
                                                    ?>
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">Ticket For</label>
                                                        <select name="ticket_for" id="ticket_for" class="form-select">
                                                            <option value="<?php echo $ticketfor; ?>"><?php echo $ticketfor; ?></option>
                                                            <option value="Reseller">Reseller</option>
                                                            <option value="Corporate">Corporate</option>
                                                            <option value="Home Connection">Home Connection</option>
                                                        </select>
                                                    </div>
                                                </div>


                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">
                                                            Complain Type
                                                        </label>
                                                        <select name="complain_type" id="complain_type" class="form-select">
                                <?php
                                    if ($group = $con->query("SELECT * FROM ticket_topic ")) {
                                        while ($rows = $group->fetch_array()) {
                                            $id = $rows["id"];
                                            $topic_name = $rows["topic_name"];
                                            
                                            /*Check if this userId is the assigned one*/ 
                                            $selected = ($id == $complain_type) ? 'selected' : '';
                                            
                                            echo '<option value="'.$userId.'" '.$selected.'>'.$topic_name.'</option>';  
                                        }
                                    }
                                ?>
                                                        </select>
                                                    </div>
                                                </div>


                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">Form Date</label>
                                                        <input name="from_data" id="from_data" type="text" class="form-control" value="<?php echo $startdate; ?>">
                                                    </div>
                                                </div>
                                               
                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">End Date</label>
                                                        <input type="text" id="end_date" name="to_date" class="form-control" value="<?php echo date('Y-m-d'); ?>">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group mb-2">
                                                        <label for="">Note</label>
                                                        <input name="note" id="note" type="text" class="form-control" value="<?php echo $note; ?>">
                                                    </div>
                                                </div>

                                            </div><br>
                                            <button type="button" id="update_tickets_button" class="btn btn-info">Update Data</button>
                                            <button onclick="history.back();" type="button" class="btn btn-danger">Back</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            updateTickets();

            function updateTickets() {
                $("#update_tickets_button").click(function() {
                    var id = $("#id").val();
                    var ticket_type = $("#ticket_type").val();
                    var assigned = $("#assigned").val();
                    var ticket_for = $("#ticket_for").val();
                    var note = $("#note").val();

                    var complain_type = $("#complain_type").val();
                    var from_data = $("#from_data").val();
                    var to_date = $("#to_date").val();
                    var updateTicket = "0";
                    $.ajax({
                        type: "POST",
                        url: "include/tickets_server.php",
                        data: {
                            id: id,
                            updateTicket: updateTicket,
                            ticket_type: ticket_type,
                            assigned: assigned,
                            ticket_for: ticket_for,
                            note: note,
                            complain_type: complain_type,
                            from_data: from_data,
                            to_date: to_date,
                        },
                        success: function(response) {
                            if (response == 1) {
                                toastr.success("Ticket Update Successfully");
                               
                                setTimeout(() => {
                                    window.history.back();
                                }, 1000);
                            } else {
                                toastr.error(response);
                            }
                        }
                    });
                });
            }
        });
    </script>
</body>

</html>

<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';

if (isset($_GET['id'])) {
    $tId = $_GET['id'];
    if ($cstmr = $con->query("SELECT * FROM ticket WHERE id='$tId'")) {
        while ($rows = $cstmr->fetch_array()) {
            $ticket_id = $rows['id'];
            $customer_id = $rows['customer_id'];
            $ticket_type = $rows['ticket_type'];
            $asignto = $rows['asignto'];
            $ticketfor = $rows['ticketfor'];
            $complain_type = $rows['complain_type'];
            $pop = $rows['pop'];
            $startdate = $rows['startdate'];
            $enddate = $rows['enddate'];
        }

        $onlineusr = $con->query("SELECT * FROM radacct WHERE acctterminatecause='' AND username='$username'");
        $onlineusr->num_rows;
    }

    // $ticketId = $rows['id'];

    // if ($ticketDetails = $con->query("SELECT * FROM ticket_details WHERE tcktid='$ticketId' ORDER BY id DESC LIMIT 1")) {
    //     while ($rowss = $ticketDetails->fetch_array()) {
    //         $comment = $rowss['comments'];
    //         echo $comment;
    //     }
    // }
}
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>

</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Ticket Profile';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6 ml-auto">
                            <a class="btn-sm btn btn-info mb-3" href="tickets_edit.php?id=<?php echo $_GET['id']; ?>"><i
                                    class="fas fa-edit"></i></a>

                            <a href="ticket_delete.php?id=<?php echo $_GET['id']; ?>" class="btn-sm btn btn-danger mb-3"
                                onclick=" return confirm('Are You Sure');"><i class="fas fa-trash"></i></a>
                            <br>
                        </div>
                    </div>
                    <div class="row">
                        <div class="row gutters-sm">
                            <div class="col-md-4 mb-3">
                                <div class="card rounded-3 border-0">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="mdi mdi-ticket-confirmation"></i> Ticket Profile
                                        </h5>
                                    </div>
                                    <div class="card-body p-4">
                                        <div class="list-group list-group-flush">
                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="mdi mdi-account-circle text-primary"></i>
                                                    Customer Name:</p>
                                                <a href="#" class="text-dark fw-bold">
                                                    <?php
                                                    echo $con->query("SELECT * FROM customers WHERE id='$customer_id'")->fetch_array()['fullname'];
                                                    ?>
                                                </a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="mdi mdi-marker-check text-success"></i>
                                                    Ticket Type:</p>
                                                <a href="#" class="text-dark fw-bold"><?php echo $ticket_type; ?></a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="mdi mdi-tag text-warning"></i> Ticket ID:
                                                </p>
                                                <a href="#" class="text-dark fw-bold"><?php echo $ticket_id; ?></a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="fas fa-user-cog text-danger"></i> Assigned
                                                    To:</p>
                                                <a href="#" class="text-dark fw-bold">
                                                    <?php
                                                    if ($group = $con->query("SELECT * FROM `working_group` WHERE id=$asignto")) {
                                                        while ($rows = $group->fetch_array()) {
                                                            echo $rows['group_name'];
                                                        }
                                                    }
                                                    ?>
                                                </a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="ion ion-md-paper text-info"></i> Ticket For:
                                                </p>
                                                <a href="#" class="text-dark fw-bold"><?php echo $ticketfor; ?></a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="fas fa-envelope text-secondary"></i>
                                                    Complain Type:</p>
                                                <a href="#" class="text-dark fw-bold">
                                                    <?php
                                                    $complainId = $complain_type;
                                                    if ($allComplain = $con->query("SELECT * FROM ticket_topic WHERE id='$complainId' ")) {
                                                        while ($singleComplain = $allComplain->fetch_array()) {
                                                            echo $singleComplain['topic_name'];
                                                        }
                                                    }
                                                    ?>
                                                </a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="fas fa-calendar-alt text-primary"></i> From
                                                    Date:</p>
                                                <a href="#" class="text-dark fw-bold"><?php echo date('d M Y', strtotime($startdate)); ?></a>
                                            </div>

                                            <div class="list-group-item d-flex justify-content-between">
                                                <p class="mb-0"><i class="fas fa-calendar-check text-success"></i> To
                                                    Date:</p>
                                                <a href="#" class="text-dark fw-bold"><?php echo date('d M Y', strtotime($enddate)); ?></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="col-md-8 ">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h4 class="card-title">POST Table</h4>
                                        <div class="table-responsive">
                                            <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                                style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Comment</th>
                                                        <th>Progress</th>
                                                        <th>date</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <?php
                                                    if ($tickets = $con->query("SELECT * FROM ticket_details WHERE tcktid='$ticket_id' ")) {
                                                        while ($rows = $tickets->fetch_array()) {
                                                            $lstid = $rows['id'];
                                                            $date = $rows['datetm'];
                                                            $comment = $rows['comments'];
                                                            $progress = $rows['parcent'];
                                                    
                                                            echo '
                                                                                                                                                                                                                                <tr>
                                                                                                                                                                                                                                <td>' .
                                                                $lstid .
                                                                '</td>
                                                                                                                    
                                                                                                                    <td>' .
                                                                $comment .
                                                                '</td>
                                                                                                                                                                                                                                    <td>' .
                                                                $progress .
                                                                '</td>
                                                                                                                                                                                                                                <td>' .
                                                                date('d F Y', strtotime($date)) .
                                                                '</td>';
                                                        }
                                                    }
                                                    
                                                    ?>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm">
                                                <div class="form-group mb-2">
                                                    <label>Ticket Status</label>
                                                    <input type="text" class="d-none" id="ticket_id"
                                                        value="<?php echo $ticket_id; ?>">
                                                    <select id="ticket_type" class="form-select">
                                                        <option value="">Select</option>
                                                        <option value="Active" <?php echo $ticket_type == 'Active' ? 'selected' : ''; ?>>Active</option>
                                                        <option value="New" <?php echo $ticket_type == 'New' ? 'selected' : ''; ?>>New</option>
                                                        <option value="Open" <?php echo $ticket_type == 'Open' ? 'selected' : ''; ?>>Open</option>
                                                        <option value="Complete" <?php echo $ticket_type == 'Complete' ? 'selected' : ''; ?>>Complete</option>
                                                        <option value="Close" <?php echo $ticket_type == 'Close' ? 'selected' : ''; ?>>Close</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm">
                                                <div class="form-group mb-2">
                                                    <label>Progress</label>
                                                    <select id="progress" class="form-select">
                                                        <option value="">Select</option>
                                                        <option value="0%">0%</option>
                                                        <option value="15%">15%</option>
                                                        <option value="25%">25%</option>
                                                        <option value="35%">35%</option>
                                                        <option value="45%">45%</option>
                                                        <option value="55%">55%</option>
                                                        <option value="65%">65%</option>
                                                        <option value="75%">75%</option>
                                                        <option value="85%">85%</option>
                                                        <option value="95%">95%</option>
                                                        <option value="100%">100%</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm">
                                                <div class="form-group mb-2">
                                                    <label for="">Assigned To</label>
                                                    <select name="assigned" id="assigned" class="form-select">
                                                        <?php
                                                        
                                                        if ($group = $con->query('SELECT * FROM `working_group`')) {
                                                            while ($rows = $group->fetch_array()) {
                                                                $userId = $rows['id'];
                                                                $group_name = $rows['group_name'];
                                                                $selected = $userId == $asignto ? 'selected' : '';
                                                                echo '<option value="' . $userId . '" ' . $selected . '>' . $group_name . '</option>';
                                                            }
                                                        }
                                                        ?>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">

                                            <div class="col-sm">
                                                <div class="form-group mb-2">
                                                    <label>Write Comment</label>
                                                    <textarea class="form-control" id="commentBox" rows="5" name="comment" placeholder="Enter Your Comment"
                                                        style="height: 89px;"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <button class="btn btn-success" type="button" id="addCommentBtn">Add Comment</button> -->
                                        <button type="button" id="addCommentBtn" class="btn btn-success">Add
                                            Comment</button>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">Latest Tickets</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="tickets_table" class="table table-bordered dt-responsive nowrap"
                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Complain Type</th>
                                            <th>Ticket Type</th>
                                            <th>Comments</th>
                                            <th> Assigned To</th>
                                            <th>Created</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ticket-list">
                                        <?php
                                            $result = $con->query("SELECT * FROM ticket WHERE customer_id=$customer_id ORDER BY id DESC");

                                            while ($rows = mysqli_fetch_assoc($result)) {

                                            ?>
                                        <tr>
                                            <td>
                                                <?php
                                                $complain_typeId = $rows['complain_type'];
                                                $ticketsId = $rows['id'];
                                                if ($allCom = $con->query("SELECT * FROM ticket_topic WHERE id='$complain_typeId' ")) {
                                                    while ($rowss = $allCom->fetch_array()) {
                                                        $topicName = $rowss['topic_name'];
                                                        echo '<a href="#">' . $topicName . '</a>';
                                                    }
                                                }
                                                ?>
                                            </td>
                                            <td>
                                                <?php
                                                $ticketType = $rows['ticket_type'];
                                                if ($ticketType == 'Active') {
                                                    echo "<span class='badge bg-danger'>Active</span>";
                                                } elseif ($ticketType == 'Open') {
                                                    echo "<span class='badge bg-info'>Open</span>";
                                                } elseif ($ticketType == 'New') {
                                                    echo "<span class='badge bg-danger'>New</span>";
                                                } elseif ($ticketType == 'Complete') {
                                                    echo "<span class='badge bg-success'>Complete</span>";
                                                }
                                                
                                                ?>
                                            </td>
                                            <td>
                                                <?php
                                                $ticketId = $rows['id'];
                                                
                                                if ($ticketDetails = $con->query("SELECT * FROM ticket_details WHERE tcktid='$ticketId' ORDER BY id DESC ")) {
                                                    while ($rowss = $ticketDetails->fetch_array()) {
                                                        $comment = $rowss['comments'];
                                                        echo $comment . '--' . $rowss['parcent'];
                                                        if (count($rowss) > 1) {
                                                            echo '<br>';
                                                        }
                                                    }
                                                }
                                                ?>
                                            </td>
                                            <td>
                                                <?php
                                                $assign_id = $rows['asignto'];
                                                echo $con->query("SELECT * FROM `working_group` WHERE id=$assign_id")->fetch_array()['group_name'];
                                                ?>
                                            </td>

                                            <td>
                                                <?php
                                                
                                                echo date('d M Y', strtotime($rows['startdate']));
                                                
                                                ?>
                                            </td>
                                        </tr>
                                        <?php } ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->



    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>



    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#tickets_table").DataTable();
            $("#addCommentBtn").click(function() {
                var ticket_id = $("#ticket_id").val();
                var ticket_type = $("#ticket_type").val();
                var progress = $("#progress").val();
                var commentBox = $("#commentBox").val();
                var assigned = $("#assigned").val();
                addTicketData(ticket_id, ticket_type, progress, commentBox, assigned);
            });

            function addTicketData(ticket_id, ticket_type, progress, commentBox, assigned) {
                if (ticket_type.length == 0) {
                    toastr.error("Ticket Type is required");
                } else if (progress.length == 0) {
                    toastr.error("Progress is required");
                } else if (commentBox.length == 0) {
                    toastr.error("Comment is required");
                } else if (assigned.length == 0) {
                    toastr.error("Assigned To is required");
                } else {
                    $.ajax({
                        type: "POST",
                        url: "include/tickets_server.php",
                        data: {
                            id: ticket_id,
                            type: ticket_type,
                            progress: progress,
                            comment: commentBox,
                            assigned: assigned,
                            addTicketComment: "1"
                        },
                        cache: false,
                        success: function(response) {
                            if (response == 1) {
                                toastr.success("Comment Successfully Added");
                                setTimeout(function() {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response);
                            }
                        },
                        error: function(xhr, status, error) {
                            toastr.error("An error occurred: " + error);
                        }
                    });
                }
            }
        });
    </script>
</body>

</html>


<?php
include("include/security_token.php");
include("include/db_connect.php");

include("include/users_right.php");
?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">
    <!-- DataTables -->
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Responsive datatable examples -->
    <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
</head>

<body data-sidebar="dark">


    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.php" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="17">
                            </span>
                        </a>

                        <a href="index.php" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/it-fast.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/it-fast.png" alt="" height="36">
                            </span>
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <div class="d-none d-sm-block ms-2">
                        <h4 class="page-title">Tickets</h4>
                    </div>
                </div>



                <div class="d-flex">





                    <div class="dropdown d-none d-md-block me-2">
                        <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="font-size-16">
                                <?php if (isset($_SESSION['username'])) {
                                    echo $_SESSION['username'];
                                } ?>
                            </span>
                        </button>
                    </div>


                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                        </div>
                    </div>

                    <div class="dropdown d-inline-block me-2">
                        <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="ion ion-md-notifications"></i>
                            <span class="badge bg-danger rounded-pill">3</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                    </div>
                                </div>
                            </div>
                            <div data-simplebar style="max-height: 230px;">
                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-success rounded-circle font-size-16">
                                                <i class="mdi mdi-cart-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                <i class="mdi mdi-message-text-outline"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">You have 87 unread messages</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a href="" class="text-reset notification-item">
                                    <div class="d-flex">
                                        <div class="avatar-xs me-3">
                                            <span class="avatar-title bg-info rounded-circle font-size-16">
                                                <i class="mdi mdi-glass-cocktail"></i>
                                            </span>
                                        </div>
                                        <div class="flex-1">
                                            <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                            <div class="font-size-12 text-muted">
                                                <p class="mb-1">It is a long established fact that a reader will</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>
                            <div class="p-2 border-top">
                                <div class="d-grid">
                                    <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                        View all
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Ticket</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg" style="margin-bottom: 12px;">&nbsp;&nbsp;Add New</button>
                                </div>
                                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" id="addModal">
                                    <div class="modal-dialog modal-medium" role="document">
                                        <div class="modal-content col-md-12">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"><span class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Ticket Topic</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form>
                                                    <div class="form-group mb-2">
                                                        <label>Ticket Topic</label>
                                                        <input type="text" id="ticketTopic" class="form-control" placeholder="Enter Ticket Topic">
                                                    </div>
                                                    <div class="form-group  mb-2">
                                                        <label>POP/Branch</label>
                                                        <!-- <input type="text" id="pop_id" class="form-control" value="<?php echo $auth_usr_POP_id; ?>"> -->
                                                        <select id="pop_id" class="form-select">
                                                        <?php

if ($allData = $con->query("SELECT * FROM add_pop ")) {
    while ($rows = $allData->fetch_array()) {
        echo ' <option value="' . $rows['id'] . '">' . $rows['pop'] . '</option>';
    }
}


?>
                                                        </select>
                                                    </div>
                                                </form>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-primary" id="save">Add Now</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                        <div class="form-group">

                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Ticket Topics</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                <?php
                                                $sql = "SELECT * FROM ticket_topic  WHERE user_type=$auth_usr_type  ";
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {

                                                ?>

                                                    <tr>
                                                        <td><?php echo $rows['id']; ?></td>
                                                        <td><?php echo $rows["topic_name"]; ?></td>

                                                        <td style="text-align:right">
                                                            <a class="btn-sm btn btn-info" href="ticket_topic_edit.php?id=<?php echo $rows['id']; ?>"><i class="fas fa-edit"></i></a>


                                                            <a href="ticket_topic_delete.php?id=<?php echo $rows['id']; ?>" class="btn-sm btn btn-danger deleteBtn" onclick=" return confirm('Are You Sure');" data-id=<?php echo $rows['id']; ?>><i class="fas fa-trash"></i>
                                                            </a>

                                                        </td>
                                                    </tr>
                                                <?php } ?>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script>  IT-FAST.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Right Sidebar -->
    <div class="right-bar">
        <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
                <a href="javascript:void(0);" class="right-bar-toggle float-end">
                    <i class="mdi mdi-close noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>

            <div class="p-4">
                <div class="mb-2">
                    <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                </div>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                    <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                    <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                </div>

                <div class="mb-2">
                    <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input theme-choice" type="checkbox" id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                    <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                </div>


            </div>

        </div> <!-- end slimscroll-menu-->
    </div>
    <!-- /Right-bar -->

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script type="text/javascript">
        addTicket()

        function addTicket() {
            $("#save").click(function() {
                var ticketTopic = $("#ticketTopic").val();
                var pop_id = $("#pop_id").val();
                var user_type = <?php echo $auth_usr_type; ?>;
                if (ticketTopic.length == 0) {
                    toastr.error('Ticket Topic Name required');
                } else {
                    var addTicketTopicData = "0";
                    $.ajax({
                        type: "POST",
                        data: {
                            addTicketTopicData: addTicketTopicData,
                            ticketTopic: ticketTopic,
                            pop_id: pop_id,
                            user_type: user_type
                        },
                        url: "include/tickets_server.php",
                        cache: false,
                        success: function(response) {
                            if (response == 1) {
                                $("#addModal").modal('hide');
                                toastr.success("Add Successfully")
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error(response);
                            }
                        }
                    });
                }

            });
        }
    </script>
</body>

</html>


<?php 
include "include/db_connect.php"; 
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
if (isset($_GET["id"])) {
    $id=$_GET['id'];

    if ($details=$con->query("SELECT * FROM transaction_details")) {
        while ($rows=$details->fetch_array()) {
            $id= $rows["id"];
            $ledger=$rows["ledger"];
        }
    }
}

?>
<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>FAST-ISP-BILLING-SOFTWARE</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
      <meta content="Themesbrand" name="author">
      <!-- App favicon -->
      <link rel="shortcut icon" href="assets/images/favicon.ico">
      <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
      <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
      <!-- C3 Chart css -->
      <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
      <!-- Bootstrap Css -->
      <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
      <!-- Icons Css -->
      <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
      <!-- App Css-->
      <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
      
   </head>
   <body data-sidebar="dark">
      <!-- Loader -->
      <div id="preloader">
         <div id="status">
            <div class="spinner"></div>
         </div>
      </div>
      <!-- Begin page -->
      <div id="layout-wrapper">
         <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Transaction View</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
         <!-- ========== Left Sidebar Start ========== -->
         <div class="vertical-menu">
            <div data-simplebar class="h-100">
               <!--- Sidemenu -->
               <?php include 'Sidebar_menu.php'; ?>
               <!-- Sidebar -->
            </div>
         </div>
         <!-- Left Sidebar End -->
         <!-- ============================================================== -->
         <!-- Start right Content here -->
         <!-- ============================================================== -->
         <div class="main-content">
            <div class="page-content">
               <div class="container-fluid">
                 <div class="row">
                     <div class="card">
                         <div class="container">
                             <div class="col-md-12 grid-margin mt-3">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Sub Transaction</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-lan mdi-18px"
                                        data-bs-toggle="modal" data-bs-target="#ledger-add-popup">&nbsp;&nbsp;New Sub Transaction</button>
                                </div>
                            </div>
                        </div>
                         <div class="col-md-12 stretch-card mt-3">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title">Sub Transaction</span>
                                    <div class="col-md-6 float-md-right grid-margin-sm-0">
                                    </div>
                                    <div class="row mt-5  p-2">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6 class="mb-0">Ledger:</h6>
                                                </div>
                                                <div class="col text-secondary">
                                                    <?php 
                                                    if ($allLedger=$con->query("SELECT * FROM ledger WHERE id='$ledger'")) {
                                                        while ($rowss=$allLedger->fetch_array()) {
                                                          echo $ledger_name= $rowss['ledger_name'];
                                                        }
                                                    }
                                                    ?>
                                                </div>
                                            </div>
                                            <hr>
                                        </div>
                                    </div>

                                    <div class="table-responsive mt-4">
                                        <div class="table-responsive">
                                            <table id="table" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>Item Name</th>
                                                        <th>Description</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>

    <?php 

    if ($sub_trnsc=$con->query("SELECT * FROM sub_transaction WHERE id='$id'")) {
        while($rows=$sub_trnsc->fetch_array()){
            $name=$rows["item_name"];
            $description=$rows["description"];
            echo '<tr>

            <td>'.$name.'</td>
            <td>'.$description.'</td>
            <td style="text-align:right;">

             <a class="btn btn-info" href="">
             <i class="fas fa-edit"></i>
             </a>

           <a class="btn btn-success" href="">
           <i class="fas fa-eye"></i>
            </a>

            </td>
            </tr>';
        }
    }


     ?>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                         </div>
                     </div>
                 </div>
               </div>
               <!-- container-fluid -->
               <div class="modal fade" id="ledger-add-popup" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content col-md-10">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel"><span
                                            class="mdi mdi-lan mdi-18px"></span> &nbsp;New Transaction</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div>
                                    <!--ledger form start-->
                            <form id="sub_transaction">
                                <div>
                            <div class="card">
                                <div class="card-body">
                                    <form class="form-sample">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group ">
                                                    <input type="hidden" class="form-control"
                                                        name="id" placeholder="Ledger Id"
                                                        value="<?php echo $id; ?>">
                                                </div>
                                                <div class="form-group ">
                                                    <input type="text" class="form-control" name="name"
                                                        placeholder="Transaction Name">
                                                </div><br>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input class="form-control"
                                                        placeholder="Enter description"
                                                        name="description">

                                                    </input>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button id="submitButton" type="submit" name="save" class="btn btn-primary"
                                        id="save">Save</button>
                                </div>
                            </form>
                                    <!--ledger form end-->
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <!-- End Page-content -->
            <footer class="footer">
               <div class="container-fluid">
                  <div class="row">
                     <div class="col-sm-6">
                        <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                     </div>
                     <div class="col-sm-6">
                        <div class="text-sm-end d-none d-sm-block">
                           Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                        </div>
                     </div>
                  </div>
               </div>
            </footer>
         </div>
         <!-- end main content-->
      </div>
      <!-- END layout-wrapper -->
      <!-- Right Sidebar -->
      <div class="right-bar">
         <div data-simplebar class="h-100">
            <div class="rightbar-title px-3 py-4">
               <a href="javascript:void(0);" class="right-bar-toggle float-end">
               <i class="mdi mdi-close noti-icon"></i>
               </a>
               <h5 class="m-0">Settings</h5>
            </div>
            <!-- Settings -->
            <hr class="mt-0">
            <h6 class="text-center mb-0">Choose Layouts</h6>
            <div class="p-4">
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                  <label class="form-check-label" for="light-mode-switch">Light Mode</label>
               </div>
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                  <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
               </div>
               <div class="mb-2">
                  <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
               </div>
               <div class="form-check form-switch mb-3">
                  <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                  <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
               </div>
            </div>
         </div>
         <!-- end slimscroll-menu-->
      </div>
      <!-- /Right-bar -->
      <!-- Right bar overlay-->
      <div class="rightbar-overlay"></div>
      <!-- JAVASCRIPT -->
      <script src="assets/libs/jquery/jquery.min.js"></script>
      <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
      <script src="assets/libs/metismenu/metisMenu.min.js"></script>
      <script src="assets/libs/simplebar/simplebar.min.js"></script>
      <script src="assets/libs/node-waves/waves.min.js"></script>
      <!-- Peity chart-->
      <script src="assets/libs/peity/jquery.peity.min.js"></script>
      <!--C3 Chart-->
      <script src="assets/libs/d3/d3.min.js"></script>
      <script src="assets/libs/c3/c3.min.js"></script> 
      <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
      <script src="assets/js/pages/dashboard.init.js"></script>
      <script src="assets/js/app.js"></script>
      <!-- Required datatable js -->
      <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
      <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
      <!-- Responsive examples -->
      <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
      <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
      <!-- Datatable init js -->
      <script src="assets/js/pages/datatables.init.js"></script> 
      <script src="assets/js/app.js"></script>
      <script type="text/javascript" src="assets/js/js-fluid-meter.js"></script>
      <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
    <script type="text/javascript">
    $(document).ready(function(){
         $('#table').DataTable();
        $("#submitButton").click(function(e){
            e.preventDefault();
            var formData=$("#sub_transaction").serialize();
            alert("Are You Sure");
            $.ajax({
                type:"GET",
                data:formData,
                url:"include/sub_transaction.php?add",
                cache:false,
                success:function(){
                    Swal.fire(
                      'Success!',
                      'Data Insert Success!',
                      'success'
                        )

                }
            });
        });
    });
</script>

   </body>
</html>

<?php
include "include/db_connect.php";
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");


?>
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
    
</head>

<body data-sidebar="dark">
    
    <!-- Begin page -->
    <div id="layout-wrapper">
       <?php $page_title="Transaction"; include 'Header.php';?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="row">
                            <div class="card ">
                                <div class="container">
                                    <div class="row mb-3 mt-1">
                                        <input id="user_id" class="form-control d-none" type="text" value="<?php if (isset($_SESSION['uid'])) {echo $_SESSION['uid'];} ?>">


                                    </div>
                                    <div class="row mb-3 mt-1">
                                        <div class="col-sm mt-2">
                                            <div class="form-group">
                                                <label>Refer No:</label>
                                                <input class="form-control" type="text" placeholder="Type Your Refer No" id="refer_no">
                                            </div>
                                        </div>
                                        <div class="col-sm mt-2">
                                            <div class="form-group">
                                                <label>Note:</label>
                                                <input class="form-control" type="text" placeholder="Notes" id="note">
                                            </div>
                                        </div>
                                        <div class="col-sm mt-2">
                                            <div class="form-group">
                                                <label>Date</label>
                                                <input class="form-control" type="date" id="currentDate" value="<?php echo $date = date('m/d/Y ', time()); ?>">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group mt-2">
                                                <label for="">Sub Ledger</label>
                                                <select class="form-control select2" id="sub_ledger">

                                                </select>

                                            </div>
                                        </div>

                                        <div class="col-md-1 ">
                                            <div class="form-group mt-4">
                                                <button class=" btn btn-primary ml-0" type="button" data-bs-toggle="modal" data-bs-target="#addSubLedgerModal" style="margin-top:5px;">+</button>
                                            </div>

                                        </div>

                                        <div class="col-md-1">
                                            <div class="form-group mt-2">
                                                <label for="">Quantity</label>
                                                <input type="number" id="qty" class="form-control" min="1" value="1">
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="form-group mt-2">
                                                <label for="">Value</label>
                                                <input type="text" class="form-control" id="value">
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="form-group mt-2">
                                                <label for="">Total</label>
                                                <input id="total" type="text" class="form-control">
                                            </div>
                                        </div>
										<div class="col-md-3">
                                            <div class="form-group mt-2">
                                                <label for="">Details</label>
                                                <input id="details" type="text" class="form-control" placeholder="Details">
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <div class="form-group">
                                                <button type="button" id="submitButton" class=" btn btn-primary " style="margin-top: 25px; width:100%;">Add</button>
                                            </div>
                                        </div>
										
                                    </div>

                                    <div class="row">
                                        <div class=" mt-4">
                                            <div class="col-md-12 col-sm-12" >
                                               <div class="table-responsive" id="sub_ledgr_table1">

                                               </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
                <div class="modal fade" id="addSubLedgerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Add Sub Ledger</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                        <div class="row">
                                            
                                                <div class="form-group mb-2"style="width:100%">
                                                    <label for="">Ledger Name</label>
                                                    <select name="ledger_id" id="sub_ledger_id" class="form-select" >
                                                        <?php
                                                        if ($ledgr = $con->query("SELECT * FROM ledger")) {

                                                            while ($rowsitm = $ledgr->fetch_array()) {
                                                                $ldgritmsID = $rowsitm["id"];
                                                                $ledger_name = $rowsitm["ledger_name"];
                                                                echo '<option value="' . $ldgritmsID . '">' . $ledger_name . '</option>';
                                                            }
                                                        }


                                                        ?>
                                                    </select>
                                                </div>
                                                <div class="form-group mb-2">
                                                    <label for="">Sub Ledger Name</label>
                                                    <input id="item_name" type="text" class="form-control" placeholder="Enter Item Name">
                                                </div>
                                                <div class="form-group mb-2">
                                                    <label for="">Description</label>
                                                    <input id="subLedgerDescription" type="text" class="form-control" name="description" placeholder="description">
                                                </div>
                                        </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button id="addSubLedgerBtn" type="submit" class="btn btn-primary">Add Sub Ledger</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php';?>
        </div>
        <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->
    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>
    
    <?php include 'script.php';?>
    <script type="text/javascript">
        $(document).ready(function() {
            // $('#sub_ledgr_table1').html('include/_server.php?show');
            getAllData();
            getLedgerData();

            
            function getLedgerData() {
                $.ajax({
                    url: "include/transactions_server.php?getLedger",
                    method: 'GET',
                    success: function(response) {
                        $('#sub_ledger').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            }

            function getAllData() {
                $.ajax({
                    url: "include/transactions_server.php?show",
                    method: 'GET',
                    success: function(response) {
                        $('#sub_ledgr_table1').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            } 
            //$("#sub_ledger_id").select2();
            $("#sub_ledger").select2();
           
            // Get the value and quantity input elements
            $('#qty').change(calculate);
            $('#value').keyup(calculate);

            function calculate(e) {
                $('#total').val($('#qty').val() * $('#value').val());
            }
            $("#submitButton").click(function() {
                var user_id = $("#user_id").val();
                var refer_no = $("#refer_no").val();
				var details = $("#details").val();
                var note = $("#note").val();
                var currentDate = $("#currentDate").val();

                var sub_ledger = $("#sub_ledger").val();
                var qty = $("#qty").val();
                var value = $("#value").val();
                var total = $("#total").val();

                if (sub_ledger.length == '') {
                    toastr.error('Sub ledger is require');
                }else if(currentDate.length==0){
                    toastr.error('Please Select Your Date');
                }
                
                else if (value.length=='') {
                    toastr.error('Value is require');
                } else if (qty.length=='') {
                    toastr.error('Quantity is require');
                } else if (total.length=='') {
                    total.error('Total Amount is require');
                } else {
                    //alert(sub_ledger);
                    var addTransactionData = 0;
                    $.ajax({
                        type: "POST",
                        data: {
                            addTransactionData: addTransactionData,
                            refer_no: refer_no,
                            note: note,
                            currentDate: currentDate,
                            sub_ledger: sub_ledger,
                            qty: qty,
                            value: value,
                            total: total,
                            user_id: user_id,
							details: details
                        },
                        url: "include/transactions_server.php",
                        cache: false,
                        success: function(response) {
                            if (response == 1) {
                                $("#refer_no").val('');
                                $("#description").val('');
                                $("#qty").val(1);
                                $("#value").val('');
                                $("#total").val('');

                            } else {
                                toastr.error(response);
                            }
                            getAllData();

                        }
                    });
                }

            });
            $("#addSubLedgerBtn").click(function() {
                var sub_ledger_id = $("#sub_ledger_id").val();
                var item_name = $("#item_name").val();
                var subLedgerDescription = $("#subLedgerDescription").val();
                if (sub_ledger_id.length == '') {
                    toastr.error('Select Ledger');
                } else if (item_name.length == 0) {
                    toastr.error('Item is require');
                }  else {
                    var addSubLedgerData = 0;
                    $.ajax({
                        type: "POST",
                        data: {
                            addSubLedgerData: addSubLedgerData,
                            sub_ledger_id: sub_ledger_id,
                            item_name: item_name,
                            description: subLedgerDescription
                        },
                        url: "include/transactions_server.php",
                        cache: false,
                        success: function(response) {
                            if (response == 1) {
                                toastr.success("Add Successfully ");
                                $('#addSubLedgerModal').modal('hide');
                            } else {
                                toastr.error("Please Try Again");
                            }
                            //$('#sub_ledgr_table').load('include/transactions_server.php?show');
                            getLedgerData();
                        }
                    });
                }

            });
            $(document).on('click',".finishedBtn",function(){
                $.ajax({
                    url: "include/transactions_server.php?finishedTransaction",
                    method: 'GET',
                    success: function(response) {
                        if (response==1) {
                            toastr.success("Finish Successfully");
                            getAllData();
                        }
                       // $('#sub_ledger').html(response);
                    },
                    error: function(xhr, status, error) {
                        // handle the error response
                        console.log(error);
                    }
                });
            });
            $(document).on('click',".delete-button",function(){
                var id=$(this).data('id');
                alert(id);
                // $.ajax({
                //     url: "include/transactions_server.php?finishedTransaction",
                //     method: 'GET',
                //     success: function(response) {
                //         if (response==1) {
                //             toastr.success("Finish Successfully");
                //             getAllData();
                //         }
                //        // $('#sub_ledger').html(response);
                //     },
                //     error: function(xhr, status, error) {
                //         // handle the error response
                //         console.log(error);
                //     }
                // });
            });
            
        });
    </script>


</body>

</html>

<?php
include("include/security_token.php");
include("include/db_connect.php");
include("include/pop_security.php");
include("include/users_right.php");
?>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php';?>
</head>

<body data-sidebar="dark">


    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title="Units";  include 'Header.php';  ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>

                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Units</p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button data-bs-toggle="modal" data-bs-target="#addModal" class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px" id="addBtn" style="margin-bottom: 12px;">&nbsp;&nbsp;New Unit</button>

                                   

                                </div>

                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                
                                <div class="card-body">
                                    <div class="table-responsive ">
                                        <table id="table1" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;" >
                                            <thead class="bg-success text-white" style="background-color: #2c845f !important;">
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Units Name</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->
    
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header flex-column">
                    <div class="icon-box">
                        <i class="fa fa-trash"></i>
                    </div>
                    <h4 class="modal-title w-100">Are you sure?</h4>
                    <h4 class="modal-title w-100 " id="DeleteId">1</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="True">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete these records? This process cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="DeleteConfirm">Delete</button>
                </div>
            </div>
        </div>
    </div>
     <!-- Add Modal -->
     <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Unit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/unit_server.php?add_unit=true" method="POST" enctype="multipart/form-data">
                        <div class="form-group mb-2">
                            <label>Unit Name</label>
                            <input name="unit_name" placeholder="Enter Unit Name" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
     <!-- Edit Modal -->
     <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog " role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span
                        class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Unit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/unit_server.php?update_unit=true" method="POST" enctype="multipart/form-data" >          
                        <div class="form-group mb-2">
                            <label>Unit Name</label>
                             <input name="id" class="d-none" type="text" >
                            <input name="unit_name" placeholder="Enter Unit Name" class="form-control" type="text" >
                        </div>           
                        <div class="modal-footer ">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="rightbar-overlay"></div>
    <?php include 'script.php';?>
    <script type="text/javascript">
    var table;
    $(document).ready(function(){
            table=$('#table1').DataTable( {
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange":true ,
                "processing"		: true,
                "serverSide"		: true,
                "zeroRecords":    "No matching records found",
                "ajax"				: {
                    url			: "include/unit_server.php?show_unit_data=true",
                    type		: 'GET',
                },
                "buttons": [			
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                titleAttr: 'Copy',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                titleAttr: 'Excel',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'csv',
                text: '<i class="fas fa-file-csv"></i> CSV',
                titleAttr: 'CSV',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'pdf',
                exportOptions: { columns: ':visible' },
                orientation: 'landscape',
                pageSize: "LEGAL",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                titleAttr: 'PDF'
            }, 
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                titleAttr: 'Print',
                exportOptions: { columns: ':visible' }
            }, 
            {
                extend: 'colvis',
                text: '<i class="fas fa-list"></i> Column Visibility',
                titleAttr: 'Column Visibility'
            }
            ],
        });
        table.buttons().container().appendTo($('#export_buttonscc'));	
    });
    /** Department Add **/
    $('#addModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    $('#addModal').modal('hide'); 
                    $('#addModal form')[0].reset();
                    table.draw();
                    toastr.success(jsonResponse.message); 
                } else {
                    toastr.error(jsonResponse.message); 
                }
            },


            error: function (xhr, status, error) {
                /** Handle  errors **/
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]); 
                    });
                }
            }
        });
    });
    /** Department Edit **/
    $(document).on("click", "button[name='edit_button']", function() {
        var unit_id = $(this).data("id");
        $.ajax({
            url: "include/unit_server.php?get_unit=true", 
            type: "GET",
            data: { id: unit_id }, 
            dataType:'json',
            success: function(response) {
                if (response.success) {
                $('#editModal').modal('show');
                $('#editModal input[name="id"]').val(response.data.id);
                $('#editModal input[name="unit_name"]').val(response.data.unit_name);
                } else {
                    toastr.error("Error fetching data for edit: " + response.message);
                }
            },
            error: function(xhr, status, error) {
                toastr.error('Failed to fetch department details');
            }
        });
    });

    /** Update The data from the database table **/
    $('#editModal form').submit(function(e){
        e.preventDefault();

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();

        /*Get the submit button*/
        var submitBtn = form.find('button[type="submit"]');

        /*Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
            

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
            type:'POST',
            'url':url,
            data: formData,
            beforeSend: function () {
            form.find(':input').prop('disabled', true);
            },
            success: function (response) {
                const jsonResponse = JSON.parse(response);
                if (jsonResponse.success) {
                    toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
                    table.draw();
                }
            },

            error: function (xhr, status, error) {
                if (xhr.status === 422) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function(key, value) {
                        toastr.error(value[0]);
                    });
                } else {
                    toastr.error("An error occurred. Please try again.");
                }
            },
            complete:function(){
                form.find(':input').prop('disabled', false);
            }
        });
    });

    /*Delete Script*/
    $(document).on('click',"button[name='delete_button']",function(){
        var id=$(this).data('id');
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/unit_server.php', 
                data: { delete_data: true, id: id }, 
                dataType:'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success("Deleted successfully!");
                       table.draw();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

    </script>
</body>

</html>

<?php 


include 'include/db_connect.php';

if (isset($_GET['id'])) {
	 $id=$_GET['id'];

	$result=$con->query("DELETE FROM `users` WHERE id=$id ");
	if ($result==true) {
		header("location:users.php");
	}else{

	}
}


 ?>

 <?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    	<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Users Log</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Users log</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                
                            </div>
                        </div>
                    </div>






                    <div class="modal fade bs-example-modal-lg" id="client-add-popup" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content col-md-10">
                           
                           <div>
  <form id="user_form">
            <div>
                <div class="card">
                    <div class="card-body">
                        <form class="form-sample">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group ">
                                        <label>Full Name</label>
                                        <input id="fullname" type="text"
                                            class="form-control"
                                            name="fullname" id="fullname"
                                            placeholder="Enter Your Fullname" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>User Name</label>
                                        <input id="username" type="text"
                                            class="form-control"
                                            name="username" id="username"
                                            placeholder="Enter Your Username" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Password</label>
                                        <input id="password" type="password"
                                            class="form-control"
                                            name="password" id="password"
                                            placeholder="Enter Your Password" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Mobile no.</label>
                                        <input id="mobile" type="text"
                                            class="form-control"
                                            name="mobile" id="mobile"
                                            placeholder="Enter Your Mobile Number" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input id="email" type="email"
                                            class="form-control"
                                            name="email" id="email"
                                            placeholder="Enter Your Email" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Role</label>
                                        <select class="form-select"
                                            name="role" id="role">
                                            <option value="">Select</option>
                                            <option value="Operations">Operations</option>
                                            <option value="ACCOUNTS">ACCOUNTS</option>
                                            <option value="SUPPORT">SUPPORT</option>
                                            <option value="HR & Admin">HR & Admin</option>
                                            <option value="NOC">NOC</option>
                                            <option value="SALES">SALES</option>
                                            <option value="BANK">BANK</option>
                                            <option value="BILLING">BILLING</option>
                                            <option value="CUSTOMERS">CUSTOMERS</option>
                                            <option value="SUPPLIERS">SUPPLIERS</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!--Customer form end-->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="user_add">Save changes</button>
            </div>
        </form>
                           </div>
                        </div>
                     </div>
                  </div>







                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                  
                                                    <th>User Name</th>
                                                    <th>IP</th>
                                                    <th>Time</th>
                                                    <th>Status</th>
                                                    
                                               </tr>
                                            </thead>
                                            <tbody>
<?php 

            if ($loglist=$con->query("SELECT * FROM user_login_log ORDER BY id DESC LIMIT 20")) {

                    while ($rows=$loglist->fetch_array()) {

                        $username=$rows["username"];
                        $ip=$rows["ip"];
                        $time=$rows["time"];
                        $status=$rows["status"];
                        
                        if($status=="Success")
                            {

                                $stts ='<span class="badge bg-success">Success</span>';
                            }
                            
                            else
                            {
                                $stts ='<span class="badge bg-danger">Failed</span>';

                            }

                        echo '
                <tr>
                <td>'.$username.'</td>
                <td>'.$ip.'</td>
                <td>'.$time.'</td>
                <td>'.$stts.'</td>
                </tr>'; 
                    }
                }

?>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#users_table").DataTable();
        $("#user-list").load("include/users.php?list");
        var userdta = "0";
        $.ajax({
            type: "GET",
            url: "include/users.php?list",
            data: userdta,
            cache: false,
            success: function(userlist) {
                $("#user-list").html(userlist);
            }
        });

        $("#user_add").click(function() {
        	var fullname=$("#fullname").val();
        	var username=$("#username").val();
        	var password=$("#password").val();
        	var mobile=$("#mobile").val();
        	var email=$("#email").val();
        	var role=$("#role").val();
        	if (fullname.length==0) {
                    toastr.error('name is required');
                 }else if(username.length==0){
                    toastr.error('Username is required');
                 }else if(password.length==0){
                    toastr.error('Password is required');
                 }else if(mobile.length==0){
                    toastr.error('Mobile is required');
                 }else if(email.length==0){
                    toastr.error('Email is required');
                 }else if(role.length==0){
                 	toastr.error("Role is required");
                 }else{
                 	var userdta = $("#user_form").serialize();
                    alert(userdta);
            $.ajax({
                type: "GET",
                url: "include/users.php?add",
                data: userdta,
                cache: false,
                success: function(repp) {
                    toastr.success("User added Success");
                    setTimeout(()=>{
                            location.reload();
                        },1000);
                }
            });
                 }
        });
    });
    </script>

    </body>
</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
include "include/db_connect.php";

if (isset($_GET["id"])) {

    $userId=$_GET["id"];

    if ($userData=$con->query("SELECT *FROM users WHERE id='$userId'")) {

        while ($rows=$userData->fetch_array()) {

            $userId=$rows["id"];

            $fullname=$rows["fullname"];

            $username=$rows["username"];

            $password=$rows["password"];

            $mobile=$rows["mobile"];

            $email=$rows["email"];

            $role=$rows["role"];

            $last_login=$rows["lastlogin"];
        }
    }
}



?>




<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">User Profile Update</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6 m-auto">
                </div>
            </div>
            <div class="row">
                <div class="card">
                    <form id="customer_form">
                        <div class="container">
                        <div class="row mb-3 mt-1 ">
                            <div class="col-sm d-none">
                                <div class="form-group">
                                     <label>ID</label>
                                      <input  id="form" type="text" class="form-control" name="id"value="<?php echo $userId; ?>" />
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="form-group ">
                                     <label>Full Name</label>
                                        <input id="form" type="text" class="form-control" name="fullname" value="<?php echo $fullname; ?>" />
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="form-group  ml-2">
                                 <label>User Name</label>
                                    <input id="form" type="text" class="form-control" name="username"value="<?php echo $username; ?>" />
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3 mt-1 ">
                            <div class="col-sm">
                                <div class="form-group">
                                    <label>Password</label>
                                        <input id="form" type="text" class="form-control" name="password" value="<?php echo $password; ?>" />
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="form-group ">
                                    <label>Mobile no.</label>
                                        <input id="form" type="text" class="form-control" name="mobile"value="<?php echo $mobile; ?>" />
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="form-group  ml-2">
                                 <label>Email</label>
                                    <input id="form" type="email" class="form-control" name="email"
                                        value="<?php echo $email; ?>" />
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3 mt-1 ">
                            <div class="col-sm">
                                <div class="form-group ">
                                      <label>Role</label>

                                                <select id="form" class="form-control" name="role">
                                                    <option value="Operations">Operations</option>
                                                    <option value="ACCOUNTS">ACCOUNTS</option>
                                                    <option value="SUPPORT">SUPPORT</option>
                                                    <option value="HR & Admin">HR & Admin</option>
                                                    <option value="NOC">NOC</option>
                                                    <option value="SALES">SALES</option>
                                                    <option value="BANK">BANK</option>
                                                    <option value="BILLING">BILLING</option>
                                                    <option value="CUSTOMERS">CUSTOMERS</option>
                                                    <option value="SUPPLIERS">SUPPLIERS</option>
                                                </select>
                                </div>
                            </div>
                            <div class="col-sm">
                                <div class="form-group ">
                                      <button type="button" id="update_user_button" class="btn btn-primary ml-4" style="margin-top: 21px;">Update Data</button>
                                      <a style="margin-top: 21px;" class="btn btn-danger" href="users.php">Cancle</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>
            </div>
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a target="__blank" href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        <!-- Buttons examples -->
        <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
        <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
        <script src="assets/libs/jszip/jszip.min.js"></script>
        <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
        <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
        <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
        <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="text/javascript">
        $(document).ready(function(){
            $("#update_user_button").click(function(){
                var formData=$("#customer_form").serialize();
                $.ajax({
                    type:"GET",
                    data:formData,
                    url:"include/users.php?update",
                    cache:false,
                    success:function(){
                        Swal.fire(
                      'Success!',
                      'User Update Success!',
                      'success'
                        )
                    }
                });
            });
        });
    </script>

    </body>
</html>
<?php
include("include/security_token.php");
include("include/users_right.php");
include("include/pop_security.php");
include "include/db_connect.php";


if (isset($_GET["id"])) {

    $userId=$_GET["id"];

    if ($userData=$con->query("SELECT *FROM users WHERE id='$userId'")) {

        while ($rows=$userData->fetch_array()) {

            $userId=$rows["id"];

            $fullname=$rows["fullname"];

            $username=$rows["username"];

            $password=$rows["password"];

            $mobile=$rows["mobile"];

            $email=$rows["email"];

            $role=$rows["role"];

            $last_login=$rows["lastlogin"];
        }
    }
}



?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
        <link href="assets/css/custom.css" id="app-style" rel="stylesheet" type="text/css">
    
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">User Profile</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
               <div class="container">
                    <div class="main-body">

                        <div class="row gutters-sm">
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex flex-column align-items-center text-center profile">
                                            <img src="images/avatar.png" alt='profile' class="rounded-circle"
                                                width="150" />
                                            <div class="imgUpIcon">
                                                <button id="uploadBtn" data-bs-toggle="modal"
                                                    data-bs-target="#Profile_pic_upload_Modal" type="button">
                                                    <i class="mdi mdi-camera"></i>
                                                </button>

                                            </div>
                                            <div class="mt-3">
                                                <h4>
                                                    <?php echo $fullname; ?><br>
                                                    (<?php echo $userId; ?>)
                                                </h4>
                                                <p class="text-secondary mb-1"><?php echo $mobile; ?></p>
                                                <p class="text-muted font-size-sm"><?php echo $address; ?></p>
                                                <button class="btn btn-primary">Print</button>
                                                <button class="btn btn-outline-primary">Message</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
               <div class="card-body">
                   <div class="col-12 bg-white p-0 px-2 pb-3 mb-3">
                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                        <p><i class="mdi mdi-marker-check"></i> Fullname:</p> <a href="#"><?php echo $fullname; ?></a>
                    </div>
                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                        <p><i class="mdi mdi-account-circle"></i>   Username:</p> <a href="#"><?php echo $username; ?></a>
                    </div>
                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                        <p><i class="mdi mdi-phone"></i> Mobile:</p> <a href="#"><?php echo $mobile; ?></a>
                    </div>
                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                        <p><i class=" fas fa-envelope"></i> Email:</p> <a href="#"><?php echo $email; ?></a>
                    </div>
                    <div class="d-flex justify-content-between border-bottom py-2 px-3">
                        <p><i class="fas fa-location-arrow"></i> Area:</p> <a href="#"><?php echo $area; ?></a>
                    </div>
                </div>
               </div>
           </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Full Name</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $fullname; ?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Username</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $username;?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Password</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $password; ?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Mobile</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $mobile; ?>
                                            </div>
                                        </div>
                                        <hr>

                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Email</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $email; ?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Role</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $role; ?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <h6 class="mb-0">Last Login</h6>
                                            </div>
                                            <div class="col-sm-9 text-secondary">
                                                <?php echo $last_login; ?>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <a class="btn btn-info "
                                                    href="users_profile_edit.php?id=<?php echo $userId; ?>">Edit</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="card-title">Hoverable Table</h4>
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>User</th>
                                                        <th>Product</th>
                                                        <th>Sale</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Jacob</td>
                                                        <td>Photoshop</td>
                                                        <td class="text-danger"> 28.76% <i
                                                                class="mdi mdi-arrow-down"></i></td>
                                                        <td><label class="badge badge-danger">Pending</label></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Messsy</td>
                                                        <td>Flash</td>
                                                        <td class="text-danger"> 21.06% <i
                                                                class="mdi mdi-arrow-down"></i></td>
                                                        <td><label class="badge badge-warning">In progress</label></td>
                                                    </tr>
                                                    <tr>
                                                        <td>John</td>
                                                        <td>Premier</td>
                                                        <td class="text-danger"> 35.00% <i
                                                                class="mdi mdi-arrow-down"></i></td>
                                                        <td><label class="badge badge-info">Fixed</label></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Peter</td>
                                                        <td>After effects</td>
                                                        <td class="text-success"> 82.00% <i
                                                                class="mdi mdi-arrow-up"></i></td>
                                                        <td><label class="badge badge-success">Completed</label></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Dave</td>
                                                        <td>53275535</td>
                                                        <td class="text-success"> 98.05% <i
                                                                class="mdi mdi-arrow-up"></i></td>
                                                        <td><label class="badge badge-warning">In progress</label></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
           </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

<!-- Modal for profile picture upload -->
                <div class="modal fade" id="Profile_pic_upload_Modal" tabindex="-1" role="dialog"
                    aria-labelledby="Profile_pic_upload_Label" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="Profile_pic_upload_Label">Upload Profile Picture</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form enctype="multipart/form-data" method="POST">
                                    <input class="d-none" type="text" name="profile_pic_id" value="<?php echo $lstid; ?>">
                                    <input type="file" name="photo" class="form-control"><br>

                                    <button name="upload" class="btn btn-primary">Upload Now</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
<!-- Modal for Complain -->
                <div class="modal fade" id="ComplainModalCenter" tabindex="-1" role="dialog"
                    aria-labelledby="ComplainModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ComplainModalLongTitle">
                                    Complain Box
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="from-group">
                                        <label>Name:</label>
                                        <input type="text" class="form-control form-control-sm" placeholder="Name">
                                    </div><br>
                                    <div class="form-group">
                                        <label for=""> Complain Type </label>
                                <select id="form" name="complain_type" id="" class="form-control form-control-sm">
                                    <option value="">Select</option>
                                    <option value="Disconnect/Discontinue">Disconnect/Discontinue</option>
                                    <option value="Fibre Down">Fibre Down</option>
                                    <option value="Router re-configure">Router re-configure</option>
                                    <option value="New Connection">New Connection</option>
                                    <option value="Connection Shift">Connection Shift</option>
                                    <option value="Connection Problem">Connection Problem</option>
                                    <option value="Internet Speed">Internet Speed</option>
                                    <option value="Other">Other</option>
                                    <option value="ONU Power Off">ONU Power Off</option>
                                    <option value="ONU Wire Down">ONU Wire Down</option>
                                    <option value="Line Problem">Line Problem</option>
                                </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Complain Box</label>
                                        <input name="" id="" placeholder="Enter Here Complain" class="form-control" />
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
<!-- Modal for Recharge -->
                <div class="modal fade" id="rechargeModal" tabindex="-1" role="dialog"
                    aria-labelledby="ComplainModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ComplainModalLongTitle">
                                    Recharge
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="recharge-form" method="POST">
                                    <div class="from-group">
                                        <label>Previous Balance</label>
                                        <input disabled="Disable" type="text" class="form-control form-control-sm" placeholder="00">
                                    </div><br>
                                    <div class="form-group d-none" >
                                        <label for="">Username</label>
                                        <input id="form" type="text" name='customer_name' value="<?php echo $username; ?>" class="form-control form-control-sm">
                                    </div>
                                    <div class="form-group">
                                        <label>Month</label>
                                        <select id="form" class="form-control form-control-sm" name='month'>
                                            <option value="01">1</option>
                                            <option value="02">2</option>
                                            <option value="03">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="">Package</label>
                                        <select id="form" name="package" class="form-control form-control-sm">
                                            <option value="">Select Package</option>
                                            <?php 
                                            if ($package_p=$con->query("SELECT * FROM radpackageprice")) {
                                                while($rows=$package_p->fetch_array()){
                                                    $name=$rows["packagename"];
                                                    $price=$rows["sprice"];
                                                    echo '<option value='.$name.' ('.$price.')>'.$name.' ('.$price.')</option>';
                                                }
                                            }

                                            ?>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Amount:</label>
                                        <strong><input id="form" type="text" name='amount' class="form-control form-control-sm"></strong>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button id="recharge-button" type="button" class="btn btn-primary">Save</button>
                            </div>
                        </div>
                    </div>
                </div>











    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
        <!-- JAVASCRIPT -->
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/libs/metismenu/metisMenu.min.js"></script>
        <script src="assets/libs/simplebar/simplebar.min.js"></script>
        <script src="assets/libs/node-waves/waves.min.js"></script>
        
        
        <!-- Peity chart-->
        <script src="assets/libs/peity/jquery.peity.min.js"></script>
        
        <!--C3 Chart-->
        <script src="assets/libs/d3/d3.min.js"></script>
        <script src="assets/libs/c3/c3.min.js"></script> 
        <script src="assets/libs/jquery-knob/jquery.knob.min.js"></script>
        
        <script src="assets/js/pages/dashboard.init.js"></script>
        
        <script src="assets/js/app.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

        <!-- Required datatable js -->
        <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
        
        <!-- Responsive examples -->
        <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
        <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/js/pages/datatables.init.js"></script> 

        <script src="assets/js/app.js"></script>
        <script type="text/javascript" src="assets/js/js-fluid-meter.js"></script>
 <script type="text/javascript">
     $(document).ready(function(){
        $("#tickets_table").DataTable();
        $('#example').DataTable();
        $("#recharge-button").click(function(){
            var formData=$("#recharge-form").serialize();
            alert(formData);
            $.ajax({
                type:"GET",
                url:"include/customer_recharge.php?add",
                data:formData,
                success:function(rsps){
                    //alert(rsps);
                }
            });
        });
     });
 </script> 

    </body>
</html>


<?php
include 'include/security_token.php';
include 'include/users_right.php';
include 'include/db_connect.php';
include 'include/pop_security.php';

?>
<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Users';
        include 'Header.php'; ?>



        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Users</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                        data-bs-toggle="modal" data-bs-target="#addModal"
                                        style="margin-bottom: 12px;">&nbsp;&nbsp;New User</button>
                                </div>
                            </div>
                        </div>
                    </div>













                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>User Name</th>
                                                    <th>Mobile no.</th>
                                                    <th>Role</th>
                                                    <th>Last Login</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                
                                                if ($userlist = $con->query('SELECT* FROM users')) {
                                                    while ($rows = $userlist->fetch_array()) {
                                                        $userId = $rows['id'];
                                                        $fullname = $rows['fullname'];
                                                        $username = $rows['username'];
                                                        $password = $rows['password'];
                                                        $mobile = $rows['mobile'];
                                                        $email = $rows['email'];
                                                        $role = $rows['role'];
                                                        $last_login = $rows['lastlogin'];
                                                
                                                        echo '
                                                     <tr>
                                                     <td>' .
                                                            $userId .
                                                            '</td>
                                                     <td><a href="users_profile.php?id=' .
                                                            $userId .
                                                            '">' .
                                                            $fullname .
                                                            '</a></td>
                                                     <td>' .
                                                            $username .
                                                            '</td>
                                                    <td>' .
                                                            $mobile .
                                                            '</td>
                                                    <td>' .
                                                            $role .
                                                            '</td>
                                                    <td>' .
                                                            $last_login .
                                                            '</td>
                                                    <td style=" text-align:right;">
                                                        <button type="button" name="edit_button" class="btn-sm btn btn-info" data-id="'.$userId.'"><i class="fas fa-edit"></i></button>
                                                        <a class="btn-sm btn btn-success" href="users_profile.php?id=' .
                                                            $userId .
                                                            '"><i class="fas fa-eye"></i>
                                                        </a>
                                                       
                                                        </td>
                                                     </tr>';
                                                    }
                                                }
                                                
                                                ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Add Modal -->
    <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Add New User
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/users_server.php?add_user=true" method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="fullname">Full Name</label>
                                    <input type="text" class="form-control" id="fullname" name="fullname"
                                        placeholder="Enter Your Fullname" />
                                </div>
                                <div class="form-group mb-3">
                                    <label for="username">User Name</label>
                                    <input type="text" class="form-control" id="username" name="username"
                                        placeholder="Enter Your Username" />

                                </div>
                                <div class="form-group mb-3">
                                    <label for="password">Password</label>
                                    <input type="password" class="form-control" id="password" name="password"
                                        placeholder="Enter Your Password" />
                                </div>

                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="mobile">Mobile no.</label>
                                    <input type="text" class="form-control" id="mobile" name="mobile"
                                        placeholder="Enter Your Mobile Number" />
                                </div>
                                <div class="form-group mb-3">
                                    <label for="email">Email</label>
                                    <input type="email" class="form-control" id="email" name="email"
                                        placeholder="Enter Your Email" />

                                </div>
                                <div class="form-group mb-3">
                                    <label for="role">Role</label>
                                    <select class="form-select" id="role" name="role">
                                        <option value="">Select</option>
                                        <?php 
                                       if($all_role=$con->query("SELECT * FROM role_management")){
                                        while($rows=$all_role->fetch_assoc()){
                                            echo '<option value="'.$rows['name'].'">'.$rows['name'].'</option>';
                                        }
                                       }
                                       
                                       ?>
                                    </select>
                                </div>

                            </div>
                        </div>



                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content col-md-12">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        <span class="mdi mdi-account-check mdi-18px"></span> &nbsp;Edit User
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="include/users_server.php?update_user=true" method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3 d-none">
                                    <label for="fullname">User id</label>
                                    <input type="text" id="id" name="id" />
                                </div>
                                <div class="form-group mb-3">
                                    <label for="fullname">Full Name</label>
                                    <input type="text" class="form-control" id="fullname" name="fullname"
                                        placeholder="Enter Your Fullname" />
                                </div>
                                <div class="form-group mb-3">
                                    <label for="username">User Name</label>
                                    <input type="text" class="form-control" id="username" name="username"
                                        placeholder="Enter Your Username" />

                                </div>
                                <div class="form-group mb-3">
                                    <label for="password">Password</label>
                                    <input type="password" class="form-control" id="password" name="password"
                                        placeholder="Enter Your Password" />
                                </div>

                            </div>

                            <!-- Right Column -->
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="mobile">Mobile no.</label>
                                    <input type="text" class="form-control" id="mobile" name="mobile"
                                        placeholder="Enter Your Mobile Number" />
                                </div>
                                <div class="form-group mb-3">
                                    <label for="email">Email</label>
                                    <input type="email" class="form-control" id="email" name="email"
                                        placeholder="Enter Your Email" />

                                </div>
                                <div class="form-group mb-3">
                                    <label for="role">Role</label>
                                    <select class="form-select" id="role" name="role">
                                        <option value="">Select</option>
                                       <?php 
                                       if($all_role=$con->query("SELECT * FROM role_management")){
                                        while($rows=$all_role->fetch_assoc()){
                                            echo '<option value="'.$rows['name'].'">'.$rows['name'].'</option>';
                                        }
                                       }
                                       
                                       ?>
                                    </select>
                                </div>

                            </div>
                        </div>



                        <!-- Modal Footer -->
                        <div class="modal-footer">
                            <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                            <button type="submit" class="btn btn-success">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <!-- JAVASCRIPT -->
    <?php include 'script.php'; ?>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#users_table").DataTable();

            function confirmDelete(userId) {
                if (confirm("Are you sure you want to delete this user?")) {
                    window.location.href = "user_delete.php?id=" + userId;
                }
            }
            /**  Add **/
            $('#addModal form').submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    'url': url,
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            $('#addModal').modal('hide');
                            toastr.success(response.message);
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } else {
                            toastr.error(response.message);
                        }
                    },


                    error: function(xhr, status, error) {
                        /** Handle  errors **/
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        }
                    }
                });
            });
            $(document).on('click',"button[name='edit_button']",function(){
                var id=$(this).data('id');
                $.ajax({
                    url: "include/users_server.php?get_user=true", 
                    type: "GET",
                    data: { id: id }, 
                    dataType:'json',
                    success: function(response) {
                        if (response.success) {
                        $('#editModal').modal('show');
                        $('#editModal input[name="id"]').val(response.data.id);
                        $('#editModal input[name="fullname"]').val(response.data.fullname);
                        $('#editModal input[name="username"]').val(response.data.username);
                        $('#editModal input[name="password"]').val(response.data.password);
                        $('#editModal input[name="mobile"]').val(response.data.mobile);
                        $('#editModal input[name="email"]').val(response.data.email);
                        $('#editModal select[name="role"]').val(response.data.role);
                        } else {
                            toastr.error("Error fetching data for edit: " + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        toastr.error('Failed to fetch department details');
                    }
                });
            });
            /** Update The data from the database table **/
            $('#editModal form').submit(function(e){
                e.preventDefault();

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();

                /*Get the submit button*/
                var submitBtn = form.find('button[type="submit"]');

                /*Save the original button text*/
                var originalBtnText = submitBtn.html();

                /*Change button text to loading state*/
                    

                var form = $(this);
                var url = form.attr('action');
                var formData = form.serialize();
                /** Use Ajax to send the delete request **/
                $.ajax({
                    type:'POST',
                    'url':url,
                    data: formData,
                    dataType:'json',
                    beforeSend: function () {
                        form.find(':input').prop('disabled', true);
                    },
                    success: function (response) {
                        if (response.success) {
                            toastr.success(response.message);
                            $('#editModal').modal('hide');
                            setTimeout(() => {
                                location.reload();
                            }, 500);

                        }
                        if(response.success==false){
                            toastr.error(response.message);
                        }
                    },

                    error: function (xhr, status, error) {
                        if (xhr.status === 422) {
                            var errors = xhr.responseJSON.errors;
                            $.each(errors, function(key, value) {
                                toastr.error(value[0]);
                            });
                        } else {
                            toastr.error("An error occurred. Please try again.");
                        }
                    },
                    complete:function(){
                        form.find(':input').prop('disabled', false);
                    }
                });
            });

        });
    </script>

</body>

</html>


<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/users_right.php';
include 'include/pop_security.php';
include 'include/functions.php';
if (isset($_GET['id']) && !empty($_GET['id'])) {
    $area_id = $_GET['id'];
    if ($area = $con->query("SELECT * FROM area_list WHERE id='$area_id'")) {
        while ($rows = $area->fetch_array()) {
            $id = $rows["id"];
            $area_name = $rows["name"];
        }
    }
}

if (isset($_GET['inactive'])) {
    if ($_GET['inactive'] == 'true') {
        $area_id = $_GET['id'];

        $custmrs = $con->query("SELECT * FROM customers WHERE area=$area_id");
        while ($rowsct = mysqli_fetch_assoc($custmrs)) {
            $custmr_usrname = $rowsct['username'];

            // Deleting users from Radius user list
            $con->query("DELETE FROM radcheck WHERE username = '$custmr_usrname'");
            $con->query("DELETE FROM radreply WHERE username = '$custmr_usrname'");
            $con->query("UPDATE customers SET status='0' WHERE username='$custmr_usrname'");
            $con->query("UPDATE add_pop SET status='0' WHERE area_id='$area_id'");
        }

        header('Location: ' . $_SERVER['PHP_SELF'] . '?id=' . $area_id);
        die();
    } elseif ($_GET['inactive'] == 'false') {
        $area_id = $_GET['id'];

        $custmrs = $con->query("SELECT * FROM customers WHERE area=$area_id");
        while ($rowsct = mysqli_fetch_assoc($custmrs)) {
            $custmr_usrname = $rowsct['username'];
            $custmr_password = $rowsct['password'];
            $custmr_package = $rowsct['package_name'];

            // Deleting users from Radius user list
            $con->query("INSERT INTO radcheck(username,attribute,op,value) VALUES('$custmr_usrname','Cleartext-Password',':=','$custmr_password')");
            $con->query("INSERT INTO radreply (username,attribute,op,value) VALUES('$custmr_usrname','MikroTik-Group',':=','$custmr_package')");
            $con->query("UPDATE customers SET status='1' WHERE username='$custmr_usrname'");
            $con->query("UPDATE add_pop SET status='1' WHERE area_id='$area_id'");
        }

        header('Location: ' . $_SERVER['PHP_SELF'] . '?id=' . $area_id);
        die();
    }
}

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

        <?php $page_title = 'Area';
        include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">
                                                <a href="index.php">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;</a>
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor"><a
                                                    href="pop_area.php">POP/Area&nbsp;/&nbsp; </a><?php echo $area_name; ?></p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <div class="d-flex py-2" style="float:right;">
                                        
                                        <abbr title="Add Customer">
                                            <button type="button" data-bs-target="#addCustomerModal"
                                                data-bs-toggle="modal" class="btn-sm btn btn-primary"
                                                style="float:right;" type="button" id=""><i
                                                    class="mdi mdi-account-plus"></i></button>
                                        </abbr>
                                        
                                        
                                        &nbsp;
                                        <abbr title="Recharge">
                                            <button type="button" id="" class="btn-sm btn btn-success "
                                                data-bs-target="#addPaymentModal" data-bs-toggle="modal">
                                                <i class=" mdi mdi-cash-multiple"></i>
                                            </button></abbr>
                                        &nbsp;

                                        <?php
                                        //echo $pop_status;
                                        if ($pop_status == '0') {
                                            $checkd = '';
                                            echo '<a href="?inactive=false&id=' .
                                                $lstid .
                                                '"><abbr title="Make Enable POP/Area"><button type="button" class="btn-sm btn btn-success">
                                                                                                                                               <i class="mdi mdi mdi-wifi-off "></i>
                                                                                                                                           </button></abbr></a>';
                                        } elseif ($pop_status == '1') {
                                            echo '<a href="?inactive=true&id=' .
                                                $lstid .
                                                '"><abbr title="Make Disable POP/Area"><button type="button" class="btn-sm btn btn-danger">
                                                                                                                                                <i class="mdi mdi mdi-wifi-off "></i>
                                                                                                                                            </button></abbr></a>';
                                            $checkd = 'checked';
                                        }
                                        
                                        ?>


                                        &nbsp;
                                        <abbr title="Edit Area">
                                            <a href="area_edit.php?id=<?php echo $area_id; ?>">
                                                <button type="button" class="btn-sm btn btn-info">
                                                    <i class="mdi mdi-account-edit"></i>
                                                </button></a>
                                        </abbr>
                                    </div>







                                </div>
                            </div>
                        </div>


                    </div>







                    <div class="row">

                        <div class="col">
                            <div class="card">
                            <a href="customers_new.php?online=1&area_id=<?php echo $area_id; ?>">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-primary me-0 float-end"><i
                                                class="fas fa-user-check"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-primary">
                                                <?php 
                                                     echo count(get_filtered_customers('online',$area_id,$pop_id=null,$con));
                                                ?>
                                            </span>
                                            Online
                                        </div>
                                    </div>
                                </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                        <div class="col">
                            <div class="card">
							<a href="customers_new.php?offline=1&area_id=<?php echo $area_id; ?>">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-secondary me-0 float-end"><i
                                                class="fas fa-user-times"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-muted">
                                                <?php
												
                                                    
                                                echo count(get_filtered_customers('offline',$area_id,$pop_id=null,$con));
												
												
                                                ?>
                                            </span>
                                            <img src="images/icon/disabled.png" height="10" width="10"/>&nbsp;Offline
                                        </div>
                                    </div>
                                </div>
								</a>
                            </div>
                        </div> <!-- End col -->

                        <div class="col">
                            <a href="customers_new.php?area_id=<?php echo $area_id; ?>&active=1">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-success me-0 float-end"><i
                                                    class="fas fa-users"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-success">
                                                    <?php 
                                                    
                                                    echo count(get_filtered_customers('active',$area_id,$pop_id=null,$con));
                                                    
                                                    ?>
                                                </span>
                                                Active Customers
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div> <!--End col -->





                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?expired=1&area_id=<?php echo $area_id; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-danger me-0 float-end"><i
                                                    class="fas fa-exclamation-triangle"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php 
                                                    
                                                    echo count(get_filtered_customers('expired',$area_id,$pop_id=null,$con));
                                                    
                                                    ?>
                                                </span>
                                                Expired
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?disabled=1&area_id=<?php echo $area_id; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-brown me-0 float-end"><i class="fas fa-user-lock"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-secondary">
                                                    <?php 
                                                      echo count(get_filtered_customers('disabled',$area_id,$pop_id=null,$con));
                                                    ?>
                                                </span>
                                                Disabled
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div><!--end col -->
                    </div> <!-- end row-->
                    <!-- New Row-->
                    <div class="row">
                       
                        <div class="col-md-6 col-xl-4">
                            <div class="card">
                                <a href="allTickets.php?area_id=<?php echo $area_id; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-warning me-0 float-end">
                                                <i class="fas fa-notes-medical"></i>
                                            </span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php
                                                    if ($dsblcstmr = $con->query("SELECT * FROM ticket WHERE area_id=$area_id")) {
                                                        echo $dsblcstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Tickets
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                     

                    </div> <!-- end row-->
                    <div class="row">
                        <div class="card">
                            <div class="card-body">

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#branch_user"
                                            role="tab">
                                            <span class="d-none d-md-block">Users (

                                                <?php if ($totalCustomers = $con->query("SELECT * FROM customers WHERE area=$area_id ")) {
                                                    echo $totalCustomers->num_rows ?? 0;
                                                }
                                                
                                                ?>

                                                )</span><span class="d-block d-md-none"><i
                                                    class="mdi mdi-account-check h5"></i></span>
                                        </a>
                                    </li>


                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tickets" role="tab">
                                            <span class="d-none d-md-block">Tickets
                                            </span><span class="d-block d-md-none"><i
                                                    class="mdi mdi-home-variant h5"></i></span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#recharge_history"
                                            role="tab">
                                            <span class="d-none d-md-block">Recharge History</span><span
                                                class="d-block d-md-none"><i
                                                    class="mdi mdi-battery-charging h5"></i></span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#packages" role="tab">
                                            <span class="d-none d-md-block">Package</span><span
                                                class="d-block d-md-none"><i class="mdi mdi-package h5"></i></span>
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#pop_transaction"
                                            role="tab">
                                            <span class="d-none d-md-block">Transaction Statment</span><span
                                                class="d-block d-md-none"><i
                                                    class="mdi mdi-currency-bdt h5"></i></span>
                                        </a>
                                    </li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">

                                    <div class="tab-pane active p-3" id="branch_user" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="customers_table"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th><input type="checkbox" id="checkedAll"
                                                                    name="checkedAll" class="form-check-input"></th>
                                                            <th>ID</th>
                                                            <th>Name</th>
                                                            <th>Package</th>
                                                            <th>Amount</th>
                                                            <th>Create Date</th>
                                                            <th>Expired Date</th>
                                                            <th>User Name</th>
                                                            <th>Mobile no.</th>
                                                            <th>POP/Branch</th>
                                                            <th>Area/Location</th>
                                                            <th>Liablities</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customer-list">

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane p-3" id="tickets" role="tabpanel">
                                        <div class="card">
                                            <div class="card-body">
                                                <table id="tickets_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>No.</th>
                                                            <th>Status</th>
                                                            <th>Created</th>
                                                            <th>Priority</th>
                                                            <th>Customer Name</th>
                                                            <th>Phone Number</th>
                                                            <th>Issues</th>
                                                            <th>Pop/Area</th>
                                                            <th>Assigned Team</th>
                                                            <th>Ticket For</th>
                                                            <th>Acctual Work</th>
                                                            <th>Completed</th>
                                                            <th>Percentage</th>
                                                            <th>Note</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane p-3" id="recharge_history" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="recharge_history_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Recharged date</th>
                                                            <th>Customer Name</th>
                                                            <th>Months</th>
                                                            <th>Paid until</th>
                                                            <th>Amount</th>
                                                        </tr>
                                                    </thead>
                                                   
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="tab-pane p-3" id="packages" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="package_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Package List</th>
                                                            <th>Purchase Price</th>
                                                            <th>Sale's Price</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="package-list">
                                                        <?php
                                                        $increment = 1;
                                                        $sql = "SELECT * FROM branch_package WHERE pop_id='$popid'";
                                                        $result = mysqli_query($con, $sql);

                                                        while ($rows = mysqli_fetch_assoc($result)) {

                                                        ?>

                                                        <tr>
                                                            <td><?php echo $increment++; ?></td>

                                                            <td><?php echo $rows['package_name']; ?></td>
                                                            <td><?php echo $rows['p_price']; ?></td>
                                                            <td><?php echo $rows['s_price']; ?></td>


                                                        </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="tab-pane p-3" id="pop_transaction" role="tabpanel">
                                        <div class="card">
                                            <div class="card-body">
                                                <table id="transaction_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Recharge Amount</th>
                                                            <th>Paid Amount</th>
                                                            <th>Action</th>
                                                            <th>Transaction Type</th>
                                                            <th>Date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <?php
                                                        $sql = "SELECT * FROM pop_transaction WHERE pop_id='$popid'  ";
                                                        $result = mysqli_query($con, $sql);

                                                        while ($rows = mysqli_fetch_assoc($result)) {

                                                        ?>

                                                        <tr>
                                                            <td><?php echo $rows['id']; ?></td>
                                                            <td> <?php echo $rows['amount']; ?></td>
                                                            <td> <?php echo $rows['paid_amount']; ?></td>


                                                            <td>
                                                                <?php
                                                                $transaction_action = $rows['action'];
                                                                $transaction_type = $rows['transaction_type'];
                                                                
                                                                if ($transaction_action == 'Recharge' && $transaction_type == '1') {
                                                                    echo '<span class="badge bg-danger">Recharged</span> <br> <span class="badge bg-success">Paid</span>';
                                                                } elseif ($transaction_action == 'Recharge' && $transaction_type == '0') {
                                                                    echo '<span class="badge bg-danger">Recharged </span>';
                                                                } elseif ($transaction_action == 'paid') {
                                                                    echo '<span class="badge bg-success">Paid</span>';
                                                                } elseif ($transaction_action == 'Return') {
                                                                    echo '<span class="badge bg-warning">Return</span>';
                                                                }
                                                                
                                                                ?>
                                                            </td>
                                                            <td>
                                                                <?php
                                                                $transaction_type = $rows['transaction_type'];
                                                                if ($transaction_type == 1) {
                                                                    echo '<button class="btn-sm btn btn-outline-success">Cash</button>';
                                                                } elseif ($transaction_type == 0) {
                                                                    echo '<button class="btn-sm btn btn-outline-danger">Credit</button>';
                                                                } elseif ($transaction_type == 2) {
                                                                    echo 'Bkash';
                                                                } elseif ($transaction_type == 3) {
                                                                    echo 'Nagad';
                                                                } elseif ($transaction_type == 4) {
                                                                    echo 'Bank';
                                                                } elseif ($transaction_type == 5) {
                                                                    echo '<button class="btn-sm btn btn-outline-primary">Payment Rcvd</button>';
                                                                }
                                                                
                                                                ?>
                                                            </td>
                                                            <td> <?php echo $rows['date']; ?></td>
                                                        </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                  
                    <div class="row">
                        <div class="col-md-12 grid-margin stretch-card">
                            <div class="row">
                                <div class="card">
                                    <div class="card-body">
                                        <div id="map" style="height: 400px;"></div>
                                    </div>
                                </div>
                            </div>                         
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Ticket Statics 10 Days</h4>


                                    <div class="row text-center mt-4">
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE area_id=$area_id AND  startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Tickets</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                            <?php
                                            $daystkt = date('Y-m-d', strtotime('-7 day'));
                                            $area_id = (int)$area_id; 
                                            $tktsql = $con->query("SELECT * FROM ticket WHERE area_id=$area_id AND ticket_type='Complete' AND startdate BETWEEN '$daystkt' AND NOW()");

                                            echo $tktsql->num_rows;
                                            ?>


                                            </h5>
                                            <p class="text-muted text-truncate">Resolved</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE area_id=$area_id AND ticket_type='Active' AND startdate BETWEEN '$daystkt' AND NOW() AND area_id=$area_id");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate">Pending</p>
                                        </div>

                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $area_id = (int)$area_id; 
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE area_id='$area_id' AND ticket_type='Close' AND startdate BETWEEN '$daystkt' AND NOW()");
                                                
                                                echo $tktsql->num_rows ?? 0;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate danger">Closed</p>
                                        </div>


                                    </div>

                                    <div id="chart" dir="ltr"></div>





                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">

                                <div class="card-body">
                                    <h4 class="card-title mb-4">Customer Statics</h4>

                                    <div class="row text-center mt-4">
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">50</h5>
                                            <p class="text-muted text-truncate">New</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">44</h5>
                                            <p class="text-muted text-truncate">Expired</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">32</h5>
                                            <p class="text-muted text-truncate">Disabled</p>
                                        </div>
                                    </div>

                                    <div id="simple-line-chart" class="ct-chart ct-golden-section" dir="ltr">
                                    </div>

                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="row">
                                                     
                    <div class="col-md-6 stretch-card">
                            <div class="card">
                                <div class="card-body">



                                    <div class="row">
                                        <div class="col-md-8 mt-1 py-2">
                                            <p class="card-title ">Recent Customers</p>
                                        </div>
                                        <div class="col-md-4">
                                            <button style="float: right;">
                                                <a href="customers_new.php?area_id=<?php echo $area_id; ?>&active=1">+</a>
                                            </button>
                                        </div>
                                    </div>



                                    <div class="table-responsive">
                                        <table id="datatables" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Full Name</th>

                                                    <th>POP</th>
                                                    <th>Area</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                //AND user_type='$auth_usr_type'
                                                $sql = "SELECT * FROM customers WHERE area=$area_id ORDER BY id DESC LIMIT 12 ";
                                                $result = mysqli_query($con, $sql);

                                                while ($rows = mysqli_fetch_assoc($result)) {
                                                    $username = $rows["username"];

                                                ?>

                                                <tr>
                                                    <td><?php echo $rows['id']; ?></td>
                                                    <td><a target="new"
                                                            href="profile.php?clid=<?php echo $rows['id']; ?>">
                                                            <?php
                                                            $onlineusr = $con->query("SELECT * FROM radacct WHERE radacct.acctstoptime IS NULL AND username='$username'");
                                                            $chkc = $onlineusr->num_rows;
                                                            if ($chkc == 1) {
                                                                echo '<abbr title="Online"><img src="images/icon/online.png" height="10" width="10"/></abbr>';
                                                            } else {
                                                                echo '<abbr title="Offline"><img src="images/icon/offline.png" height="10" width="10"/></abbr>';
                                                            }
                                                            
                                                            echo ' ' . $rows['fullname']; ?></a></td>

                                                    <td>
                                                        <?php
                                                        $popID = $rows['pop'];
                                                        $allPOP = $con->query("SELECT * FROM add_pop WHERE id=$popID ");
                                                        while ($popRow = $allPOP->fetch_array()) {
                                                            echo $popRow['pop'];
                                                        }
                                                        
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php $id = $rows['area'];
                                                        $allArea = $con->query("SELECT * FROM area_list WHERE id='$id' ");
                                                        while ($popRow = $allArea->fetch_array()) {
                                                            echo $popRow['name'];
                                                        }
                                                        
                                                        ?>

                                                    </td>

                                                </tr>
                                                <?php } ?>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>                               
                        <div class="col-md-6 stretch-card">
                            <div class="card">
                                <div class="card-body">

                                    <div class="row">
                                        <div class="col-md-8 mt-1 py-2">
                                            <p class="card-title ">New Customers by months</p>
                                        </div>
                                        <div class="col-md-4">
                                            <button style="float: right;">
                                                <a href="customers.php">+</a>
                                            </button>
                                        </div>
                                    </div>



                                    <div class="table-responsive">
                                        <table id="datatables" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Months</th>
                                                    <th>New Conn.</th>
                                                    <th>Expired Conn.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                for($i=1; $i<=12; $i++)
                                                {
                                                    ?>
                                                <tr>
                                                    <td><?php echo $i; ?></td>
                                                    <td>
                                                        <?php
                                                        $month = sprintf('%02d', $i);
                                                        $currentyrMnth = date('Y') . '-' . $month;
                                                        echo date('M-Y', strtotime($currentyrMnth));
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%' AND area=$area_id";
                                                        $result = mysqli_query($con, $sql);
                                                        $countconn = mysqli_num_rows($result);
                                                        echo '<a href="customer_newcon.php?list=' . $currentyrMnth . '">' . $countconn . '</a>';
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE  expiredate LIKE '%$currentyrMnth%' AND area=$area_id";
                                                        $result = mysqli_query($con, $sql);
                                                        $countexpconn = mysqli_num_rows($result);
                                                        echo '<a href="customer_expire.php?list=' . $currentyrMnth . '">' . $countexpconn . '</a>';
                                                        ?>
                                                    </td>
                                                </tr>
                                                <?php  } ?>
                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div> <!-- container-fluid -->

               
            </div>
            <!-- End Page-content -->
          
           
         


            <!----------------Customer MODAL---------------->
            <?php include 'modal/customer_modal.php'; ?>
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <?php include 'script.php'; ?>
    <script type="text/javascript" src="js/customer.js"></script>
    <script type="text/javascript" src="js/google_map.js"></script>
    <script type="text/javascript">
        /*************************simple-line-chart Start**************************************************/
        var chart = new Chartist.Line("#simple-line-chart", {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            series: [
                [<?php
                for ($i = 1; $i < 13; $i++) {
                    $currentyrMnth = date('Y') . '-0' . $i;
                    $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%' AND area='$area_id'";
                    $result = mysqli_query($con, $sql);
                    echo $countconn = mysqli_num_rows($result) . ',';
                }
                ?>],
                [

                    <?php
                    for ($i = 1; $i < 13; $i++) {
                        $currentyrMnth = date('Y') . '-0' . $i;
                        $sql = "SELECT * FROM customers WHERE expiredate LIKE '%$currentyrMnth%'AND area='$area_id'";
                        $result = mysqli_query($con, $sql);
                    }
                    
                    ?>
                ],
                [1, 3, 4, 5, 6, 7, 7, 7, 7, 7, 7, 7, 10],
                [10, 2, 3, 4, 5, 6, 6, 6, 6, 6, 6, 6, 13]
            ]
        }, {
            fullWidth: !0,
            chartPadding: {
                right: 40
            },
            plugins: [Chartist.plugins.tooltip()]
        });

        var times = function(e) {
                return Array.apply(null, new Array(e))
            },
            data = times(52).map(Math.random).reduce(function(e, t, a) {
                return e.labels.push(a + 1), e.series.forEach(function(e) {
                    e.push(100 * Math.random())
                }), e
            }, {
                labels: [],
                series: times(4).map(function() {
                    return new Array
                })
            }),
            options = {
                showLine: !1,
                axisX: {
                    labelInterpolationFnc: function(e, t) {
                        return t % 13 == 0 ? "W" + e : null
                    }
                }
            },
            responsiveOptions = [
                ["screen and (min-width: 640px)", {
                    axisX: {
                        labelInterpolationFnc: function(e, t) {
                            return t % 4 == 0 ? "W" + e : null
                        }
                    }
                }]
            ];
        new Chartist.Line("#scatter-diagram", data, options, responsiveOptions);
        /*************************simple-line-chart End**************************************************/
        ///////////////// Chart Bar //////////////////////
        ! function(e) {
            "use strict";

            function a() {}
            a.prototype.init = function() {
                    c3.generate({
                        bindto: "#chart",
                        data: {
                            columns: [
                                ["Tickets",
                                    <?php
                                    // Date find from 9 days ago
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare('SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND area_id = ?');
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $area_id);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ],
                                ["Resolved",
                                    <?php
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare("SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND ticket_type='Complete' AND area_id = ?");
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $area_id);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ],
                                ["Pending",
                                    <?php
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare("SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND ticket_type='Active' AND area_id = ?");
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $area_id);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ]
                            ],
                            type: "bar",
                            colors: {
                                Tickets: "#fb8c00",
                                Resolved: "#3bc3e9",
                                Pending: "#5468da"
                            }
                        }
                    })
                },
                e.ChartC3 = new a, e.ChartC3.Constructor = a
        }(window.jQuery),
        function() {
            "use strict";
            window.jQuery.ChartC3.init()
        }();

        $(document).ready(function() {

            $('#customers_table').DataTable({
                "searching": true,
                "paging": true,
                "info": true,
                "order": [
                    [0, "desc"]
                ],
                "lengthChange": true,
                "processing": true,
                "serverSide": true,

                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/customer_server_new.php?get_customers_data=true",
                    type: 'GET',
                    data: function(d) {
                        //d.status = $('.status_filter').val();
                        // d.pop_id = $('.pop_filter').val();
                        d.area_id = <?php echo $area_id; ?>;
                        //d.area_id = $('.area_filter').val();
                    },
                },
                "drawCallback": function() {
                    $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
                },

            });
            $('#recharge_history_datatable').DataTable({
                "searching": true,
                "paging": true,
                "info": true,
                "order": [
                    [0, "desc"]
                ],
                "lengthChange": true,
                "processing": true,
                "serverSide": true,

                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/customer_recharge_server.php?get_recharge_data=true",
                    type: 'GET',
                    data: function(d) {
                        //d.status = $('.status_filter').val();
                        // d.pop_id = $('.pop_filter').val();
                        // d.area_id = <?php echo $area_id; ?>;
                    },
                },
                "drawCallback": function() {
                    $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
                },

            });

            $('#tickets_datatable').DataTable({
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange": true,
                "processing": false,
                "serverSide": false,
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/tickets_server.php?get_tickets_data=1",
                    type: 'GET',
                    data: function(d) {
                        d.area_id = $('.area_filter').val();
                        <?php if (isset($area_id)) {
                            echo 'd.area_id = ' . $area_id;
                        } ?>
                    },
                    beforeSend: function() {
                        $(".dataTables_empty").html(
                            '<img src="assets/images/loading.gif" style="background-color: transparent"/>'
                            );
                    }
                },
                "order": [
                    [0, 'desc']
                ],
                "scrollX": true,
                "responsive": true,
                "columnDefs": [{
                        "width": "5%",
                        "targets": 0
                    },
                    {
                        "width": "10%",
                        "targets": 1
                    }
                ]
            });


            //$("#package-list-table").DataTable();

            $("#transaction_datatable").DataTable();
            $("#package_datatable").DataTable();
            $("#recharge_history_datatable").DataTable();


        });

        




        var xValues = [1, 2, 3, 4, 5, 6];
        new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    data: [860, 1140, 1060, 1060, 1070, 1110],
                    borderColor: "red",
                    fill: false
                }, {
                    data: [1600, 1700, 1700, 1900, 2000, 2700],
                    borderColor: "green",
                    fill: false
                }, {
                    data: [300, 700, 2000, 3000, 3000, 4000],
                    borderColor: "blue",
                    fill: false
                }]
            },
            options: {
                legend: {
                    display: false
                }
            }
        });
         /*************************Google Map Load**********************************************************/
        loadMaps(0,<?= $area_id; ?>);
    </script>

   

</body>

</html>


<?php
include 'include/security_token.php';
include 'include/db_connect.php';
include 'include/users_right.php';
include 'include/pop_security.php';
include 'include/functions.php';
if (isset($_GET['id'])) {
    $popid = $_GET['id'];
}
if ($pop_list = $con->query("SELECT * FROM add_pop WHERE id='$popid'")) {
    while ($rows = $pop_list->fetch_array()) {
        $lstid = $rows['id'];
        $pop_name = $rows['pop'];
        $pop_status = $rows['status'];
        $fullname = $rows['fullname'];
        $username = $rows['username'];
        $password = $rows['password'];
        $opening_bal = $rows['opening_bal'];
        $mobile_num1 = $rows['mobile_num1'];
        $mobile_num2 = $rows['mobile_num2'];
        $email_address = $rows['email_address'];
        $note = $rows['note'];
    }

    // Enable /disable POP Users
    if (isset($_GET['inactive'])) {
        if ($_GET['inactive'] == 'true') {
            $popID = $_GET['id'];

            $custmrs = $con->query("SELECT * FROM customers WHERE pop=$popID");
            while ($rowsct = mysqli_fetch_assoc($custmrs)) {
                $custmr_usrname = $rowsct['username'];

                // Deleting users from Radius user list
                $con->query("DELETE FROM radcheck WHERE username = '$custmr_usrname'");
                $con->query("DELETE FROM radreply WHERE username = '$custmr_usrname'");
                $con->query("UPDATE customers SET status='0' WHERE username='$custmr_usrname'");
                $con->query("UPDATE add_pop SET status='0' WHERE id='$popID'");
            }

            header('Location: ' . $_SERVER['PHP_SELF'] . '?id=' . $popID);
            die();
        } elseif ($_GET['inactive'] == 'false') {
            $popID = $_GET['id'];

            $custmrs = $con->query("SELECT * FROM customers WHERE pop=$popID");
            while ($rowsct = mysqli_fetch_assoc($custmrs)) {
                $custmr_usrname = $rowsct['username'];
                $custmr_password = $rowsct['password'];
                $custmr_package = $rowsct['package_name'];

                // Deleting users from Radius user list
                $con->query("INSERT INTO radcheck(username,attribute,op,value) VALUES('$custmr_usrname','Cleartext-Password',':=','$custmr_password')");
                $con->query("INSERT INTO radreply (username,attribute,op,value) VALUES('$custmr_usrname','MikroTik-Group',':=','$custmr_package')");
                $con->query("UPDATE customers SET status='1' WHERE username='$custmr_usrname'");
                $con->query("UPDATE add_pop SET status='1' WHERE id='$popID'");
            }

            header('Location: ' . $_SERVER['PHP_SELF'] . '?id=' . $popID);
            die();
        }
    }
}

?>

<!doctype html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>FAST-ISP-BILLING-SOFTWARE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php include 'style.php'; ?>
    
</head>

<body data-sidebar="dark">




    <!-- Begin page -->
    <div id="layout-wrapper">

      
        <?php $page_title="POP/Branch"; include 'Header.php'; ?>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">

            <div data-simplebar class="h-100">

                <!--- Sidemenu -->
                <?php include 'Sidebar_menu.php'; ?>
                <!-- Sidebar -->
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">
                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">
                                                <a href="index.php">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;</a>
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor"><a
                                                    href="pop_branch.php">POP&nbsp;/&nbsp; </a><?php echo $pop_name; ?></p>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">

                                    <div class="d-flex py-2" style="float:right;">
                                        <abbr title="Recharge All">
                                            <button type="button" class="btn-sm btn btn-success" style="float:right;"
                                                type="button" id="RchgMdlBtn"><i
                                                    class="ion ion-ios-people"></i></button>
                                        </abbr>
                                        &nbsp;
                                        <abbr title="Add Package">
                                            <button type="button" class="btn-sm btn btn-danger" style="float:right;"
                                                type="button" id="packageAddBtn"><i
                                                    class="mdi mdi-briefcase-plus"></i></button>
                                        </abbr>
                                        &nbsp;
                                        <abbr title="Add Customer">
                                            <button type="button" data-bs-target="#addCustomerModal"
                                                data-bs-toggle="modal" class="btn-sm btn btn-primary"
                                                style="float:right;" type="button" id=""><i
                                                    class="mdi mdi-account-plus"></i></button>
                                        </abbr>
                                        &nbsp;
                                        <abbr title="Complain">
                                            <button type="button" data-bs-target="#ComplainModalCenter"
                                                data-bs-toggle="modal" class="btn-sm btn btn-warning ">
                                                <i class="mdi mdi-alert-outline"></i>
                                            </button></abbr>
                                        &nbsp;
                                        <abbr title="Recharge">
                                            <button type="button" id="rechargeBtn" class="btn-sm btn btn-primary "
                                                data-bs-target="#addRechargeModal" data-bs-toggle="modal">
                                                <i class="mdi mdi mdi-battery-charging-90"></i>
                                            </button></abbr>
                                        &nbsp;
                                        <abbr title="Recharge">
                                            <button type="button" id="" class="btn-sm btn btn-success "
                                                data-bs-target="#addPaymentModal" data-bs-toggle="modal">
                                                <i class=" mdi mdi-cash-multiple"></i>
                                            </button></abbr>
                                        &nbsp;

                                        <?php
                                        //echo $pop_status;
                                        if ($pop_status == '0') {
                                            $checkd = '';
                                            echo '<a href="?inactive=false&id=' .
                                                $lstid .
                                                '"><abbr title="Make Enable POP"><button type="button" class="btn-sm btn btn-success">
                                                                                                                                               <i class="mdi mdi mdi-wifi-off "></i>
                                                                                                                                           </button></abbr></a>';
                                        } elseif ($pop_status == '1') {
                                            echo '<a href="?inactive=true&id=' .
                                                $lstid .
                                                '"><abbr title="Make Disable POP"><button type="button" class="btn-sm btn btn-danger">
                                                                                                                                                <i class="mdi mdi mdi-wifi-off "></i>
                                                                                                                                            </button></abbr></a>';
                                            $checkd = 'checked';
                                        }
                                        
                                        ?>


                                        &nbsp;
                                        <abbr title="Edit Customer">
                                            <a href="pop_edit.php?id=<?php echo $popid; ?>">
                                                <button type="button"
                                                    class="btn-sm btn btn-info">
                                                    <i class="mdi mdi-account-edit"></i>
                                                </button></a>
                                        </abbr>
                                    </div>







                                </div>
                            </div>
                        </div>


                    </div>







                    <div class="row">

                    <div class="col">
                            <div class="card">
							<a href="customers_new.php?online=1&pop_id=<?php echo $popid; ?>">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-primary me-0 float-end"><i
                                                class="fas fa-user-check"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-primary">
                                                <?php
                                                   echo count(get_filtered_customers('online',$area_id=null,$pop_id=$popid,$con));

                                                ?>
                                            </span>
                                            <img src="images/icon/online.png" height="10" width="10"/>&nbsp;Online
                                        </div>
                                    </div>
                                </div>
								</a>
                            </div>
                        </div> <!-- End col -->
						
						
						
						<div class="col">
                            <div class="card">
							<a href="customers_new.php?offline=1&pop_id=<?php echo $popid; ?>">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-secondary me-0 float-end"><i
                                                class="fas fa-user-times"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-muted">
                                                <?php
												  echo count(get_filtered_customers('offline',$area_id=null,$pop_id=$popid,$con));
												
												
                                                ?>
                                            </span>
                                            <img src="images/icon/disabled.png" height="10" width="10"/>&nbsp;Offline
                                        </div>
                                    </div>
                                </div>
								</a>
                            </div>
                        </div> <!-- End col -->
						

                        <div class="col">
                            <a href="customers_new.php?active=1&pop_id=<?php echo $popid; ?>">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-success me-0 float-end"><i
                                                    class="fas fa-users"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-success">
                                                    <?php 
                                                        echo count(get_filtered_customers('active',$area_id=null,$pop_id=$popid,$con));
                                                
                                                    ?>
                                                </span>
                                                Active Customers
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div> <!--End col -->

                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?expired=1&pop_id=<?php echo $popid; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-danger me-0 float-end"><i
                                                    class="fas fa-user-clock"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-secondary">
                                                    <?php 
                                                      echo count(get_filtered_customers('expired',$area_id=null,$pop_id=$popid,$con));
                                                    
                                                    ?>
                                                </span>
                                                Expired
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col -->
                        <div class="col">
                            <div class="card">
                                <a href="customers_new.php?disabled=1&pop_id=<?php echo $popid; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-brown me-0 float-end"><i
                                                    class="fas fa-user-lock"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php 
                                                       echo count(get_filtered_customers('disabled',$area_id=null,$pop_id=$popid,$con));
                                                    ?>
                                                </span>
                                                Disabled
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>


 
                    </div> <!-- end row-->
                    
                    <div class="row">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <a href="#">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-teal me-0 float-end"><i
                                                    class="mdi mdi-currency-bdt fa-2x text-gray-300"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-teal">
                                                <?php

                                                $pop_amount=$con->query("SELECT SUM(amount) AS pop_amount FROM pop_transaction WHERE pop_id='$pop_id' AND transaction_type !='5'")->fetch_array()['pop_amount'] ?? 0;

                                                $total_paid =$con->query("SELECT SUM(purchase_price) AS total_paid FROM customer_rechrg WHERE pop_id='$pop_id' AND type!='4'")->fetch_array()['total_paid'] ?? 0;
                                                echo  number_format($pop_amount - $total_paid);

                                                ?>
                                                </span>
                                                Current Balance
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card ">
                                <a href="#">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-success me-0 float-end"> <i class="mdi mdi-currency-bdt fa-2x text-white-300"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-teal">
                                            <?php

                                                if ($pop_payment = $con->query(" SELECT `paid_amount` FROM `pop_transaction` WHERE pop_id='$pop_id' ")) {
                                                    while ($rows = $pop_payment->fetch_array()) {
                                                        $stotalpaid += $rows["paid_amount"];
                                                    }
                                                    echo number_format($stotalpaid);
                                                }
                                                ?>
                                            </span>
                                            Total Paid
                                        </div>
                                    </div>
                                </div>
                                </a>
                            </div>
                        </div>
                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <a href="#">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-danger me-0 float-end">  <i class="mdi mdi-currency-bdt fa-2x text-gray-300"></i>
                                            </span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php
                                                    
                                                    if ($pop_payment = $con->query("SELECT SUM(amount) AS balance FROM `pop_transaction` WHERE pop_id=$pop_id  ")) {
                                                        while ($rows = $pop_payment->fetch_array()) {
                                                            $totalAmount += $rows["balance"];
                                                        }
                                                        $totalAmount;
                                                    }
    
                                                    if ($pop_payment = $con->query("SELECT SUM(paid_amount) AS amount FROM `pop_transaction` WHERE pop_id=$pop_id  ")) {
                                                        while ($rows = $pop_payment->fetch_array()) {
                                                            $paidAmount += $rows["amount"];
                                                        }
                                                    }
                                                    echo number_format($totalAmount - $paidAmount);
                                                    ?>

                                                </span>
                                                Total Due
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                                               
                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card ">
                                <a href="#">
                                <div class="card-body">
                                    <div class="mini-stat">
                                        <span class="mini-stat-icon bg-success me-0 float-end"> <i class="mdi mdi-currency-bdt fa-2x text-white-300"></i></span>
                                        <div class="mini-stat-info">
                                            <span class="counter text-teal">
                                            <?php

                                                if ($pop_dupayment = $con->query(" SELECT paid_amount FROM pop_transaction WHERE pop_id='$pop_id' AND transaction_type='5' ")) {
                                                    while ($rowsdp = $pop_dupayment->fetch_array()) {
                                                        $stotalDupaid += $rowsdp['paid_amount'];
                                                    }
                                                    echo number_format($stotalDupaid);
                                                }
                                                ?>
                                            </span>
                                            Due Paid
                                        </div>
                                    </div>
                                </div>
                                </a>
                            </div>
                        </div>                       
                    </div>
                    <!-- New Row-->
                    <div class="row">
                        <div class="col-md-3 ">
                            <div class="card">
                                <div class="card-body">
                                    <a href="pop_area.php?pop_id=<?php echo $popid; ?>">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-teal me-0 float-end"><i
                                                    class="fas fa-search-location"></i></span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-teal">
                                                    <?php if ($totalarea = $con->query("SELECT * FROM area_list WHERE pop_id=$popid")) {
                                                        echo $totalarea->num_rows;
                                                    }
                                                    
                                                    ?>
                                                </span>
                                                Area


                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div> <!--End col -->                           
                        <div class="col-md-3">
                            <div class="card">
                                <a href="allTickets.php?pop_id=<?php echo $popid; ?>">
                                    <div class="card-body">
                                        <div class="mini-stat">
                                            <span class="mini-stat-icon bg-warning me-0 float-end">
                                                <i class="fas fa-notes-medical"></i>
                                            </span>
                                            <div class="mini-stat-info">
                                                <span class="counter text-danger">
                                                    <?php
                                                    if ($dsblcstmr = $con->query("SELECT * FROM ticket WHERE pop_id=$popid")) {
                                                        echo $dsblcstmr->num_rows;
                                                    }
                                                    ?>
                                                </span>
                                                Tickets
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div> <!-- End col --> 
                    </div> <!-- end row-->
                    <div class="">
                    <div class="row">
                        <div class="card">
                            <div class="card-body">

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#branch_user"
                                            role="tab">
                                            <span class="d-none d-md-block">Users (

                                                <?php if ($totalCustomers = $con->query("SELECT * FROM customers WHERE pop=$popid ")) {
                                                    echo $totalCustomers->num_rows;
                                                }
                                                
                                                ?>

                                                )</span><span class="d-block d-md-none"><i
                                                    class="mdi mdi-account-check h5"></i></span>
                                        </a>
                                    </li>


                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tickets" role="tab">
                                            <span class="d-none d-md-block">Tickets
                                            </span><span class="d-block d-md-none"><i
                                                    class="mdi mdi-home-variant h5"></i></span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#recharge_history"
                                            role="tab">
                                            <span class="d-none d-md-block">Recharge History</span><span
                                                class="d-block d-md-none"><i
                                                    class="mdi mdi-battery-charging h5"></i></span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#packages" role="tab">
                                            <span class="d-none d-md-block">Package</span><span
                                                class="d-block d-md-none"><i class="mdi mdi-package h5"></i></span>
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#pop_transaction"
                                            role="tab">
                                            <span class="d-none d-md-block">Transaction Statment</span><span
                                                class="d-block d-md-none"><i
                                                    class="mdi mdi-currency-bdt h5"></i></span>
                                        </a>
                                    </li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">

                                    <div class="tab-pane active p-3" id="branch_user" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="customers_table"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th><input type="checkbox" id="checkedAll"
                                                                    name="checkedAll" class="form-check-input"></th>
                                                            <th>ID</th>
                                                            <th>Name</th>
                                                            <th>Package</th>
                                                            <th>Amount</th>
                                                            <th>Create Date</th>
                                                            <th>Expired Date</th>
                                                            <th>User Name</th>
                                                            <th>Mobile no.</th>
                                                            <th>POP/Branch</th>
                                                            <th>Area/Location</th>
                                                            <th>Liablities</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="customer-list">

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="card-footer flex-wrap justify-content-between align-items-center">

                                            <button type="button" class="btn btn-info mb-2" name="recharge_btn">
                                                <i class="mdi mdi-battery-charging-20"></i>&nbsp;Recharge
                                            </button>
                                        </div>
                                    </div>
                                    <div class="tab-pane p-3" id="tickets" role="tabpanel">
                                        <div class="card">
                                            <div class="card-body">
                                                <table id="tickets_datatable"
                                                class="table table-bordered dt-responsive nowrap"
                                                style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>No.</th> 
                                                            <th>Status</th> 
                                                            <th>Created</th>
                                                            <th>Priority</th>
                                                            <th>Customer Name</th>
                                                            <th>Phone Number</th>
                                                            <th>Issues</th>
                                                            <th>Pop/Area</th>                                                   
                                                            <th>Assigned Team</th>
                                                            <th>Ticket For</th>
                                                            <th>Acctual Work</th>
                                                            <th>Completed</th>
                                                            <th>Percentage</th>
                                                            <th>Note</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane p-3" id="recharge_history" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="recharge_history_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                        <th>ID</th>
                                                        <th>Recharged date</th>
                                                        <th>Customer Username</th>
                                                        <th>Months</th>
                                                        <th>Type</th>
                                                        <th>Paid until</th>
                                                        <th>Amount</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="tab-pane p-3" id="packages" role="tabpanel">
                                        <div class="card">

                                            <div class="card-body">
                                                <table id="package_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Package List</th>
                                                            <th>Purchase Price</th>
                                                            <th>Sale's Price</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="package-list">
                                                        <?php
                                                        $increment = 1;
                                                        $sql = "SELECT * FROM branch_package WHERE pop_id='$popid'";
                                                        $result = mysqli_query($con, $sql);

                                                        while ($rows = mysqli_fetch_assoc($result)) {

                                                        ?>

                                                        <tr>
                                                            <td><?php echo $increment++; ?></td>

                                                            <td><?php echo $rows['package_name']; ?></td>
                                                            <td><?php echo $rows['p_price']; ?></td>
                                                            <td><?php echo $rows['s_price']; ?></td>
                                                            <td>
                                                                <button class="btn-sm btn btn-primary edit_btn" data-id="<?php echo $rows['id']; ?>">Edit</button>
                                                            </td>


                                                        </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="tab-pane p-3" id="pop_transaction" role="tabpanel">
                                        <div class="card">
                                            <div class="card-body">
                                                <table id="transaction_datatable"
                                                    class="table table-bordered dt-responsive nowrap"
                                                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Recharge Amount</th>
                                                            <th>Paid Amount</th>
                                                            <th>Action</th>
                                                            <th>Transaction Type</th>
                                                            <th>Date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <?php
                                                        $sql = "SELECT * FROM pop_transaction WHERE pop_id='$popid'  ";
                                                        $result = mysqli_query($con, $sql);

                                                        while ($rows = mysqli_fetch_assoc($result)) {

                                                        ?>

                                                        <tr>
                                                            <td><?php echo $rows['id']; ?></td>
                                                            <td> <?php echo $rows['amount']; ?></td>
                                                            <td> <?php echo $rows['paid_amount']; ?></td>


                                                            <td>
                                                                <?php
                                                                $transaction_action = $rows['action'];
                                                                $transaction_type = $rows['transaction_type'];
                                                                
                                                                if ($transaction_action == 'Recharge' && $transaction_type == '1') {
                                                                    echo '<span class="badge bg-danger">Recharged</span> <br> <span class="badge bg-success">Paid</span>';
                                                                } elseif ($transaction_action == 'Recharge' && $transaction_type == '0') {
                                                                    echo '<span class="badge bg-danger">Recharged </span>';
                                                                } elseif ($transaction_action == 'paid') {
                                                                    echo '<span class="badge bg-success">Paid</span>';
                                                                } elseif ($transaction_action == 'Return') {
                                                                    echo '<span class="badge bg-warning">Return</span>';
                                                                }
                                                                
                                                                ?>
                                                            </td>
                                                            <td>
                                                                <?php
                                                                $transaction_type = $rows['transaction_type'];
                                                                if ($transaction_type == 1) {
                                                                    echo '<button class="btn-sm btn btn-outline-success">Cash</button>';
                                                                } elseif ($transaction_type == 0) {
                                                                    echo '<button class="btn-sm btn btn-outline-danger">Credit</button>';
                                                                } elseif ($transaction_type == 2) {
                                                                    echo 'Bkash';
                                                                } elseif ($transaction_type == 3) {
                                                                    echo 'Nagad';
                                                                } elseif ($transaction_type == 4) {
                                                                    echo 'Bank';
                                                                } elseif ($transaction_type == 5) {
                                                                    echo '<button class="btn-sm btn btn-outline-primary">Payment Rcvd</button>';
                                                                }
                                                                
                                                                ?>
                                                            </td>
                                                            <td> <?php echo $rows['date']; ?></td>
                                                        </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <div id="map" style="height: 400px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <table id="customer_table_area" class="table table-bordered dt-responsive nowrap"
                                        style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Area Name</th>
                                                
                                                <th><img src="images/icon/online.png" height="10"
                                                        width="10" /> Online</th>
                                                <th><img src="images/icon/expired.png" height="10"
                                                        width="10" /> Expired</th>
                                                <th><img src="images/icon/disabled.png" height="10"
                                                        width="10" /> Disabled</th>
                                                        <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php
                                            $sql = "SELECT * FROM area_list WHERE pop_id=$pop_id";
                                            $result = mysqli_query($con, $sql);

                                            while ($rows = mysqli_fetch_assoc($result)) {
                                                $area_ID = $rows['id'];
                                            ?>

                                            <tr>
                                                <td><?php echo $rows['id']; ?></td>
                                                <td><a
                                                        href="view_area.php?id=<?php echo $area_ID; ?>"><?php echo $rows['name']; ?></a>
                                                </td>
                                                
                                                <td>
                                                    <?php
                                                    
                                                    $sql = "SELECT radacct.username FROM radacct
                                                                                                                    INNER JOIN customers
                                                                                                                    ON customers.username=radacct.username
                                                                                                                    
                                                                                                                    WHERE customers.area='$area_ID' AND radacct.acctstoptime IS NULL";
                                                    $countpoponlnusr = mysqli_query($con, $sql);
                                                    
                                                    echo $countpoponlnusr->num_rows;
                                                    
                                                    ?>

                                                </td>
                                                <td>
                                                    <?php
                                                    $sql = "SELECT * FROM customers WHERE area='$area_ID' AND NOW() > expiredate";
                                                    $countxprd = mysqli_query($con, $sql);
                                                    $totalexprs = $countxprd->num_rows;
                                                    if ($totalexprs == 0) {
                                                        echo $totalexprs;
                                                    } else {
                                                        echo "<span class='badge bg-danger'>$totalexprs</span>";
                                                    }
                                                    
                                                    //
                                                    
                                                    ?>
                                                </td>

                                                <td>
                                                    <?php
                                                    $disableQ = "SELECT * FROM customers WHERE area='$area_ID' AND status='0'";
                                                    $countdsbld = mysqli_query($con, $disableQ);
                                                    $totaldsbld = $countdsbld->num_rows;
                                                    if ($totaldsbld == 0) {
                                                        echo $totaldsbld;
                                                    } else {
                                                        echo "<span class='badge bg-danger'>$totaldsbld</span>";
                                                    }
                                                    
                                                    ?>
                                                </td>
                                                <td>
                                                    <?php
                                                    
                                                    $sql = "SELECT * FROM customers WHERE area='$area_ID'";
                                                    $countpopusr = mysqli_query($con, $sql);
                                                    
                                                    echo $countpopusr->num_rows;
                                                    
                                                    ?>

                                                </td>

                                            </tr>
                                            <?php } ?>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>


                        



                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-header bg-white text-black">
                                    <h6>New Customers by months</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="datatables" class="table table-bordered dt-responsive nowrap"
                                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Months</th>
                                                    <th>New Conn.</th>
                                                    <th>Expired Conn.</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <?php
                                                for($i=1; $i<=12; $i++)
                                                {
                                                    ?>
                                                <tr>
                                                    <td><?php echo $i; ?></td>
                                                    <td>
                                                        <?php
                                                        $month = sprintf('%02d', $i);
                                                        $currentyrMnth = date('Y') . '-' . $month;
                                                        echo date('M-Y', strtotime($currentyrMnth));
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%' AND pop=$popid";
                                                        $result = mysqli_query($con, $sql);
                                                        $countconn = mysqli_num_rows($result);
                                                        echo '<a href="customer_newcon.php?list=' . $currentyrMnth . '">' . $countconn . '</a>';
                                                        ?>
                                                    </td>
                                                    <td>
                                                        <?php
                                                        $sql = "SELECT * FROM customers WHERE  expiredate LIKE '%$currentyrMnth%' AND pop=$popid";
                                                        $result = mysqli_query($con, $sql);
                                                        $countexpconn = mysqli_num_rows($result);
                                                        echo '<a href="customer_expire.php?list=' . $currentyrMnth . '">' . $countexpconn . '</a>';
                                                        ?>
                                                    </td>
                                                </tr>
                                                <?php } ?>
                                            </tbody>
                                        </table>

                                    </div>  
                                </div>    
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Ticket Statics 10 Days</h4>


                                    <div class="row text-center mt-4">
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE startdate BETWEEN '$daystkt' AND NOW()");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Tickets</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Complete' AND startdate BETWEEN '$daystkt' AND NOW() AND pop_id=$popid");
                                                echo $tktsql->num_rows;
                                                ?>

                                            </h5>
                                            <p class="text-muted text-truncate">Resolved</p>
                                        </div>
                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Active' AND startdate BETWEEN '$daystkt' AND NOW() AND pop_id=$popid");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate">Pending</p>
                                        </div>

                                        <div class="col-3">
                                            <h5 class="mb-0 font-size-18">
                                                <?php
                                                $daystkt = date('Y-m-d', strtotime('-7 day'));
                                                $tktsql = $con->query("SELECT * FROM ticket WHERE ticket_type='Close' AND startdate BETWEEN '$daystkt' AND NOW() AND pop_id=$popid");
                                                echo $tktsql->num_rows;
                                                ?>
                                            </h5>
                                            <p class="text-muted text-truncate danger">Closed</p>
                                        </div>

                                    </div>

                                    <div id="chart" dir="ltr"></div>





                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 stretch-card">
                            <div class="card">
                            <div class="card-body">
                                    <h4 class="card-title mb-4">Customer Statics</h4>

                                    <div class="row text-center mt-4">
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">50</h5>
                                            <p class="text-muted text-truncate">New</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">44</h5>
                                            <p class="text-muted text-truncate">Expired</p>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="mb-0 font-size-18">32</h5>
                                            <p class="text-muted text-truncate">Disabled</p>
                                        </div>
                                    </div>

                                    <div id="simple-line-chart" class="ct-chart ct-golden-section" dir="ltr">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>


                </div> <!-- container-fluid -->

               
            </div>
            <!-- End Page-content -->
            <!-----modal--->
            <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel"
                aria-hidden="true" id="addRechargeModal">
                <div class="modal-dialog" role="document">
                    <form id="FormData">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Add POP Recharge</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <input class="d-none" type="text" name="pop_id"
                                        value="<?php echo $popid; ?>">
                                    <div class="form-group mb-2">
                                        <label>Amount:</label>
                                        <input type="text" id="addPopAmount" placeholder="Enter Your Amount"
                                            class="form-control">
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Action:</label>
                                        <select id="addPopAction" class="form-select">
                                            <option value="">Select</option>
                                            <option value="Recharge">Add</option>
                                            <option value="Return">Return</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Transaction Type:</label>
                                        <select id="addPopTra_type" class="form-select">
                                            <option value="">Select</option>
                                            <option value="1">Cash</option>
                                            <option value="0">Credit</option>
                                        </select>
                                    </div>
                                    <div class="form-group d-none">
                                        <label>Transaction Type:</label>
                                        <input type="text" id="recharge_by" class="form-control"
                                            value="<?php echo $_SESSION['username']; ?>" />
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-bs-dismiss="modal" aria-label="Close"
                                    class="btn btn-danger">Cancle</button>
                                <button id="submitBtn" type="button" name="submit"
                                    class="btn btn-primary">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel"
                aria-hidden="true" id="addPaymentModal">
                <div class="modal-dialog" role="document">
                    <form id="FormData">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Payment Received</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <input class="d-none" type="text" name="pop_id"
                                        value="<?php echo $popid; ?>">
                                    <div class="form-group mb-2">
                                        <label>Amount:</label>
                                        <input type="text" id="addPopRechargeAmount"
                                            placeholder="Enter Your Amount" class="form-control">
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Transaction Type:</label>
                                        <select id="addPopRechargeTra_type" class="form-select">
                                            <option value="1">Cash</option>
                                            <option value="2">Bkash</option>
                                            <option value="3">Nagad</option>
                                            <option value="4">Bank</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Remarks</label>
                                        <textarea id="addRechargeRemarks" class="form-control" placeholder="Enter Remarks"></textarea>
                                    </div>
                                    <div class="form-group d-none">
                                        <label>Recharge By:</label>
                                        <input type="text" id="recharge_by" class="form-control"
                                            value="<?php echo $_SESSION['username']; ?>" />
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-bs-dismiss="modal" aria-label="Close"
                                    class="btn btn-danger">Cancle</button>
                                <button type="button" id="addPaymentBtn" class="btn btn-primary"><i
                                        class="mdi mdi-cash"></i> Add Payment</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
           
            <div class="modal fade bs-example-modal-lg" tabindex="-1" aria-labelledby="myLargeModalLabel"
                aria-hidden="true" id="addPackageModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Add Package</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <input class="d-none" type="text" id="pop_id" value="<?php echo $popid; ?>">
                                <div class="form-group mb-2">
                                    <label>Package Name</label>
                                    <select id="p_name" id="p_name" class="form-select"
                                        onchange="getPackagePrice()">
                                        <option>Select Package</option>
                                        <?php
                                        if ($allPackage = $con->query('SELECT * FROM radgroupcheck')) {
                                            while ($rows = $allPackage->fetch_array()) {
                                                echo '<option value=' . $rows['id'] . '>' . $rows['groupname'] . '</option>';
                                            }
                                        }
                                        
                                        ?>


                                    </select>
                                </div>
                                <div class="form-group mb-2">
                                    <label>Purchase Price</label>
                                    <input type="text" id="p_price" name="p_price"
                                        placeholder="Enter Your Amount" class="form-control">
                                </div>
                                <div class="form-group mb-2">
                                    <label>Sale's Price</label>
                                    <input type="text" id="s_price" name="s_price"
                                        placeholder="Enter Your Amount" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" data-bs-dismiss="modal" aria-label="Close"
                                class="btn btn-danger">Cancle</button>
                            <button id="PackageSubmitBtn" type="button" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </div>
            </div> 
            <!----------------- Modal for Package update ------------------> 
            <div class="modal fade bs-example-modal-lg" tabindex="-1"
                aria-hidden="true" id="editPackageModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <form id="updatePackageForm">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Update Package</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <input class="d-none" type="text" name="id" id="id" value="">
                                    <input class="d-none" type="text" name="pop_id" id="pop_id" value="<?php echo $popid; ?>">
                                    
                                    <div class="form-group mb-2">
                                        <label>Purchase Price</label>
                                        <input type="text" id="p_price" name="p_price"
                                            placeholder="Enter Your Amount" class="form-control">
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Sale's Price</label>
                                        <input type="text" id="s_price" name="s_price"
                                            placeholder="Enter Your Amount" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-bs-dismiss="modal" aria-label="Close"
                                    class="btn btn-danger">Cancle</button>
                                <button  type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div> 
            <!------------------ Modal for Recharge ------------------>
            <div class="modal fade " id="rechargeModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                Recharge
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info" id="selectedCustomerCount"></div>
                            <form id="recharge-form" method="POST">
                                <div id="holders">
                                    <div class="form-group mb-1">
                                        <label>Month</label>
                                        <select id="month" class="form-select" name='month'>
                                            <option value="">Select</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group mb-1 ">
                                    <label>Ref No.:</label>
                                    <input id="RefNo" type="text" class="form-control" name="RefNo"
                                        placeholder="Enter Ref No" />
                                </div>
                                <div class="form-group mb-1">
                                    <label>Transaction Type:</label>
                                    <select id="tra_type" name="tra_type" class="form-select">
                                        <option>---Select---</option>
                                        <option value="1">Cash</option>
                                        <option value="0">On Credit</option>
                                        <option value="2">Bkash</option>
                                        <option value="3">Nagad</option>
                                        <option value="4">Due Payment</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                            <button type="button" name="recharge_submit_btn" class="btn btn-success">Recharge Now</button>
                        </div>
                    </div>
                </div>
            </div>

            <!----------------Customer MODAL---------------->
            <?php include 'modal/customer_modal.php'; ?>
            <?php include 'Footer.php'; ?>

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->


    <!-- Right bar overlay-->
    <div class="rightbar-overlay"></div>


    <?php include 'script.php'; ?>
    <script type="text/javascript" src="js/customer.js"></script>
    <script type="text/javascript" src="js/google_map.js"></script>
    <script type="text/javascript">
        $("#customer_table_area").DataTable();
        /*************************simple-line-chart Start**************************************************/
        var chart = new Chartist.Line("#simple-line-chart", {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            series: [
                [<?php
                for ($i = 1; $i < 13; $i++) {
                    $currentyrMnth = date('Y') . '-0' . $i;
                    $sql = "SELECT * FROM customers WHERE createdate LIKE '%$currentyrMnth%' AND pop='{$_GET['id']}'";
                    $result = mysqli_query($con, $sql);
                    echo $countconn = mysqli_num_rows($result) . ',';
                }
                ?>],
                [

                    <?php
                    for ($i = 1; $i < 13; $i++) {
                        $currentyrMnth = date('Y') . '-0' . $i;
                        $sql = "SELECT * FROM customers WHERE expiredate LIKE '%$currentyrMnth%' AND pop='{$_GET['id']}'";
                        $result = mysqli_query($con, $sql);
                    }
                    
                    ?>
                ],
                [1, 3, 4, 5, 6, 7, 7, 7, 7, 7, 7, 7, 10],
                [10, 2, 3, 4, 5, 6, 6, 6, 6, 6, 6, 6, 13]
            ]
        }, {
            fullWidth: !0,
            chartPadding: {
                right: 40
            },
            plugins: [Chartist.plugins.tooltip()]
        });

        var times = function(e) {
                return Array.apply(null, new Array(e))
            },
            data = times(52).map(Math.random).reduce(function(e, t, a) {
                return e.labels.push(a + 1), e.series.forEach(function(e) {
                    e.push(100 * Math.random())
                }), e
            }, {
                labels: [],
                series: times(4).map(function() {
                    return new Array
                })
            }),
            options = {
                showLine: !1,
                axisX: {
                    labelInterpolationFnc: function(e, t) {
                        return t % 13 == 0 ? "W" + e : null
                    }
                }
            },
            responsiveOptions = [
                ["screen and (min-width: 640px)", {
                    axisX: {
                        labelInterpolationFnc: function(e, t) {
                            return t % 4 == 0 ? "W" + e : null
                        }
                    }
                }]
            ];
        new Chartist.Line("#scatter-diagram", data, options, responsiveOptions);
        /*************************simple-line-chart End**************************************************/
        ///////////////// Chart Bar //////////////////////
        ! function(e) {
            "use strict";

            function a() {}
            a.prototype.init = function() {
                    c3.generate({
                        bindto: "#chart",
                        data: {
                            columns: [
                                ["Tickets",
                                    <?php
                                    // Date find from 9 days ago
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare('SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND pop_id = ?');
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $_GET['id']);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ],
                                ["Resolved",
                                    <?php
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare("SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND ticket_type='Complete' AND pop_id = ?");
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $_GET['id']);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ],
                                ["Pending",
                                    <?php
                                    for ($i = 0; $i < 9; $i++) {
                                        $daystkt = date('Y-m-d', strtotime('-' . $i . ' day'));
                                        $stmt = $con->prepare("SELECT COUNT(*) AS total FROM ticket WHERE startdate LIKE ? AND ticket_type='Active' AND pop_id = ?");
                                        $likeDate = "%$daystkt%";
                                        $stmt->bind_param('si', $likeDate, $_GET['id']);
                                        $stmt->execute();
                                        $result = $stmt->get_result();
                                        $row = $result->fetch_assoc();
                                        echo $row['total'] . ',';
                                    }
                                    ?>
                                ]
                            ],
                            type: "bar",
                            colors: {
                                Tickets: "#fb8c00",
                                Resolved: "#3bc3e9",
                                Pending: "#5468da"
                            }
                        }
                    })
                },
                e.ChartC3 = new a, e.ChartC3.Constructor = a
        }(window.jQuery),
        function() {
            "use strict";
            window.jQuery.ChartC3.init()
        }();

        $(document).ready(function() {
            var checkedBoxes = {};
            var table=$('#customers_table').DataTable({
                "searching": true,
                "paging": true,
                "info": true,
                "order": [
                    [0, "desc"]
                ],
                "lengthChange": true,
                "processing": false,
                "serverSide": false,

                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/customer_server_new.php?get_customers_data=true",
                    type: 'GET',
                    data: function(d) {
                        d.status = $('.status_filter').val();
                        // d.pop_id = $('.pop_filter').val();
                        d.pop_id = <?php echo $popid; ?>;
                        d.area_id = $('.area_filter').val();
                    },
                },
                "drawCallback": function() {
                    $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
                },

            });
            /* Check/Uncheck All Checkboxes*/
            $(document).on('change', '#checkedAll', function() {
                var isChecked = $(this).is(':checked');
                $('.customer-checkbox').prop('checked', isChecked);
                $('.customer-checkbox').each(function() {
                    var id = $(this).val();
                    checkedBoxes[id] = isChecked;
                });
            });

            /* Handle Individual Checkbox Change*/
            $(document).on('cilck', '.customer-checkbox', function() {
                var id = $(this).val();
                checkedBoxes[id] = $(this).is(':checked');

                var allChecked = $('.customer-checkbox:checked').length === $('.customer-checkbox').length;
                $('#checkedAll').prop('checked', allChecked);
            });
           
            /************************** Customer Recharage Section **************************/
        $(document).on('click', 'button[name="recharge_btn"]', function(e) {
            event.preventDefault();
            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            if (selectedCustomers.length == 0) {
                toastr.error("Please select at least one customer to recharge.");
                return false;
            }
            var countText = "You have selected " + selectedCustomers.length + " customers.";
            $("#rechargeModal #selectedCustomerCount").text(countText);
            $('#rechargeModal').modal('show');
        });

        $(document).on('click', 'button[name="recharge_submit_btn"]', function(e) {
            event.preventDefault();
            var $button = $(this);
            $button.prop('disabled', true);
            $button.html(
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...'
            );

            var selectedCustomers = [];
            $(".checkSingle:checked").each(function() {
                selectedCustomers.push($(this).val());
            });
            var data = $('#recharge-form').serialize() + '&selectedCustomers=' + JSON.stringify(selectedCustomers);
            $.ajax({
                url: 'include/customer_recharge_server.php?add_customer_recharge=true',
                method: 'POST',
                data: data,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#rechargeModal').modal('hide');
                        $('#customers_table').DataTable().ajax.reload();
                    } else if (response.success == false) {
                        if (response.errors) {
                            $.each(response.errors, function(key, error) {
                                toastr.error(error);
                            });
                        } else {
                            toastr.error(response.message);
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("An error occurred: " + error);
                    alert("There was an error sending the message.");
                },
                complete: function() {

                    $button.prop('disabled', false);
                    $button.html('Recharge Now');
                }
            });
        });

            $('#tickets_datatable').DataTable({
                "searching": true,
                "paging": true,
                "info": false,
                "lengthChange": true,
                "processing": false,
                "serverSide": false,
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/tickets_server.php?get_tickets_data=1",
                    type: 'GET',
                    data: function(d) {
                        d.pop_id = <?php echo $popid; ?>;
                        
                        d.status = 'Active';
                    },
                    beforeSend: function() {
                        $(".dataTables_empty").html(
                            '<img src="assets/images/loading.gif" style="background-color: transparent"/>'
                            );
                    }
                },
                "order": [
                    [0, 'desc']
                ],
                "scrollX": true,
                "responsive": true,
                "columnDefs": [{
                        "width": "5%",
                        "targets": 0
                    },
                    {
                        "width": "10%",
                        "targets": 1
                    }
                ]
            });

            $('#recharge_history_datatable').DataTable({
                "searching": true,
                "paging": true,
                "info": true,
                "order": [
                    [0, "desc"]
                ],
                "lengthChange": true,
                "processing": true,
                "serverSide": true,

                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
                "zeroRecords": "No matching records found",
                "ajax": {
                    url: "include/customer_recharge_server.php?get_recharge_data=true",
                    type: 'GET',
                    data: function(d) {
                        //d.status = $('.status_filter').val();
                        // d.pop_id = $('.pop_filter').val();
                        d.pop_id = <?php echo $popid; ?>;
                    },
                },
                "drawCallback": function() {
                    $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
                },

            });
            //$("#package-list-table").DataTable();

            $("#transaction_datatable").DataTable();
            $("#package_datatable").DataTable();


            $("#packageAddBtn").click(function() {
                $("#addPackageModal").modal('show');
            });


            $("#PackageSubmitBtn").click(function() {
                var pop_id = $("#pop_id").val();
                var p_name = $("#p_name").val();
                var p_price = $("#p_price").val();
                var s_price = $("#s_price").val();
                if (p_name.length == 0) {
                    toastr.error("Package Name is required");
                } else if (p_price.length == 0) {
                    toastr.error("Purchase price is required");
                } else if (s_price.length == 0) {
                    toastr.error("Sale's price is required");
                } else {
                    $.ajax({
                        type: "POST",
                        data: {
                            pop_id: pop_id,
                            p_name: p_name,
                            p_price: p_price,
                            s_price:s_price,
                        },
                        url: "include/package_server.php",
                        cache: false,
                        dataType:'json',
                        success: function(response) {
                            if(response.success==true){
                                $("#addPackageModal").modal('hide');
                                toastr.success(response.message);
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            }
                            if(response.success==false){
                                toastr.error(response.message);
                            }
                        }
                    });
                }
            });
            $("#submitBtn").click(function() {
                var pop_id = $("#pop_id").val();
                var addPopAmount = $("#addPopAmount").val();
                var addPopAction = $("#addPopAction").val();
                var addPopTra_type = $("#addPopTra_type").val();
                var recharge_by = $("#recharge_by").val();
                var addPopRecharge = "0";
                if (addPopAmount.length == 0) {
                    toastr.error("Amount is required");
                } else if (addPopAction.length == 0) {
                    toastr.error("Please Select Action Type");
                } else if (addPopTra_type.length == 0) {
                    toastr.error("Please Select Trasaction Type");
                } else {
                    $.ajax({
                        type: "POST",
                        data: {
                            id: pop_id,
                            amount: addPopAmount,
                            action: addPopAction,
                            trasaction: addPopTra_type,
                            addPopRecharge: addPopRecharge,
                            recharge_by: recharge_by
                        },
                        url: "include/pop_transaction.php",
                        cache: false,
                        success: function(repsonse) {
                            if (repsonse == 1) {
                                $("#addRechargeModal").modal('hide');
                                toastr.success("Recharge Successfully");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error('Please Try Again');
                            }
                        }
                    });
                }


            });
            $("#addPaymentBtn").click(function() {
                var pop_id = $("#pop_id").val();
                var addPopAmount = $("#addPopRechargeAmount").val();
                var addPopTra_type = $("#addPopRechargeTra_type").val();
                var addRemarks = $("#addRechargeRemarks").val();
                var recharge_by = $("#recharge_by").val();
                var addPayment = "0";
                if (addPopAmount.length == 0) {
                    toastr.error("Amount is required");
                } else {
                    $.ajax({
                        type: "POST",
                        data: {
                            id: pop_id,
                            amount: addPopAmount,
                            trasaction: addPopTra_type,
                            addRemarks: addRemarks,
                            addPayment: addPayment,
                            recharge_by: recharge_by
                        },
                        url: "include/pop_transaction.php",
                        cache: false,
                        success: function(repsonse) {
                            if (repsonse == 1) {
                                $("#addPaymentModal").modal('hide');
                                toastr.success("Payment Successfully");
                                toastr.success("Thank You");
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);
                            } else {
                                toastr.error('Please Try Again');
                            }
                        }
                    });
                }


            });
        });

        function getPackagePrice() {
            var p_name = $("#p_name").val();
            $.ajax({
                type: 'POST',
                data: {
                    package_name_id: p_name,
                },
                url: 'include/package_server.php',
                success: function(response) {
                    $("#p_price").val(response);
                }

            });
        }
        // **UPDATE Package**
        $(document).on('click', '.edit_btn', function() {
            var id=$(this).data('id');
            $("#editPackageModal").modal('show');
            $.ajax({
                type: 'GET',
                data: {
                    id: id,
                    'get_package_data': true
                },
                url: 'include/package_server.php',
                success: function(response) {
                    var data = JSON.parse(response);
                     if (data.length > 0) { 
                        $('#editPackageModal #id').val(data[0].id);
                        $('#editPackageModal #p_price').val(data[0].p_price);
                        $('#editPackageModal #s_price').val(data[0].s_price);
                        $('#editPackageModal #pop_id').val(data[0].pop_id);
                    } else {
                        alert('No data found for the selected package.');
                    }
                }
            });
        });

        // **UPDATE Package**
        $(document).on('submit', '#updatePackageForm', function(e) {
            e.preventDefault();

               var id= $('#editPackageModal #id').val();
               var pop_id= $('#editPackageModal #pop_id').val();
               var p_price= $('#editPackageModal #p_price').val();
               var s_price= $('#editPackageModal #s_price').val();

            $.ajax({
                type: 'POST',
                url: 'include/package_server.php',
                data:
                {
                     id: id,
                     pop_id: pop_id,
                     p_price: p_price,
                     s_price: s_price,
                    'update_package_data': true
                },
                dataType:'json',
                success: function(response) {
                    if (response.success==true) {
                        toastr.success(response.message);
                        $("#editPackageModal").modal('hide');
                        location.reload(); 
                    } else {
                         toastr.error("Package Not Updated!");
                    }
                }
            });
        });


        var xValues = [1, 2, 3, 4, 5, 6];
        new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    data: [860, 1140, 1060, 1060, 1070, 1110],
                    borderColor: "red",
                    fill: false
                }, {
                    data: [1600, 1700, 1700, 1900, 2000, 2700],
                    borderColor: "green",
                    fill: false
                }, {
                    data: [300, 700, 2000, 3000, 3000, 4000],
                    borderColor: "blue",
                    fill: false
                }]
            },
            options: {
                legend: {
                    display: false
                }
            }
        });
    /*************************Google Map Load**********************************************************/
    loadMaps(<?= $popid; ?>);
    </script>

</body>

</html>


<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    	<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
        <link href="assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Working Group</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['fullname'])) {
                                        echo $_SESSION['fullname'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="profileImages/avatar.png" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Working Group</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target="#addModal" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                              Working Group</button>
                          </div>
                            </div>
                        </div>
                    </div>






                          <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Working Group</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/working_group_backend.php" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="add_group_data" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Group Name</label>
										<input name="group_name" placeholder="Group Name" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Area</label>
										<select  name="area_id[]"  class="form-control" style="width: 100%;" multiple >
                                        <option>---Select---</option>
                                        <?php
                                        if ($allArea=$con->query("SELECT * FROM area_list")) {
                                            while($rows=$allArea->fetch_array()){
                                                echo '<option value="'.$rows['id'].'">'.$rows['name'].'</option>'; 
                                            }
                                        }
                                        ?>
                                        </select>
									</div>
									<div class="form-group mb-2 ">
										<label>Note</label>
										<input name="note" placeholder="Enter Your Note" class="form-control" type="text" >
									</div>                    
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>


				 <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Working Group</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/working_group_backend.php" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="update_working_data" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2 d-none">
										<input name="id" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Group Name</label>
										<input name="group_name" placeholder="Group Name" class="form-control" type="text" >
									</div>
                                    <div class="form-group mb-2">
										<label>Area</label>
										<select type="text" name="area_id[]"  class="form-select" style="width: 100%;" multiple>
                                        <option>---Select---</option>
                                        <?php
                                        if ($allArea=$con->query("SELECT * FROM area_list")) {
                                            while($rows=$allArea->fetch_array()){
                                                echo '<option value="'.$rows['id'].'">'.$rows['name'].'</option>'; 
                                            }
                                        }
                                        ?>
                                        </select>
									</div>
									<div class="form-group mb-2 ">
										<label>Note</label>
										<input name="note" placeholder="Enter Your Note" class="form-control" type="text" >
									</div>                    
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>






                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                  <th>ID</th>
                                                    <th>Group Name</th>
                                                    <th>Area Name</th>
                                                    <th>Note</th>
                                                    <th></th>
                                               </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script> 
    <script src="assets/libs/select2/js/select2.min.js"></script>
    <script src="assets/js/app.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        loadTableData();

        function loadTableData() {
            $.ajax({
                url: "include/working_group_backend.php?get_all_working_data", 
                type: "GET",
                dataType: "json",
                success: function(data) {
                    var tbody = $('#datatable tbody');
                    tbody.empty();

                    $.each(data, function(index, row) {
                        var areaNames = row.area_names.join(', ');

                        var html = '<tr>'+
                            '<td>'+ row.id +'</td>'+
                            '<td>'+ row.group_name +'</td>'+
                            '<td>'+ areaNames +'</td>'+
                            '<td>'+ row.note +'</td>'+
                            '<td style="text-align:right;">'+
                                '<button type="button" class="btn btn-info edit-btn" data-id="'+ row.id +'"><i class="fas fa-edit"></i></button>'+
                                '<button type="button" class="btn btn-danger delete-btn" data-id="'+ row.id +'"><i class="fas fa-trash"></i></button>'+
                            '</td>'+
                        '</tr>';
                        tbody.append(html);
                    });
                }
            });
        }

        $('#addModal').on('shown.bs.modal', function () {
            if (!$("select[name='area_id[]']").hasClass("select2-hidden-accessible")) {
                $("select[name='area_id[]']").select2({
                    dropdownParent: $('#addModal'),
                     allowClear: true,
                    placeholder: "Select Area"
                });
            }
        });
        $('#editModal').on('shown.bs.modal', function () {
            if (!$("select[name='area_id']").hasClass("select2-hidden-accessible")) {
                $("select[name='area_id']").select2({
                    dropdownParent: $('#editModal'),
                     allowClear: true,
                    placeholder: "Select Area"
                });
            }
        });
        $("#users_table").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/working_group_backend.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

       /** Store The data from the database table **/
	  $('#addModal form').submit(function(e){
		e.preventDefault();

		var form = $(this);
		var url = form.attr('action');
		var formData = form.serialize();
		/** Use Ajax to send the delete request **/
		$.ajax({
		  type:'POST',
		  'url':url,
		  data: formData,
		 success: function (response) {
			/*Parse the JSON response*/ 
			const jsonResponse = JSON.parse(response);

			/* Check if the request was successful*/
			if (jsonResponse.success) {
				/*Hide the modal*/ 
				$('#addModal').modal('hide'); 
				 /*Reset the form*/ 
				$('#addModal form')[0].reset();
				/* Show success message*/
				toastr.success(jsonResponse.message); 

				/*Reload the page after a short delay*/ 
				setTimeout(() => {
					location.reload();
				}, 500);
			} else {
				/*Show error message if success is false*/ 
				toastr.error(jsonResponse.message); // Show error message
			}
		},


		  error: function (xhr, status, error) {
			 /** Handle  errors **/
			if (xhr.status === 422) {
				var errors = xhr.responseJSON.errors;
				$.each(errors, function(key, value) {
					toastr.error(value[0]); 
				});
			}
		  }
		});
	  });
    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/working_group_backend.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="group_name"]').val(jsonResponse.data.group_name);
                    $('#editModal input[name="note"]').val(jsonResponse.data.note);
                    $('#editModal select[name="area_id"]').val(jsonResponse.data.area_id);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
            const jsonResponse = JSON.parse(response);
    			$('#editModal').modal('hide');
    			$('#editModal form')[0].reset();
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);

    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>
<?php
include("include/security_token.php");
include("include/users_right.php");
include "include/db_connect.php";
include "include/pop_security.php";

?>
<!doctype html>
<html lang="en">
    <head>
    
        <meta charset="utf-8">
        <title>FAST-ISP-BILLING-SOFTWARE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">
        <!-- App favicon -->
        <!-- <link rel="shortcut icon" href="assets/images/favicon.ico"> -->
        <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <link href="assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
        <!-- C3 Chart css -->
        <link href="assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">
    
        <!-- Bootstrap Css -->
        <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">
    	<link rel="stylesheet" type="text/css" href="css/toastr/toastr.min.css">
    </head>

    <body data-sidebar="dark">


        <!-- Loader -->
            <div id="preloader"><div id="status"><div class="spinner"></div></div></div>

        <!-- Begin page -->
        <div id="layout-wrapper">
        
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="index.php" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="17">
                                </span>
                            </a>

                            <a href="index.php" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="assets/images/it-fast.png" alt="" height="22">
                                </span>
                                <span class="logo-lg">
                                    <img src="assets/images/it-fast.png" alt="" height="36">
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                        <div class="d-none d-sm-block ms-2">
                            <h4 class="page-title">Works</h4>
                        </div>
                    </div>

                    

                    <div class="d-flex">

                       

                        

                        <div class="dropdown d-none d-md-block me-2">
                            <button type="button" class="btn header-item waves-effect" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="font-size-16">
                                    <?php if (isset($_SESSION['username'])) {
                                        echo $_SESSION['username'];
                                    } ?>
                                </span> 
                            </button>
                        </div>


                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="assets/images/users/avatar-1.jpg" alt="Header Avatar">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item text-danger" href="logout.php">Logout</a>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block me-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="ion ion-md-notifications"></i>
                                <span class="badge bg-danger rounded-pill">3</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h5 class="m-0 font-size-16"> Notification (3) </h5>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="mdi mdi-cart-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your order is placed</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">Dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-warning rounded-circle font-size-16">
                                                    <i class="mdi mdi-message-text-outline"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">New Message received</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">You have 87 unread messages</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="avatar-xs me-3">
                                                <span class="avatar-title bg-info rounded-circle font-size-16">
                                                    <i class="mdi mdi-glass-cocktail"></i>
                                                </span>
                                            </div>
                                            <div class="flex-1">
                                                <h6 class="mt-0 font-size-15 mb-1">Your item is shipped</h6>
                                                <div class="font-size-12 text-muted">
                                                    <p class="mb-1">It is a long established fact that a reader will</p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                </div>
                                <div class="p-2 border-top">
                                    <div class="d-grid">
                                        <a class="btn btn-sm btn-link font-size-14  text-center" href="javascript:void(0)">
                                            View all
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>


        
            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar class="h-100">

                    <!--- Sidemenu -->
                     <?php include 'Sidebar_menu.php'; ?>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->
        
            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
           <div class="row">
                        <div class="col-md-12 grid-margin">
                            <div class="d-flex justify-content-between flex-wrap">
                                <div class="d-flex align-items-end flex-wrap">
                                    <div class="mr-md-3 mr-xl-5">


                                        <div class="d-flex">
                                            <i class="mdi mdi-home text-muted hover-cursor"></i>
                                            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;
                                            </p>
                                            <p class="text-primary mb-0 hover-cursor">Works</p>
                                        </div>


                                    </div>
                                    <br>


                                </div>
                                <div class="d-flex justify-content-between align-items-end flex-wrap">
                                    <button class="btn btn-primary mt-2 mt-xl-0 mdi mdi-account-plus mdi-18px"
                                 data-bs-toggle="modal" data-bs-target="#addModal" style="margin-bottom: 12px;">&nbsp;&nbsp;New
                              Works</button>
                          </div>
                            </div>
                        </div>
                    </div>






                          <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;New Works</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/works_backend.php" method="POST" enctype="multipart/form-data">
									<div class="form-group mb-2 d-none">
										<input name="add_works_data" class="form-control" type="text" >
									</div>
									<div class="form-group mb-2">
										<label>Name</label>
										<input name="name" placeholder="Enter Name" class="form-control" type="text" >
									</div>
                                    <div class="form-group mb-2">
                                        <label>Email</label>
                                        <input name="email" placeholder="Enter Email" class="form-control" type="email" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Phone</label>
                                        <input name="phone" placeholder="Enter Phone" class="form-control" type="text" >
                                    </div>
									<div class="form-group mb-2 ">
										<label>Group</label>
										<select name="group_id" class="form-select" type="text" >
                                            <option>---Select---</option>  
                                            <?php 

                                                if ($group=$con->query("SELECT* FROM working_group")) {

                                                    while ($rows=$group->fetch_array()) {

                                                        $userId=$rows["id"];
                                                        $group_name=$rows["group_name"];
                                                     echo '<option value='.$userId.'>'.$group_name.'</option>';  
                                                    }
                                                }

                                                 ?>                             
                                        </select>
									</div>                    
									<div class="modal-footer ">
										<button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
										<button type="submit" class="btn btn-success">Save Changes</button>
									</div>
								</form>
							</div>
                        </div>
                     </div>
                  </div>


				 <div class="modal fade bs-example-modal-lg" id="editModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                     <div class="modal-dialog " role="document">
                        <div class="modal-content col-md-12">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel"><span
                                 class="mdi mdi-account-check mdi-18px"></span> &nbsp;Update Works</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
						   <div class="modal-body">
							  <form action="include/works_backend.php" method="POST" enctype="multipart/form-data">
                                    <div class="form-group mb-2 d-none">
                                        <input name="update_works_data" class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2 d-none">
                                        <label>ID</label>
                                        <input name="id"  class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Name</label>
                                        <input name="name" placeholder="Enter Name" class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Email</label>
                                        <input name="email" placeholder="Enter Email" class="form-control" type="email" >
                                    </div>
                                    <div class="form-group mb-2">
                                        <label>Phone</label>
                                        <input name="phone" placeholder="Enter Phone" class="form-control" type="text" >
                                    </div>
                                    <div class="form-group mb-2 ">
                                        <label>Group</label>
                                        <select name="group_id" class="form-select" type="text" >
                                            <option>---Select---</option>  
                                            <?php 

                                                if ($group=$con->query("SELECT* FROM working_group")) {

                                                    while ($rows=$group->fetch_array()) {

                                                        $userId=$rows["id"];
                                                        $group_name=$rows["group_name"];
                                                     echo '<option value='.$userId.'>'.$group_name.'</option>';  
                                                    }
                                                }

                                                 ?>                             
                                        </select>
                                    </div>                    
                                    <div class="modal-footer ">
                                        <button data-bs-dismiss="modal" type="button" class="btn btn-danger">Cancel</button>
                                        <button type="submit" class="btn btn-success">Save Changes</button>
                                    </div>
                                </form>
							</div>
                        </div>
                     </div>
                  </div>






                    <div class="row">
                        <div class="col-md-12 stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <span class="card-title"></span>


                                    <div class="col-md-6 float-md-right grid-margin-sm-0">



                                    </div>


                                    <div class="table-responsive">
                                        <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                            <thead>
                                               <tr>
                                                  <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Phone</th>
                                                    <th>Group</th>
                                                    <th></th>
                                               </tr>
                                            </thead>
                                            <tbody>
                                                <?php 

                                                if ($userlist=$con->query("SELECT* FROM works")) {

        while ($rows=$userlist->fetch_array()) {

            $userId=$rows["id"];
            $name=$rows["name"];
            $email=$rows["email"];
            $phone=$rows["phone"];
            $group_id=$rows["group_id"];
            if ($list=$con->query("SELECT `group_name` FROM working_group WHERE id=$group_id")) {
                while ($ro=$list->fetch_array()) {
                     $group_name=$ro["group_name"];
                }
            }
             echo '
     <tr>
     <td>'.$userId.'</td>
     <td>'.$name.'</td>
	 <td>'.$email.'</td>
     <td>'.$phone.'</td>
     <td>
       '.$group_name.' 
    </td>
    <td style=" text-align:right;">
        <button type="button" class="btn btn-info edit-btn" data-id="'.$userId.'"><i class="fas fa-edit"></i></button>
        <button type="button" class="btn btn-danger delete-btn" data-id="'.$userId.'" ><i class=" fas fa-trash"></i>
        </button>
        </td>
     </tr>'; 
        }
    }

                                                 ?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <script>document.write(new Date().getFullYear())</script>  IT-FAST.
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Development <i class="mdi mdi-heart text-danger"></i><a href="https://facebook.com/rakib56789">Rakib Mahmud</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</div>
<!-- end main content-->
        
        </div>
        <!-- END layout-wrapper -->

        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar class="h-100">
                <div class="rightbar-title px-3 py-4">
                    <a href="javascript:void(0);" class="right-bar-toggle float-end">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                    <h5 class="m-0">Settings</h5>
                </div>

                <!-- Settings -->
                <hr class="mt-0">
                <h6 class="text-center mb-0">Choose Layouts</h6>

                <div class="p-4">
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-1.jpg" class="img-fluid img-thumbnail" alt="Layouts-1">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="light-mode-switch">
                        <label class="form-check-label" for="light-mode-switch">Light Mode</label>
                    </div>

                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-2.jpg" class="img-fluid img-thumbnail" alt="Layouts-2">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox" id="dark-mode-switch" data-bsStyle="assets/css/bootstrap-dark.min.css" data-appStyle="assets/css/app-dark.min.css">
                        <label class="form-check-label" for="dark-mode-switch">Dark Mode</label>
                    </div>
    
                    <div class="mb-2">
                        <img src="assets/images/layouts/layout-3.jpg" class="img-fluid img-thumbnail" alt="Layouts-3">
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input theme-choice" type="checkbox"  id="rtl-mode-switch" data-appStyle="assets/css/app-rtl.min.css">
                        <label class="form-check-label" for="rtl-mode-switch">RTL Mode</label>
                    </div>
            
            
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>
        
        
    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Required datatable js -->
    <script src="assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="assets/libs/jszip/jszip.min.js"></script>
    <script src="assets/libs/pdfmake/build/pdfmake.min.js"></script>
    <script src="assets/libs/pdfmake/build/vfs_fonts.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.min.js"></script>
    <script type="text/javascript" src="js/toastr/toastr.init.js"></script>
    <!-- Datatable init js -->
    <script src="assets/js/pages/datatables.init.js"></script> 

    <script src="assets/js/app.js"></script>
     <script type="text/javascript">
    $(document).ready(function() {
        $("#users_table").DataTable();
		/** Handle Delete button click**/
        $('#datatable tbody').on('click', '.delete-btn', function() {
        var id = $(this).data('id');
        // Confirm deletion
        if (confirm("Are you sure you want to delete this item?")) {
            $.ajax({
                type: 'POST', 
                url: 'include/works_backend.php', 
                data: { delete_data: true, id: id }, 
                success: function(response) {
                    const jsonResponse = JSON.parse(response);
                    if (jsonResponse.success) {
                        toastr.success("Item deleted successfully!");
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else {
                        toastr.error(jsonResponse.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    toastr.error("Error deleting item! " + error);
                }
            });
        }
    });

       /** Store The data from the database table **/
	  $('#addModal form').submit(function(e){
		e.preventDefault();

		var form = $(this);
		var url = form.attr('action');
		var formData = form.serialize();
		/** Use Ajax to send the delete request **/
		$.ajax({
		  type:'POST',
		  'url':url,
		  data: formData,
		 success: function (response) {
			/*Parse the JSON response*/ 
			const jsonResponse = JSON.parse(response);

			/* Check if the request was successful*/
			if (jsonResponse.success) {
				/*Hide the modal*/ 
				$('#addModal').modal('hide'); 
				 /*Reset the form*/ 
				$('#addModal form')[0].reset();
				/* Show success message*/
				toastr.success(jsonResponse.message); 

				/*Reload the page after a short delay*/ 
				setTimeout(() => {
					location.reload();
				}, 500);
			} else {
				/*Show error message if success is false*/ 
				toastr.error(jsonResponse.message); // Show error message
			}
		},


		  error: function (xhr, status, error) {
			 /** Handle  errors **/
			if (xhr.status === 422) {
				var errors = xhr.responseJSON.errors;
				$.each(errors, function(key, value) {
					toastr.error(value[0]); 
				});
			}
		  }
		});
	  });
    
    	/** Handle edit button click**/
        $('#datatable tbody').on('click', '.edit-btn', function () {
    		
        var id = $(this).data('id');
        var url = "include/works_backend.php?edit_data=true&id=" + id;
          $.ajax({
            type: 'GET',
            url: url,
              success: function (response) {
                const jsonResponse = JSON.parse(response);
                  if (jsonResponse.success) {
                    $('#editModal').modal('show');
                    $('#editModal input[name="id"]').val(jsonResponse.data.id);
                    $('#editModal input[name="name"]').val(jsonResponse.data.name);
                    $('#editModal input[name="email"]').val(jsonResponse.data.email);
                    $('#editModal input[name="phone"]').val(jsonResponse.data.phone);
                    $('#editModal select[name="group_id"]').val(jsonResponse.data.group_id);
                  } else {
                      toastr.error("Error fetching data for edit: " + jsonResponse.message);
                  }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                toastr.error("Error fetching data for edit!");
              }
          });
        });
	
	
    	/** Update The data from the database table **/
    	  $('#editModal form').submit(function(e){
    		e.preventDefault();

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();

    		/*Get the submit button*/
    		var submitBtn = form.find('button[type="submit"]');

    		/*Save the original button text*/
    		var originalBtnText = submitBtn.html();

    		/*Change button text to loading state*/
    		  

    		var form = $(this);
    		var url = form.attr('action');
    		var formData = form.serialize();
    		/** Use Ajax to send the delete request **/
    		$.ajax({
    		  type:'POST',
    		  'url':url,
    		  data: formData,
    		  beforeSend: function () {
    			form.find(':input').prop('disabled', true);
    		  },
    		  success: function (response) {
                const jsonResponse = JSON.parse(response);
    			if (jsonResponse.success) {
    				toastr.success(jsonResponse.message);
                    $('#editModal').modal('hide');
                    $('#editModal form')[0].reset();
    				/*Reload the page after a short delay*/ 
    				setTimeout(() => {
    					location.reload();
    				}, 500);
    			}
    		  },

    		  error: function (xhr, status, error) {
    			if (xhr.status === 422) {
    				var errors = xhr.responseJSON.errors;
    				$.each(errors, function(key, value) {
    					toastr.error(value[0]);
    				});
    			} else {
    				toastr.error("An error occurred. Please try again.");
    			}
    		  },
    	  });
    	});


        /** Handle form submission for delete **/
      $('#DeleteModal form').submit(function(e){
        e.preventDefault();
        /*Get the submit button*/
        var submitBtn =  $('#DeleteModal form').find('button[type="submit"]');

        /* Save the original button text*/
        var originalBtnText = submitBtn.html();

        /*Change button text to loading state*/
        submitBtn.html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>`);

        var form = $(this);
        var url = form.attr('action');
        var formData = form.serialize();
        /** Use Ajax to send the delete request **/
        $.ajax({
          type:'POST',
          'url':url,
          data: formData,
          success: function (response) {
            if (response.success) {
              $('#DeleteModal').modal('hide');
              toastr.success(response.message);
             
            }
          },

          error: function (xhr, status, error) {
             /** Handle  errors **/
             toastr.error(xhr.responseText);
          },
          complete: function () {
            submitBtn.html(originalBtnText);
            }
        });
      });
    });
    </script>

    </body>
</html>
